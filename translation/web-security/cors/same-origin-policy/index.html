<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Same-origin policy (SOP) - 凌虚 Blog</title><meta name=Description content="Same-origin policy (SOP)"><meta property="og:title" content="Same-origin policy (SOP)"><meta property="og:description" content="Same-origin policy (SOP)"><meta property="og:type" content="article"><meta property="og:url" content="https://rifewang.github.io/translation/web-security/cors/same-origin-policy/"><meta property="og:image" content="https://rifewang.github.io/images/avatar.png"><meta property="article:section" content="translation"><meta property="article:published_time" content="2021-02-28T00:00:00+08:00"><meta property="article:modified_time" content="2023-02-21T11:33:46+08:00"><meta property="og:site_name" content="凌虚 Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://rifewang.github.io/images/avatar.png"><meta name=twitter:title content="Same-origin policy (SOP)"><meta name=twitter:description content="Same-origin policy (SOP)"><meta name=application-name content="凌虚的博客"><meta name=apple-mobile-web-app-title content="凌虚的博客"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel=canonical href=https://rifewang.github.io/translation/web-security/cors/same-origin-policy/><link rel=next href=https://rifewang.github.io/translation/web-security/cors/access-control-allow-origin/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Same-origin policy (SOP)","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/rifewang.github.io\/translation\/web-security\/cors\/same-origin-policy\/"},"image":["https:\/\/rifewang.github.io\/images\/avatar.png"],"genre":"translation","wordcount":1036,"url":"https:\/\/rifewang.github.io\/translation\/web-security\/cors\/same-origin-policy\/","datePublished":"2021-02-28T00:00:00+08:00","dateModified":"2023-02-21T11:33:46+08:00","license":"Attribution-NonCommercial 4.0 International (CC BY-NC 4.0)","publisher":{"@type":"Organization","name":"凌虚","logo":"https:\/\/rifewang.github.io\/images\/avatar.png"},"author":{"@type":"Person","name":"凌虚"},"description":"Same-origin policy (SOP)"}</script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-VRMQFEVL7J"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VRMQFEVL7J")</script><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"light"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"light"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="凌虚 Blog">凌虚的博客</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/about/>关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="凌虚 Blog">凌虚的博客</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/about/ title>关于</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class="page single special"><h1 class="single-title animate__animated animate__pulse animate__faster">Same-origin policy (SOP)</h1><div class=content id=content><h1 id=same-origin-policy-sop---同源策略>Same-origin policy (SOP) - 同源策略</h1><p>在本节中，我们将解释什么是同源策略以及它是如何实现的。</p><h2 id=什么是同源策略>什么是同源策略？</h2><p>同源策略是一种旨在防止网站互相攻击的 web 浏览器的安全机制。</p><p>同源策略限制一个源上的脚本访问另一个源的数据。</p><p>Origin 源由三个部分组成：<code>schema</code>、<code>domain</code>、<code>port</code> ，所谓的同源就是要求这三个部分全部相同。 例如下面这个 URL：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>http://normal-website.com/example/example.html
</span></span></code></pre></td></tr></table></div></div><p>其 <code>schema</code> 是 http，<code>domain</code> 是 <code>normal-website.com</code>，<code>port</code> 是 80 。下表显示了如果上述 URL 中的内容尝试访问其它源将会是什么情况：</p><table><thead><tr><th style=text-align:left>访问的 URL</th><th style=text-align:left>是否可以访问</th></tr></thead><tbody><tr><td style=text-align:left><code>http://normal-website.com/example/</code></td><td style=text-align:left>是，同源</td></tr><tr><td style=text-align:left><code>http://normal-website.com/example2/</code></td><td style=text-align:left>是，同源</td></tr><tr><td style=text-align:left><code>https://normal-website.com/example/</code></td><td style=text-align:left>否: scheme 和 port 都不同</td></tr><tr><td style=text-align:left><code>http://en.normal-website.com/example/</code></td><td style=text-align:left>否: domain 不同</td></tr><tr><td style=text-align:left><code>http://www.normal-website.com/example/</code></td><td style=text-align:left>否: domain 不同</td></tr><tr><td style=text-align:left><code>http://normal-website.com:8080/example/</code></td><td style=text-align:left>否: port 不同*</td></tr></tbody></table><p>*IE 浏览器将会允许访问，因为 IE 浏览器在应用同源策略时不考虑端口号。</p><h2 id=为什么同源策略是必要的>为什么同源策略是必要的？</h2><p>当浏览器从一个源发送 HTTP 请求到另一个源时，与另一个源相关的任何 cookie （包括身份验证会话cookie）也将会作为请求的一部分一起发送。这意味着响应将在用户会话中返回，并包含此特定用户的相关数据。如果没有同源策略，如果你访问了一个恶意网站，它将能够读取你 GMail 中的电子邮件、Facebook 上的私人消息等。</p><h2 id=同源策略是如何实施的>同源策略是如何实施的？</h2><p>同源策略通常控制 JavaScript 代码对跨域加载的内容的访问。通常允许页面资源的跨域加载。例如，同源策略允许通过 <code>&lt;img></code> 标签嵌入图像，通过 <code>&lt;video></code> 标签嵌入媒体、以及通过 <code>&lt;script></code> 标签嵌入 JavaScript 。但是，页面只能加载这些外部资源，页面上的任何 JavaScript 都无法读取这些资源的内容。</p><p>同源策略也有一些例外：</p><ul><li>有些对象跨域可写入但不可读，例如 <code>location</code> 对象，或者来自 iframes 或新窗口的 <code>location.href</code> 属性。</li><li>有些对象跨域可读但不可写，例如 <code>window</code> 对象的 <code>length</code> 属性和 <code>closed</code> 属性。</li><li>在 <code>location</code> 对象上可以跨域调用 <code>replace</code> 函数。</li><li>你可以跨域调用某些函数。例如，你可以在一个新窗口上调用 <code>close</code>、<code>blur</code>、<code>focus</code> 函数。也可以在 iframes 和新窗口上 <code>postMessage</code> 函数以将消息从一个域发送到另一个域。</li></ul><p>由于历史遗留，在处理 cookie 时，同源策略更为宽松，通常可以从站点的所有子域访问它们，即使每个子域并不满足同源的要求。你可以使用 <code>HttpOnly</code> 一定程度缓解这个风险。</p><p>使用 <code>document.domain</code> 可以放宽同源策略，这个特殊属性允许放宽特定域的同源策略，但前提是它是 FQDN（fully qualified domain name）的一部分。例如，你有一个域名 <code>marketing.example.com</code>，并且你想读取 <code>example.com</code> 域的内容。为此，两个域都需要设置 <code>document.domain</code> 为 <code>example.com</code>，那么同源策略将会允许这里两个域之间的访问，尽管它们并不同源。在过去，你可以将 <code>document.domain</code> 设置为顶级域名如 <code>com</code>，以允许同一个顶级域名上的任何域之间的访问，但是现代浏览器已经不允许这么做了。</p></div></div></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2017 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>凌虚</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/katex/katex.min.css><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js></script><script type=text/javascript src=/lib/katex/contrib/auto-render.min.js></script><script type=text/javascript src=/lib/katex/contrib/copy-tex.min.js></script><script type=text/javascript src=/lib/katex/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:50,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>