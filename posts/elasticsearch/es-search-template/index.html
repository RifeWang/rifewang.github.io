<!doctype html><html lang=en><head><title>Elasticsearch Search Template · 凌虚 Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="凌虚"><meta name=description content="Elasticsearch Search Template"><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Elasticsearch Search Template"><meta name=twitter:description content="Elasticsearch Search Template"><meta property="og:title" content="Elasticsearch Search Template"><meta property="og:description" content="Elasticsearch Search Template"><meta property="og:type" content="article"><meta property="og:url" content="https://rifewang.github.io/posts/elasticsearch/es-search-template/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-11-16T00:00:00+08:00"><meta property="article:modified_time" content="2020-11-16T00:00:00+08:00"><link rel=canonical href=https://rifewang.github.io/posts/elasticsearch/es-search-template/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.0fa2dc75ed1b76894ac0e062b10a6c4730daa745096fa120114b290ed8a48788.css integrity="sha256-D6Lcde0bdolKwOBisQpsRzDap0UJb6EgEUspDtikh4g=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.593028e7f7ac55c003b79c230d1cd411bb4ca53b31556c3abb7f027170e646e9.css integrity="sha256-WTAo5/esVcADt5wjDRzUEbtMpTsxVWw6u38CcXDmRuk=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5><meta name=generator content="Hugo 0.110.0"></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>凌虚 Blog</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=/about/>About</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://rifewang.github.io/posts/elasticsearch/es-search-template/>Elasticsearch Search Template</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2020-11-16T00:00:00+08:00>November 16, 2020</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
6-minute read</span></div><div class=categories><i class="fa fa-folder" aria-hidden=true></i>
<a href=/categories/elasticsearch/>Elasticsearch</a></div></div></header><div class=post-content><h1 id=elasticsearch-search-template>Elasticsearch Search Template
<a class=heading-link href=#elasticsearch-search-template><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>所谓 search template 搜索模板其实就是：</p><ol><li>预先定义好查询语句 DSL 的结构并预留参数</li><li>搜索的时再传入参数值</li><li>渲染出完整的 DSL ，最后进行搜索</li></ol><p>使用搜索模板可以将 DSL 从应用程序中解耦出来，并且可以更加灵活的更改查询语句。</p><p>例如：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>GET _search/template
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;source&#34; : {
</span></span><span style=display:flex><span>    &#34;query&#34;: {
</span></span><span style=display:flex><span>      &#34;match&#34; : {
</span></span><span style=display:flex><span>        &#34;{{my_field}}&#34; : &#34;{{my_value}}&#34;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  &#34;params&#34; : {
</span></span><span style=display:flex><span>    &#34;my_field&#34; : &#34;message&#34;,
</span></span><span style=display:flex><span>    &#34;my_value&#34; : &#34;foo&#34;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>构造出来的 DSL 就是：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;query&#34;: {
</span></span><span style=display:flex><span>    &#34;match&#34;: {
</span></span><span style=display:flex><span>      &#34;message&#34;: &#34;foo&#34;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>在模板中通过 <code>{{ }}</code> 的方式预留参数，然后查询时再指定对应的参数值，最后填充成具体的查询语句进行搜索。</p><hr><h2 id=搜索模板-api>搜索模板 API
<a class=heading-link href=#%e6%90%9c%e7%b4%a2%e6%a8%a1%e6%9d%bf-api><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>为了实现搜索模板和查询分离，我们首先需要单独保存和管理搜索模板。</p><h4 id=保存搜索模板>保存搜索模板
<a class=heading-link href=#%e4%bf%9d%e5%ad%98%e6%90%9c%e7%b4%a2%e6%a8%a1%e6%9d%bf><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><p>使用 scripts API 保存搜索模板（不存在则创建，存在则覆盖）。示例：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>POST _scripts/&lt;templateid&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;script&#34;: {
</span></span><span style=display:flex><span>    &#34;lang&#34;: &#34;mustache&#34;,
</span></span><span style=display:flex><span>    &#34;source&#34;: {
</span></span><span style=display:flex><span>      &#34;query&#34;: {
</span></span><span style=display:flex><span>        &#34;match&#34;: {
</span></span><span style=display:flex><span>          &#34;title&#34;: &#34;{{query_string}}&#34;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=查询搜索模板>查询搜索模板
<a class=heading-link href=#%e6%9f%a5%e8%af%a2%e6%90%9c%e7%b4%a2%e6%a8%a1%e6%9d%bf><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>GET _scripts/&lt;templateid&gt;
</span></span></code></pre></div><h4 id=删除搜索模板>删除搜索模板
<a class=heading-link href=#%e5%88%a0%e9%99%a4%e6%90%9c%e7%b4%a2%e6%a8%a1%e6%9d%bf><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>DELETE _scripts/&lt;templateid&gt;
</span></span></code></pre></div><h4 id=使用搜索模板>使用搜索模板
<a class=heading-link href=#%e4%bd%bf%e7%94%a8%e6%90%9c%e7%b4%a2%e6%a8%a1%e6%9d%bf><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><p>示例：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>GET _search/template
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;id&#34;: &#34;&lt;templateid&gt;&#34;,
</span></span><span style=display:flex><span>  &#34;params&#34;: {
</span></span><span style=display:flex><span>    &#34;query_string&#34;: &#34;search words&#34;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>params</code> 中的参数与搜索模板中定义的一致，上文保存搜索模板的示例是 <code>{{query_string}}</code>，所以这里进行搜索时对应的参数就是 <code>query_string</code> 。</p><h4 id=检验搜索模板>检验搜索模板
<a class=heading-link href=#%e6%a3%80%e9%aa%8c%e6%90%9c%e7%b4%a2%e6%a8%a1%e6%9d%bf><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><p>有时候我们想看看搜索模板输入了参数之后渲染成的 DSL 到底长啥样。</p><p>示例：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>GET _render/template
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;source&#34;: &#34;{ \&#34;query\&#34;: { \&#34;terms\&#34;: {{#toJson}}statuses{{/toJson}} }}&#34;,
</span></span><span style=display:flex><span>  &#34;params&#34;: {
</span></span><span style=display:flex><span>    &#34;statuses&#34; : {
</span></span><span style=display:flex><span>        &#34;status&#34;: [ &#34;pending&#34;, &#34;published&#34; ]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>返回的结果就是：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;template_output&#34;: {
</span></span><span style=display:flex><span>    &#34;query&#34;: {
</span></span><span style=display:flex><span>      &#34;terms&#34;: {
</span></span><span style=display:flex><span>        &#34;status&#34;: [
</span></span><span style=display:flex><span>          &#34;pending&#34;,
</span></span><span style=display:flex><span>          &#34;published&#34;
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>{{#toJson}} {{/toJson}}</code> 就是转换成 json 格式。</p><p>已经保存的搜索模板可以通过以下方式查看渲染结果：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>GET _render/template/&lt;template_name&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;params&#34;: {
</span></span><span style=display:flex><span>    &#34;...&#34;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=使用-explain-和-profile-参数>使用 <code>explain</code> 和 <code>profile</code> 参数
<a class=heading-link href=#%e4%bd%bf%e7%94%a8-explain-%e5%92%8c-profile-%e5%8f%82%e6%95%b0><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><p>示例：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>GET _search/template
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;id&#34;: &#34;my_template&#34;,
</span></span><span style=display:flex><span>  &#34;params&#34;: {
</span></span><span style=display:flex><span>    &#34;status&#34;: [ &#34;pending&#34;, &#34;published&#34; ]
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  &#34;explain&#34;: true
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>GET _search/template
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;id&#34;: &#34;my_template&#34;,
</span></span><span style=display:flex><span>  &#34;params&#34;: {
</span></span><span style=display:flex><span>    &#34;status&#34;: [ &#34;pending&#34;, &#34;published&#34; ]
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  &#34;profile&#34;: true
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=模板渲染>模板渲染
<a class=heading-link href=#%e6%a8%a1%e6%9d%bf%e6%b8%b2%e6%9f%93><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><h4 id=填充简单值>填充简单值
<a class=heading-link href=#%e5%a1%ab%e5%85%85%e7%ae%80%e5%8d%95%e5%80%bc><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>GET _search/template
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;source&#34;: {
</span></span><span style=display:flex><span>    &#34;query&#34;: {
</span></span><span style=display:flex><span>      &#34;term&#34;: {
</span></span><span style=display:flex><span>        &#34;message&#34;: &#34;{{query_string}}&#34;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  &#34;params&#34;: {
</span></span><span style=display:flex><span>    &#34;query_string&#34;: &#34;search words&#34;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>渲染出来的 DSL 就是：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;query&#34;: {
</span></span><span style=display:flex><span>    &#34;term&#34;: {
</span></span><span style=display:flex><span>      &#34;message&#34;: &#34;search words&#34;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=将参数转换为-json>将参数转换为 JSON
<a class=heading-link href=#%e5%b0%86%e5%8f%82%e6%95%b0%e8%bd%ac%e6%8d%a2%e4%b8%ba-json><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><p>使用 <code>{{#toJson}}parameter{{/toJson}}</code> 会将参数转换为 JSON。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>GET _search/template
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;source&#34;: &#34;{ \&#34;query\&#34;: { \&#34;terms\&#34;: {{#toJson}}statuses{{/toJson}} }}&#34;,
</span></span><span style=display:flex><span>  &#34;params&#34;: {
</span></span><span style=display:flex><span>    &#34;statuses&#34; : {
</span></span><span style=display:flex><span>        &#34;status&#34;: [ &#34;pending&#34;, &#34;published&#34; ]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>渲染出来的 DSL 就是：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;query&#34;: {
</span></span><span style=display:flex><span>    &#34;terms&#34;: {
</span></span><span style=display:flex><span>      &#34;status&#34;: [
</span></span><span style=display:flex><span>        &#34;pending&#34;,
</span></span><span style=display:flex><span>        &#34;published&#34;
</span></span><span style=display:flex><span>      ]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>对象数组的渲染示例：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>GET _search/template
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;source&#34;: &#34;{\&#34;query\&#34;:{\&#34;bool\&#34;:{\&#34;must\&#34;: {{#toJson}}clauses{{/toJson}} }}}&#34;,
</span></span><span style=display:flex><span>  &#34;params&#34;: {
</span></span><span style=display:flex><span>    &#34;clauses&#34;: [
</span></span><span style=display:flex><span>      { &#34;term&#34;: { &#34;user&#34; : &#34;foo&#34; } },
</span></span><span style=display:flex><span>      { &#34;term&#34;: { &#34;user&#34; : &#34;bar&#34; } }
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>渲染结果就是：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;query&#34;: {
</span></span><span style=display:flex><span>    &#34;bool&#34;: {
</span></span><span style=display:flex><span>      &#34;must&#34;: [
</span></span><span style=display:flex><span>        { &#34;term&#34;: { &#34;user&#34; : &#34;foo&#34; } },
</span></span><span style=display:flex><span>        { &#34;term&#34;: { &#34;user&#34; : &#34;bar&#34; } }
</span></span><span style=display:flex><span>      ]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=将数组-join-成字符串>将数组 join 成字符串
<a class=heading-link href=#%e5%b0%86%e6%95%b0%e7%bb%84-join-%e6%88%90%e5%ad%97%e7%ac%a6%e4%b8%b2><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><p>使用 <code>{{#join}}array{{/join}}</code> 可以将数组 join 成字符串。</p><p>示例：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>GET _search/template
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;source&#34;: {
</span></span><span style=display:flex><span>    &#34;query&#34;: {
</span></span><span style=display:flex><span>      &#34;match&#34;: {
</span></span><span style=display:flex><span>        &#34;emails&#34;: &#34;{{#join}}emails{{/join}}&#34;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  &#34;params&#34;: {
</span></span><span style=display:flex><span>    &#34;emails&#34;: [ &#34;aaa&#34;, &#34;bbb&#34; ]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>渲染结果：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;query&#34; : {
</span></span><span style=display:flex><span>    &#34;match&#34; : {
</span></span><span style=display:flex><span>      &#34;emails&#34; : &#34;aaa,bbb&#34;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>除了默认以 <code>,</code> 分隔外，还可以自定义分隔符，示例：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;source&#34;: {
</span></span><span style=display:flex><span>    &#34;query&#34;: {
</span></span><span style=display:flex><span>      &#34;range&#34;: {
</span></span><span style=display:flex><span>        &#34;born&#34;: {
</span></span><span style=display:flex><span>          &#34;gte&#34;: &#34;{{date.min}}&#34;,
</span></span><span style=display:flex><span>          &#34;lte&#34;: &#34;{{date.max}}&#34;,
</span></span><span style=display:flex><span>          &#34;format&#34;: &#34;{{#join delimiter=&#39;||&#39;}}date.formats{{/join delimiter=&#39;||&#39;}}&#34;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  &#34;params&#34;: {
</span></span><span style=display:flex><span>    &#34;date&#34;: {
</span></span><span style=display:flex><span>      &#34;min&#34;: &#34;2016&#34;,
</span></span><span style=display:flex><span>      &#34;max&#34;: &#34;31/12/2017&#34;,
</span></span><span style=display:flex><span>      &#34;formats&#34;: [ &#34;dd/MM/yyyy&#34;, &#34;yyyy&#34; ]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>例子中的 <code>{{#join delimiter='||'}} {{/join delimiter='||'}}</code> 意思就是进行 join 操作，分隔符设置为 <code>||</code> ，渲染结果就是：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;query&#34;: {
</span></span><span style=display:flex><span>    &#34;range&#34;: {
</span></span><span style=display:flex><span>      &#34;born&#34;: {
</span></span><span style=display:flex><span>        &#34;gte&#34;: &#34;2016&#34;,
</span></span><span style=display:flex><span>        &#34;lte&#34;: &#34;31/12/2017&#34;,
</span></span><span style=display:flex><span>        &#34;format&#34;: &#34;dd/MM/yyyy||yyyy&#34;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=默认值>默认值
<a class=heading-link href=#%e9%bb%98%e8%ae%a4%e5%80%bc><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><p>使用 <code>{{var}}{{^var}}default{{/var}}</code> 的方式设置默认值。</p><p>示例：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;source&#34;: {
</span></span><span style=display:flex><span>    &#34;query&#34;: {
</span></span><span style=display:flex><span>      &#34;range&#34;: {
</span></span><span style=display:flex><span>        &#34;line_no&#34;: {
</span></span><span style=display:flex><span>          &#34;gte&#34;: &#34;{{start}}&#34;,
</span></span><span style=display:flex><span>          &#34;lte&#34;: &#34;{{end}}{{^end}}20{{/end}}&#34;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  &#34;params&#34;: { ... }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>{{end}}{{^end}}20{{/end}}</code> 就是给 <code>end</code> 设置了默认值为 20 。</p><p>当 <code>params</code> 是 <code>{ "start": 10, "end": 15 }</code> 时，渲染结果是：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;range&#34;: {
</span></span><span style=display:flex><span>    &#34;line_no&#34;: {
</span></span><span style=display:flex><span>      &#34;gte&#34;: &#34;10&#34;,
</span></span><span style=display:flex><span>      &#34;lte&#34;: &#34;15&#34;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>当 <code>params</code> 是 <code>{ "start": 10 }</code> 时，end 就会使用默认值，渲染结果就是：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;range&#34;: {
</span></span><span style=display:flex><span>    &#34;line_no&#34;: {
</span></span><span style=display:flex><span>      &#34;gte&#34;: &#34;10&#34;,
</span></span><span style=display:flex><span>      &#34;lte&#34;: &#34;20&#34;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=条件子句>条件子句
<a class=heading-link href=#%e6%9d%a1%e4%bb%b6%e5%ad%90%e5%8f%a5><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><p>有时候我们的参数是可选的，这时候就可以使用 <code>{{#key}} {{/key}}</code>的语法。</p><p>示例，假设参数 <code>line_no</code>, <code>start</code>, <code>end</code> 都是可选的，使用 <code>{{#key}} {{/key}}</code> 形如：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;query&#34;: {
</span></span><span style=display:flex><span>    &#34;bool&#34;: {
</span></span><span style=display:flex><span>      &#34;must&#34;: {
</span></span><span style=display:flex><span>        &#34;match&#34;: {
</span></span><span style=display:flex><span>          &#34;line&#34;: &#34;{{text}}&#34;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      &#34;filter&#34;: {
</span></span><span style=display:flex><span>        {{#line_no}}
</span></span><span style=display:flex><span>          &#34;range&#34;: {
</span></span><span style=display:flex><span>            &#34;line_no&#34;: {
</span></span><span style=display:flex><span>              {{#start}}
</span></span><span style=display:flex><span>                &#34;gte&#34;: &#34;{{start}}&#34;
</span></span><span style=display:flex><span>                {{#end}},{{/end}}
</span></span><span style=display:flex><span>              {{/start}}
</span></span><span style=display:flex><span>              {{#end}}
</span></span><span style=display:flex><span>                &#34;lte&#34;: &#34;{{end}}&#34;
</span></span><span style=display:flex><span>              {{/end}}
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        {{/line_no}}
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>1、 当参数为：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;params&#34;: {
</span></span><span style=display:flex><span>    &#34;text&#34;: &#34;words to search for&#34;,
</span></span><span style=display:flex><span>    &#34;line_no&#34;: {
</span></span><span style=display:flex><span>      &#34;start&#34;: 10,
</span></span><span style=display:flex><span>      &#34;end&#34;: 20
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>渲染结果是：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;query&#34;: {
</span></span><span style=display:flex><span>    &#34;bool&#34;: {
</span></span><span style=display:flex><span>      &#34;must&#34;: {
</span></span><span style=display:flex><span>        &#34;match&#34;: {
</span></span><span style=display:flex><span>          &#34;line&#34;: &#34;words to search for&#34;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      &#34;filter&#34;: {
</span></span><span style=display:flex><span>        &#34;range&#34;: {
</span></span><span style=display:flex><span>          &#34;line_no&#34;: {
</span></span><span style=display:flex><span>            &#34;gte&#34;: &#34;10&#34;,
</span></span><span style=display:flex><span>            &#34;lte&#34;: &#34;20&#34;
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>2、 当参数为：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;params&#34;: {
</span></span><span style=display:flex><span>    &#34;text&#34;: &#34;words to search for&#34;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>渲染结果为：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;query&#34;: {
</span></span><span style=display:flex><span>    &#34;bool&#34;: {
</span></span><span style=display:flex><span>      &#34;must&#34;: {
</span></span><span style=display:flex><span>        &#34;match&#34;: {
</span></span><span style=display:flex><span>          &#34;line&#34;: &#34;words to search for&#34;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      &#34;filter&#34;: {}
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>3、当参数为：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;params&#34;: {
</span></span><span style=display:flex><span>    &#34;text&#34;: &#34;words to search for&#34;,
</span></span><span style=display:flex><span>    &#34;line_no&#34;: {
</span></span><span style=display:flex><span>      &#34;start&#34;: 10
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>渲染结果为：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;query&#34;: {
</span></span><span style=display:flex><span>    &#34;bool&#34;: {
</span></span><span style=display:flex><span>      &#34;must&#34;: {
</span></span><span style=display:flex><span>        &#34;match&#34;: {
</span></span><span style=display:flex><span>          &#34;line&#34;: &#34;words to search for&#34;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      &#34;filter&#34;: {
</span></span><span style=display:flex><span>        &#34;range&#34;: {
</span></span><span style=display:flex><span>          &#34;line_no&#34;: {
</span></span><span style=display:flex><span>            &#34;gte&#34;: 10
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>4、当参数为：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;params&#34;: {
</span></span><span style=display:flex><span>    &#34;text&#34;: &#34;words to search for&#34;,
</span></span><span style=display:flex><span>    &#34;line_no&#34;: {
</span></span><span style=display:flex><span>      &#34;end&#34;: 20
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>渲染结果为：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;query&#34;: {
</span></span><span style=display:flex><span>    &#34;bool&#34;: {
</span></span><span style=display:flex><span>      &#34;must&#34;: {
</span></span><span style=display:flex><span>        &#34;match&#34;: {
</span></span><span style=display:flex><span>          &#34;line&#34;: &#34;words to search for&#34;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      &#34;filter&#34;: {
</span></span><span style=display:flex><span>        &#34;range&#34;: {
</span></span><span style=display:flex><span>          &#34;line_no&#34;: {
</span></span><span style=display:flex><span>            &#34;lte&#34;: 20
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>需要注意的是在 JSON 对象中，</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;filter&#34;: {
</span></span><span style=display:flex><span>    {{#line_no}}
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>    {{/line_no}}
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>这样直接写 <code>{{#line_no}}</code> 肯定是非法的JSON格式，你必须转换为 JSON 字符串。</p><h4 id=urls-编码>URLs 编码
<a class=heading-link href=#urls-%e7%bc%96%e7%a0%81><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><p>使用 <code>{{#url}}value{{/url}}</code> 的方式可以进行 HTML 编码转义。</p><p>示例：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>GET _render/template
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;source&#34;: {
</span></span><span style=display:flex><span>    &#34;query&#34;: {
</span></span><span style=display:flex><span>      &#34;term&#34;: {
</span></span><span style=display:flex><span>        &#34;http_access_log&#34;: &#34;{{#url}}{{host}}/{{page}}{{/url}}&#34;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  &#34;params&#34;: {
</span></span><span style=display:flex><span>    &#34;host&#34;: &#34;https://www.elastic.co/&#34;,
</span></span><span style=display:flex><span>    &#34;page&#34;: &#34;learn&#34;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>渲染结果：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;template_output&#34;: {
</span></span><span style=display:flex><span>    &#34;query&#34;: {
</span></span><span style=display:flex><span>      &#34;term&#34;: {
</span></span><span style=display:flex><span>        &#34;http_access_log&#34;: &#34;https%3A%2F%2Fwww.elastic.co%2F%2Flearn&#34;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><h2 id=mustache-基本语法>Mustache 基本语法
<a class=heading-link href=#mustache-%e5%9f%ba%e6%9c%ac%e8%af%ad%e6%b3%95><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>上文中的 <code>{{ }}</code> 语法其实就是 <a href=https://mustache.github.io/mustache.5.html>mustache language</a> ，补充介绍下基本的语法规则。</p><h4 id=使用-key>使用 <code>{{key}}</code>
<a class=heading-link href=#%e4%bd%bf%e7%94%a8-key><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><p>模板：<code>Hello {{name}}</code></p><p>输入：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>    &#34;name&#34;: &#34;Chris&#34;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>输出：<code>Hello Chris</code></p><h4 id=使用-key-避免转义>使用 <code>{{{key}}}</code> 避免转义
<a class=heading-link href=#%e4%bd%bf%e7%94%a8-key-%e9%81%bf%e5%85%8d%e8%bd%ac%e4%b9%89><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><p>所有变量都会默认进行 HTML 转义。</p><p>模板：<code>{{company}}</code></p><p>输入：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>    &#34;company&#34;: &#34;&lt;b&gt;GitHub&lt;/b&gt;&#34;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>输出：<code>&amp;lt;b&amp;gt;GitHub&amp;lt;/b&amp;gt;</code></p><p>使用 <code>{{{ }}}</code> 避免转义。</p><p>模板：<code>{{{company}}}</code></p><p>输入：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>    &#34;company&#34;: &#34;&lt;b&gt;GitHub&lt;/b&gt;&#34;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>输出：<code>&lt;b>GitHub&lt;/b></code></p><h4 id=使用-key--key-构造区块>使用 <code>{{#key}} {{/key}}</code> 构造区块
<a class=heading-link href=#%e4%bd%bf%e7%94%a8-key--key-%e6%9e%84%e9%80%a0%e5%8c%ba%e5%9d%97><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><p>1、 当 key 是 false 或者空列表将会忽略
模板：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>    Shown.
</span></span><span style=display:flex><span>    {{#person}}
</span></span><span style=display:flex><span>        Never shown!
</span></span><span style=display:flex><span>    {{/person}}
</span></span></code></pre></div><p>输入：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>    &#34;person&#34;: false
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>输出：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>    Shown.
</span></span></code></pre></div><p>2、 当 key 非空值则渲染填充
模板：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>    {{#repo}}
</span></span><span style=display:flex><span>        &lt;b&gt;{{name}}&lt;/b&gt;
</span></span><span style=display:flex><span>    {{/repo}}
</span></span></code></pre></div><p>输入：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>    &#34;repo&#34;: [
</span></span><span style=display:flex><span>        { &#34;name&#34;: &#34;resque&#34; },
</span></span><span style=display:flex><span>        { &#34;name&#34;: &#34;hub&#34; },
</span></span><span style=display:flex><span>        { &#34;name&#34;: &#34;rip&#34; }
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>输出：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>    &lt;b&gt;resque&lt;/b&gt;
</span></span><span style=display:flex><span>    &lt;b&gt;hub&lt;/b&gt;
</span></span><span style=display:flex><span>    &lt;b&gt;rip&lt;/b&gt;
</span></span></code></pre></div><p>3、当 key 是函数则调用后渲染
模板：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>    {{#wrapped}}
</span></span><span style=display:flex><span>        {{name}} is awesome.
</span></span><span style=display:flex><span>    {{/wrapped}}
</span></span></code></pre></div><p>输入：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>    &#34;name&#34;: &#34;Willy&#34;,
</span></span><span style=display:flex><span>    &#34;wrapped&#34;: function() {
</span></span><span style=display:flex><span>        return function(text, render) {
</span></span><span style=display:flex><span>            return &#34;&lt;b&gt;&#34; + render(text) + &#34;&lt;/b&gt;&#34;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>输出：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>    &lt;b&gt;Willy is awesome.&lt;/b&gt;
</span></span></code></pre></div><p>4、当 key 是非 false 且非列表
模板：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>    {{#person?}}
</span></span><span style=display:flex><span>        Hi {{name}}!
</span></span><span style=display:flex><span>    {{/person?}}
</span></span></code></pre></div><p>输入：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>    &#34;person?&#34;: { &#34;name&#34;: &#34;Jon&#34; }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>输出：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>    Hi Jon!
</span></span></code></pre></div><h4 id=使用-key--key-构造反区块>使用 <code>{{^key}} {{/key}}</code> 构造反区块
<a class=heading-link href=#%e4%bd%bf%e7%94%a8-key--key-%e6%9e%84%e9%80%a0%e5%8f%8d%e5%8c%ba%e5%9d%97><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><p><code>{{^key}} {{/key}}</code> 的语法与 <code>{{#key}} {{/key}}</code> 类似，不同的是，当 key 不存在，或者是 false ，又或者是空列表时才渲染输出区块内容。</p><p>模板：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>    {{#repo}}
</span></span><span style=display:flex><span>        &lt;b&gt;{{name}}&lt;/b&gt;
</span></span><span style=display:flex><span>    {{/repo}}
</span></span><span style=display:flex><span>    {{^repo}}
</span></span><span style=display:flex><span>        No repos :(
</span></span><span style=display:flex><span>    {{/repo}}
</span></span></code></pre></div><p>输入：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>    &#34;repo&#34;: []
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>输出：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>    No repos :(
</span></span></code></pre></div><h4 id=使用---添加注释>使用 <code>{{! }}</code> 添加注释
<a class=heading-link href=#%e4%bd%bf%e7%94%a8---%e6%b7%bb%e5%8a%a0%e6%b3%a8%e9%87%8a><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><p><code>{{! }}</code> 注释内容将会被忽略。</p><p>模板：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>&lt;h1&gt;Today{{! ignore me }}.&lt;/h1&gt;
</span></span></code></pre></div><p>输出：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>&lt;h1&gt;Today.&lt;/h1&gt;
</span></span></code></pre></div><h4 id=使用---子模块>使用 <code>{{> }}</code> 子模块
<a class=heading-link href=#%e4%bd%bf%e7%94%a8---%e5%ad%90%e6%a8%a1%e5%9d%97><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><p>模板：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>base.mustache:
</span></span><span style=display:flex><span>&lt;h2&gt;Names&lt;/h2&gt;
</span></span><span style=display:flex><span>{{#names}}
</span></span><span style=display:flex><span>    {{&gt; user}}
</span></span><span style=display:flex><span>{{/names}}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>user.mustache:
</span></span><span style=display:flex><span>&lt;strong&gt;{{name}}&lt;/strong&gt;
</span></span></code></pre></div><p>其实也就等价于：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>&lt;h2&gt;Names&lt;/h2&gt;
</span></span><span style=display:flex><span>{{#names}}
</span></span><span style=display:flex><span>    &lt;strong&gt;{{name}}&lt;/strong&gt;
</span></span><span style=display:flex><span>{{/names}}
</span></span></code></pre></div><h4 id=使用----自定义定界符>使用 <code>{{= =}}</code> 自定义定界符
<a class=heading-link href=#%e4%bd%bf%e7%94%a8----%e8%87%aa%e5%ae%9a%e4%b9%89%e5%ae%9a%e7%95%8c%e7%ac%a6><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><p>有时候我们需要改变默认的定界符 <code>{{ }}</code> ，那么就可以使用 <code>{{= =}}</code> 的方式自定义定界符。</p><p>例如：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{{=&lt;% %&gt;=}}
</span></span></code></pre></div><p>定界符被定义为了 <code>&lt;% %></code>，这样原先 <code>{{key}}</code> 的使用方式就变成了 <code>&lt;%key%></code>。
再使用：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>&lt;%={{ }}=%&gt;
</span></span></code></pre></div><p>就重新把定界符改回了 <code>{{ }}</code>。</p><p>更多语法详情请查阅官方文档 <a href=https://mustache.github.io/mustache.5.html>mustache language</a> 。</p><h2 id=结语>结语
<a class=heading-link href=#%e7%bb%93%e8%af%ad><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>使用 search template 可以对搜索进行有效的解耦，即应用程序只需要关注搜索参数与返回结果，而不用关注具体使用的 DSL 查询语句，到底使用哪种 DSL 则由搜索模板进行单独管理。</p></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2019 -
2023
凌虚
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>