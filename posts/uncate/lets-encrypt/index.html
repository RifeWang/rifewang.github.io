<!doctype html><html lang=en><head><title>Let's Encrypt 配置 HTTPS 免费泛域名证书 · 凌虚 Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="凌虚"><meta name=description content="Let's Encrypt 配置 HTTPS 免费泛域名证书"><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Let's Encrypt 配置 HTTPS 免费泛域名证书"><meta name=twitter:description content="Let's Encrypt 配置 HTTPS 免费泛域名证书"><meta property="og:title" content="Let's Encrypt 配置 HTTPS 免费泛域名证书"><meta property="og:description" content="Let's Encrypt 配置 HTTPS 免费泛域名证书"><meta property="og:type" content="article"><meta property="og:url" content="https://rifewang.github.io/posts/uncate/lets-encrypt/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-06-27T16:26:45+08:00"><meta property="article:modified_time" content="2019-06-27T16:26:45+08:00"><link rel=canonical href=https://rifewang.github.io/posts/uncate/lets-encrypt/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.0fa2dc75ed1b76894ac0e062b10a6c4730daa745096fa120114b290ed8a48788.css integrity="sha256-D6Lcde0bdolKwOBisQpsRzDap0UJb6EgEUspDtikh4g=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.593028e7f7ac55c003b79c230d1cd411bb4ca53b31556c3abb7f027170e646e9.css integrity="sha256-WTAo5/esVcADt5wjDRzUEbtMpTsxVWw6u38CcXDmRuk=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5><meta name=generator content="Hugo 0.110.0"></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>凌虚 Blog</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/posts/>博客</a></li><li class=navigation-item><a class=navigation-link href=/translation/>译文</a></li><li class=navigation-item><a class=navigation-link href=/about/>关于</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://rifewang.github.io/posts/uncate/lets-encrypt/>Let's Encrypt 配置 HTTPS 免费泛域名证书</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2019-06-27T16:26:45+08:00>June 27, 2019</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
One-minute read</span></div></div></header><div class=post-content><p>想要使用 HTTPS ，你必须先拥有权威 CA（证书签发机构）签发的证书（对于自签名的证书，浏览器是不认账的）。Let&rsquo;s Encrypt 就是一家权威的 CA 证书签发机构，你可以向他申请免费的证书（一般商业证书的价格比较贵）。</p><p>推荐使用 <code>acme.sh</code> 这个工具，申请泛域名证书示例：</p><p>注意：以下示例中，我的二级域名是 rifewang.club （一般你向云服务商购买的都是二级域名），泛域名是 *.x.rifewang.club 。</p><p>1、在系统上安装 acme.sh ，默认安装位置是 <code>~/.acme.sh</code> :</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>curl https://get.acme.sh | sh
</span></span></code></pre></div><p>安装要求系统必须已经安装了 cron , crontab , crontabs , vivie-cron 其中任意一个工具，不然会提示你安装失败，没有的话先安装一个即可。</p><p>注意：以下操作使用的是 DNS manual mode 的方式。</p><p>2、发起 issue 申请获取域名 DNS TXT 记录：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>acme.sh --issue --force --dns -d &lt;二级域名&gt; -d &lt;泛域名&gt; \
</span></span><span style=display:flex><span>   --yes-I-know-dns-manual-mode-enough-go-ahead-please
</span></span></code></pre></div><p>注意：你必须先将 acme.sh 这个可执行文件的路径添加到系统的环境变量 PATH 中，或者直接在可执行文件目录下执行，否则肯定会提示你 acme.sh command not found 。</p><p>&ndash;force 强制 issue ，某些情况下你的域名已经验证成功了就会跳过验证，不会生成新的 TXT 记录，所以这里强制执行一下。</p><p>&ndash;yes-I-know&mldr; 这一堆冗长的东西是必须加的，这里就是想提示你 DNS manual mode 的方式不支持自动续签。</p><p>issue 之后的结果如图所示：</p><p><img src=/images/uncate/lets-encrypt1.jpeg alt></p><p>按照说明你需要分别添加 _acme-challenge.&lt;二级域名> 和 _acme-challenge.&lt;泛域名> 这两个域名的 TXT 类型的域名解析：</p><p><img src=/images/uncate/lets-encrypt2.jpeg alt></p><p>之所以要添加域名解析是为了验证你对此域名的所有权。</p><p>3、等待 DNS TXT 解析生效，同一条解析重复更新需要避免 DNS 缓存的问题。</p><p>4、发起 renew 申请签发并下载证书：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>acme.sh --renew --force --dns -d &lt;二级域名&gt; -d &lt;泛域名&gt; \   --yes-I-know-dns-manual-mode-enough-go-ahead-please
</span></span></code></pre></div><p>示例结果如图所示：</p><p><img src=/images/uncate/lets-encrypt3.jpeg alt></p><p>输出结果除了会告诉你证书签发成功之外，还会在最后说明证书的存放位置，默认是 <code>~/.acme.sh/&lt;二级域名>/</code> 这个目录。</p><p>5、配置你的证书和密钥，对应的就是 <code>fullchain.cer</code> 和 <code>&lt;二级域名>.key</code> 这两个文件的内容。不同的情况下，配置的操作是不同的：比如你是在自己的服务器上直接操作 nginx ，那么将配置路径指向正确的证书和密钥地址即可，而如果你使用的是云服务，那么你可能需要做的是上传证书和密钥文件内容。总之，你已经成功获取了 HTTPS 证书。</p><p>Let&rsquo;s Encrypt 的泛域名证书有效期是三个月，acme.sh 的 DNS manual mode 方式不支持自动续签，你想要续签就必须重新 issue 然后 renew 操作一遍，我之所以这么做是因为权限受限，当然写个定时脚本任务就行了，也不用我手动操作。</p><p>acme.sh 不只一种 mode 方式，其它的方式是有支持自动续签的，并且也接入了主流的云服务商（你只需要配置 apikey 即可），更多内容请参考官网。</p></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2019 -
2023
凌虚
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>